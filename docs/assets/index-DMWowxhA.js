(function(){const Ee=document.createElement("link").relList;if(Ee&&Ee.supports&&Ee.supports("modulepreload"))return;for(const Ye of document.querySelectorAll('link[rel="modulepreload"]'))fe(Ye);new MutationObserver(Ye=>{for(const _t of Ye)if(_t.type==="childList")for(const O of _t.addedNodes)O.tagName==="LINK"&&O.rel==="modulepreload"&&fe(O)}).observe(document,{childList:!0,subtree:!0});function Ne(Ye){const _t={};return Ye.integrity&&(_t.integrity=Ye.integrity),Ye.referrerPolicy&&(_t.referrerPolicy=Ye.referrerPolicy),Ye.crossOrigin==="use-credentials"?_t.credentials="include":Ye.crossOrigin==="anonymous"?_t.credentials="omit":_t.credentials="same-origin",_t}function fe(Ye){if(Ye.ep)return;Ye.ep=!0;const _t=Ne(Ye);fetch(Ye.href,_t)}})();function gy(te){return te&&te.__esModule&&Object.prototype.hasOwnProperty.call(te,"default")?te.default:te}var Ng={exports:{}},Wp={};var S_;function _y(){if(S_)return Wp;S_=1;var te=Symbol.for("react.transitional.element"),Ee=Symbol.for("react.fragment");function Ne(fe,Ye,_t){var O=null;if(_t!==void 0&&(O=""+_t),Ye.key!==void 0&&(O=""+Ye.key),"key"in Ye){_t={};for(var d in Ye)d!=="key"&&(_t[d]=Ye[d])}else _t=Ye;return Ye=_t.ref,{$$typeof:te,type:fe,key:O,ref:Ye!==void 0?Ye:null,props:_t}}return Wp.Fragment=Ee,Wp.jsx=Ne,Wp.jsxs=Ne,Wp}var M_;function yy(){return M_||(M_=1,Ng.exports=_y()),Ng.exports}var oi=yy(),Vg={exports:{}},ii={};var E_;function vy(){if(E_)return ii;E_=1;var te=Symbol.for("react.transitional.element"),Ee=Symbol.for("react.portal"),Ne=Symbol.for("react.fragment"),fe=Symbol.for("react.strict_mode"),Ye=Symbol.for("react.profiler"),_t=Symbol.for("react.consumer"),O=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),ge=Symbol.for("react.suspense"),Be=Symbol.for("react.memo"),ft=Symbol.for("react.lazy"),ht=Symbol.for("react.activity"),At=Symbol.iterator;function ei(de){return de===null||typeof de!="object"?null:(de=At&&de[At]||de["@@iterator"],typeof de=="function"?de:null)}var tt={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},nt=Object.assign,ve={};function ti(de,Ze,ot){this.props=de,this.context=Ze,this.refs=ve,this.updater=ot||tt}ti.prototype.isReactComponent={},ti.prototype.setState=function(de,Ze){if(typeof de!="object"&&typeof de!="function"&&de!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,de,Ze,"setState")},ti.prototype.forceUpdate=function(de){this.updater.enqueueForceUpdate(this,de,"forceUpdate")};function mt(){}mt.prototype=ti.prototype;function Ft(de,Ze,ot){this.props=de,this.context=Ze,this.refs=ve,this.updater=ot||tt}var Ot=Ft.prototype=new mt;Ot.constructor=Ft,nt(Ot,ti.prototype),Ot.isPureReactComponent=!0;var jn=Array.isArray;function Ht(){}var Ct={H:null,A:null,T:null,S:null},Pi=Object.prototype.hasOwnProperty;function bn(de,Ze,ot){var yt=ot.ref;return{$$typeof:te,type:de,key:Ze,ref:yt!==void 0?yt:null,props:ot}}function Yn(de,Ze){return bn(de.type,Ze,de.props)}function An(de){return typeof de=="object"&&de!==null&&de.$$typeof===te}function Gi(de){var Ze={"=":"=0",":":"=2"};return"$"+de.replace(/[=:]/g,function(ot){return Ze[ot]})}var Cn=/\/+/g;function ma(de,Ze){return typeof de=="object"&&de!==null&&de.key!=null?Gi(""+de.key):Ze.toString(36)}function Hi(de){switch(de.status){case"fulfilled":return de.value;case"rejected":throw de.reason;default:switch(typeof de.status=="string"?de.then(Ht,Ht):(de.status="pending",de.then(function(Ze){de.status==="pending"&&(de.status="fulfilled",de.value=Ze)},function(Ze){de.status==="pending"&&(de.status="rejected",de.reason=Ze)})),de.status){case"fulfilled":return de.value;case"rejected":throw de.reason}}throw de}function je(de,Ze,ot,yt,xt){var zt=typeof de;(zt==="undefined"||zt==="boolean")&&(de=null);var Xt=!1;if(de===null)Xt=!0;else switch(zt){case"bigint":case"string":case"number":Xt=!0;break;case"object":switch(de.$$typeof){case te:case Ee:Xt=!0;break;case ft:return Xt=de._init,je(Xt(de._payload),Ze,ot,yt,xt)}}if(Xt)return xt=xt(de),Xt=yt===""?"."+ma(de,0):yt,jn(xt)?(ot="",Xt!=null&&(ot=Xt.replace(Cn,"$&/")+"/"),je(xt,Ze,ot,"",function(Xi){return Xi})):xt!=null&&(An(xt)&&(xt=Yn(xt,ot+(xt.key==null||de&&de.key===xt.key?"":(""+xt.key).replace(Cn,"$&/")+"/")+Xt)),Ze.push(xt)),1;Xt=0;var ri=yt===""?".":yt+":";if(jn(de))for(var wi=0;wi<de.length;wi++)yt=de[wi],zt=ri+ma(yt,wi),Xt+=je(yt,Ze,ot,zt,xt);else if(wi=ei(de),typeof wi=="function")for(de=wi.call(de),wi=0;!(yt=de.next()).done;)yt=yt.value,zt=ri+ma(yt,wi++),Xt+=je(yt,Ze,ot,zt,xt);else if(zt==="object"){if(typeof de.then=="function")return je(Hi(de),Ze,ot,yt,xt);throw Ze=String(de),Error("Objects are not valid as a React child (found: "+(Ze==="[object Object]"?"object with keys {"+Object.keys(de).join(", ")+"}":Ze)+"). If you meant to render a collection of children, use an array instead.")}return Xt}function it(de,Ze,ot){if(de==null)return de;var yt=[],xt=0;return je(de,yt,"","",function(zt){return Ze.call(ot,zt,xt++)}),yt}function Mt(de){if(de._status===-1){var Ze=de._result;Ze=Ze(),Ze.then(function(ot){(de._status===0||de._status===-1)&&(de._status=1,de._result=ot)},function(ot){(de._status===0||de._status===-1)&&(de._status=2,de._result=ot)}),de._status===-1&&(de._status=0,de._result=Ze)}if(de._status===1)return de._result.default;throw de._result}var St=typeof reportError=="function"?reportError:function(de){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ze=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof de=="object"&&de!==null&&typeof de.message=="string"?String(de.message):String(de),error:de});if(!window.dispatchEvent(Ze))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",de);return}console.error(de)},Wt={map:it,forEach:function(de,Ze,ot){it(de,function(){Ze.apply(this,arguments)},ot)},count:function(de){var Ze=0;return it(de,function(){Ze++}),Ze},toArray:function(de){return it(de,function(Ze){return Ze})||[]},only:function(de){if(!An(de))throw Error("React.Children.only expected to receive a single React element child.");return de}};return ii.Activity=ht,ii.Children=Wt,ii.Component=ti,ii.Fragment=Ne,ii.Profiler=Ye,ii.PureComponent=Ft,ii.StrictMode=fe,ii.Suspense=ge,ii.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ct,ii.__COMPILER_RUNTIME={__proto__:null,c:function(de){return Ct.H.useMemoCache(de)}},ii.cache=function(de){return function(){return de.apply(null,arguments)}},ii.cacheSignal=function(){return null},ii.cloneElement=function(de,Ze,ot){if(de==null)throw Error("The argument must be a React element, but you passed "+de+".");var yt=nt({},de.props),xt=de.key;if(Ze!=null)for(zt in Ze.key!==void 0&&(xt=""+Ze.key),Ze)!Pi.call(Ze,zt)||zt==="key"||zt==="__self"||zt==="__source"||zt==="ref"&&Ze.ref===void 0||(yt[zt]=Ze[zt]);var zt=arguments.length-2;if(zt===1)yt.children=ot;else if(1<zt){for(var Xt=Array(zt),ri=0;ri<zt;ri++)Xt[ri]=arguments[ri+2];yt.children=Xt}return bn(de.type,xt,yt)},ii.createContext=function(de){return de={$$typeof:O,_currentValue:de,_currentValue2:de,_threadCount:0,Provider:null,Consumer:null},de.Provider=de,de.Consumer={$$typeof:_t,_context:de},de},ii.createElement=function(de,Ze,ot){var yt,xt={},zt=null;if(Ze!=null)for(yt in Ze.key!==void 0&&(zt=""+Ze.key),Ze)Pi.call(Ze,yt)&&yt!=="key"&&yt!=="__self"&&yt!=="__source"&&(xt[yt]=Ze[yt]);var Xt=arguments.length-2;if(Xt===1)xt.children=ot;else if(1<Xt){for(var ri=Array(Xt),wi=0;wi<Xt;wi++)ri[wi]=arguments[wi+2];xt.children=ri}if(de&&de.defaultProps)for(yt in Xt=de.defaultProps,Xt)xt[yt]===void 0&&(xt[yt]=Xt[yt]);return bn(de,zt,xt)},ii.createRef=function(){return{current:null}},ii.forwardRef=function(de){return{$$typeof:d,render:de}},ii.isValidElement=An,ii.lazy=function(de){return{$$typeof:ft,_payload:{_status:-1,_result:de},_init:Mt}},ii.memo=function(de,Ze){return{$$typeof:Be,type:de,compare:Ze===void 0?null:Ze}},ii.startTransition=function(de){var Ze=Ct.T,ot={};Ct.T=ot;try{var yt=de(),xt=Ct.S;xt!==null&&xt(ot,yt),typeof yt=="object"&&yt!==null&&typeof yt.then=="function"&&yt.then(Ht,St)}catch(zt){St(zt)}finally{Ze!==null&&ot.types!==null&&(Ze.types=ot.types),Ct.T=Ze}},ii.unstable_useCacheRefresh=function(){return Ct.H.useCacheRefresh()},ii.use=function(de){return Ct.H.use(de)},ii.useActionState=function(de,Ze,ot){return Ct.H.useActionState(de,Ze,ot)},ii.useCallback=function(de,Ze){return Ct.H.useCallback(de,Ze)},ii.useContext=function(de){return Ct.H.useContext(de)},ii.useDebugValue=function(){},ii.useDeferredValue=function(de,Ze){return Ct.H.useDeferredValue(de,Ze)},ii.useEffect=function(de,Ze){return Ct.H.useEffect(de,Ze)},ii.useEffectEvent=function(de){return Ct.H.useEffectEvent(de)},ii.useId=function(){return Ct.H.useId()},ii.useImperativeHandle=function(de,Ze,ot){return Ct.H.useImperativeHandle(de,Ze,ot)},ii.useInsertionEffect=function(de,Ze){return Ct.H.useInsertionEffect(de,Ze)},ii.useLayoutEffect=function(de,Ze){return Ct.H.useLayoutEffect(de,Ze)},ii.useMemo=function(de,Ze){return Ct.H.useMemo(de,Ze)},ii.useOptimistic=function(de,Ze){return Ct.H.useOptimistic(de,Ze)},ii.useReducer=function(de,Ze,ot){return Ct.H.useReducer(de,Ze,ot)},ii.useRef=function(de){return Ct.H.useRef(de)},ii.useState=function(de){return Ct.H.useState(de)},ii.useSyncExternalStore=function(de,Ze,ot){return Ct.H.useSyncExternalStore(de,Ze,ot)},ii.useTransition=function(){return Ct.H.useTransition()},ii.version="19.2.3",ii}var A_;function s_(){return A_||(A_=1,Vg.exports=vy()),Vg.exports}var Lt=s_(),jg={exports:{}},Kp={},Ug={exports:{}},Gg={};var C_;function xy(){return C_||(C_=1,(function(te){function Ee(je,it){var Mt=je.length;je.push(it);e:for(;0<Mt;){var St=Mt-1>>>1,Wt=je[St];if(0<Ye(Wt,it))je[St]=it,je[Mt]=Wt,Mt=St;else break e}}function Ne(je){return je.length===0?null:je[0]}function fe(je){if(je.length===0)return null;var it=je[0],Mt=je.pop();if(Mt!==it){je[0]=Mt;e:for(var St=0,Wt=je.length,de=Wt>>>1;St<de;){var Ze=2*(St+1)-1,ot=je[Ze],yt=Ze+1,xt=je[yt];if(0>Ye(ot,Mt))yt<Wt&&0>Ye(xt,ot)?(je[St]=xt,je[yt]=Mt,St=yt):(je[St]=ot,je[Ze]=Mt,St=Ze);else if(yt<Wt&&0>Ye(xt,Mt))je[St]=xt,je[yt]=Mt,St=yt;else break e}}return it}function Ye(je,it){var Mt=je.sortIndex-it.sortIndex;return Mt!==0?Mt:je.id-it.id}if(te.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var _t=performance;te.unstable_now=function(){return _t.now()}}else{var O=Date,d=O.now();te.unstable_now=function(){return O.now()-d}}var ge=[],Be=[],ft=1,ht=null,At=3,ei=!1,tt=!1,nt=!1,ve=!1,ti=typeof setTimeout=="function"?setTimeout:null,mt=typeof clearTimeout=="function"?clearTimeout:null,Ft=typeof setImmediate<"u"?setImmediate:null;function Ot(je){for(var it=Ne(Be);it!==null;){if(it.callback===null)fe(Be);else if(it.startTime<=je)fe(Be),it.sortIndex=it.expirationTime,Ee(ge,it);else break;it=Ne(Be)}}function jn(je){if(nt=!1,Ot(je),!tt)if(Ne(ge)!==null)tt=!0,Ht||(Ht=!0,Gi());else{var it=Ne(Be);it!==null&&Hi(jn,it.startTime-je)}}var Ht=!1,Ct=-1,Pi=5,bn=-1;function Yn(){return ve?!0:!(te.unstable_now()-bn<Pi)}function An(){if(ve=!1,Ht){var je=te.unstable_now();bn=je;var it=!0;try{e:{tt=!1,nt&&(nt=!1,mt(Ct),Ct=-1),ei=!0;var Mt=At;try{t:{for(Ot(je),ht=Ne(ge);ht!==null&&!(ht.expirationTime>je&&Yn());){var St=ht.callback;if(typeof St=="function"){ht.callback=null,At=ht.priorityLevel;var Wt=St(ht.expirationTime<=je);if(je=te.unstable_now(),typeof Wt=="function"){ht.callback=Wt,Ot(je),it=!0;break t}ht===Ne(ge)&&fe(ge),Ot(je)}else fe(ge);ht=Ne(ge)}if(ht!==null)it=!0;else{var de=Ne(Be);de!==null&&Hi(jn,de.startTime-je),it=!1}}break e}finally{ht=null,At=Mt,ei=!1}it=void 0}}finally{it?Gi():Ht=!1}}}var Gi;if(typeof Ft=="function")Gi=function(){Ft(An)};else if(typeof MessageChannel<"u"){var Cn=new MessageChannel,ma=Cn.port2;Cn.port1.onmessage=An,Gi=function(){ma.postMessage(null)}}else Gi=function(){ti(An,0)};function Hi(je,it){Ct=ti(function(){je(te.unstable_now())},it)}te.unstable_IdlePriority=5,te.unstable_ImmediatePriority=1,te.unstable_LowPriority=4,te.unstable_NormalPriority=3,te.unstable_Profiling=null,te.unstable_UserBlockingPriority=2,te.unstable_cancelCallback=function(je){je.callback=null},te.unstable_forceFrameRate=function(je){0>je||125<je?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Pi=0<je?Math.floor(1e3/je):5},te.unstable_getCurrentPriorityLevel=function(){return At},te.unstable_next=function(je){switch(At){case 1:case 2:case 3:var it=3;break;default:it=At}var Mt=At;At=it;try{return je()}finally{At=Mt}},te.unstable_requestPaint=function(){ve=!0},te.unstable_runWithPriority=function(je,it){switch(je){case 1:case 2:case 3:case 4:case 5:break;default:je=3}var Mt=At;At=je;try{return it()}finally{At=Mt}},te.unstable_scheduleCallback=function(je,it,Mt){var St=te.unstable_now();switch(typeof Mt=="object"&&Mt!==null?(Mt=Mt.delay,Mt=typeof Mt=="number"&&0<Mt?St+Mt:St):Mt=St,je){case 1:var Wt=-1;break;case 2:Wt=250;break;case 5:Wt=1073741823;break;case 4:Wt=1e4;break;default:Wt=5e3}return Wt=Mt+Wt,je={id:ft++,callback:it,priorityLevel:je,startTime:Mt,expirationTime:Wt,sortIndex:-1},Mt>St?(je.sortIndex=Mt,Ee(Be,je),Ne(ge)===null&&je===Ne(Be)&&(nt?(mt(Ct),Ct=-1):nt=!0,Hi(jn,Mt-St))):(je.sortIndex=Wt,Ee(ge,je),tt||ei||(tt=!0,Ht||(Ht=!0,Gi()))),je},te.unstable_shouldYield=Yn,te.unstable_wrapCallback=function(je){var it=At;return function(){var Mt=At;At=it;try{return je.apply(this,arguments)}finally{At=Mt}}}})(Gg)),Gg}var z_;function by(){return z_||(z_=1,Ug.exports=xy()),Ug.exports}var qg={exports:{}},Lr={};var D_;function wy(){if(D_)return Lr;D_=1;var te=s_();function Ee(ge){var Be="https://react.dev/errors/"+ge;if(1<arguments.length){Be+="?args[]="+encodeURIComponent(arguments[1]);for(var ft=2;ft<arguments.length;ft++)Be+="&args[]="+encodeURIComponent(arguments[ft])}return"Minified React error #"+ge+"; visit "+Be+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Ne(){}var fe={d:{f:Ne,r:function(){throw Error(Ee(522))},D:Ne,C:Ne,L:Ne,m:Ne,X:Ne,S:Ne,M:Ne},p:0,findDOMNode:null},Ye=Symbol.for("react.portal");function _t(ge,Be,ft){var ht=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ye,key:ht==null?null:""+ht,children:ge,containerInfo:Be,implementation:ft}}var O=te.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(ge,Be){if(ge==="font")return"";if(typeof Be=="string")return Be==="use-credentials"?Be:""}return Lr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=fe,Lr.createPortal=function(ge,Be){var ft=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Be||Be.nodeType!==1&&Be.nodeType!==9&&Be.nodeType!==11)throw Error(Ee(299));return _t(ge,Be,null,ft)},Lr.flushSync=function(ge){var Be=O.T,ft=fe.p;try{if(O.T=null,fe.p=2,ge)return ge()}finally{O.T=Be,fe.p=ft,fe.d.f()}},Lr.preconnect=function(ge,Be){typeof ge=="string"&&(Be?(Be=Be.crossOrigin,Be=typeof Be=="string"?Be==="use-credentials"?Be:"":void 0):Be=null,fe.d.C(ge,Be))},Lr.prefetchDNS=function(ge){typeof ge=="string"&&fe.d.D(ge)},Lr.preinit=function(ge,Be){if(typeof ge=="string"&&Be&&typeof Be.as=="string"){var ft=Be.as,ht=d(ft,Be.crossOrigin),At=typeof Be.integrity=="string"?Be.integrity:void 0,ei=typeof Be.fetchPriority=="string"?Be.fetchPriority:void 0;ft==="style"?fe.d.S(ge,typeof Be.precedence=="string"?Be.precedence:void 0,{crossOrigin:ht,integrity:At,fetchPriority:ei}):ft==="script"&&fe.d.X(ge,{crossOrigin:ht,integrity:At,fetchPriority:ei,nonce:typeof Be.nonce=="string"?Be.nonce:void 0})}},Lr.preinitModule=function(ge,Be){if(typeof ge=="string")if(typeof Be=="object"&&Be!==null){if(Be.as==null||Be.as==="script"){var ft=d(Be.as,Be.crossOrigin);fe.d.M(ge,{crossOrigin:ft,integrity:typeof Be.integrity=="string"?Be.integrity:void 0,nonce:typeof Be.nonce=="string"?Be.nonce:void 0})}}else Be==null&&fe.d.M(ge)},Lr.preload=function(ge,Be){if(typeof ge=="string"&&typeof Be=="object"&&Be!==null&&typeof Be.as=="string"){var ft=Be.as,ht=d(ft,Be.crossOrigin);fe.d.L(ge,ft,{crossOrigin:ht,integrity:typeof Be.integrity=="string"?Be.integrity:void 0,nonce:typeof Be.nonce=="string"?Be.nonce:void 0,type:typeof Be.type=="string"?Be.type:void 0,fetchPriority:typeof Be.fetchPriority=="string"?Be.fetchPriority:void 0,referrerPolicy:typeof Be.referrerPolicy=="string"?Be.referrerPolicy:void 0,imageSrcSet:typeof Be.imageSrcSet=="string"?Be.imageSrcSet:void 0,imageSizes:typeof Be.imageSizes=="string"?Be.imageSizes:void 0,media:typeof Be.media=="string"?Be.media:void 0})}},Lr.preloadModule=function(ge,Be){if(typeof ge=="string")if(Be){var ft=d(Be.as,Be.crossOrigin);fe.d.m(ge,{as:typeof Be.as=="string"&&Be.as!=="script"?Be.as:void 0,crossOrigin:ft,integrity:typeof Be.integrity=="string"?Be.integrity:void 0})}else fe.d.m(ge)},Lr.requestFormReset=function(ge){fe.d.r(ge)},Lr.unstable_batchedUpdates=function(ge,Be){return ge(Be)},Lr.useFormState=function(ge,Be,ft){return O.H.useFormState(ge,Be,ft)},Lr.useFormStatus=function(){return O.H.useHostTransitionStatus()},Lr.version="19.2.3",Lr}var P_;function Ty(){if(P_)return qg.exports;P_=1;function te(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(te)}catch(Ee){console.error(Ee)}}return te(),qg.exports=wy(),qg.exports}var I_;function Sy(){if(I_)return Kp;I_=1;var te=by(),Ee=s_(),Ne=Ty();function fe(a){var s="https://react.dev/errors/"+a;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+a+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Ye(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function _t(a){var s=a,c=a;if(a.alternate)for(;s.return;)s=s.return;else{a=s;do s=a,(s.flags&4098)!==0&&(c=s.return),a=s.return;while(a)}return s.tag===3?c:null}function O(a){if(a.tag===13){var s=a.memoizedState;if(s===null&&(a=a.alternate,a!==null&&(s=a.memoizedState)),s!==null)return s.dehydrated}return null}function d(a){if(a.tag===31){var s=a.memoizedState;if(s===null&&(a=a.alternate,a!==null&&(s=a.memoizedState)),s!==null)return s.dehydrated}return null}function ge(a){if(_t(a)!==a)throw Error(fe(188))}function Be(a){var s=a.alternate;if(!s){if(s=_t(a),s===null)throw Error(fe(188));return s!==a?null:a}for(var c=a,g=s;;){var w=c.return;if(w===null)break;var M=w.alternate;if(M===null){if(g=w.return,g!==null){c=g;continue}break}if(w.child===M.child){for(M=w.child;M;){if(M===c)return ge(w),a;if(M===g)return ge(w),s;M=M.sibling}throw Error(fe(188))}if(c.return!==g.return)c=w,g=M;else{for(var L=!1,Z=w.child;Z;){if(Z===c){L=!0,c=w,g=M;break}if(Z===g){L=!0,g=w,c=M;break}Z=Z.sibling}if(!L){for(Z=M.child;Z;){if(Z===c){L=!0,c=M,g=w;break}if(Z===g){L=!0,g=M,c=w;break}Z=Z.sibling}if(!L)throw Error(fe(189))}}if(c.alternate!==g)throw Error(fe(190))}if(c.tag!==3)throw Error(fe(188));return c.stateNode.current===c?a:s}function ft(a){var s=a.tag;if(s===5||s===26||s===27||s===6)return a;for(a=a.child;a!==null;){if(s=ft(a),s!==null)return s;a=a.sibling}return null}var ht=Object.assign,At=Symbol.for("react.element"),ei=Symbol.for("react.transitional.element"),tt=Symbol.for("react.portal"),nt=Symbol.for("react.fragment"),ve=Symbol.for("react.strict_mode"),ti=Symbol.for("react.profiler"),mt=Symbol.for("react.consumer"),Ft=Symbol.for("react.context"),Ot=Symbol.for("react.forward_ref"),jn=Symbol.for("react.suspense"),Ht=Symbol.for("react.suspense_list"),Ct=Symbol.for("react.memo"),Pi=Symbol.for("react.lazy"),bn=Symbol.for("react.activity"),Yn=Symbol.for("react.memo_cache_sentinel"),An=Symbol.iterator;function Gi(a){return a===null||typeof a!="object"?null:(a=An&&a[An]||a["@@iterator"],typeof a=="function"?a:null)}var Cn=Symbol.for("react.client.reference");function ma(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===Cn?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case nt:return"Fragment";case ti:return"Profiler";case ve:return"StrictMode";case jn:return"Suspense";case Ht:return"SuspenseList";case bn:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case tt:return"Portal";case Ft:return a.displayName||"Context";case mt:return(a._context.displayName||"Context")+".Consumer";case Ot:var s=a.render;return a=a.displayName,a||(a=s.displayName||s.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case Ct:return s=a.displayName||null,s!==null?s:ma(a.type)||"Memo";case Pi:s=a._payload,a=a._init;try{return ma(a(s))}catch{}}return null}var Hi=Array.isArray,je=Ee.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,it=Ne.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Mt={pending:!1,data:null,method:null,action:null},St=[],Wt=-1;function de(a){return{current:a}}function Ze(a){0>Wt||(a.current=St[Wt],St[Wt]=null,Wt--)}function ot(a,s){Wt++,St[Wt]=a.current,a.current=s}var yt=de(null),xt=de(null),zt=de(null),Xt=de(null);function ri(a,s){switch(ot(zt,s),ot(xt,a),ot(yt,null),s.nodeType){case 9:case 11:a=(a=s.documentElement)&&(a=a.namespaceURI)?eu(a):0;break;default:if(a=s.tagName,s=s.namespaceURI)s=eu(s),a=Ap(s,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Ze(yt),ot(yt,a)}function wi(){Ze(yt),Ze(xt),Ze(zt)}function Xi(a){a.memoizedState!==null&&ot(Xt,a);var s=yt.current,c=Ap(s,a.type);s!==c&&(ot(xt,a),ot(yt,c))}function Un(a){xt.current===a&&(Ze(yt),Ze(xt)),Xt.current===a&&(Ze(Xt),rh._currentValue=Mt)}var ga,Ya;function Ii(a){if(ga===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);ga=s&&s[1]||"",Ya=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ga+a+Ya}var Qn=!1;function La(a,s){if(!a||Qn)return"";Qn=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(s){var $e=function(){throw Error()};if(Object.defineProperty($e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct($e,[])}catch(ke){var Le=ke}Reflect.construct(a,[],$e)}else{try{$e.call()}catch(ke){Le=ke}a.call($e.prototype)}}else{try{throw Error()}catch(ke){Le=ke}($e=a())&&typeof $e.catch=="function"&&$e.catch(function(){})}}catch(ke){if(ke&&Le&&typeof ke.stack=="string")return[ke.stack,Le.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var w=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");w&&w.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var M=g.DetermineComponentFrameRoot(),L=M[0],Z=M[1];if(L&&Z){var ce=L.split(`
`),Re=Z.split(`
`);for(w=g=0;g<ce.length&&!ce[g].includes("DetermineComponentFrameRoot");)g++;for(;w<Re.length&&!Re[w].includes("DetermineComponentFrameRoot");)w++;if(g===ce.length||w===Re.length)for(g=ce.length-1,w=Re.length-1;1<=g&&0<=w&&ce[g]!==Re[w];)w--;for(;1<=g&&0<=w;g--,w--)if(ce[g]!==Re[w]){if(g!==1||w!==1)do if(g--,w--,0>w||ce[g]!==Re[w]){var Ue=`
`+ce[g].replace(" at new "," at ");return a.displayName&&Ue.includes("<anonymous>")&&(Ue=Ue.replace("<anonymous>",a.displayName)),Ue}while(1<=g&&0<=w);break}}}finally{Qn=!1,Error.prepareStackTrace=c}return(c=a?a.displayName||a.name:"")?Ii(c):""}function $i(a,s){switch(a.tag){case 26:case 27:case 5:return Ii(a.type);case 16:return Ii("Lazy");case 13:return a.child!==s&&s!==null?Ii("Suspense Fallback"):Ii("Suspense");case 19:return Ii("SuspenseList");case 0:case 15:return La(a.type,!1);case 11:return La(a.type.render,!1);case 1:return La(a.type,!0);case 31:return Ii("Activity");default:return""}}function Qa(a){try{var s="",c=null;do s+=$i(a,c),c=a,a=a.return;while(a);return s}catch(g){return`
Error generating stack: `+g.message+`
`+g.stack}}var Br=Object.prototype.hasOwnProperty,es=te.unstable_scheduleCallback,Gn=te.unstable_cancelCallback,Ba=te.unstable_shouldYield,Wa=te.unstable_requestPaint,On=te.unstable_now,ua=te.unstable_getCurrentPriorityLevel,ye=te.unstable_ImmediatePriority,j=te.unstable_UserBlockingPriority,V=te.unstable_NormalPriority,H=te.unstable_LowPriority,oe=te.unstable_IdlePriority,ue=te.log,Me=te.unstable_setDisableYieldValue,_e=null,W=null;function he(a){if(typeof ue=="function"&&Me(a),W&&typeof W.setStrictMode=="function")try{W.setStrictMode(_e,a)}catch{}}var we=Math.clz32?Math.clz32:pt,Ie=Math.log,et=Math.LN2;function pt(a){return a>>>=0,a===0?32:31-(Ie(a)/et|0)|0}var Et=256,li=262144,$t=4194304;function be(a){var s=a&42;if(s!==0)return s;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function fi(a,s,c){var g=a.pendingLanes;if(g===0)return 0;var w=0,M=a.suspendedLanes,L=a.pingedLanes;a=a.warmLanes;var Z=g&134217727;return Z!==0?(g=Z&~M,g!==0?w=be(g):(L&=Z,L!==0?w=be(L):c||(c=Z&~a,c!==0&&(w=be(c))))):(Z=g&~M,Z!==0?w=be(Z):L!==0?w=be(L):c||(c=g&~a,c!==0&&(w=be(c)))),w===0?0:s!==0&&s!==w&&(s&M)===0&&(M=w&-w,c=s&-s,M>=c||M===32&&(c&4194048)!==0)?s:w}function Ki(a,s){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&s)===0}function Pt(a,s){switch(a){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ni(){var a=$t;return $t<<=1,($t&62914560)===0&&($t=4194304),a}function Vi(a){for(var s=[],c=0;31>c;c++)s.push(a);return s}function Nt(a,s){a.pendingLanes|=s,s!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Ji(a,s,c,g,w,M){var L=a.pendingLanes;a.pendingLanes=c,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=c,a.entangledLanes&=c,a.errorRecoveryDisabledLanes&=c,a.shellSuspendCounter=0;var Z=a.entanglements,ce=a.expirationTimes,Re=a.hiddenUpdates;for(c=L&~c;0<c;){var Ue=31-we(c),$e=1<<Ue;Z[Ue]=0,ce[Ue]=-1;var Le=Re[Ue];if(Le!==null)for(Re[Ue]=null,Ue=0;Ue<Le.length;Ue++){var ke=Le[Ue];ke!==null&&(ke.lane&=-536870913)}c&=~$e}g!==0&&Ri(a,g,0),M!==0&&w===0&&a.tag!==0&&(a.suspendedLanes|=M&~(L&~s))}function Ri(a,s,c){a.pendingLanes|=s,a.suspendedLanes&=~s;var g=31-we(s);a.entangledLanes|=s,a.entanglements[g]=a.entanglements[g]|1073741824|c&261930}function zn(a,s){var c=a.entangledLanes|=s;for(a=a.entanglements;c;){var g=31-we(c),w=1<<g;w&s|a[g]&s&&(a[g]|=s),c&=~w}}function bl(a,s){var c=s&-s;return c=(c&42)!==0?1:Do(c),(c&(a.suspendedLanes|s))!==0?0:c}function Do(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Qe(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function _a(){var a=it.p;return a!==0?a:(a=window.event,a===void 0?32:rc(a.type))}function ya(a,s){var c=it.p;try{return it.p=a,s()}finally{it.p=c}}var Or=Math.random().toString(36).slice(2),ji="__reactFiber$"+Or,Je="__reactProps$"+Or,jt="__reactContainer$"+Or,Zt="__reactEvents$"+Or,Ka="__reactListeners$"+Or,cc="__reactHandles$"+Or,ts="__reactResources$"+Or,Vt="__reactMarker$"+Or;function Po(a){delete a[ji],delete a[Je],delete a[Zt],delete a[Ka],delete a[cc]}function is(a){var s=a[ji];if(s)return s;for(var c=a.parentNode;c;){if(s=c[jt]||c[ji]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(a=tf(a);a!==null;){if(c=a[ji])return c;a=tf(a)}return s}a=c,c=a.parentNode}return null}function zs(a){if(a=a[ji]||a[jt]){var s=a.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return a}return null}function ns(a){var s=a.tag;if(s===5||s===26||s===27||s===6)return a.stateNode;throw Error(fe(33))}function as(a){var s=a[ts];return s||(s=a[ts]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function fn(a){a[Vt]=!0}var wl=new Set,va={};function ui(a,s){Ds(a,s),Ds(a+"Capture",s)}function Ds(a,s){for(va[a]=s,a=0;a<s.length;a++)wl.add(s[a])}var Tl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Sl={},Js={};function kr(a){return Br.call(Js,a)?!0:Br.call(Sl,a)?!1:Tl.test(a)?Js[a]=!0:(Sl[a]=!0,!1)}function cu(a,s,c){if(kr(s))if(c===null)a.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":a.removeAttribute(s);return;case"boolean":var g=s.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){a.removeAttribute(s);return}}a.setAttribute(s,""+c)}}function rs(a,s,c){if(c===null)a.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(s);return}a.setAttribute(s,""+c)}}function mr(a,s,c,g){if(g===null)a.removeAttribute(c);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttributeNS(s,c,""+g)}}function gi(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function uh(a){var s=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function wf(a,s,c){var g=Object.getOwnPropertyDescriptor(a.constructor.prototype,s);if(!a.hasOwnProperty(s)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var w=g.get,M=g.set;return Object.defineProperty(a,s,{configurable:!0,get:function(){return w.call(this)},set:function(L){c=""+L,M.call(this,L)}}),Object.defineProperty(a,s,{enumerable:g.enumerable}),{getValue:function(){return c},setValue:function(L){c=""+L},stopTracking:function(){a._valueTracker=null,delete a[s]}}}}function Io(a){if(!a._valueTracker){var s=uh(a)?"checked":"value";a._valueTracker=wf(a,s,""+a[s])}}function ch(a){if(!a)return!1;var s=a._valueTracker;if(!s)return!0;var c=s.getValue(),g="";return a&&(g=uh(a)?a.checked?"true":"false":a.value),a=g,a!==c?(s.setValue(a),!0):!1}function hu(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Tf=/[\n"\\]/g;function Ea(a){return a.replace(Tf,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function fu(a,s,c,g,w,M,L,Z){a.name="",L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"?a.type=L:a.removeAttribute("type"),s!=null?L==="number"?(s===0&&a.value===""||a.value!=s)&&(a.value=""+gi(s)):a.value!==""+gi(s)&&(a.value=""+gi(s)):L!=="submit"&&L!=="reset"||a.removeAttribute("value"),s!=null?du(a,L,gi(s)):c!=null?du(a,L,gi(c)):g!=null&&a.removeAttribute("value"),w==null&&M!=null&&(a.defaultChecked=!!M),w!=null&&(a.checked=w&&typeof w!="function"&&typeof w!="symbol"),Z!=null&&typeof Z!="function"&&typeof Z!="symbol"&&typeof Z!="boolean"?a.name=""+gi(Z):a.removeAttribute("name")}function hc(a,s,c,g,w,M,L,Z){if(M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(a.type=M),s!=null||c!=null){if(!(M!=="submit"&&M!=="reset"||s!=null)){Io(a);return}c=c!=null?""+gi(c):"",s=s!=null?""+gi(s):c,Z||s===a.value||(a.value=s),a.defaultValue=s}g=g??w,g=typeof g!="function"&&typeof g!="symbol"&&!!g,a.checked=Z?a.checked:!!g,a.defaultChecked=!!g,L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(a.name=L),Io(a)}function du(a,s,c){s==="number"&&hu(a.ownerDocument)===a||a.defaultValue===""+c||(a.defaultValue=""+c)}function eo(a,s,c,g){if(a=a.options,s){s={};for(var w=0;w<c.length;w++)s["$"+c[w]]=!0;for(c=0;c<a.length;c++)w=s.hasOwnProperty("$"+a[c].value),a[c].selected!==w&&(a[c].selected=w),w&&g&&(a[c].defaultSelected=!0)}else{for(c=""+gi(c),s=null,w=0;w<a.length;w++){if(a[w].value===c){a[w].selected=!0,g&&(a[w].defaultSelected=!0);return}s!==null||a[w].disabled||(s=a[w])}s!==null&&(s.selected=!0)}}function Sf(a,s,c){if(s!=null&&(s=""+gi(s),s!==a.value&&(a.value=s),c==null)){a.defaultValue!==s&&(a.defaultValue=s);return}a.defaultValue=c!=null?""+gi(c):""}function Ml(a,s,c,g){if(s==null){if(g!=null){if(c!=null)throw Error(fe(92));if(Hi(g)){if(1<g.length)throw Error(fe(93));g=g[0]}c=g}c==null&&(c=""),s=c}c=gi(s),a.defaultValue=c,g=a.textContent,g===c&&g!==""&&g!==null&&(a.value=g),Io(a)}function Ps(a,s){if(s){var c=a.firstChild;if(c&&c===a.lastChild&&c.nodeType===3){c.nodeValue=s;return}}a.textContent=s}var Mf=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ro(a,s,c){var g=s.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?g?a.setProperty(s,""):s==="float"?a.cssFloat="":a[s]="":g?a.setProperty(s,c):typeof c!="number"||c===0||Mf.has(s)?s==="float"?a.cssFloat=c:a[s]=(""+c).trim():a[s]=c+"px"}function fc(a,s,c){if(s!=null&&typeof s!="object")throw Error(fe(62));if(a=a.style,c!=null){for(var g in c)!c.hasOwnProperty(g)||s!=null&&s.hasOwnProperty(g)||(g.indexOf("--")===0?a.setProperty(g,""):g==="float"?a.cssFloat="":a[g]="");for(var w in s)g=s[w],s.hasOwnProperty(w)&&c[w]!==g&&Ro(a,w,g)}else for(var M in s)s.hasOwnProperty(M)&&Ro(a,M,s[M])}function Lo(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var to=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),El=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function qt(a){return El.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function Fr(){}var hh=null;function pu(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var qn=null,Dn=null;function en(a){var s=zs(a);if(s&&(a=s.stateNode)){var c=a[Je]||null;e:switch(a=s.stateNode,s.type){case"input":if(fu(a,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),s=c.name,c.type==="radio"&&s!=null){for(c=a;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+Ea(""+s)+'"][type="radio"]'),s=0;s<c.length;s++){var g=c[s];if(g!==a&&g.form===a.form){var w=g[Je]||null;if(!w)throw Error(fe(90));fu(g,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name)}}for(s=0;s<c.length;s++)g=c[s],g.form===a.form&&ch(g)}break e;case"textarea":Sf(a,c.value,c.defaultValue);break e;case"select":s=c.value,s!=null&&eo(a,!!c.multiple,s,!1)}}}var It=!1;function Li(a,s,c){if(It)return a(s,c);It=!0;try{var g=a(s);return g}finally{if(It=!1,(qn!==null||Dn!==null)&&(Xh(),qn&&(s=qn,a=Dn,Dn=qn=null,en(s),a)))for(s=0;s<a.length;s++)en(a[s])}}function gr(a,s){var c=a.stateNode;if(c===null)return null;var g=c[Je]||null;if(g===null)return null;c=g[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(a=a.type,g=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!g;break e;default:a=!1}if(a)return null;if(c&&typeof c!="function")throw Error(fe(231,s,typeof c));return c}var dn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Aa=!1;if(dn)try{var Zn={};Object.defineProperty(Zn,"passive",{get:function(){Aa=!0}}),window.addEventListener("test",Zn,Zn),window.removeEventListener("test",Zn,Zn)}catch{Aa=!1}var Ja=null,ss=null,tn=null;function io(){if(tn)return tn;var a,s=ss,c=s.length,g,w="value"in Ja?Ja.value:Ja.textContent,M=w.length;for(a=0;a<c&&s[a]===w[a];a++);var L=c-a;for(g=1;g<=L&&s[c-g]===w[M-g];g++);return tn=w.slice(a,1<g?1-g:void 0)}function er(a){var s=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&s===13&&(a=13)):a=s,a===10&&(a=13),32<=a||a===13?a:0}function Bo(){return!0}function Ca(){return!1}function kn(a){function s(c,g,w,M,L){this._reactName=c,this._targetInst=w,this.type=g,this.nativeEvent=M,this.target=L,this.currentTarget=null;for(var Z in a)a.hasOwnProperty(Z)&&(c=a[Z],this[Z]=c?c(M):M[Z]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?Bo:Ca,this.isPropagationStopped=Ca,this}return ht(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Bo)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Bo)},persist:function(){},isPersistent:Bo}),s}var za={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},mu=kn(za),Oo=ht({},za,{view:0,detail:0}),ko=kn(Oo),Ei,no,Kt,Ut=ht({},Oo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yu,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Kt&&(Kt&&a.type==="mousemove"?(Ei=a.screenX-Kt.screenX,no=a.screenY-Kt.screenY):no=Ei=0,Kt=a),Ei)},movementY:function(a){return"movementY"in a?a.movementY:no}}),Fo=kn(Ut),ci=ht({},Ut,{dataTransfer:0}),gu=kn(ci),_r=ht({},Oo,{relatedTarget:0}),ao=kn(_r),ro=ht({},za,{animationName:0,elapsedTime:0,pseudoElement:0}),Ef=kn(ro),_u=ht({},za,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),fh=kn(_u),Zd=ht({},za,{data:0}),dh=kn(Zd),Da={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},os={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function No(a){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(a):(a=nn[a])?!!s[a]:!1}function yu(){return No}var vu=ht({},Oo,{key:function(a){if(a.key){var s=Da[a.key]||a.key;if(s!=="Unidentified")return s}return a.type==="keypress"?(a=er(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?os[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yu,charCode:function(a){return a.type==="keypress"?er(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?er(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),pn=kn(vu),Af=ht({},Ut,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dc=kn(Af),Cf=ht({},Oo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yu}),Hd=kn(Cf),Al=ht({},za,{propertyName:0,elapsedTime:0,pseudoElement:0}),pc=kn(Al),Cl=ht({},Ut,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),ph=kn(Cl),xu=ht({},za,{newState:0,oldState:0}),zl=kn(xu),Dl=[9,13,27,32],wn=dn&&"CompositionEvent"in window,Pl=null;dn&&"documentMode"in document&&(Pl=document.documentMode);var Il=dn&&"TextEvent"in window&&!Pl,Rl=dn&&(!wn||Pl&&8<Pl&&11>=Pl),so=" ",zf=!1;function bu(a,s){switch(a){case"keyup":return Dl.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Df(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Nr=!1;function mc(a,s){switch(a){case"compositionend":return Df(s);case"keypress":return s.which!==32?null:(zf=!0,so);case"textInput":return a=s.data,a===so&&zf?null:a;default:return null}}function Pf(a,s){if(Nr)return a==="compositionend"||!wn&&bu(a,s)?(a=io(),tn=ss=Ja=null,Nr=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Rl&&s.locale!=="ko"?null:s.data;default:return null}}var If={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gc(a){var s=a&&a.nodeName&&a.nodeName.toLowerCase();return s==="input"?!!If[a.type]:s==="textarea"}function _c(a,s,c,g){qn?Dn?Dn.push(g):Dn=[g]:qn=g,s=Wh(s,"onChange"),0<s.length&&(c=new mu("onChange","change",null,c,g),a.push({event:c,listeners:s}))}var Vo=null,Ll=null;function Rf(a){km(a,0)}function wu(a){var s=ns(a);if(ch(s))return a}function oo(a,s){if(a==="change")return s}var mh=!1;if(dn){var Tu;if(dn){var lo="oninput"in document;if(!lo){var gh=document.createElement("div");gh.setAttribute("oninput","return;"),lo=typeof gh.oninput=="function"}Tu=lo}else Tu=!1;mh=Tu&&(!document.documentMode||9<document.documentMode)}function Su(){Vo&&(Vo.detachEvent("onpropertychange",Lf),Ll=Vo=null)}function Lf(a){if(a.propertyName==="value"&&wu(Ll)){var s=[];_c(s,Ll,a,pu(a)),Li(Rf,s)}}function Xd(a,s,c){a==="focusin"?(Su(),Vo=s,Ll=c,Vo.attachEvent("onpropertychange",Lf)):a==="focusout"&&Su()}function Bf(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return wu(Ll)}function Mu(a,s){if(a==="click")return wu(s)}function Of(a,s){if(a==="input"||a==="change")return wu(s)}function _h(a,s){return a===s&&(a!==0||1/a===1/s)||a!==a&&s!==s}var Oa=typeof Object.is=="function"?Object.is:_h;function uo(a,s){if(Oa(a,s))return!0;if(typeof a!="object"||a===null||typeof s!="object"||s===null)return!1;var c=Object.keys(a),g=Object.keys(s);if(c.length!==g.length)return!1;for(g=0;g<c.length;g++){var w=c[g];if(!Br.call(s,w)||!Oa(a[w],s[w]))return!1}return!0}function yr(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Eu(a,s){var c=yr(a);a=0;for(var g;c;){if(c.nodeType===3){if(g=a+c.textContent.length,a<=s&&g>=s)return{node:c,offset:s-a};a=g}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=yr(c)}}function yc(a,s){return a&&s?a===s?!0:a&&a.nodeType===3?!1:s&&s.nodeType===3?yc(a,s.parentNode):"contains"in a?a.contains(s):a.compareDocumentPosition?!!(a.compareDocumentPosition(s)&16):!1:!1}function vc(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var s=hu(a.document);s instanceof a.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)a=s.contentWindow;else break;s=hu(a.document)}return s}function Au(a){var s=a&&a.nodeName&&a.nodeName.toLowerCase();return s&&(s==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||s==="textarea"||a.contentEditable==="true")}var xc=dn&&"documentMode"in document&&11>=document.documentMode,vr=null,Cu=null,zu=null,bc=!1;function kf(a,s,c){var g=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;bc||vr==null||vr!==hu(g)||(g=vr,"selectionStart"in g&&Au(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),zu&&uo(zu,g)||(zu=g,g=Wh(Cu,"onSelect"),0<g.length&&(s=new mu("onSelect","select",null,s,c),a.push({event:s,listeners:g}),s.target=vr)))}function jo(a,s){var c={};return c[a.toLowerCase()]=s.toLowerCase(),c["Webkit"+a]="webkit"+s,c["Moz"+a]="moz"+s,c}var Uo={animationend:jo("Animation","AnimationEnd"),animationiteration:jo("Animation","AnimationIteration"),animationstart:jo("Animation","AnimationStart"),transitionrun:jo("Transition","TransitionRun"),transitionstart:jo("Transition","TransitionStart"),transitioncancel:jo("Transition","TransitionCancel"),transitionend:jo("Transition","TransitionEnd")},yh={},_i={};dn&&(_i=document.createElement("div").style,"AnimationEvent"in window||(delete Uo.animationend.animation,delete Uo.animationiteration.animation,delete Uo.animationstart.animation),"TransitionEvent"in window||delete Uo.transitionend.transition);function ls(a){if(yh[a])return yh[a];if(!Uo[a])return a;var s=Uo[a],c;for(c in s)if(s.hasOwnProperty(c)&&c in _i)return yh[a]=s[c];return a}var Du=ls("animationend"),Pu=ls("animationiteration"),wc=ls("animationstart"),Go=ls("transitionrun"),Iu=ls("transitionstart"),Bl=ls("transitioncancel"),tr=ls("transitionend"),vh=new Map,Tc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Tc.push("scrollEnd");function ir(a,s){vh.set(a,s),ui(s,[a])}var us=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},Pa=[],Is=0,qo=0;function Zo(){for(var a=Is,s=qo=Is=0;s<a;){var c=Pa[s];Pa[s++]=null;var g=Pa[s];Pa[s++]=null;var w=Pa[s];Pa[s++]=null;var M=Pa[s];if(Pa[s++]=null,g!==null&&w!==null){var L=g.pending;L===null?w.next=w:(w.next=L.next,L.next=w),g.pending=w}M!==0&&xh(c,w,M)}}function Ru(a,s,c,g){Pa[Is++]=a,Pa[Is++]=s,Pa[Is++]=c,Pa[Is++]=g,qo|=g,a.lanes|=g,a=a.alternate,a!==null&&(a.lanes|=g)}function co(a,s,c,g){return Ru(a,s,c,g),Ol(a)}function xr(a,s){return Ru(a,null,null,s),Ol(a)}function xh(a,s,c){a.lanes|=c;var g=a.alternate;g!==null&&(g.lanes|=c);for(var w=!1,M=a.return;M!==null;)M.childLanes|=c,g=M.alternate,g!==null&&(g.childLanes|=c),M.tag===22&&(a=M.stateNode,a===null||a._visibility&1||(w=!0)),a=M,M=M.return;return a.tag===3?(M=a.stateNode,w&&s!==null&&(w=31-we(c),a=M.hiddenUpdates,g=a[w],g===null?a[w]=[s]:g.push(s),s.lane=c|536870912),M):null}function Ol(a){if(50<Hh)throw Hh=0,hp=null,Error(fe(185));for(var s=a.return;s!==null;)a=s,s=a.return;return a.tag===3?a.stateNode:null}var Gt={};function Sc(a,s,c,g){this.tag=a,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function nr(a,s,c,g){return new Sc(a,s,c,g)}function Mc(a){return a=a.prototype,!(!a||!a.isReactComponent)}function ar(a,s){var c=a.alternate;return c===null?(c=nr(a.tag,s,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=s,c.type=a.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=a.flags&65011712,c.childLanes=a.childLanes,c.lanes=a.lanes,c.child=a.child,c.memoizedProps=a.memoizedProps,c.memoizedState=a.memoizedState,c.updateQueue=a.updateQueue,s=a.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=a.sibling,c.index=a.index,c.ref=a.ref,c.refCleanup=a.refCleanup,c}function Ff(a,s){a.flags&=65011714;var c=a.alternate;return c===null?(a.childLanes=0,a.lanes=s,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,s=c.dependencies,a.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),a}function Ec(a,s,c,g,w,M){var L=0;if(g=a,typeof a=="function")Mc(a)&&(L=1);else if(typeof a=="string")L=Pd(a,c,yt.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case bn:return a=nr(31,c,s,w),a.elementType=bn,a.lanes=M,a;case nt:return ho(c.children,w,M,s);case ve:L=8,w|=24;break;case ti:return a=nr(12,c,s,w|2),a.elementType=ti,a.lanes=M,a;case jn:return a=nr(13,c,s,w),a.elementType=jn,a.lanes=M,a;case Ht:return a=nr(19,c,s,w),a.elementType=Ht,a.lanes=M,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case Ft:L=10;break e;case mt:L=9;break e;case Ot:L=11;break e;case Ct:L=14;break e;case Pi:L=16,g=null;break e}L=29,c=Error(fe(130,a===null?"null":typeof a,"")),g=null}return s=nr(L,c,s,w),s.elementType=a,s.type=g,s.lanes=M,s}function ho(a,s,c,g){return a=nr(7,a,g,s),a.lanes=c,a}function bh(a,s,c){return a=nr(6,a,null,s),a.lanes=c,a}function Ac(a){var s=nr(18,null,null,0);return s.stateNode=a,s}function fo(a,s,c){return s=nr(4,a.children!==null?a.children:[],a.key,s),s.lanes=c,s.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},s}var kl=new WeakMap;function Ia(a,s){if(typeof a=="object"&&a!==null){var c=kl.get(a);return c!==void 0?c:(s={value:a,source:s,stack:Qa(s)},kl.set(a,s),s)}return{value:a,source:s,stack:Qa(s)}}var po=[],mo=0,Ho=null,go=0,Hn=[],Wn=0,cs=null,hs=1,ka="";function Rs(a,s){po[mo++]=go,po[mo++]=Ho,Ho=a,go=s}function wh(a,s,c){Hn[Wn++]=hs,Hn[Wn++]=ka,Hn[Wn++]=cs,cs=a;var g=hs;a=ka;var w=32-we(g)-1;g&=~(1<<w),c+=1;var M=32-we(s)+w;if(30<M){var L=w-w%5;M=(g&(1<<L)-1).toString(32),g>>=L,w-=L,hs=1<<32-we(s)+w|c<<w|g,ka=M+a}else hs=1<<M|c<<w|g,ka=a}function Xo(a){a.return!==null&&(Rs(a,1),wh(a,1,0))}function Fl(a){for(;a===Ho;)Ho=po[--mo],po[mo]=null,go=po[--mo],po[mo]=null;for(;a===cs;)cs=Hn[--Wn],Hn[Wn]=null,ka=Hn[--Wn],Hn[Wn]=null,hs=Hn[--Wn],Hn[Wn]=null}function Th(a,s){Hn[Wn++]=hs,Hn[Wn++]=ka,Hn[Wn++]=cs,hs=s.id,ka=s.overflow,cs=a}var Kn=null,Bi=null,si=!1,Ls=null,rr=!1,ln=Error(fe(519));function Fa(a){var s=Error(fe(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Bs(Ia(s,a)),ln}function Na(a){var s=a.stateNode,c=a.type,g=a.memoizedProps;switch(s[ji]=a,s[Je]=g,c){case"dialog":mi("cancel",s),mi("close",s);break;case"iframe":case"object":case"embed":mi("load",s);break;case"video":case"audio":for(c=0;c<Jl.length;c++)mi(Jl[c],s);break;case"source":mi("error",s);break;case"img":case"image":case"link":mi("error",s),mi("load",s);break;case"details":mi("toggle",s);break;case"input":mi("invalid",s),hc(s,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0);break;case"select":mi("invalid",s);break;case"textarea":mi("invalid",s),Ml(s,g.value,g.defaultValue,g.children)}c=g.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||s.textContent===""+c||g.suppressHydrationWarning===!0||Mp(s.textContent,c)?(g.popover!=null&&(mi("beforetoggle",s),mi("toggle",s)),g.onScroll!=null&&mi("scroll",s),g.onScrollEnd!=null&&mi("scrollend",s),g.onClick!=null&&(s.onclick=Fr),s=!0):s=!1,s||Fa(a,!0)}function Lu(a){for(Kn=a.return;Kn;)switch(Kn.tag){case 5:case 31:case 13:rr=!1;return;case 27:case 3:rr=!0;return;default:Kn=Kn.return}}function fs(a){if(a!==Kn)return!1;if(!si)return Lu(a),si=!0,!1;var s=a.tag,c;if((c=s!==3&&s!==27)&&((c=s===5)&&(c=a.type,c=!(c!=="form"&&c!=="button")||Sd(a.type,a.memoizedProps)),c=!c),c&&Bi&&Fa(a),Lu(a),s===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(fe(317));Bi=sa(a)}else if(s===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(fe(317));Bi=sa(a)}else s===27?(s=Bi,iu(a.type)?(a=dr,dr=null,Bi=a):Bi=s):Bi=Kn?Wr(a.stateNode.nextSibling):null;return!0}function ds(){Bi=Kn=null,si=!1}function ps(){var a=Ls;return a!==null&&(Dr===null?Dr=a:Dr.push.apply(Dr,a),Ls=null),a}function Bs(a){Ls===null?Ls=[a]:Ls.push(a)}var Os=de(null),br=null,ms=null;function ks(a,s,c){ot(Os,s._currentValue),s._currentValue=c}function gs(a){a._currentValue=Os.current,Ze(Os)}function Cc(a,s,c){for(;a!==null;){var g=a.alternate;if((a.childLanes&s)!==s?(a.childLanes|=s,g!==null&&(g.childLanes|=s)):g!==null&&(g.childLanes&s)!==s&&(g.childLanes|=s),a===c)break;a=a.return}}function zc(a,s,c,g){var w=a.child;for(w!==null&&(w.return=a);w!==null;){var M=w.dependencies;if(M!==null){var L=w.child;M=M.firstContext;e:for(;M!==null;){var Z=M;M=w;for(var ce=0;ce<s.length;ce++)if(Z.context===s[ce]){M.lanes|=c,Z=M.alternate,Z!==null&&(Z.lanes|=c),Cc(M.return,c,a),g||(L=null);break e}M=Z.next}}else if(w.tag===18){if(L=w.return,L===null)throw Error(fe(341));L.lanes|=c,M=L.alternate,M!==null&&(M.lanes|=c),Cc(L,c,a),L=null}else L=w.child;if(L!==null)L.return=w;else for(L=w;L!==null;){if(L===a){L=null;break}if(w=L.sibling,w!==null){w.return=L.return,L=w;break}L=L.return}w=L}}function sr(a,s,c,g){a=null;for(var w=s,M=!1;w!==null;){if(!M){if((w.flags&524288)!==0)M=!0;else if((w.flags&262144)!==0)break}if(w.tag===10){var L=w.alternate;if(L===null)throw Error(fe(387));if(L=L.memoizedProps,L!==null){var Z=w.type;Oa(w.pendingProps.value,L.value)||(a!==null?a.push(Z):a=[Z])}}else if(w===Xt.current){if(L=w.alternate,L===null)throw Error(fe(387));L.memoizedState.memoizedState!==w.memoizedState.memoizedState&&(a!==null?a.push(rh):a=[rh])}w=w.return}a!==null&&zc(s,a,c,g),s.flags|=262144}function Nl(a){for(a=a.firstContext;a!==null;){if(!Oa(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Fs(a){br=a,ms=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Pn(a){return Dc(br,a)}function Bu(a,s){return br===null&&Fs(a),Dc(a,s)}function Dc(a,s){var c=s._currentValue;if(s={context:s,memoizedValue:c,next:null},ms===null){if(a===null)throw Error(fe(308));ms=s,a.dependencies={lanes:0,firstContext:s},a.flags|=524288}else ms=ms.next=s;return c}var Sh=typeof AbortController<"u"?AbortController:function(){var a=[],s=this.signal={aborted:!1,addEventListener:function(c,g){a.push(g)}};this.abort=function(){s.aborted=!0,a.forEach(function(c){return c()})}},Nf=te.unstable_scheduleCallback,Mh=te.unstable_NormalPriority,Tn={$$typeof:Ft,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function _s(){return{controller:new Sh,data:new Map,refCount:0}}function Vl(a){a.refCount--,a.refCount===0&&Nf(Mh,function(){a.controller.abort()})}var xa=null,or=0,$o=0,ba=null;function $d(a,s){if(xa===null){var c=xa=[];or=0,$o=xp(),ba={status:"pending",value:void 0,then:function(g){c.push(g)}}}return or++,s.then(jl,jl),s}function jl(){if(--or===0&&xa!==null){ba!==null&&(ba.status="fulfilled");var a=xa;xa=null,$o=0,ba=null;for(var s=0;s<a.length;s++)(0,a[s])()}}function Ou(a,s){var c=[],g={status:"pending",value:null,reason:null,then:function(w){c.push(w)}};return a.then(function(){g.status="fulfilled",g.value=s;for(var w=0;w<c.length;w++)(0,c[w])(s)},function(w){for(g.status="rejected",g.reason=w,w=0;w<c.length;w++)(0,c[w])(void 0)}),g}var Xn=je.S;je.S=function(a,s){xm=On(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&$d(a,s),Xn!==null&&Xn(a,s)};var Vr=de(null);function Pc(){var a=Vr.current;return a!==null?a:sn.pooledCache}function Ic(a,s){s===null?ot(Vr,Vr.current):ot(Vr,s.pool)}function Vf(){var a=Pc();return a===null?null:{parent:Tn._currentValue,pool:a}}var jr=Error(fe(460)),_o=Error(fe(474)),Va=Error(fe(542)),lt={then:function(){}};function ku(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Rc(a,s,c){switch(c=a[c],c===void 0?a.push(s):c!==s&&(s.then(Fr,Fr),s=c),s.status){case"fulfilled":return s.value;case"rejected":throw a=s.reason,Lc(a),a;default:if(typeof s.status=="string")s.then(Fr,Fr);else{if(a=sn,a!==null&&100<a.shellSuspendCounter)throw Error(fe(482));a=s,a.status="pending",a.then(function(g){if(s.status==="pending"){var w=s;w.status="fulfilled",w.value=g}},function(g){if(s.status==="pending"){var w=s;w.status="rejected",w.reason=g}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw a=s.reason,Lc(a),a}throw Ur=s,jr}}function wr(a){try{var s=a._init;return s(a._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(Ur=c,jr):c}}var Ur=null;function Ul(){if(Ur===null)throw Error(fe(459));var a=Ur;return Ur=null,a}function Lc(a){if(a===jr||a===Va)throw Error(fe(483))}var ys=null,Yo=0;function Fu(a){var s=Yo;return Yo+=1,ys===null&&(ys=[]),Rc(ys,a,s)}function vs(a,s){s=s.props.ref,a.ref=s!==void 0?s:null}function Bc(a,s){throw s.$$typeof===At?Error(fe(525)):(a=Object.prototype.toString.call(s),Error(fe(31,a==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":a)))}function Nu(a){function s(xe,me){if(a){var De=xe.deletions;De===null?(xe.deletions=[me],xe.flags|=16):De.push(me)}}function c(xe,me){if(!a)return null;for(;me!==null;)s(xe,me),me=me.sibling;return null}function g(xe){for(var me=new Map;xe!==null;)xe.key!==null?me.set(xe.key,xe):me.set(xe.index,xe),xe=xe.sibling;return me}function w(xe,me){return xe=ar(xe,me),xe.index=0,xe.sibling=null,xe}function M(xe,me,De){return xe.index=De,a?(De=xe.alternate,De!==null?(De=De.index,De<me?(xe.flags|=67108866,me):De):(xe.flags|=67108866,me)):(xe.flags|=1048576,me)}function L(xe){return a&&xe.alternate===null&&(xe.flags|=67108866),xe}function Z(xe,me,De,He){return me===null||me.tag!==6?(me=bh(De,xe.mode,He),me.return=xe,me):(me=w(me,De),me.return=xe,me)}function ce(xe,me,De,He){var Rt=De.type;return Rt===nt?Ue(xe,me,De.props.children,He,De.key):me!==null&&(me.elementType===Rt||typeof Rt=="object"&&Rt!==null&&Rt.$$typeof===Pi&&wr(Rt)===me.type)?(me=w(me,De.props),vs(me,De),me.return=xe,me):(me=Ec(De.type,De.key,De.props,null,xe.mode,He),vs(me,De),me.return=xe,me)}function Re(xe,me,De,He){return me===null||me.tag!==4||me.stateNode.containerInfo!==De.containerInfo||me.stateNode.implementation!==De.implementation?(me=fo(De,xe.mode,He),me.return=xe,me):(me=w(me,De.children||[]),me.return=xe,me)}function Ue(xe,me,De,He,Rt){return me===null||me.tag!==7?(me=ho(De,xe.mode,He,Rt),me.return=xe,me):(me=w(me,De),me.return=xe,me)}function $e(xe,me,De){if(typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint")return me=bh(""+me,xe.mode,De),me.return=xe,me;if(typeof me=="object"&&me!==null){switch(me.$$typeof){case ei:return De=Ec(me.type,me.key,me.props,null,xe.mode,De),vs(De,me),De.return=xe,De;case tt:return me=fo(me,xe.mode,De),me.return=xe,me;case Pi:return me=wr(me),$e(xe,me,De)}if(Hi(me)||Gi(me))return me=ho(me,xe.mode,De,null),me.return=xe,me;if(typeof me.then=="function")return $e(xe,Fu(me),De);if(me.$$typeof===Ft)return $e(xe,Bu(xe,me),De);Bc(xe,me)}return null}function Le(xe,me,De,He){var Rt=me!==null?me.key:null;if(typeof De=="string"&&De!==""||typeof De=="number"||typeof De=="bigint")return Rt!==null?null:Z(xe,me,""+De,He);if(typeof De=="object"&&De!==null){switch(De.$$typeof){case ei:return De.key===Rt?ce(xe,me,De,He):null;case tt:return De.key===Rt?Re(xe,me,De,He):null;case Pi:return De=wr(De),Le(xe,me,De,He)}if(Hi(De)||Gi(De))return Rt!==null?null:Ue(xe,me,De,He,null);if(typeof De.then=="function")return Le(xe,me,Fu(De),He);if(De.$$typeof===Ft)return Le(xe,me,Bu(xe,De),He);Bc(xe,De)}return null}function ke(xe,me,De,He,Rt){if(typeof He=="string"&&He!==""||typeof He=="number"||typeof He=="bigint")return xe=xe.get(De)||null,Z(me,xe,""+He,Rt);if(typeof He=="object"&&He!==null){switch(He.$$typeof){case ei:return xe=xe.get(He.key===null?De:He.key)||null,ce(me,xe,He,Rt);case tt:return xe=xe.get(He.key===null?De:He.key)||null,Re(me,xe,He,Rt);case Pi:return He=wr(He),ke(xe,me,De,He,Rt)}if(Hi(He)||Gi(He))return xe=xe.get(De)||null,Ue(me,xe,He,Rt,null);if(typeof He.then=="function")return ke(xe,me,De,Fu(He),Rt);if(He.$$typeof===Ft)return ke(xe,me,De,Bu(me,He),Rt);Bc(me,He)}return null}function bt(xe,me,De,He){for(var Rt=null,zi=null,wt=me,Dt=me=0,hi=null;wt!==null&&Dt<De.length;Dt++){wt.index>Dt?(hi=wt,wt=null):hi=wt.sibling;var Mi=Le(xe,wt,De[Dt],He);if(Mi===null){wt===null&&(wt=hi);break}a&&wt&&Mi.alternate===null&&s(xe,wt),me=M(Mi,me,Dt),zi===null?Rt=Mi:zi.sibling=Mi,zi=Mi,wt=hi}if(Dt===De.length)return c(xe,wt),si&&Rs(xe,Dt),Rt;if(wt===null){for(;Dt<De.length;Dt++)wt=$e(xe,De[Dt],He),wt!==null&&(me=M(wt,me,Dt),zi===null?Rt=wt:zi.sibling=wt,zi=wt);return si&&Rs(xe,Dt),Rt}for(wt=g(wt);Dt<De.length;Dt++)hi=ke(wt,xe,Dt,De[Dt],He),hi!==null&&(a&&hi.alternate!==null&&wt.delete(hi.key===null?Dt:hi.key),me=M(hi,me,Dt),zi===null?Rt=hi:zi.sibling=hi,zi=hi);return a&&wt.forEach(function(gl){return s(xe,gl)}),si&&Rs(xe,Dt),Rt}function Bt(xe,me,De,He){if(De==null)throw Error(fe(151));for(var Rt=null,zi=null,wt=me,Dt=me=0,hi=null,Mi=De.next();wt!==null&&!Mi.done;Dt++,Mi=De.next()){wt.index>Dt?(hi=wt,wt=null):hi=wt.sibling;var gl=Le(xe,wt,Mi.value,He);if(gl===null){wt===null&&(wt=hi);break}a&&wt&&gl.alternate===null&&s(xe,wt),me=M(gl,me,Dt),zi===null?Rt=gl:zi.sibling=gl,zi=gl,wt=hi}if(Mi.done)return c(xe,wt),si&&Rs(xe,Dt),Rt;if(wt===null){for(;!Mi.done;Dt++,Mi=De.next())Mi=$e(xe,Mi.value,He),Mi!==null&&(me=M(Mi,me,Dt),zi===null?Rt=Mi:zi.sibling=Mi,zi=Mi);return si&&Rs(xe,Dt),Rt}for(wt=g(wt);!Mi.done;Dt++,Mi=De.next())Mi=ke(wt,xe,Dt,Mi.value,He),Mi!==null&&(a&&Mi.alternate!==null&&wt.delete(Mi.key===null?Dt:Mi.key),me=M(Mi,me,Dt),zi===null?Rt=Mi:zi.sibling=Mi,zi=Mi);return a&&wt.forEach(function(Xp){return s(xe,Xp)}),si&&Rs(xe,Dt),Rt}function Zi(xe,me,De,He){if(typeof De=="object"&&De!==null&&De.type===nt&&De.key===null&&(De=De.props.children),typeof De=="object"&&De!==null){switch(De.$$typeof){case ei:e:{for(var Rt=De.key;me!==null;){if(me.key===Rt){if(Rt=De.type,Rt===nt){if(me.tag===7){c(xe,me.sibling),He=w(me,De.props.children),He.return=xe,xe=He;break e}}else if(me.elementType===Rt||typeof Rt=="object"&&Rt!==null&&Rt.$$typeof===Pi&&wr(Rt)===me.type){c(xe,me.sibling),He=w(me,De.props),vs(He,De),He.return=xe,xe=He;break e}c(xe,me);break}else s(xe,me);me=me.sibling}De.type===nt?(He=ho(De.props.children,xe.mode,He,De.key),He.return=xe,xe=He):(He=Ec(De.type,De.key,De.props,null,xe.mode,He),vs(He,De),He.return=xe,xe=He)}return L(xe);case tt:e:{for(Rt=De.key;me!==null;){if(me.key===Rt)if(me.tag===4&&me.stateNode.containerInfo===De.containerInfo&&me.stateNode.implementation===De.implementation){c(xe,me.sibling),He=w(me,De.children||[]),He.return=xe,xe=He;break e}else{c(xe,me);break}else s(xe,me);me=me.sibling}He=fo(De,xe.mode,He),He.return=xe,xe=He}return L(xe);case Pi:return De=wr(De),Zi(xe,me,De,He)}if(Hi(De))return bt(xe,me,De,He);if(Gi(De)){if(Rt=Gi(De),typeof Rt!="function")throw Error(fe(150));return De=Rt.call(De),Bt(xe,me,De,He)}if(typeof De.then=="function")return Zi(xe,me,Fu(De),He);if(De.$$typeof===Ft)return Zi(xe,me,Bu(xe,De),He);Bc(xe,De)}return typeof De=="string"&&De!==""||typeof De=="number"||typeof De=="bigint"?(De=""+De,me!==null&&me.tag===6?(c(xe,me.sibling),He=w(me,De),He.return=xe,xe=He):(c(xe,me),He=bh(De,xe.mode,He),He.return=xe,xe=He),L(xe)):c(xe,me)}return function(xe,me,De,He){try{Yo=0;var Rt=Zi(xe,me,De,He);return ys=null,Rt}catch(wt){if(wt===jr||wt===Va)throw wt;var zi=nr(29,wt,null,xe.mode);return zi.lanes=He,zi.return=xe,zi}}}var xs=Nu(!0),Eh=Nu(!1),bs=!1;function Oc(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Vu(a,s){a=a.updateQueue,s.updateQueue===a&&(s.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function ws(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Ns(a,s,c){var g=a.updateQueue;if(g===null)return null;if(g=g.shared,(Fi&2)!==0){var w=g.pending;return w===null?s.next=s:(s.next=w.next,w.next=s),g.pending=s,s=Ol(a),xh(a,null,c),s}return Ru(a,g,s,c),Ol(a)}function Tr(a,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194048)!==0)){var g=s.lanes;g&=a.pendingLanes,c|=g,s.lanes=c,zn(a,c)}}function Ti(a,s){var c=a.updateQueue,g=a.alternate;if(g!==null&&(g=g.updateQueue,c===g)){var w=null,M=null;if(c=c.firstBaseUpdate,c!==null){do{var L={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};M===null?w=M=L:M=M.next=L,c=c.next}while(c!==null);M===null?w=M=s:M=M.next=s}else w=M=s;c={baseState:g.baseState,firstBaseUpdate:w,lastBaseUpdate:M,shared:g.shared,callbacks:g.callbacks},a.updateQueue=c;return}a=c.lastBaseUpdate,a===null?c.firstBaseUpdate=s:a.next=s,c.lastBaseUpdate=s}var Ah=!1;function Vs(){if(Ah){var a=ba;if(a!==null)throw a}}function yo(a,s,c,g){Ah=!1;var w=a.updateQueue;bs=!1;var M=w.firstBaseUpdate,L=w.lastBaseUpdate,Z=w.shared.pending;if(Z!==null){w.shared.pending=null;var ce=Z,Re=ce.next;ce.next=null,L===null?M=Re:L.next=Re,L=ce;var Ue=a.alternate;Ue!==null&&(Ue=Ue.updateQueue,Z=Ue.lastBaseUpdate,Z!==L&&(Z===null?Ue.firstBaseUpdate=Re:Z.next=Re,Ue.lastBaseUpdate=ce))}if(M!==null){var $e=w.baseState;L=0,Ue=Re=ce=null,Z=M;do{var Le=Z.lane&-536870913,ke=Le!==Z.lane;if(ke?(pi&Le)===Le:(g&Le)===Le){Le!==0&&Le===$o&&(Ah=!0),Ue!==null&&(Ue=Ue.next={lane:0,tag:Z.tag,payload:Z.payload,callback:null,next:null});e:{var bt=a,Bt=Z;Le=s;var Zi=c;switch(Bt.tag){case 1:if(bt=Bt.payload,typeof bt=="function"){$e=bt.call(Zi,$e,Le);break e}$e=bt;break e;case 3:bt.flags=bt.flags&-65537|128;case 0:if(bt=Bt.payload,Le=typeof bt=="function"?bt.call(Zi,$e,Le):bt,Le==null)break e;$e=ht({},$e,Le);break e;case 2:bs=!0}}Le=Z.callback,Le!==null&&(a.flags|=64,ke&&(a.flags|=8192),ke=w.callbacks,ke===null?w.callbacks=[Le]:ke.push(Le))}else ke={lane:Le,tag:Z.tag,payload:Z.payload,callback:Z.callback,next:null},Ue===null?(Re=Ue=ke,ce=$e):Ue=Ue.next=ke,L|=Le;if(Z=Z.next,Z===null){if(Z=w.shared.pending,Z===null)break;ke=Z,Z=ke.next,ke.next=null,w.lastBaseUpdate=ke,w.shared.pending=null}}while(!0);Ue===null&&(ce=$e),w.baseState=ce,w.firstBaseUpdate=Re,w.lastBaseUpdate=Ue,M===null&&(w.shared.lanes=0),ul|=L,a.lanes=L,a.memoizedState=$e}}function ju(a,s){if(typeof a!="function")throw Error(fe(191,a));a.call(s)}function kc(a,s){var c=a.callbacks;if(c!==null)for(a.callbacks=null,a=0;a<c.length;a++)ju(c[a],s)}var Qo=de(null),Uu=de(0);function Ch(a,s){a=ll,ot(Uu,a),ot(Qo,s),ll=a|s.baseLanes}function lr(){ot(Uu,ll),ot(Qo,Qo.current)}function Wo(){ll=Uu.current,Ze(Qo),Ze(Uu)}var ct=de(null),vt=null;function Sr(a){var s=a.alternate;ot(mn,mn.current&1),ot(ct,a),vt===null&&(s===null||Qo.current!==null||s.memoizedState!==null)&&(vt=a)}function Gl(a){ot(mn,mn.current),ot(ct,a),vt===null&&(vt=a)}function Gu(a){a.tag===22?(ot(mn,mn.current),ot(ct,a),vt===null&&(vt=a)):Sn()}function Sn(){ot(mn,mn.current),ot(ct,ct.current)}function un(a){Ze(ct),vt===a&&(vt=null),Ze(mn)}var mn=de(0);function qu(a){for(var s=a;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||qa(c)||Nn(c)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break;for(;s.sibling===null;){if(s.return===null||s.return===a)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var js=0,Qt=null,xi=null,Yt=null,an=!1,Mr=!1,Gr=!1,Ko=0,Jo=0,Us=null,zh=0;function Yi(){throw Error(fe(321))}function qr(a,s){if(s===null)return!1;for(var c=0;c<s.length&&c<a.length;c++)if(!Oa(a[c],s[c]))return!1;return!0}function ql(a,s,c,g,w,M){return js=M,Qt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,je.H=a===null||a.memoizedState===null?ki:In,Gr=!1,M=c(g,w),Gr=!1,Mr&&(M=Zu(s,c,g,w)),Zl(a),M}function Zl(a){je.H=Si;var s=xi!==null&&xi.next!==null;if(js=0,Yt=xi=Qt=null,an=!1,Jo=0,Us=null,s)throw Error(fe(300));a===null||ta||(a=a.dependencies,a!==null&&Nl(a)&&(ta=!0))}function Zu(a,s,c,g){Qt=a;var w=0;do{if(Mr&&(Us=null),Jo=0,Mr=!1,25<=w)throw Error(fe(301));if(w+=1,Yt=xi=null,a.updateQueue!=null){var M=a.updateQueue;M.lastEffect=null,M.events=null,M.stores=null,M.memoCache!=null&&(M.memoCache.index=0)}je.H=Fn,M=s(c,g)}while(Mr);return M}function Hu(){var a=je.H,s=a.useState()[0];return s=typeof s.then=="function"?el(s):s,a=a.useState()[0],(xi!==null?xi.memoizedState:null)!==a&&(Qt.flags|=1024),s}function Xu(){var a=Ko!==0;return Ko=0,a}function vo(a,s,c){s.updateQueue=a.updateQueue,s.flags&=-2053,a.lanes&=~c}function Gs(a){if(an){for(a=a.memoizedState;a!==null;){var s=a.queue;s!==null&&(s.pending=null),a=a.next}an=!1}js=0,Yt=xi=Qt=null,Mr=!1,Jo=Ko=0,Us=null}function ca(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Yt===null?Qt.memoizedState=Yt=a:Yt=Yt.next=a,Yt}function rn(){if(xi===null){var a=Qt.alternate;a=a!==null?a.memoizedState:null}else a=xi.next;var s=Yt===null?Qt.memoizedState:Yt.next;if(s!==null)Yt=s,xi=a;else{if(a===null)throw Qt.alternate===null?Error(fe(467)):Error(fe(310));xi=a,a={memoizedState:xi.memoizedState,baseState:xi.baseState,baseQueue:xi.baseQueue,queue:xi.queue,next:null},Yt===null?Qt.memoizedState=Yt=a:Yt=Yt.next=a}return Yt}function Ts(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function el(a){var s=Jo;return Jo+=1,Us===null&&(Us=[]),a=Rc(Us,a,s),s=Qt,(Yt===null?s.memoizedState:Yt.next)===null&&(s=s.alternate,je.H=s===null||s.memoizedState===null?ki:In),a}function tl(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return el(a);if(a.$$typeof===Ft)return Pn(a)}throw Error(fe(438,String(a)))}function Hl(a){var s=null,c=Qt.updateQueue;if(c!==null&&(s=c.memoCache),s==null){var g=Qt.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(s={data:g.data.map(function(w){return w.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),c===null&&(c=Ts(),Qt.updateQueue=c),c.memoCache=s,c=s.data[s.index],c===void 0)for(c=s.data[s.index]=Array(a),g=0;g<a;g++)c[g]=Yn;return s.index++,c}function Zr(a,s){return typeof s=="function"?s(a):s}function m(a){var s=rn();return t(s,xi,a)}function t(a,s,c){var g=a.queue;if(g===null)throw Error(fe(311));g.lastRenderedReducer=c;var w=a.baseQueue,M=g.pending;if(M!==null){if(w!==null){var L=w.next;w.next=M.next,M.next=L}s.baseQueue=w=M,g.pending=null}if(M=a.baseState,w===null)a.memoizedState=M;else{s=w.next;var Z=L=null,ce=null,Re=s,Ue=!1;do{var $e=Re.lane&-536870913;if($e!==Re.lane?(pi&$e)===$e:(js&$e)===$e){var Le=Re.revertLane;if(Le===0)ce!==null&&(ce=ce.next={lane:0,revertLane:0,gesture:null,action:Re.action,hasEagerState:Re.hasEagerState,eagerState:Re.eagerState,next:null}),$e===$o&&(Ue=!0);else if((js&Le)===Le){Re=Re.next,Le===$o&&(Ue=!0);continue}else $e={lane:0,revertLane:Re.revertLane,gesture:null,action:Re.action,hasEagerState:Re.hasEagerState,eagerState:Re.eagerState,next:null},ce===null?(Z=ce=$e,L=M):ce=ce.next=$e,Qt.lanes|=Le,ul|=Le;$e=Re.action,Gr&&c(M,$e),M=Re.hasEagerState?Re.eagerState:c(M,$e)}else Le={lane:$e,revertLane:Re.revertLane,gesture:Re.gesture,action:Re.action,hasEagerState:Re.hasEagerState,eagerState:Re.eagerState,next:null},ce===null?(Z=ce=Le,L=M):ce=ce.next=Le,Qt.lanes|=$e,ul|=$e;Re=Re.next}while(Re!==null&&Re!==s);if(ce===null?L=M:ce.next=Z,!Oa(M,a.memoizedState)&&(ta=!0,Ue&&(c=ba,c!==null)))throw c;a.memoizedState=M,a.baseState=L,a.baseQueue=ce,g.lastRenderedState=M}return w===null&&(g.lanes=0),[a.memoizedState,g.dispatch]}function r(a){var s=rn(),c=s.queue;if(c===null)throw Error(fe(311));c.lastRenderedReducer=a;var g=c.dispatch,w=c.pending,M=s.memoizedState;if(w!==null){c.pending=null;var L=w=w.next;do M=a(M,L.action),L=L.next;while(L!==w);Oa(M,s.memoizedState)||(ta=!0),s.memoizedState=M,s.baseQueue===null&&(s.baseState=M),c.lastRenderedState=M}return[M,g]}function l(a,s,c){var g=Qt,w=rn(),M=si;if(M){if(c===void 0)throw Error(fe(407));c=c()}else c=s();var L=!Oa((xi||w).memoizedState,c);if(L&&(w.memoizedState=c,ta=!0),w=w.queue,Ce(v.bind(null,g,w,a),[a]),w.getSnapshot!==s||L||Yt!==null&&Yt.memoizedState.tag&1){if(g.flags|=2048,ie(9,{destroy:void 0},_.bind(null,g,w,c,s),null),sn===null)throw Error(fe(349));M||(js&127)!==0||h(g,s,c)}return c}function h(a,s,c){a.flags|=16384,a={getSnapshot:s,value:c},s=Qt.updateQueue,s===null?(s=Ts(),Qt.updateQueue=s,s.stores=[a]):(c=s.stores,c===null?s.stores=[a]:c.push(a))}function _(a,s,c,g){s.value=c,s.getSnapshot=g,b(s)&&S(a)}function v(a,s,c){return c(function(){b(s)&&S(a)})}function b(a){var s=a.getSnapshot;a=a.value;try{var c=s();return!Oa(a,c)}catch{return!0}}function S(a){var s=xr(a,2);s!==null&&Ir(s,a,2)}function A(a){var s=ca();if(typeof a=="function"){var c=a;if(a=c(),Gr){he(!0);try{c()}finally{he(!1)}}}return s.memoizedState=s.baseState=a,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zr,lastRenderedState:a},s}function z(a,s,c,g){return a.baseState=c,t(a,xi,typeof g=="function"?g:Zr)}function R(a,s,c,g,w){if(ur(a))throw Error(fe(485));if(a=s.action,a!==null){var M={payload:w,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(L){M.listeners.push(L)}};je.T!==null?c(!0):M.isTransition=!1,g(M),c=s.pending,c===null?(M.next=s.pending=M,I(s,M)):(M.next=c.next,s.pending=c.next=M)}}function I(a,s){var c=s.action,g=s.payload,w=a.state;if(s.isTransition){var M=je.T,L={};je.T=L;try{var Z=c(w,g),ce=je.S;ce!==null&&ce(L,Z),F(a,s,Z)}catch(Re){$(a,s,Re)}finally{M!==null&&L.types!==null&&(M.types=L.types),je.T=M}}else try{M=c(w,g),F(a,s,M)}catch(Re){$(a,s,Re)}}function F(a,s,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(g){U(a,s,g)},function(g){return $(a,s,g)}):U(a,s,c)}function U(a,s,c){s.status="fulfilled",s.value=c,Q(s),a.state=c,s=a.pending,s!==null&&(c=s.next,c===s?a.pending=null:(c=c.next,s.next=c,I(a,c)))}function $(a,s,c){var g=a.pending;if(a.pending=null,g!==null){g=g.next;do s.status="rejected",s.reason=c,Q(s),s=s.next;while(s!==g)}a.action=null}function Q(a){a=a.listeners;for(var s=0;s<a.length;s++)(0,a[s])()}function Y(a,s){return s}function J(a,s){if(si){var c=sn.formState;if(c!==null){e:{var g=Qt;if(si){if(Bi){t:{for(var w=Bi,M=rr;w.nodeType!==8;){if(!M){w=null;break t}if(w=Wr(w.nextSibling),w===null){w=null;break t}}M=w.data,w=M==="F!"||M==="F"?w:null}if(w){Bi=Wr(w.nextSibling),g=w.data==="F!";break e}}Fa(g)}g=!1}g&&(s=c[0])}}return c=ca(),c.memoizedState=c.baseState=s,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Y,lastRenderedState:s},c.queue=g,c=Xl.bind(null,Qt,g),g.dispatch=c,g=A(!1),M=Ua.bind(null,Qt,!1,g.queue),g=ca(),w={state:s,dispatch:null,action:a,pending:null},g.queue=w,c=R.bind(null,Qt,w,M,c),w.dispatch=c,g.memoizedState=a,[s,c,!1]}function re(a){var s=rn();return K(s,xi,a)}function K(a,s,c){if(s=t(a,s,Y)[0],a=m(Zr)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var g=el(s)}catch(L){throw L===jr?Va:L}else g=s;s=rn();var w=s.queue,M=w.dispatch;return c!==s.memoizedState&&(Qt.flags|=2048,ie(9,{destroy:void 0},ae.bind(null,w,c),null)),[g,M,a]}function ae(a,s){a.action=s}function le(a){var s=rn(),c=xi;if(c!==null)return K(s,c,a);rn(),s=s.memoizedState,c=rn();var g=c.queue.dispatch;return c.memoizedState=a,[s,g,!1]}function ie(a,s,c,g){return a={tag:a,create:c,deps:g,inst:s,next:null},s=Qt.updateQueue,s===null&&(s=Ts(),Qt.updateQueue=s),c=s.lastEffect,c===null?s.lastEffect=a.next=a:(g=c.next,c.next=a,a.next=g,s.lastEffect=a),a}function pe(){return rn().memoizedState}function ze(a,s,c,g){var w=ca();Qt.flags|=a,w.memoizedState=ie(1|s,{destroy:void 0},c,g===void 0?null:g)}function Te(a,s,c,g){var w=rn();g=g===void 0?null:g;var M=w.memoizedState.inst;xi!==null&&g!==null&&qr(g,xi.memoizedState.deps)?w.memoizedState=ie(s,M,c,g):(Qt.flags|=a,w.memoizedState=ie(1|s,M,c,g))}function Ae(a,s){ze(8390656,8,a,s)}function Ce(a,s){Te(2048,8,a,s)}function We(a){Qt.flags|=4;var s=Qt.updateQueue;if(s===null)s=Ts(),Qt.updateQueue=s,s.events=[a];else{var c=s.events;c===null?s.events=[a]:c.push(a)}}function Ke(a){var s=rn().memoizedState;return We({ref:s,nextImpl:a}),function(){if((Fi&2)!==0)throw Error(fe(440));return s.impl.apply(void 0,arguments)}}function Ge(a,s){return Te(4,2,a,s)}function at(a,s){return Te(4,4,a,s)}function kt(a,s){if(typeof s=="function"){a=a();var c=s(a);return function(){typeof c=="function"?c():s(null)}}if(s!=null)return a=a(),s.current=a,function(){s.current=null}}function bi(a,s,c){c=c!=null?c.concat([a]):null,Te(4,4,kt.bind(null,s,a),c)}function Ui(){}function Oi(a,s){var c=rn();s=s===void 0?null:s;var g=c.memoizedState;return s!==null&&qr(s,g[1])?g[0]:(c.memoizedState=[a,s],a)}function Qi(a,s){var c=rn();s=s===void 0?null:s;var g=c.memoizedState;if(s!==null&&qr(s,g[1]))return g[0];if(g=a(),Gr){he(!0);try{a()}finally{he(!1)}}return c.memoizedState=[g,s],g}function Ai(a,s,c){return c===void 0||(js&1073741824)!==0&&(pi&261930)===0?a.memoizedState=s:(a.memoizedState=c,a=wm(),Qt.lanes|=a,ul|=a,c)}function cn(a,s,c,g){return Oa(c,s)?c:Qo.current!==null?(a=Ai(a,c,g),Oa(a,s)||(ta=!0),a):(js&42)===0||(js&1073741824)!==0&&(pi&261930)===0?(ta=!0,a.memoizedState=c):(a=wm(),Qt.lanes|=a,ul|=a,s)}function Wi(a,s,c,g,w){var M=it.p;it.p=M!==0&&8>M?M:8;var L=je.T,Z={};je.T=Z,Ua(a,!1,s,c);try{var ce=w(),Re=je.S;if(Re!==null&&Re(Z,ce),ce!==null&&typeof ce=="object"&&typeof ce.then=="function"){var Ue=Ou(ce,g);Xr(a,s,Ue,Pr(a))}else Xr(a,s,g,Pr(a))}catch($e){Xr(a,s,{then:function(){},status:"rejected",reason:$e},Pr())}finally{it.p=M,L!==null&&Z.types!==null&&(L.types=Z.types),je.T=L}}function Jn(){}function gn(a,s,c,g){if(a.tag!==5)throw Error(fe(476));var w=_n(a).queue;Wi(a,w,s,Mt,c===null?Jn:function(){return ea(a),c(g)})}function _n(a){var s=a.memoizedState;if(s!==null)return s;s={memoizedState:Mt,baseState:Mt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zr,lastRenderedState:Mt},next:null};var c={};return s.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zr,lastRenderedState:c},next:null},a.memoizedState=s,a=a.alternate,a!==null&&(a.memoizedState=s),s}function ea(a){var s=_n(a);s.next===null&&(s=a.alternate.memoizedState),Xr(a,s.next.queue,{},Pr())}function Ss(){return Pn(rh)}function Ms(){return rn().memoizedState}function Hr(){return rn().memoizedState}function ja(a){for(var s=a.return;s!==null;){switch(s.tag){case 24:case 3:var c=Pr();a=ws(c);var g=Ns(s,a,c);g!==null&&(Ir(g,s,c),Tr(g,s,c)),s={cache:_s()},a.payload=s;return}s=s.return}}function il(a,s,c){var g=Pr();c={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},ur(a)?Er(s,c):(c=co(a,s,c,g),c!==null&&(Ir(c,a,g),Ar(c,s,g)))}function Xl(a,s,c){var g=Pr();Xr(a,s,c,g)}function Xr(a,s,c,g){var w={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(ur(a))Er(s,w);else{var M=a.alternate;if(a.lanes===0&&(M===null||M.lanes===0)&&(M=s.lastRenderedReducer,M!==null))try{var L=s.lastRenderedState,Z=M(L,c);if(w.hasEagerState=!0,w.eagerState=Z,Oa(Z,L))return Ru(a,s,w,0),sn===null&&Zo(),!1}catch{}if(c=co(a,s,w,g),c!==null)return Ir(c,a,g),Ar(c,s,g),!0}return!1}function Ua(a,s,c,g){if(g={lane:2,revertLane:xp(),gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},ur(a)){if(s)throw Error(fe(479))}else s=co(a,c,g,2),s!==null&&Ir(s,a,2)}function ur(a){var s=a.alternate;return a===Qt||s!==null&&s===Qt}function Er(a,s){Mr=an=!0;var c=a.pending;c===null?s.next=s:(s.next=c.next,c.next=s),a.pending=s}function Ar(a,s,c){if((c&4194048)!==0){var g=s.lanes;g&=a.pendingLanes,c|=g,s.lanes=c,zn(a,c)}}var Si={readContext:Pn,use:tl,useCallback:Yi,useContext:Yi,useEffect:Yi,useImperativeHandle:Yi,useLayoutEffect:Yi,useInsertionEffect:Yi,useMemo:Yi,useReducer:Yi,useRef:Yi,useState:Yi,useDebugValue:Yi,useDeferredValue:Yi,useTransition:Yi,useSyncExternalStore:Yi,useId:Yi,useHostTransitionStatus:Yi,useFormState:Yi,useActionState:Yi,useOptimistic:Yi,useMemoCache:Yi,useCacheRefresh:Yi};Si.useEffectEvent=Yi;var ki={readContext:Pn,use:tl,useCallback:function(a,s){return ca().memoizedState=[a,s===void 0?null:s],a},useContext:Pn,useEffect:Ae,useImperativeHandle:function(a,s,c){c=c!=null?c.concat([a]):null,ze(4194308,4,kt.bind(null,s,a),c)},useLayoutEffect:function(a,s){return ze(4194308,4,a,s)},useInsertionEffect:function(a,s){ze(4,2,a,s)},useMemo:function(a,s){var c=ca();s=s===void 0?null:s;var g=a();if(Gr){he(!0);try{a()}finally{he(!1)}}return c.memoizedState=[g,s],g},useReducer:function(a,s,c){var g=ca();if(c!==void 0){var w=c(s);if(Gr){he(!0);try{c(s)}finally{he(!1)}}}else w=s;return g.memoizedState=g.baseState=w,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:w},g.queue=a,a=a.dispatch=il.bind(null,Qt,a),[g.memoizedState,a]},useRef:function(a){var s=ca();return a={current:a},s.memoizedState=a},useState:function(a){a=A(a);var s=a.queue,c=Xl.bind(null,Qt,s);return s.dispatch=c,[a.memoizedState,c]},useDebugValue:Ui,useDeferredValue:function(a,s){var c=ca();return Ai(c,a,s)},useTransition:function(){var a=A(!1);return a=Wi.bind(null,Qt,a.queue,!0,!1),ca().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,s,c){var g=Qt,w=ca();if(si){if(c===void 0)throw Error(fe(407));c=c()}else{if(c=s(),sn===null)throw Error(fe(349));(pi&127)!==0||h(g,s,c)}w.memoizedState=c;var M={value:c,getSnapshot:s};return w.queue=M,Ae(v.bind(null,g,M,a),[a]),g.flags|=2048,ie(9,{destroy:void 0},_.bind(null,g,M,c,s),null),c},useId:function(){var a=ca(),s=sn.identifierPrefix;if(si){var c=ka,g=hs;c=(g&~(1<<32-we(g)-1)).toString(32)+c,s="_"+s+"R_"+c,c=Ko++,0<c&&(s+="H"+c.toString(32)),s+="_"}else c=zh++,s="_"+s+"r_"+c.toString(32)+"_";return a.memoizedState=s},useHostTransitionStatus:Ss,useFormState:J,useActionState:J,useOptimistic:function(a){var s=ca();s.memoizedState=s.baseState=a;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=c,s=Ua.bind(null,Qt,!0,c),c.dispatch=s,[a,s]},useMemoCache:Hl,useCacheRefresh:function(){return ca().memoizedState=ja.bind(null,Qt)},useEffectEvent:function(a){var s=ca(),c={impl:a};return s.memoizedState=c,function(){if((Fi&2)!==0)throw Error(fe(440));return c.impl.apply(void 0,arguments)}}},In={readContext:Pn,use:tl,useCallback:Oi,useContext:Pn,useEffect:Ce,useImperativeHandle:bi,useInsertionEffect:Ge,useLayoutEffect:at,useMemo:Qi,useReducer:m,useRef:pe,useState:function(){return m(Zr)},useDebugValue:Ui,useDeferredValue:function(a,s){var c=rn();return cn(c,xi.memoizedState,a,s)},useTransition:function(){var a=m(Zr)[0],s=rn().memoizedState;return[typeof a=="boolean"?a:el(a),s]},useSyncExternalStore:l,useId:Ms,useHostTransitionStatus:Ss,useFormState:re,useActionState:re,useOptimistic:function(a,s){var c=rn();return z(c,xi,a,s)},useMemoCache:Hl,useCacheRefresh:Hr};In.useEffectEvent=Ke;var Fn={readContext:Pn,use:tl,useCallback:Oi,useContext:Pn,useEffect:Ce,useImperativeHandle:bi,useInsertionEffect:Ge,useLayoutEffect:at,useMemo:Qi,useReducer:r,useRef:pe,useState:function(){return r(Zr)},useDebugValue:Ui,useDeferredValue:function(a,s){var c=rn();return xi===null?Ai(c,a,s):cn(c,xi.memoizedState,a,s)},useTransition:function(){var a=r(Zr)[0],s=rn().memoizedState;return[typeof a=="boolean"?a:el(a),s]},useSyncExternalStore:l,useId:Ms,useHostTransitionStatus:Ss,useFormState:le,useActionState:le,useOptimistic:function(a,s){var c=rn();return xi!==null?z(c,xi,a,s):(c.baseState=a,[a,c.queue.dispatch])},useMemoCache:Hl,useCacheRefresh:Hr};Fn.useEffectEvent=Ke;function Fc(a,s,c,g){s=a.memoizedState,c=c(g,s),c=c==null?s:ht({},s,c),a.memoizedState=c,a.lanes===0&&(a.updateQueue.baseState=c)}var Nc={enqueueSetState:function(a,s,c){a=a._reactInternals;var g=Pr(),w=ws(g);w.payload=s,c!=null&&(w.callback=c),s=Ns(a,w,g),s!==null&&(Ir(s,a,g),Tr(s,a,g))},enqueueReplaceState:function(a,s,c){a=a._reactInternals;var g=Pr(),w=ws(g);w.tag=1,w.payload=s,c!=null&&(w.callback=c),s=Ns(a,w,g),s!==null&&(Ir(s,a,g),Tr(s,a,g))},enqueueForceUpdate:function(a,s){a=a._reactInternals;var c=Pr(),g=ws(c);g.tag=2,s!=null&&(g.callback=s),s=Ns(a,g,c),s!==null&&(Ir(s,a,c),Tr(s,a,c))}};function xo(a,s,c,g,w,M,L){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(g,M,L):s.prototype&&s.prototype.isPureReactComponent?!uo(c,g)||!uo(w,M):!0}function jf(a,s,c,g){a=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,g),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,g),s.state!==a&&Nc.enqueueReplaceState(s,s.state,null)}function bo(a,s){var c=s;if("ref"in s){c={};for(var g in s)g!=="ref"&&(c[g]=s[g])}if(a=a.defaultProps){c===s&&(c=ht({},c));for(var w in a)c[w]===void 0&&(c[w]=a[w])}return c}function Vc(a){us(a)}function qs(a){console.error(a)}function Zs(a){us(a)}function $r(a,s){try{var c=a.onUncaughtError;c(s.value,{componentStack:s.stack})}catch(g){setTimeout(function(){throw g})}}function jc(a,s,c){try{var g=a.onCaughtError;g(c.value,{componentStack:c.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(w){setTimeout(function(){throw w})}}function $u(a,s,c){return c=ws(c),c.tag=3,c.payload={element:null},c.callback=function(){$r(a,s)},c}function Yu(a){return a=ws(a),a.tag=3,a}function Qu(a,s,c,g){var w=c.type.getDerivedStateFromError;if(typeof w=="function"){var M=g.value;a.payload=function(){return w(M)},a.callback=function(){jc(s,c,g)}}var L=c.stateNode;L!==null&&typeof L.componentDidCatch=="function"&&(a.callback=function(){jc(s,c,g),typeof w!="function"&&(cl===null?cl=new Set([this]):cl.add(this));var Z=g.stack;this.componentDidCatch(g.value,{componentStack:Z!==null?Z:""})})}function Uf(a,s,c,g,w){if(c.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(s=c.alternate,s!==null&&sr(s,c,w,!0),c=ct.current,c!==null){switch(c.tag){case 31:case 13:return vt===null?$h():c.alternate===null&&Rn===0&&(Rn=3),c.flags&=-257,c.flags|=65536,c.lanes=w,g===lt?c.flags|=16384:(s=c.updateQueue,s===null?c.updateQueue=new Set([g]):s.add(g),dd(a,g,w)),!1;case 22:return c.flags|=65536,g===lt?c.flags|=16384:(s=c.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([g])},c.updateQueue=s):(c=s.retryQueue,c===null?s.retryQueue=new Set([g]):c.add(g)),dd(a,g,w)),!1}throw Error(fe(435,c.tag))}return dd(a,g,w),$h(),!1}if(si)return s=ct.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=w,g!==ln&&(a=Error(fe(422),{cause:g}),Bs(Ia(a,c)))):(g!==ln&&(s=Error(fe(423),{cause:g}),Bs(Ia(s,c))),a=a.current.alternate,a.flags|=65536,w&=-w,a.lanes|=w,g=Ia(g,c),w=$u(a.stateNode,g,w),Ti(a,w),Rn!==4&&(Rn=2)),!1;var M=Error(fe(520),{cause:g});if(M=Ia(M,c),qh===null?qh=[M]:qh.push(M),Rn!==4&&(Rn=2),s===null)return!0;g=Ia(g,c),c=s;do{switch(c.tag){case 3:return c.flags|=65536,a=w&-w,c.lanes|=a,a=$u(c.stateNode,g,a),Ti(c,a),!1;case 1:if(s=c.type,M=c.stateNode,(c.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||M!==null&&typeof M.componentDidCatch=="function"&&(cl===null||!cl.has(M))))return c.flags|=65536,w&=-w,c.lanes|=w,w=Yu(w),Qu(w,a,c,g),Ti(c,w),!1}c=c.return}while(c!==null);return!1}var Gf=Error(fe(461)),ta=!1;function ha(a,s,c,g){s.child=a===null?Eh(s,null,c,g):xs(s,a.child,c,g)}function rm(a,s,c,g,w){c=c.render;var M=s.ref;if("ref"in g){var L={};for(var Z in g)Z!=="ref"&&(L[Z]=g[Z])}else L=g;return Fs(s),g=ql(a,s,c,L,M,w),Z=Xu(),a!==null&&!ta?(vo(a,s,w),To(a,s,w)):(si&&Z&&Xo(s),s.flags|=1,ha(a,s,g,w),s.child)}function qf(a,s,c,g,w){if(a===null){var M=c.type;return typeof M=="function"&&!Mc(M)&&M.defaultProps===void 0&&c.compare===null?(s.tag=15,s.type=M,Yd(a,s,M,g,w)):(a=Ec(c.type,null,g,s,s.mode,w),a.ref=s.ref,a.return=s,s.child=a)}if(M=a.child,!Ih(a,w)){var L=M.memoizedProps;if(c=c.compare,c=c!==null?c:uo,c(L,g)&&a.ref===s.ref)return To(a,s,w)}return s.flags|=1,a=ar(M,g),a.ref=s.ref,a.return=s,s.child=a}function Yd(a,s,c,g,w){if(a!==null){var M=a.memoizedProps;if(uo(M,g)&&a.ref===s.ref)if(ta=!1,s.pendingProps=g=M,Ih(a,w))(a.flags&131072)!==0&&(ta=!0);else return s.lanes=a.lanes,To(a,s,w)}return Wd(a,s,c,g,w)}function Qd(a,s,c,g){var w=g.children,M=a!==null?a.memoizedState:null;if(a===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.mode==="hidden"){if((s.flags&128)!==0){if(M=M!==null?M.baseLanes|c:c,a!==null){for(g=s.child=a.child,w=0;g!==null;)w=w|g.lanes|g.childLanes,g=g.sibling;g=w&~M}else g=0,s.child=null;return sm(a,s,M,c,g)}if((c&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},a!==null&&Ic(s,M!==null?M.cachePool:null),M!==null?Ch(s,M):lr(),Gu(s);else return g=s.lanes=536870912,sm(a,s,M!==null?M.baseLanes|c:c,c,g)}else M!==null?(Ic(s,M.cachePool),Ch(s,M),Sn(),s.memoizedState=null):(a!==null&&Ic(s,null),lr(),Sn());return ha(a,s,w,c),s.child}function wo(a,s){return a!==null&&a.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function sm(a,s,c,g,w){var M=Pc();return M=M===null?null:{parent:Tn._currentValue,pool:M},s.memoizedState={baseLanes:c,cachePool:M},a!==null&&Ic(s,null),lr(),Gu(s),a!==null&&sr(a,s,g,!0),s.childLanes=w,null}function nl(a,s){return s=Yf({mode:s.mode,children:s.children},a.mode),s.ref=a.ref,a.child=s,s.return=a,s}function Dh(a,s,c){return xs(s,a.child,null,c),a=nl(s,s.pendingProps),a.flags|=2,un(s),s.memoizedState=null,a}function Zf(a,s,c){var g=s.pendingProps,w=(s.flags&128)!==0;if(s.flags&=-129,a===null){if(si){if(g.mode==="hidden")return a=nl(s,g),s.lanes=536870912,wo(null,a);if(Gl(s),(a=Bi)?(a=nu(a,rr),a=a!==null&&a.data==="&"?a:null,a!==null&&(s.memoizedState={dehydrated:a,treeContext:cs!==null?{id:hs,overflow:ka}:null,retryLane:536870912,hydrationErrors:null},c=Ac(a),c.return=s,s.child=c,Kn=s,Bi=null)):a=null,a===null)throw Fa(s);return s.lanes=536870912,null}return nl(s,g)}var M=a.memoizedState;if(M!==null){var L=M.dehydrated;if(Gl(s),w)if(s.flags&256)s.flags&=-257,s=Dh(a,s,c);else if(s.memoizedState!==null)s.child=a.child,s.flags|=128,s=null;else throw Error(fe(558));else if(ta||sr(a,s,c,!1),w=(c&a.childLanes)!==0,ta||w){if(g=sn,g!==null&&(L=bl(g,c),L!==0&&L!==M.retryLane))throw M.retryLane=L,xr(a,L),Ir(g,a,L),Gf;$h(),s=Dh(a,s,c)}else a=M.treeContext,Bi=Wr(L.nextSibling),Kn=s,si=!0,Ls=null,rr=!1,a!==null&&Th(s,a),s=nl(s,g),s.flags|=4096;return s}return a=ar(a.child,{mode:g.mode,children:g.children}),a.ref=s.ref,s.child=a,a.return=s,a}function Hf(a,s){var c=s.ref;if(c===null)a!==null&&a.ref!==null&&(s.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(fe(284));(a===null||a.ref!==c)&&(s.flags|=4194816)}}function Wd(a,s,c,g,w){return Fs(s),c=ql(a,s,c,g,void 0,w),g=Xu(),a!==null&&!ta?(vo(a,s,w),To(a,s,w)):(si&&g&&Xo(s),s.flags|=1,ha(a,s,c,w),s.child)}function om(a,s,c,g,w,M){return Fs(s),s.updateQueue=null,c=Zu(s,g,c,w),Zl(a),g=Xu(),a!==null&&!ta?(vo(a,s,M),To(a,s,M)):(si&&g&&Xo(s),s.flags|=1,ha(a,s,c,M),s.child)}function lm(a,s,c,g,w){if(Fs(s),s.stateNode===null){var M=Gt,L=c.contextType;typeof L=="object"&&L!==null&&(M=Pn(L)),M=new c(g,M),s.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,M.updater=Nc,s.stateNode=M,M._reactInternals=s,M=s.stateNode,M.props=g,M.state=s.memoizedState,M.refs={},Oc(s),L=c.contextType,M.context=typeof L=="object"&&L!==null?Pn(L):Gt,M.state=s.memoizedState,L=c.getDerivedStateFromProps,typeof L=="function"&&(Fc(s,c,L,g),M.state=s.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(L=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),L!==M.state&&Nc.enqueueReplaceState(M,M.state,null),yo(s,g,M,w),Vs(),M.state=s.memoizedState),typeof M.componentDidMount=="function"&&(s.flags|=4194308),g=!0}else if(a===null){M=s.stateNode;var Z=s.memoizedProps,ce=bo(c,Z);M.props=ce;var Re=M.context,Ue=c.contextType;L=Gt,typeof Ue=="object"&&Ue!==null&&(L=Pn(Ue));var $e=c.getDerivedStateFromProps;Ue=typeof $e=="function"||typeof M.getSnapshotBeforeUpdate=="function",Z=s.pendingProps!==Z,Ue||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(Z||Re!==L)&&jf(s,M,g,L),bs=!1;var Le=s.memoizedState;M.state=Le,yo(s,g,M,w),Vs(),Re=s.memoizedState,Z||Le!==Re||bs?(typeof $e=="function"&&(Fc(s,c,$e,g),Re=s.memoizedState),(ce=bs||xo(s,c,ce,g,Le,Re,L))?(Ue||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount()),typeof M.componentDidMount=="function"&&(s.flags|=4194308)):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=g,s.memoizedState=Re),M.props=g,M.state=Re,M.context=L,g=ce):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),g=!1)}else{M=s.stateNode,Vu(a,s),L=s.memoizedProps,Ue=bo(c,L),M.props=Ue,$e=s.pendingProps,Le=M.context,Re=c.contextType,ce=Gt,typeof Re=="object"&&Re!==null&&(ce=Pn(Re)),Z=c.getDerivedStateFromProps,(Re=typeof Z=="function"||typeof M.getSnapshotBeforeUpdate=="function")||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(L!==$e||Le!==ce)&&jf(s,M,g,ce),bs=!1,Le=s.memoizedState,M.state=Le,yo(s,g,M,w),Vs();var ke=s.memoizedState;L!==$e||Le!==ke||bs||a!==null&&a.dependencies!==null&&Nl(a.dependencies)?(typeof Z=="function"&&(Fc(s,c,Z,g),ke=s.memoizedState),(Ue=bs||xo(s,c,Ue,g,Le,ke,ce)||a!==null&&a.dependencies!==null&&Nl(a.dependencies))?(Re||typeof M.UNSAFE_componentWillUpdate!="function"&&typeof M.componentWillUpdate!="function"||(typeof M.componentWillUpdate=="function"&&M.componentWillUpdate(g,ke,ce),typeof M.UNSAFE_componentWillUpdate=="function"&&M.UNSAFE_componentWillUpdate(g,ke,ce)),typeof M.componentDidUpdate=="function"&&(s.flags|=4),typeof M.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof M.componentDidUpdate!="function"||L===a.memoizedProps&&Le===a.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||L===a.memoizedProps&&Le===a.memoizedState||(s.flags|=1024),s.memoizedProps=g,s.memoizedState=ke),M.props=g,M.state=ke,M.context=ce,g=Ue):(typeof M.componentDidUpdate!="function"||L===a.memoizedProps&&Le===a.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||L===a.memoizedProps&&Le===a.memoizedState||(s.flags|=1024),g=!1)}return M=g,Hf(a,s),g=(s.flags&128)!==0,M||g?(M=s.stateNode,c=g&&typeof c.getDerivedStateFromError!="function"?null:M.render(),s.flags|=1,a!==null&&g?(s.child=xs(s,a.child,null,w),s.child=xs(s,null,c,w)):ha(a,s,c,w),s.memoizedState=M.state,a=s.child):a=To(a,s,w),a}function um(a,s,c,g){return ds(),s.flags|=256,ha(a,s,c,g),s.child}var Xf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ph(a){return{baseLanes:a,cachePool:Vf()}}function $f(a,s,c){return a=a!==null?a.childLanes&~c:0,s&&(a|=Ra),a}function Kd(a,s,c){var g=s.pendingProps,w=!1,M=(s.flags&128)!==0,L;if((L=M)||(L=a!==null&&a.memoizedState===null?!1:(mn.current&2)!==0),L&&(w=!0,s.flags&=-129),L=(s.flags&32)!==0,s.flags&=-33,a===null){if(si){if(w?Sr(s):Sn(),(a=Bi)?(a=nu(a,rr),a=a!==null&&a.data!=="&"?a:null,a!==null&&(s.memoizedState={dehydrated:a,treeContext:cs!==null?{id:hs,overflow:ka}:null,retryLane:536870912,hydrationErrors:null},c=Ac(a),c.return=s,s.child=c,Kn=s,Bi=null)):a=null,a===null)throw Fa(s);return Nn(a)?s.lanes=32:s.lanes=536870912,null}var Z=g.children;return g=g.fallback,w?(Sn(),w=s.mode,Z=Yf({mode:"hidden",children:Z},w),g=ho(g,w,c,null),Z.return=s,g.return=s,Z.sibling=g,s.child=Z,g=s.child,g.memoizedState=Ph(c),g.childLanes=$f(a,L,c),s.memoizedState=Xf,wo(null,g)):(Sr(s),Jd(s,Z))}var ce=a.memoizedState;if(ce!==null&&(Z=ce.dehydrated,Z!==null)){if(M)s.flags&256?(Sr(s),s.flags&=-257,s=Qf(a,s,c)):s.memoizedState!==null?(Sn(),s.child=a.child,s.flags|=128,s=null):(Sn(),Z=g.fallback,w=s.mode,g=Yf({mode:"visible",children:g.children},w),Z=ho(Z,w,c,null),Z.flags|=2,g.return=s,Z.return=s,g.sibling=Z,s.child=g,xs(s,a.child,null,c),g=s.child,g.memoizedState=Ph(c),g.childLanes=$f(a,L,c),s.memoizedState=Xf,s=wo(null,g));else if(Sr(s),Nn(Z)){if(L=Z.nextSibling&&Z.nextSibling.dataset,L)var Re=L.dgst;L=Re,g=Error(fe(419)),g.stack="",g.digest=L,Bs({value:g,source:null,stack:null}),s=Qf(a,s,c)}else if(ta||sr(a,s,c,!1),L=(c&a.childLanes)!==0,ta||L){if(L=sn,L!==null&&(g=bl(L,c),g!==0&&g!==ce.retryLane))throw ce.retryLane=g,xr(a,g),Ir(L,a,g),Gf;qa(Z)||$h(),s=Qf(a,s,c)}else qa(Z)?(s.flags|=192,s.child=a.child,s=null):(a=ce.treeContext,Bi=Wr(Z.nextSibling),Kn=s,si=!0,Ls=null,rr=!1,a!==null&&Th(s,a),s=Jd(s,g.children),s.flags|=4096);return s}return w?(Sn(),Z=g.fallback,w=s.mode,ce=a.child,Re=ce.sibling,g=ar(ce,{mode:"hidden",children:g.children}),g.subtreeFlags=ce.subtreeFlags&65011712,Re!==null?Z=ar(Re,Z):(Z=ho(Z,w,c,null),Z.flags|=2),Z.return=s,g.return=s,g.sibling=Z,s.child=g,wo(null,g),g=s.child,Z=a.child.memoizedState,Z===null?Z=Ph(c):(w=Z.cachePool,w!==null?(ce=Tn._currentValue,w=w.parent!==ce?{parent:ce,pool:ce}:w):w=Vf(),Z={baseLanes:Z.baseLanes|c,cachePool:w}),g.memoizedState=Z,g.childLanes=$f(a,L,c),s.memoizedState=Xf,wo(a.child,g)):(Sr(s),c=a.child,a=c.sibling,c=ar(c,{mode:"visible",children:g.children}),c.return=s,c.sibling=null,a!==null&&(L=s.deletions,L===null?(s.deletions=[a],s.flags|=16):L.push(a)),s.child=c,s.memoizedState=null,c)}function Jd(a,s){return s=Yf({mode:"visible",children:s},a.mode),s.return=a,a.child=s}function Yf(a,s){return a=nr(22,a,null,s),a.lanes=0,a}function Qf(a,s,c){return xs(s,a.child,null,c),a=Jd(s,s.pendingProps.children),a.flags|=2,s.memoizedState=null,a}function ep(a,s,c){a.lanes|=s;var g=a.alternate;g!==null&&(g.lanes|=s),Cc(a.return,s,c)}function tp(a,s,c,g,w,M){var L=a.memoizedState;L===null?a.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:g,tail:c,tailMode:w,treeForkCount:M}:(L.isBackwards=s,L.rendering=null,L.renderingStartTime=0,L.last=g,L.tail=c,L.tailMode=w,L.treeForkCount=M)}function Wf(a,s,c){var g=s.pendingProps,w=g.revealOrder,M=g.tail;g=g.children;var L=mn.current,Z=(L&2)!==0;if(Z?(L=L&1|2,s.flags|=128):L&=1,ot(mn,L),ha(a,s,g,c),g=si?go:0,!Z&&a!==null&&(a.flags&128)!==0)e:for(a=s.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&ep(a,c,s);else if(a.tag===19)ep(a,c,s);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(w){case"forwards":for(c=s.child,w=null;c!==null;)a=c.alternate,a!==null&&qu(a)===null&&(w=c),c=c.sibling;c=w,c===null?(w=s.child,s.child=null):(w=c.sibling,c.sibling=null),tp(s,!1,w,c,M,g);break;case"backwards":case"unstable_legacy-backwards":for(c=null,w=s.child,s.child=null;w!==null;){if(a=w.alternate,a!==null&&qu(a)===null){s.child=w;break}a=w.sibling,w.sibling=c,c=w,w=a}tp(s,!0,c,null,M,g);break;case"together":tp(s,!1,null,null,void 0,g);break;default:s.memoizedState=null}return s.child}function To(a,s,c){if(a!==null&&(s.dependencies=a.dependencies),ul|=s.lanes,(c&s.childLanes)===0)if(a!==null){if(sr(a,s,c,!1),(c&s.childLanes)===0)return null}else return null;if(a!==null&&s.child!==a.child)throw Error(fe(153));if(s.child!==null){for(a=s.child,c=ar(a,a.pendingProps),s.child=c,c.return=s;a.sibling!==null;)a=a.sibling,c=c.sibling=ar(a,a.pendingProps),c.return=s;c.sibling=null}return s.child}function Ih(a,s){return(a.lanes&s)!==0?!0:(a=a.dependencies,!!(a!==null&&Nl(a)))}function Rh(a,s,c){switch(s.tag){case 3:ri(s,s.stateNode.containerInfo),ks(s,Tn,a.memoizedState.cache),ds();break;case 27:case 5:Xi(s);break;case 4:ri(s,s.stateNode.containerInfo);break;case 10:ks(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,Gl(s),null;break;case 13:var g=s.memoizedState;if(g!==null)return g.dehydrated!==null?(Sr(s),s.flags|=128,null):(c&s.child.childLanes)!==0?Kd(a,s,c):(Sr(s),a=To(a,s,c),a!==null?a.sibling:null);Sr(s);break;case 19:var w=(a.flags&128)!==0;if(g=(c&s.childLanes)!==0,g||(sr(a,s,c,!1),g=(c&s.childLanes)!==0),w){if(g)return Wf(a,s,c);s.flags|=128}if(w=s.memoizedState,w!==null&&(w.rendering=null,w.tail=null,w.lastEffect=null),ot(mn,mn.current),g)break;return null;case 22:return s.lanes=0,Qd(a,s,c,s.pendingProps);case 24:ks(s,Tn,a.memoizedState.cache)}return To(a,s,c)}function Ga(a,s,c){if(a!==null)if(a.memoizedProps!==s.pendingProps)ta=!0;else{if(!Ih(a,c)&&(s.flags&128)===0)return ta=!1,Rh(a,s,c);ta=(a.flags&131072)!==0}else ta=!1,si&&(s.flags&1048576)!==0&&wh(s,go,s.index);switch(s.lanes=0,s.tag){case 16:e:{var g=s.pendingProps;if(a=wr(s.elementType),s.type=a,typeof a=="function")Mc(a)?(g=bo(a,g),s.tag=1,s=lm(null,s,a,g,c)):(s.tag=0,s=Wd(null,s,a,g,c));else{if(a!=null){var w=a.$$typeof;if(w===Ot){s.tag=11,s=rm(null,s,a,g,c);break e}else if(w===Ct){s.tag=14,s=qf(null,s,a,g,c);break e}}throw s=ma(a)||a,Error(fe(306,s,""))}}return s;case 0:return Wd(a,s,s.type,s.pendingProps,c);case 1:return g=s.type,w=bo(g,s.pendingProps),lm(a,s,g,w,c);case 3:e:{if(ri(s,s.stateNode.containerInfo),a===null)throw Error(fe(387));g=s.pendingProps;var M=s.memoizedState;w=M.element,Vu(a,s),yo(s,g,null,c);var L=s.memoizedState;if(g=L.cache,ks(s,Tn,g),g!==M.cache&&zc(s,[Tn],c,!0),Vs(),g=L.element,M.isDehydrated)if(M={element:g,isDehydrated:!1,cache:L.cache},s.updateQueue.baseState=M,s.memoizedState=M,s.flags&256){s=um(a,s,g,c);break e}else if(g!==w){w=Ia(Error(fe(424)),s),Bs(w),s=um(a,s,g,c);break e}else for(a=s.stateNode.containerInfo,a.nodeType===9?a=a.body:a=a.nodeName==="HTML"?a.ownerDocument.body:a,Bi=Wr(a.firstChild),Kn=s,si=!0,Ls=null,rr=!0,c=Eh(s,null,g,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(ds(),g===w){s=To(a,s,c);break e}ha(a,s,g,c)}s=s.child}return s;case 26:return Hf(a,s),a===null?(c=Bp(s.type,null,s.pendingProps,null))?s.memoizedState=c:si||(c=s.type,a=s.pendingProps,g=ef(zt.current).createElement(c),g[ji]=s,g[Je]=a,da(g,c,a),fn(g),s.stateNode=g):s.memoizedState=Bp(s.type,a.memoizedProps,s.pendingProps,a.memoizedState),null;case 27:return Xi(s),a===null&&si&&(g=s.stateNode=Gm(s.type,s.pendingProps,zt.current),Kn=s,rr=!0,w=Bi,iu(s.type)?(dr=w,Bi=Wr(g.firstChild)):Bi=w),ha(a,s,s.pendingProps.children,c),Hf(a,s),a===null&&(s.flags|=4194304),s.child;case 5:return a===null&&si&&((w=g=Bi)&&(g=wa(g,s.type,s.pendingProps,rr),g!==null?(s.stateNode=g,Kn=s,Bi=Wr(g.firstChild),rr=!1,w=!0):w=!1),w||Fa(s)),Xi(s),w=s.type,M=s.pendingProps,L=a!==null?a.memoizedProps:null,g=M.children,Sd(w,M)?g=null:L!==null&&Sd(w,L)&&(s.flags|=32),s.memoizedState!==null&&(w=ql(a,s,Hu,null,null,c),rh._currentValue=w),Hf(a,s),ha(a,s,g,c),s.child;case 6:return a===null&&si&&((a=c=Bi)&&(c=Qs(c,s.pendingProps,rr),c!==null?(s.stateNode=c,Kn=s,Bi=null,a=!0):a=!1),a||Fa(s)),null;case 13:return Kd(a,s,c);case 4:return ri(s,s.stateNode.containerInfo),g=s.pendingProps,a===null?s.child=xs(s,null,g,c):ha(a,s,g,c),s.child;case 11:return rm(a,s,s.type,s.pendingProps,c);case 7:return ha(a,s,s.pendingProps,c),s.child;case 8:return ha(a,s,s.pendingProps.children,c),s.child;case 12:return ha(a,s,s.pendingProps.children,c),s.child;case 10:return g=s.pendingProps,ks(s,s.type,g.value),ha(a,s,g.children,c),s.child;case 9:return w=s.type._context,g=s.pendingProps.children,Fs(s),w=Pn(w),g=g(w),s.flags|=1,ha(a,s,g,c),s.child;case 14:return qf(a,s,s.type,s.pendingProps,c);case 15:return Yd(a,s,s.type,s.pendingProps,c);case 19:return Wf(a,s,c);case 31:return Zf(a,s,c);case 22:return Qd(a,s,c,s.pendingProps);case 24:return Fs(s),g=Pn(Tn),a===null?(w=Pc(),w===null&&(w=sn,M=_s(),w.pooledCache=M,M.refCount++,M!==null&&(w.pooledCacheLanes|=c),w=M),s.memoizedState={parent:g,cache:w},Oc(s),ks(s,Tn,w)):((a.lanes&c)!==0&&(Vu(a,s),yo(s,null,null,c),Vs()),w=a.memoizedState,M=s.memoizedState,w.parent!==g?(w={parent:g,cache:g},s.memoizedState=w,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=w),ks(s,Tn,g)):(g=M.cache,ks(s,Tn,g),g!==w.cache&&zc(s,[Tn],c,!0))),ha(a,s,s.pendingProps.children,c),s.child;case 29:throw s.pendingProps}throw Error(fe(156,s.tag))}function So(a){a.flags|=4}function Lh(a,s,c,g,w){if((s=(a.mode&32)!==0)&&(s=!1),s){if(a.flags|=16777216,(w&335544128)===w)if(a.stateNode.complete)a.flags|=8192;else if(dp())a.flags|=8192;else throw Ur=lt,_o}else a.flags&=-16777217}function cm(a,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!rf(s))if(dp())a.flags|=8192;else throw Ur=lt,_o}function Bh(a,s){s!==null&&(a.flags|=4),a.flags&16384&&(s=a.tag!==22?ni():536870912,a.lanes|=s,tc|=s)}function Oh(a,s){if(!si)switch(a.tailMode){case"hidden":s=a.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?a.tail=null:c.sibling=null;break;case"collapsed":c=a.tail;for(var g=null;c!==null;)c.alternate!==null&&(g=c),c=c.sibling;g===null?s||a.tail===null?a.tail=null:a.tail.sibling=null:g.sibling=null}}function yn(a){var s=a.alternate!==null&&a.alternate.child===a.child,c=0,g=0;if(s)for(var w=a.child;w!==null;)c|=w.lanes|w.childLanes,g|=w.subtreeFlags&65011712,g|=w.flags&65011712,w.return=a,w=w.sibling;else for(w=a.child;w!==null;)c|=w.lanes|w.childLanes,g|=w.subtreeFlags,g|=w.flags,w.return=a,w=w.sibling;return a.subtreeFlags|=g,a.childLanes=c,s}function hm(a,s,c){var g=s.pendingProps;switch(Fl(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yn(s),null;case 1:return yn(s),null;case 3:return c=s.stateNode,g=null,a!==null&&(g=a.memoizedState.cache),s.memoizedState.cache!==g&&(s.flags|=2048),gs(Tn),wi(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(a===null||a.child===null)&&(fs(s)?So(s):a===null||a.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,ps())),yn(s),null;case 26:var w=s.type,M=s.memoizedState;return a===null?(So(s),M!==null?(yn(s),cm(s,M)):(yn(s),Lh(s,w,null,g,c))):M?M!==a.memoizedState?(So(s),yn(s),cm(s,M)):(yn(s),s.flags&=-16777217):(a=a.memoizedProps,a!==g&&So(s),yn(s),Lh(s,w,a,g,c)),null;case 27:if(Un(s),c=zt.current,w=s.type,a!==null&&s.stateNode!=null)a.memoizedProps!==g&&So(s);else{if(!g){if(s.stateNode===null)throw Error(fe(166));return yn(s),null}a=yt.current,fs(s)?Na(s):(a=Gm(w,g,c),s.stateNode=a,So(s))}return yn(s),null;case 5:if(Un(s),w=s.type,a!==null&&s.stateNode!=null)a.memoizedProps!==g&&So(s);else{if(!g){if(s.stateNode===null)throw Error(fe(166));return yn(s),null}if(M=yt.current,fs(s))Na(s);else{var L=ef(zt.current);switch(M){case 1:M=L.createElementNS("http://www.w3.org/2000/svg",w);break;case 2:M=L.createElementNS("http://www.w3.org/1998/Math/MathML",w);break;default:switch(w){case"svg":M=L.createElementNS("http://www.w3.org/2000/svg",w);break;case"math":M=L.createElementNS("http://www.w3.org/1998/Math/MathML",w);break;case"script":M=L.createElement("div"),M.innerHTML="<script><\/script>",M=M.removeChild(M.firstChild);break;case"select":M=typeof g.is=="string"?L.createElement("select",{is:g.is}):L.createElement("select"),g.multiple?M.multiple=!0:g.size&&(M.size=g.size);break;default:M=typeof g.is=="string"?L.createElement(w,{is:g.is}):L.createElement(w)}}M[ji]=s,M[Je]=g;e:for(L=s.child;L!==null;){if(L.tag===5||L.tag===6)M.appendChild(L.stateNode);else if(L.tag!==4&&L.tag!==27&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===s)break e;for(;L.sibling===null;){if(L.return===null||L.return===s)break e;L=L.return}L.sibling.return=L.return,L=L.sibling}s.stateNode=M;e:switch(da(M,w,g),w){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}g&&So(s)}}return yn(s),Lh(s,s.type,a===null?null:a.memoizedProps,s.pendingProps,c),null;case 6:if(a&&s.stateNode!=null)a.memoizedProps!==g&&So(s);else{if(typeof g!="string"&&s.stateNode===null)throw Error(fe(166));if(a=zt.current,fs(s)){if(a=s.stateNode,c=s.memoizedProps,g=null,w=Kn,w!==null)switch(w.tag){case 27:case 5:g=w.memoizedProps}a[ji]=s,a=!!(a.nodeValue===c||g!==null&&g.suppressHydrationWarning===!0||Mp(a.nodeValue,c)),a||Fa(s,!0)}else a=ef(a).createTextNode(g),a[ji]=s,s.stateNode=a}return yn(s),null;case 31:if(c=s.memoizedState,a===null||a.memoizedState!==null){if(g=fs(s),c!==null){if(a===null){if(!g)throw Error(fe(318));if(a=s.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(fe(557));a[ji]=s}else ds(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;yn(s),a=!1}else c=ps(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=c),a=!0;if(!a)return s.flags&256?(un(s),s):(un(s),null);if((s.flags&128)!==0)throw Error(fe(558))}return yn(s),null;case 13:if(g=s.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(w=fs(s),g!==null&&g.dehydrated!==null){if(a===null){if(!w)throw Error(fe(318));if(w=s.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(fe(317));w[ji]=s}else ds(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;yn(s),w=!1}else w=ps(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=w),w=!0;if(!w)return s.flags&256?(un(s),s):(un(s),null)}return un(s),(s.flags&128)!==0?(s.lanes=c,s):(c=g!==null,a=a!==null&&a.memoizedState!==null,c&&(g=s.child,w=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(w=g.alternate.memoizedState.cachePool.pool),M=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(M=g.memoizedState.cachePool.pool),M!==w&&(g.flags|=2048)),c!==a&&c&&(s.child.flags|=8192),Bh(s,s.updateQueue),yn(s),null);case 4:return wi(),a===null&&Tp(s.stateNode.containerInfo),yn(s),null;case 10:return gs(s.type),yn(s),null;case 19:if(Ze(mn),g=s.memoizedState,g===null)return yn(s),null;if(w=(s.flags&128)!==0,M=g.rendering,M===null)if(w)Oh(g,!1);else{if(Rn!==0||a!==null&&(a.flags&128)!==0)for(a=s.child;a!==null;){if(M=qu(a),M!==null){for(s.flags|=128,Oh(g,!1),a=M.updateQueue,s.updateQueue=a,Bh(s,a),s.subtreeFlags=0,a=c,c=s.child;c!==null;)Ff(c,a),c=c.sibling;return ot(mn,mn.current&1|2),si&&Rs(s,g.treeForkCount),s.child}a=a.sibling}g.tail!==null&&On()>Zh&&(s.flags|=128,w=!0,Oh(g,!1),s.lanes=4194304)}else{if(!w)if(a=qu(M),a!==null){if(s.flags|=128,w=!0,a=a.updateQueue,s.updateQueue=a,Bh(s,a),Oh(g,!0),g.tail===null&&g.tailMode==="hidden"&&!M.alternate&&!si)return yn(s),null}else 2*On()-g.renderingStartTime>Zh&&c!==536870912&&(s.flags|=128,w=!0,Oh(g,!1),s.lanes=4194304);g.isBackwards?(M.sibling=s.child,s.child=M):(a=g.last,a!==null?a.sibling=M:s.child=M,g.last=M)}return g.tail!==null?(a=g.tail,g.rendering=a,g.tail=a.sibling,g.renderingStartTime=On(),a.sibling=null,c=mn.current,ot(mn,w?c&1|2:c&1),si&&Rs(s,g.treeForkCount),a):(yn(s),null);case 22:case 23:return un(s),Wo(),g=s.memoizedState!==null,a!==null?a.memoizedState!==null!==g&&(s.flags|=8192):g&&(s.flags|=8192),g?(c&536870912)!==0&&(s.flags&128)===0&&(yn(s),s.subtreeFlags&6&&(s.flags|=8192)):yn(s),c=s.updateQueue,c!==null&&Bh(s,c.retryQueue),c=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(c=a.memoizedState.cachePool.pool),g=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(g=s.memoizedState.cachePool.pool),g!==c&&(s.flags|=2048),a!==null&&Ze(Vr),null;case 24:return c=null,a!==null&&(c=a.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),gs(Tn),yn(s),null;case 25:return null;case 30:return null}throw Error(fe(156,s.tag))}function wg(a,s){switch(Fl(s),s.tag){case 1:return a=s.flags,a&65536?(s.flags=a&-65537|128,s):null;case 3:return gs(Tn),wi(),a=s.flags,(a&65536)!==0&&(a&128)===0?(s.flags=a&-65537|128,s):null;case 26:case 27:case 5:return Un(s),null;case 31:if(s.memoizedState!==null){if(un(s),s.alternate===null)throw Error(fe(340));ds()}return a=s.flags,a&65536?(s.flags=a&-65537|128,s):null;case 13:if(un(s),a=s.memoizedState,a!==null&&a.dehydrated!==null){if(s.alternate===null)throw Error(fe(340));ds()}return a=s.flags,a&65536?(s.flags=a&-65537|128,s):null;case 19:return Ze(mn),null;case 4:return wi(),null;case 10:return gs(s.type),null;case 22:case 23:return un(s),Wo(),a!==null&&Ze(Vr),a=s.flags,a&65536?(s.flags=a&-65537|128,s):null;case 24:return gs(Tn),null;case 25:return null;default:return null}}function Kf(a,s){switch(Fl(s),s.tag){case 3:gs(Tn),wi();break;case 26:case 27:case 5:Un(s);break;case 4:wi();break;case 31:s.memoizedState!==null&&un(s);break;case 13:un(s);break;case 19:Ze(mn);break;case 10:gs(s.type);break;case 22:case 23:un(s),Wo(),a!==null&&Ze(Vr);break;case 24:gs(Tn)}}function Uc(a,s){try{var c=s.updateQueue,g=c!==null?c.lastEffect:null;if(g!==null){var w=g.next;c=w;do{if((c.tag&a)===a){g=void 0;var M=c.create,L=c.inst;g=M(),L.destroy=g}c=c.next}while(c!==w)}}catch(Z){Ni(s,s.return,Z)}}function al(a,s,c){try{var g=s.updateQueue,w=g!==null?g.lastEffect:null;if(w!==null){var M=w.next;g=M;do{if((g.tag&a)===a){var L=g.inst,Z=L.destroy;if(Z!==void 0){L.destroy=void 0,w=s;var ce=c,Re=Z;try{Re()}catch(Ue){Ni(w,ce,Ue)}}}g=g.next}while(g!==M)}}catch(Ue){Ni(s,s.return,Ue)}}function fm(a){var s=a.updateQueue;if(s!==null){var c=a.stateNode;try{kc(s,c)}catch(g){Ni(a,a.return,g)}}}function dm(a,s,c){c.props=bo(a.type,a.memoizedProps),c.state=a.memoizedState;try{c.componentWillUnmount()}catch(g){Ni(a,s,g)}}function kh(a,s){try{var c=a.ref;if(c!==null){switch(a.tag){case 26:case 27:case 5:var g=a.stateNode;break;case 30:g=a.stateNode;break;default:g=a.stateNode}typeof c=="function"?a.refCleanup=c(g):c.current=g}}catch(w){Ni(a,s,w)}}function Yr(a,s){var c=a.ref,g=a.refCleanup;if(c!==null)if(typeof g=="function")try{g()}catch(w){Ni(a,s,w)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(w){Ni(a,s,w)}else c.current=null}function Jf(a){var s=a.type,c=a.memoizedProps,g=a.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":c.autoFocus&&g.focus();break e;case"img":c.src?g.src=c.src:c.srcSet&&(g.srcset=c.srcSet)}}catch(w){Ni(a,a.return,w)}}function ed(a,s,c){try{var g=a.stateNode;jm(g,a.type,c,s),g[Je]=s}catch(w){Ni(a,a.return,w)}}function $l(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&iu(a.type)||a.tag===4}function Wu(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||$l(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&iu(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function ip(a,s,c){var g=a.tag;if(g===5||g===6)a=a.stateNode,s?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(a,s):(s=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,s.appendChild(a),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=Fr));else if(g!==4&&(g===27&&iu(a.type)&&(c=a.stateNode,s=null),a=a.child,a!==null))for(ip(a,s,c),a=a.sibling;a!==null;)ip(a,s,c),a=a.sibling}function td(a,s,c){var g=a.tag;if(g===5||g===6)a=a.stateNode,s?c.insertBefore(a,s):c.appendChild(a);else if(g!==4&&(g===27&&iu(a.type)&&(c=a.stateNode),a=a.child,a!==null))for(td(a,s,c),a=a.sibling;a!==null;)td(a,s,c),a=a.sibling}function pm(a){var s=a.stateNode,c=a.memoizedProps;try{for(var g=a.type,w=s.attributes;w.length;)s.removeAttributeNode(w[0]);da(s,g,c),s[ji]=a,s[Je]=c}catch(M){Ni(a,a.return,M)}}var rl=!1,ia=!1,np=!1,mm=typeof WeakSet=="function"?WeakSet:Set,na=null;function Tg(a,s){if(a=a.containerInfo,Jh=cf,a=vc(a),Au(a)){if("selectionStart"in a)var c={start:a.selectionStart,end:a.selectionEnd};else e:{c=(c=a.ownerDocument)&&c.defaultView||window;var g=c.getSelection&&c.getSelection();if(g&&g.rangeCount!==0){c=g.anchorNode;var w=g.anchorOffset,M=g.focusNode;g=g.focusOffset;try{c.nodeType,M.nodeType}catch{c=null;break e}var L=0,Z=-1,ce=-1,Re=0,Ue=0,$e=a,Le=null;t:for(;;){for(var ke;$e!==c||w!==0&&$e.nodeType!==3||(Z=L+w),$e!==M||g!==0&&$e.nodeType!==3||(ce=L+g),$e.nodeType===3&&(L+=$e.nodeValue.length),(ke=$e.firstChild)!==null;)Le=$e,$e=ke;for(;;){if($e===a)break t;if(Le===c&&++Re===w&&(Z=L),Le===M&&++Ue===g&&(ce=L),(ke=$e.nextSibling)!==null)break;$e=Le,Le=$e.parentNode}$e=ke}c=Z===-1||ce===-1?null:{start:Z,end:ce}}else c=null}c=c||{start:0,end:0}}else c=null;for(Ep={focusedElem:a,selectionRange:c},cf=!1,na=s;na!==null;)if(s=na,a=s.child,(s.subtreeFlags&1028)!==0&&a!==null)a.return=s,na=a;else for(;na!==null;){switch(s=na,M=s.alternate,a=s.flags,s.tag){case 0:if((a&4)!==0&&(a=s.updateQueue,a=a!==null?a.events:null,a!==null))for(c=0;c<a.length;c++)w=a[c],w.ref.impl=w.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&M!==null){a=void 0,c=s,w=M.memoizedProps,M=M.memoizedState,g=c.stateNode;try{var bt=bo(c.type,w);a=g.getSnapshotBeforeUpdate(bt,M),g.__reactInternalSnapshotBeforeUpdate=a}catch(Bt){Ni(c,c.return,Bt)}}break;case 3:if((a&1024)!==0){if(a=s.stateNode.containerInfo,c=a.nodeType,c===9)Ys(a);else if(c===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Ys(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(fe(163))}if(a=s.sibling,a!==null){a.return=s.return,na=a;break}na=s.return}}function ap(a,s,c){var g=c.flags;switch(c.tag){case 0:case 11:case 15:zr(a,c),g&4&&Uc(5,c);break;case 1:if(zr(a,c),g&4)if(a=c.stateNode,s===null)try{a.componentDidMount()}catch(L){Ni(c,c.return,L)}else{var w=bo(c.type,s.memoizedProps);s=s.memoizedState;try{a.componentDidUpdate(w,s,a.__reactInternalSnapshotBeforeUpdate)}catch(L){Ni(c,c.return,L)}}g&64&&fm(c),g&512&&kh(c,c.return);break;case 3:if(zr(a,c),g&64&&(a=c.updateQueue,a!==null)){if(s=null,c.child!==null)switch(c.child.tag){case 27:case 5:s=c.child.stateNode;break;case 1:s=c.child.stateNode}try{kc(a,s)}catch(L){Ni(c,c.return,L)}}break;case 27:s===null&&g&4&&pm(c);case 26:case 5:zr(a,c),s===null&&g&4&&Jf(c),g&512&&kh(c,c.return);break;case 12:zr(a,c);break;case 31:zr(a,c),g&4&&Fh(a,c);break;case 13:zr(a,c),g&4&&Nh(a,c),g&64&&(a=c.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(c=mp.bind(null,c),ra(a,c))));break;case 22:if(g=c.memoizedState!==null||rl,!g){s=s!==null&&s.memoizedState!==null||ia,w=rl;var M=ia;rl=g,(ia=s)&&!M?sl(a,c,(c.subtreeFlags&8772)!==0):zr(a,c),rl=w,ia=M}break;case 30:break;default:zr(a,c)}}function Gc(a){var s=a.alternate;s!==null&&(a.alternate=null,Gc(s)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(s=a.stateNode,s!==null&&Po(s)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Mn=null,yi=!1;function Cr(a,s,c){for(c=c.child;c!==null;)rp(a,s,c),c=c.sibling}function rp(a,s,c){if(W&&typeof W.onCommitFiberUnmount=="function")try{W.onCommitFiberUnmount(_e,c)}catch{}switch(c.tag){case 26:ia||Yr(c,s),Cr(a,s,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:ia||Yr(c,s);var g=Mn,w=yi;iu(c.type)&&(Mn=c.stateNode,yi=!1),Cr(a,s,c),ih(c.stateNode),Mn=g,yi=w;break;case 5:ia||Yr(c,s);case 6:if(g=Mn,w=yi,Mn=null,Cr(a,s,c),Mn=g,yi=w,Mn!==null)if(yi)try{(Mn.nodeType===9?Mn.body:Mn.nodeName==="HTML"?Mn.ownerDocument.body:Mn).removeChild(c.stateNode)}catch(M){Ni(c,s,M)}else try{Mn.removeChild(c.stateNode)}catch(M){Ni(c,s,M)}break;case 18:Mn!==null&&(yi?(a=Mn,Um(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,c.stateNode),lu(a)):Um(Mn,c.stateNode));break;case 4:g=Mn,w=yi,Mn=c.stateNode.containerInfo,yi=!0,Cr(a,s,c),Mn=g,yi=w;break;case 0:case 11:case 14:case 15:al(2,c,s),ia||al(4,c,s),Cr(a,s,c);break;case 1:ia||(Yr(c,s),g=c.stateNode,typeof g.componentWillUnmount=="function"&&dm(c,s,g)),Cr(a,s,c);break;case 21:Cr(a,s,c);break;case 22:ia=(g=ia)||c.memoizedState!==null,Cr(a,s,c),ia=g;break;default:Cr(a,s,c)}}function Fh(a,s){if(s.memoizedState===null&&(a=s.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{lu(a)}catch(c){Ni(s,s.return,c)}}}function Nh(a,s){if(s.memoizedState===null&&(a=s.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{lu(a)}catch(c){Ni(s,s.return,c)}}function Vh(a){switch(a.tag){case 31:case 13:case 19:var s=a.stateNode;return s===null&&(s=a.stateNode=new mm),s;case 22:return a=a.stateNode,s=a._retryCache,s===null&&(s=a._retryCache=new mm),s;default:throw Error(fe(435,a.tag))}}function jh(a,s){var c=Vh(a);s.forEach(function(g){if(!c.has(g)){c.add(g);var w=Eg.bind(null,a,g);g.then(w,w)}})}function cr(a,s){var c=s.deletions;if(c!==null)for(var g=0;g<c.length;g++){var w=c[g],M=a,L=s,Z=L;e:for(;Z!==null;){switch(Z.tag){case 27:if(iu(Z.type)){Mn=Z.stateNode,yi=!1;break e}break;case 5:Mn=Z.stateNode,yi=!1;break e;case 3:case 4:Mn=Z.stateNode.containerInfo,yi=!0;break e}Z=Z.return}if(Mn===null)throw Error(fe(160));rp(M,L,w),Mn=null,yi=!1,M=w.alternate,M!==null&&(M.return=null),w.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)id(s,a),s=s.sibling}var hr=null;function id(a,s){var c=a.alternate,g=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:cr(s,a),fa(a),g&4&&(al(3,a,a.return),Uc(3,a),al(5,a,a.return));break;case 1:cr(s,a),fa(a),g&512&&(ia||c===null||Yr(c,c.return)),g&64&&rl&&(a=a.updateQueue,a!==null&&(g=a.callbacks,g!==null&&(c=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=c===null?g:c.concat(g))));break;case 26:var w=hr;if(cr(s,a),fa(a),g&512&&(ia||c===null||Yr(c,c.return)),g&4){var M=c!==null?c.memoizedState:null;if(g=a.memoizedState,c===null)if(g===null)if(a.stateNode===null){e:{g=a.type,c=a.memoizedProps,w=w.ownerDocument||w;t:switch(g){case"title":M=w.getElementsByTagName("title")[0],(!M||M[Vt]||M[ji]||M.namespaceURI==="http://www.w3.org/2000/svg"||M.hasAttribute("itemprop"))&&(M=w.createElement(g),w.head.insertBefore(M,w.querySelector("head > title"))),da(M,g,c),M[ji]=a,fn(M),g=M;break e;case"link":var L=Np("link","href",w).get(g+(c.href||""));if(L){for(var Z=0;Z<L.length;Z++)if(M=L[Z],M.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&M.getAttribute("rel")===(c.rel==null?null:c.rel)&&M.getAttribute("title")===(c.title==null?null:c.title)&&M.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){L.splice(Z,1);break t}}M=w.createElement(g),da(M,g,c),w.head.appendChild(M);break;case"meta":if(L=Np("meta","content",w).get(g+(c.content||""))){for(Z=0;Z<L.length;Z++)if(M=L[Z],M.getAttribute("content")===(c.content==null?null:""+c.content)&&M.getAttribute("name")===(c.name==null?null:c.name)&&M.getAttribute("property")===(c.property==null?null:c.property)&&M.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&M.getAttribute("charset")===(c.charSet==null?null:c.charSet)){L.splice(Z,1);break t}}M=w.createElement(g),da(M,g,c),w.head.appendChild(M);break;default:throw Error(fe(468,g))}M[ji]=a,fn(M),g=M}a.stateNode=g}else af(w,a.type,a.stateNode);else a.stateNode=Fp(w,g,a.memoizedProps);else M!==g?(M===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):M.count--,g===null?af(w,a.type,a.stateNode):Fp(w,g,a.memoizedProps)):g===null&&a.stateNode!==null&&ed(a,a.memoizedProps,c.memoizedProps)}break;case 27:cr(s,a),fa(a),g&512&&(ia||c===null||Yr(c,c.return)),c!==null&&g&4&&ed(a,a.memoizedProps,c.memoizedProps);break;case 5:if(cr(s,a),fa(a),g&512&&(ia||c===null||Yr(c,c.return)),a.flags&32){w=a.stateNode;try{Ps(w,"")}catch(bt){Ni(a,a.return,bt)}}g&4&&a.stateNode!=null&&(w=a.memoizedProps,ed(a,w,c!==null?c.memoizedProps:w)),g&1024&&(np=!0);break;case 6:if(cr(s,a),fa(a),g&4){if(a.stateNode===null)throw Error(fe(162));g=a.memoizedProps,c=a.stateNode;try{c.nodeValue=g}catch(bt){Ni(a,a.return,bt)}}break;case 3:if(Dd=null,w=hr,hr=Ad(s.containerInfo),cr(s,a),hr=w,fa(a),g&4&&c!==null&&c.memoizedState.isDehydrated)try{lu(s.containerInfo)}catch(bt){Ni(a,a.return,bt)}np&&(np=!1,Uh(a));break;case 4:g=hr,hr=Ad(a.stateNode.containerInfo),cr(s,a),fa(a),hr=g;break;case 12:cr(s,a),fa(a);break;case 31:cr(s,a),fa(a),g&4&&(g=a.updateQueue,g!==null&&(a.updateQueue=null,jh(a,g)));break;case 13:cr(s,a),fa(a),a.child.flags&8192&&a.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(rd=On()),g&4&&(g=a.updateQueue,g!==null&&(a.updateQueue=null,jh(a,g)));break;case 22:w=a.memoizedState!==null;var ce=c!==null&&c.memoizedState!==null,Re=rl,Ue=ia;if(rl=Re||w,ia=Ue||ce,cr(s,a),ia=Ue,rl=Re,fa(a),g&8192)e:for(s=a.stateNode,s._visibility=w?s._visibility&-2:s._visibility|1,w&&(c===null||ce||rl||ia||Hs(a)),c=null,s=a;;){if(s.tag===5||s.tag===26){if(c===null){ce=c=s;try{if(M=ce.stateNode,w)L=M.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none";else{Z=ce.stateNode;var $e=ce.memoizedProps.style,Le=$e!=null&&$e.hasOwnProperty("display")?$e.display:null;Z.style.display=Le==null||typeof Le=="boolean"?"":(""+Le).trim()}}catch(bt){Ni(ce,ce.return,bt)}}}else if(s.tag===6){if(c===null){ce=s;try{ce.stateNode.nodeValue=w?"":ce.memoizedProps}catch(bt){Ni(ce,ce.return,bt)}}}else if(s.tag===18){if(c===null){ce=s;try{var ke=ce.stateNode;w?Jt(ke,!0):Jt(ce.stateNode,!1)}catch(bt){Ni(ce,ce.return,bt)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===a)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;c===s&&(c=null),s=s.return}c===s&&(c=null),s.sibling.return=s.return,s=s.sibling}g&4&&(g=a.updateQueue,g!==null&&(c=g.retryQueue,c!==null&&(g.retryQueue=null,jh(a,c))));break;case 19:cr(s,a),fa(a),g&4&&(g=a.updateQueue,g!==null&&(a.updateQueue=null,jh(a,g)));break;case 30:break;case 21:break;default:cr(s,a),fa(a)}}function fa(a){var s=a.flags;if(s&2){try{for(var c,g=a.return;g!==null;){if($l(g)){c=g;break}g=g.return}if(c==null)throw Error(fe(160));switch(c.tag){case 27:var w=c.stateNode,M=Wu(a);td(a,M,w);break;case 5:var L=c.stateNode;c.flags&32&&(Ps(L,""),c.flags&=-33);var Z=Wu(a);td(a,Z,L);break;case 3:case 4:var ce=c.stateNode.containerInfo,Re=Wu(a);ip(a,Re,ce);break;default:throw Error(fe(161))}}catch(Ue){Ni(a,a.return,Ue)}a.flags&=-3}s&4096&&(a.flags&=-4097)}function Uh(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var s=a;Uh(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),a=a.sibling}}function zr(a,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)ap(a,s.alternate,s),s=s.sibling}function Hs(a){for(a=a.child;a!==null;){var s=a;switch(s.tag){case 0:case 11:case 14:case 15:al(4,s,s.return),Hs(s);break;case 1:Yr(s,s.return);var c=s.stateNode;typeof c.componentWillUnmount=="function"&&dm(s,s.return,c),Hs(s);break;case 27:ih(s.stateNode);case 26:case 5:Yr(s,s.return),Hs(s);break;case 22:s.memoizedState===null&&Hs(s);break;case 30:Hs(s);break;default:Hs(s)}a=a.sibling}}function sl(a,s,c){for(c=c&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var g=s.alternate,w=a,M=s,L=M.flags;switch(M.tag){case 0:case 11:case 15:sl(w,M,c),Uc(4,M);break;case 1:if(sl(w,M,c),g=M,w=g.stateNode,typeof w.componentDidMount=="function")try{w.componentDidMount()}catch(Re){Ni(g,g.return,Re)}if(g=M,w=g.updateQueue,w!==null){var Z=g.stateNode;try{var ce=w.shared.hiddenCallbacks;if(ce!==null)for(w.shared.hiddenCallbacks=null,w=0;w<ce.length;w++)ju(ce[w],Z)}catch(Re){Ni(g,g.return,Re)}}c&&L&64&&fm(M),kh(M,M.return);break;case 27:pm(M);case 26:case 5:sl(w,M,c),c&&g===null&&L&4&&Jf(M),kh(M,M.return);break;case 12:sl(w,M,c);break;case 31:sl(w,M,c),c&&L&4&&Fh(w,M);break;case 13:sl(w,M,c),c&&L&4&&Nh(w,M);break;case 22:M.memoizedState===null&&sl(w,M,c),kh(M,M.return);break;case 30:break;default:sl(w,M,c)}s=s.sibling}}function nd(a,s){var c=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(c=a.memoizedState.cachePool.pool),a=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(a=s.memoizedState.cachePool.pool),a!==c&&(a!=null&&a.refCount++,c!=null&&Vl(c))}function ol(a,s){a=null,s.alternate!==null&&(a=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==a&&(s.refCount++,a!=null&&Vl(a))}function Xs(a,s,c,g){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)sp(a,s,c,g),s=s.sibling}function sp(a,s,c,g){var w=s.flags;switch(s.tag){case 0:case 11:case 15:Xs(a,s,c,g),w&2048&&Uc(9,s);break;case 1:Xs(a,s,c,g);break;case 3:Xs(a,s,c,g),w&2048&&(a=null,s.alternate!==null&&(a=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==a&&(s.refCount++,a!=null&&Vl(a)));break;case 12:if(w&2048){Xs(a,s,c,g),a=s.stateNode;try{var M=s.memoizedProps,L=M.id,Z=M.onPostCommit;typeof Z=="function"&&Z(L,s.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(ce){Ni(s,s.return,ce)}}else Xs(a,s,c,g);break;case 31:Xs(a,s,c,g);break;case 13:Xs(a,s,c,g);break;case 23:break;case 22:M=s.stateNode,L=s.alternate,s.memoizedState!==null?M._visibility&2?Xs(a,s,c,g):Ku(a,s):M._visibility&2?Xs(a,s,c,g):(M._visibility|=2,Mo(a,s,c,g,(s.subtreeFlags&10256)!==0||!1)),w&2048&&nd(L,s);break;case 24:Xs(a,s,c,g),w&2048&&ol(s.alternate,s);break;default:Xs(a,s,c,g)}}function Mo(a,s,c,g,w){for(w=w&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var M=a,L=s,Z=c,ce=g,Re=L.flags;switch(L.tag){case 0:case 11:case 15:Mo(M,L,Z,ce,w),Uc(8,L);break;case 23:break;case 22:var Ue=L.stateNode;L.memoizedState!==null?Ue._visibility&2?Mo(M,L,Z,ce,w):Ku(M,L):(Ue._visibility|=2,Mo(M,L,Z,ce,w)),w&&Re&2048&&nd(L.alternate,L);break;case 24:Mo(M,L,Z,ce,w),w&&Re&2048&&ol(L.alternate,L);break;default:Mo(M,L,Z,ce,w)}s=s.sibling}}function Ku(a,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var c=a,g=s,w=g.flags;switch(g.tag){case 22:Ku(c,g),w&2048&&nd(g.alternate,g);break;case 24:Ku(c,g),w&2048&&ol(g.alternate,g);break;default:Ku(c,g)}s=s.sibling}}var qc=8192;function Ju(a,s,c){if(a.subtreeFlags&qc)for(a=a.child;a!==null;)gm(a,s,c),a=a.sibling}function gm(a,s,c){switch(a.tag){case 26:Ju(a,s,c),a.flags&qc&&a.memoizedState!==null&&Vp(c,hr,a.memoizedState,a.memoizedProps);break;case 5:Ju(a,s,c);break;case 3:case 4:var g=hr;hr=Ad(a.stateNode.containerInfo),Ju(a,s,c),hr=g;break;case 22:a.memoizedState===null&&(g=a.alternate,g!==null&&g.memoizedState!==null?(g=qc,qc=16777216,Ju(a,s,c),qc=g):Ju(a,s,c));break;default:Ju(a,s,c)}}function _m(a){var s=a.alternate;if(s!==null&&(a=s.child,a!==null)){s.child=null;do s=a.sibling,a.sibling=null,a=s;while(a!==null)}}function Gh(a){var s=a.deletions;if((a.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var g=s[c];na=g,Zc(g,a)}_m(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)ym(a),a=a.sibling}function ym(a){switch(a.tag){case 0:case 11:case 15:Gh(a),a.flags&2048&&al(9,a,a.return);break;case 3:Gh(a);break;case 12:Gh(a);break;case 22:var s=a.stateNode;a.memoizedState!==null&&s._visibility&2&&(a.return===null||a.return.tag!==13)?(s._visibility&=-3,ad(a)):Gh(a);break;default:Gh(a)}}function ad(a){var s=a.deletions;if((a.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var g=s[c];na=g,Zc(g,a)}_m(a)}for(a=a.child;a!==null;){switch(s=a,s.tag){case 0:case 11:case 15:al(8,s,s.return),ad(s);break;case 22:c=s.stateNode,c._visibility&2&&(c._visibility&=-3,ad(s));break;default:ad(s)}a=a.sibling}}function Zc(a,s){for(;na!==null;){var c=na;switch(c.tag){case 0:case 11:case 15:al(8,c,s);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var g=c.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:Vl(c.memoizedState.cache)}if(g=c.child,g!==null)g.return=c,na=g;else e:for(c=a;na!==null;){g=na;var w=g.sibling,M=g.return;if(Gc(g),g===c){na=null;break e}if(w!==null){w.return=M,na=w;break e}na=M}}}var Sg={getCacheForType:function(a){var s=Pn(Tn),c=s.data.get(a);return c===void 0&&(c=a(),s.data.set(a,c)),c},cacheSignal:function(){return Pn(Tn).controller.signal}},vm=typeof WeakMap=="function"?WeakMap:Map,Fi=0,sn=null,di=null,pi=0,qi=0,fr=null,Es=!1,Yl=!1,op=!1,ll=0,Rn=0,ul=0,ec=0,lp=0,Ra=0,tc=0,qh=null,Dr=null,up=!1,rd=0,xm=0,Zh=1/0,Hc=null,cl=null,aa=0,hl=null,Xc=null,As=0,cp=0,sd=null,bm=null,Hh=0,hp=null;function Pr(){return(Fi&2)!==0&&pi!==0?pi&-pi:je.T!==null?xp():_a()}function wm(){if(Ra===0)if((pi&536870912)===0||si){var a=li;li<<=1,(li&3932160)===0&&(li=262144),Ra=a}else Ra=536870912;return a=ct.current,a!==null&&(a.flags|=32),Ra}function Ir(a,s,c){(a===sn&&(qi===2||qi===9)||a.cancelPendingCommit!==null)&&(Yc(a,0),Ql(a,pi,Ra,!1)),Nt(a,c),((Fi&2)===0||a!==sn)&&(a===sn&&((Fi&2)===0&&(ec|=c),Rn===4&&Ql(a,pi,Ra,!1)),$s(a))}function $n(a,s,c){if((Fi&6)!==0)throw Error(fe(327));var g=!c&&(s&127)===0&&(s&a.expiredLanes)===0||Ki(a,s),w=g?Qc(a,s):ud(a,s,!0),M=g;do{if(w===0){Yl&&!g&&Ql(a,s,0,!1);break}else{if(c=a.current.alternate,M&&!Mg(c)){w=ud(a,s,!1),M=!1;continue}if(w===2){if(M=s,a.errorRecoveryDisabledLanes&M)var L=0;else L=a.pendingLanes&-536870913,L=L!==0?L:L&536870912?536870912:0;if(L!==0){s=L;e:{var Z=a;w=qh;var ce=Z.current.memoizedState.isDehydrated;if(ce&&(Yc(Z,L).flags|=256),L=ud(Z,L,!1),L!==2){if(op&&!ce){Z.errorRecoveryDisabledLanes|=M,ec|=M,w=4;break e}M=Dr,Dr=w,M!==null&&(Dr===null?Dr=M:Dr.push.apply(Dr,M))}w=L}if(M=!1,w!==2)continue}}if(w===1){Yc(a,0),Ql(a,s,0,!0);break}e:{switch(g=a,M=w,M){case 0:case 1:throw Error(fe(345));case 4:if((s&4194048)!==s)break;case 6:Ql(g,s,Ra,!Es);break e;case 2:Dr=null;break;case 3:case 5:break;default:throw Error(fe(329))}if((s&62914560)===s&&(w=rd+300-On(),10<w)){if(Ql(g,s,Ra,!Es),fi(g,0,!0)!==0)break e;As=s,g.timeoutHandle=Ed($c.bind(null,g,c,Dr,Hc,up,s,Ra,ec,tc,Es,M,"Throttled",-0,0),w);break e}$c(g,c,Dr,Hc,up,s,Ra,ec,tc,Es,M,null,-0,0)}}break}while(!0);$s(a)}function $c(a,s,c,g,w,M,L,Z,ce,Re,Ue,$e,Le,ke){if(a.timeoutHandle=-1,$e=s.subtreeFlags,$e&8192||($e&16785408)===16785408){$e={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Fr},gm(s,M,$e);var bt=(M&62914560)===M?rd-On():(M&4194048)===M?xm-On():0;if(bt=jp($e,bt),bt!==null){As=M,a.cancelPendingCommit=bt(Am.bind(null,a,s,M,c,g,w,L,Z,ce,Ue,$e,null,Le,ke)),Ql(a,M,L,!Re);return}}Am(a,s,M,c,g,w,L,Z,ce)}function Mg(a){for(var s=a;;){var c=s.tag;if((c===0||c===11||c===15)&&s.flags&16384&&(c=s.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var g=0;g<c.length;g++){var w=c[g],M=w.getSnapshot;w=w.value;try{if(!Oa(M(),w))return!1}catch{return!1}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===a)break;for(;s.sibling===null;){if(s.return===null||s.return===a)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Ql(a,s,c,g){s&=~lp,s&=~ec,a.suspendedLanes|=s,a.pingedLanes&=~s,g&&(a.warmLanes|=s),g=a.expirationTimes;for(var w=s;0<w;){var M=31-we(w),L=1<<M;g[M]=-1,w&=~L}c!==0&&Ri(a,c,s)}function Xh(){return(Fi&6)===0?(Qr(0),!1):!0}function od(){if(di!==null){if(qi===0)var a=di.return;else a=di,ms=br=null,Gs(a),ys=null,Yo=0,a=di;for(;a!==null;)Kf(a.alternate,a),a=a.return;di=null}}function Yc(a,s){var c=a.timeoutHandle;c!==-1&&(a.timeoutHandle=-1,Cp(c)),c=a.cancelPendingCommit,c!==null&&(a.cancelPendingCommit=null,c()),As=0,od(),sn=a,di=c=ar(a.current,null),pi=s,qi=0,fr=null,Es=!1,Yl=Ki(a,s),op=!1,tc=Ra=lp=ec=ul=Rn=0,Dr=qh=null,up=!1,(s&8)!==0&&(s|=s&32);var g=a.entangledLanes;if(g!==0)for(a=a.entanglements,g&=s;0<g;){var w=31-we(g),M=1<<w;s|=a[w],g&=~M}return ll=s,Zo(),c}function fp(a,s){Qt=null,je.H=Si,s===jr||s===Va?(s=Ul(),qi=3):s===_o?(s=Ul(),qi=4):qi=s===Gf?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,fr=s,di===null&&(Rn=1,$r(a,Ia(s,a.current)))}function dp(){var a=ct.current;return a===null?!0:(pi&4194048)===pi?vt===null:(pi&62914560)===pi||(pi&536870912)!==0?a===vt:!1}function ic(){var a=je.H;return je.H=Si,a===null?Si:a}function ld(){var a=je.A;return je.A=Sg,a}function $h(){Rn=4,Es||(pi&4194048)!==pi&&ct.current!==null||(Yl=!0),(ul&134217727)===0&&(ec&134217727)===0||sn===null||Ql(sn,pi,Ra,!1)}function ud(a,s,c){var g=Fi;Fi|=2;var w=ic(),M=ld();(sn!==a||pi!==s)&&(Hc=null,Yc(a,s)),s=!1;var L=Rn;e:do try{if(qi!==0&&di!==null){var Z=di,ce=fr;switch(qi){case 8:od(),L=6;break e;case 3:case 2:case 9:case 6:ct.current===null&&(s=!0);var Re=qi;if(qi=0,fr=null,Wc(a,Z,ce,Re),c&&Yl){L=0;break e}break;default:Re=qi,qi=0,fr=null,Wc(a,Z,ce,Re)}}cd(),L=Rn;break}catch(Ue){fp(a,Ue)}while(!0);return s&&a.shellSuspendCounter++,ms=br=null,Fi=g,je.H=w,je.A=M,di===null&&(sn=null,pi=0,Zo()),L}function cd(){for(;di!==null;)Sm(di)}function Qc(a,s){var c=Fi;Fi|=2;var g=ic(),w=ld();sn!==a||pi!==s?(Hc=null,Zh=On()+500,Yc(a,s)):Yl=Ki(a,s);e:do try{if(qi!==0&&di!==null){s=di;var M=fr;t:switch(qi){case 1:qi=0,fr=null,Wc(a,s,M,1);break;case 2:case 9:if(ku(M)){qi=0,fr=null,Mm(s);break}s=function(){qi!==2&&qi!==9||sn!==a||(qi=7),$s(a)},M.then(s,s);break e;case 3:qi=7;break e;case 4:qi=5;break e;case 7:ku(M)?(qi=0,fr=null,Mm(s)):(qi=0,fr=null,Wc(a,s,M,7));break;case 5:var L=null;switch(di.tag){case 26:L=di.memoizedState;case 5:case 27:var Z=di;if(L?rf(L):Z.stateNode.complete){qi=0,fr=null;var ce=Z.sibling;if(ce!==null)di=ce;else{var Re=Z.return;Re!==null?(di=Re,hd(Re)):di=null}break t}}qi=0,fr=null,Wc(a,s,M,5);break;case 6:qi=0,fr=null,Wc(a,s,M,6);break;case 8:od(),Rn=6;break e;default:throw Error(fe(462))}}Tm();break}catch(Ue){fp(a,Ue)}while(!0);return ms=br=null,je.H=g,je.A=w,Fi=c,di!==null?0:(sn=null,pi=0,Zo(),Rn)}function Tm(){for(;di!==null&&!Ba();)Sm(di)}function Sm(a){var s=Ga(a.alternate,a,ll);a.memoizedProps=a.pendingProps,s===null?hd(a):di=s}function Mm(a){var s=a,c=s.alternate;switch(s.tag){case 15:case 0:s=om(c,s,s.pendingProps,s.type,void 0,pi);break;case 11:s=om(c,s,s.pendingProps,s.type.render,s.ref,pi);break;case 5:Gs(s);default:Kf(c,s),s=di=Ff(s,ll),s=Ga(c,s,ll)}a.memoizedProps=a.pendingProps,s===null?hd(a):di=s}function Wc(a,s,c,g){ms=br=null,Gs(s),ys=null,Yo=0;var w=s.return;try{if(Uf(a,w,s,c,pi)){Rn=1,$r(a,Ia(c,a.current)),di=null;return}}catch(M){if(w!==null)throw di=w,M;Rn=1,$r(a,Ia(c,a.current)),di=null;return}s.flags&32768?(si||g===1?a=!0:Yl||(pi&536870912)!==0?a=!1:(Es=a=!0,(g===2||g===9||g===3||g===6)&&(g=ct.current,g!==null&&g.tag===13&&(g.flags|=16384))),Em(s,a)):hd(s)}function hd(a){var s=a;do{if((s.flags&32768)!==0){Em(s,Es);return}a=s.return;var c=hm(s.alternate,s,ll);if(c!==null){di=c;return}if(s=s.sibling,s!==null){di=s;return}di=s=a}while(s!==null);Rn===0&&(Rn=5)}function Em(a,s){do{var c=wg(a.alternate,a);if(c!==null){c.flags&=32767,di=c;return}if(c=a.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!s&&(a=a.sibling,a!==null)){di=a;return}di=a=c}while(a!==null);Rn=6,di=null}function Am(a,s,c,g,w,M,L,Z,ce){a.cancelPendingCommit=null;do fd();while(aa!==0);if((Fi&6)!==0)throw Error(fe(327));if(s!==null){if(s===a.current)throw Error(fe(177));if(M=s.lanes|s.childLanes,M|=qo,Ji(a,c,M,L,Z,ce),a===sn&&(di=sn=null,pi=0),Xc=s,hl=a,As=c,cp=M,sd=w,bm=g,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,Rm(V,function(){return Im(),null})):(a.callbackNode=null,a.callbackPriority=0),g=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||g){g=je.T,je.T=null,w=it.p,it.p=2,L=Fi,Fi|=4;try{Tg(a,s,c)}finally{Fi=L,it.p=w,je.T=g}}aa=1,Cm(),zm(),Dm()}}function Cm(){if(aa===1){aa=0;var a=hl,s=Xc,c=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||c){c=je.T,je.T=null;var g=it.p;it.p=2;var w=Fi;Fi|=4;try{id(s,a);var M=Ep,L=vc(a.containerInfo),Z=M.focusedElem,ce=M.selectionRange;if(L!==Z&&Z&&Z.ownerDocument&&yc(Z.ownerDocument.documentElement,Z)){if(ce!==null&&Au(Z)){var Re=ce.start,Ue=ce.end;if(Ue===void 0&&(Ue=Re),"selectionStart"in Z)Z.selectionStart=Re,Z.selectionEnd=Math.min(Ue,Z.value.length);else{var $e=Z.ownerDocument||document,Le=$e&&$e.defaultView||window;if(Le.getSelection){var ke=Le.getSelection(),bt=Z.textContent.length,Bt=Math.min(ce.start,bt),Zi=ce.end===void 0?Bt:Math.min(ce.end,bt);!ke.extend&&Bt>Zi&&(L=Zi,Zi=Bt,Bt=L);var xe=Eu(Z,Bt),me=Eu(Z,Zi);if(xe&&me&&(ke.rangeCount!==1||ke.anchorNode!==xe.node||ke.anchorOffset!==xe.offset||ke.focusNode!==me.node||ke.focusOffset!==me.offset)){var De=$e.createRange();De.setStart(xe.node,xe.offset),ke.removeAllRanges(),Bt>Zi?(ke.addRange(De),ke.extend(me.node,me.offset)):(De.setEnd(me.node,me.offset),ke.addRange(De))}}}}for($e=[],ke=Z;ke=ke.parentNode;)ke.nodeType===1&&$e.push({element:ke,left:ke.scrollLeft,top:ke.scrollTop});for(typeof Z.focus=="function"&&Z.focus(),Z=0;Z<$e.length;Z++){var He=$e[Z];He.element.scrollLeft=He.left,He.element.scrollTop=He.top}}cf=!!Jh,Ep=Jh=null}finally{Fi=w,it.p=g,je.T=c}}a.current=s,aa=2}}function zm(){if(aa===2){aa=0;var a=hl,s=Xc,c=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||c){c=je.T,je.T=null;var g=it.p;it.p=2;var w=Fi;Fi|=4;try{ap(a,s.alternate,s)}finally{Fi=w,it.p=g,je.T=c}}aa=3}}function Dm(){if(aa===4||aa===3){aa=0,Wa();var a=hl,s=Xc,c=As,g=bm;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?aa=5:(aa=0,Xc=hl=null,Pm(a,a.pendingLanes));var w=a.pendingLanes;if(w===0&&(cl=null),Qe(c),s=s.stateNode,W&&typeof W.onCommitFiberRoot=="function")try{W.onCommitFiberRoot(_e,s,void 0,(s.current.flags&128)===128)}catch{}if(g!==null){s=je.T,w=it.p,it.p=2,je.T=null;try{for(var M=a.onRecoverableError,L=0;L<g.length;L++){var Z=g[L];M(Z.value,{componentStack:Z.stack})}}finally{je.T=s,it.p=w}}(As&3)!==0&&fd(),$s(a),w=a.pendingLanes,(c&261930)!==0&&(w&42)!==0?a===hp?Hh++:(Hh=0,hp=a):Hh=0,Qr(0)}}function Pm(a,s){(a.pooledCacheLanes&=s)===0&&(s=a.pooledCache,s!=null&&(a.pooledCache=null,Vl(s)))}function fd(){return Cm(),zm(),Dm(),Im()}function Im(){if(aa!==5)return!1;var a=hl,s=cp;cp=0;var c=Qe(As),g=je.T,w=it.p;try{it.p=32>c?32:c,je.T=null,c=sd,sd=null;var M=hl,L=As;if(aa=0,Xc=hl=null,As=0,(Fi&6)!==0)throw Error(fe(331));var Z=Fi;if(Fi|=4,ym(M.current),sp(M,M.current,L,c),Fi=Z,Qr(0,!1),W&&typeof W.onPostCommitFiberRoot=="function")try{W.onPostCommitFiberRoot(_e,M)}catch{}return!0}finally{it.p=w,je.T=g,Pm(a,s)}}function pp(a,s,c){s=Ia(c,s),s=$u(a.stateNode,s,2),a=Ns(a,s,2),a!==null&&(Nt(a,2),$s(a))}function Ni(a,s,c){if(a.tag===3)pp(a,a,c);else for(;s!==null;){if(s.tag===3){pp(s,a,c);break}else if(s.tag===1){var g=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(cl===null||!cl.has(g))){a=Ia(c,a),c=Yu(2),g=Ns(s,c,2),g!==null&&(Qu(c,g,s,a),Nt(g,2),$s(g));break}}s=s.return}}function dd(a,s,c){var g=a.pingCache;if(g===null){g=a.pingCache=new vm;var w=new Set;g.set(s,w)}else w=g.get(s),w===void 0&&(w=new Set,g.set(s,w));w.has(c)||(op=!0,w.add(c),a=Wl.bind(null,a,s,c),s.then(a,a))}function Wl(a,s,c){var g=a.pingCache;g!==null&&g.delete(s),a.pingedLanes|=a.suspendedLanes&c,a.warmLanes&=~c,sn===a&&(pi&c)===c&&(Rn===4||Rn===3&&(pi&62914560)===pi&&300>On()-rd?(Fi&2)===0&&Yc(a,0):lp|=c,tc===pi&&(tc=0)),$s(a)}function Yh(a,s){s===0&&(s=ni()),a=xr(a,s),a!==null&&(Nt(a,s),$s(a))}function mp(a){var s=a.memoizedState,c=0;s!==null&&(c=s.retryLane),Yh(a,c)}function Eg(a,s){var c=0;switch(a.tag){case 31:case 13:var g=a.stateNode,w=a.memoizedState;w!==null&&(c=w.retryLane);break;case 19:g=a.stateNode;break;case 22:g=a.stateNode._retryCache;break;default:throw Error(fe(314))}g!==null&&g.delete(s),Yh(a,c)}function Rm(a,s){return es(a,s)}var pd=null,Kc=null,gp=!1,md=!1,_p=!1,fl=0;function $s(a){a!==Kc&&a.next===null&&(Kc===null?pd=Kc=a:Kc=Kc.next=a),md=!0,gp||(gp=!0,vp())}function Qr(a,s){if(!_p&&md){_p=!0;do for(var c=!1,g=pd;g!==null;){if(a!==0){var w=g.pendingLanes;if(w===0)var M=0;else{var L=g.suspendedLanes,Z=g.pingedLanes;M=(1<<31-we(42|a)+1)-1,M&=w&~(L&~Z),M=M&201326741?M&201326741|1:M?M|2:0}M!==0&&(c=!0,Qh(g,M))}else M=pi,M=fi(g,g===sn?M:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(M&3)===0||Ki(g,M)||(c=!0,Qh(g,M));g=g.next}while(c);_p=!1}}function Kl(){yp()}function yp(){md=gp=!1;var a=0;fl!==0&&Md()&&(a=fl);for(var s=On(),c=null,g=pd;g!==null;){var w=g.next,M=gd(g,s);M===0?(g.next=null,c===null?pd=w:c.next=w,w===null&&(Kc=c)):(c=g,(a!==0||(M&3)!==0)&&(md=!0)),g=w}aa!==0&&aa!==5||Qr(a),fl!==0&&(fl=0)}function gd(a,s){for(var c=a.suspendedLanes,g=a.pingedLanes,w=a.expirationTimes,M=a.pendingLanes&-62914561;0<M;){var L=31-we(M),Z=1<<L,ce=w[L];ce===-1?((Z&c)===0||(Z&g)!==0)&&(w[L]=Pt(Z,s)):ce<=s&&(a.expiredLanes|=Z),M&=~Z}if(s=sn,c=pi,c=fi(a,a===s?c:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),g=a.callbackNode,c===0||a===s&&(qi===2||qi===9)||a.cancelPendingCommit!==null)return g!==null&&g!==null&&Gn(g),a.callbackNode=null,a.callbackPriority=0;if((c&3)===0||Ki(a,c)){if(s=c&-c,s===a.callbackPriority)return s;switch(g!==null&&Gn(g),Qe(c)){case 2:case 8:c=j;break;case 32:c=V;break;case 268435456:c=oe;break;default:c=V}return g=Lm.bind(null,a),c=es(c,g),a.callbackPriority=s,a.callbackNode=c,s}return g!==null&&g!==null&&Gn(g),a.callbackPriority=2,a.callbackNode=null,2}function Lm(a,s){if(aa!==0&&aa!==5)return a.callbackNode=null,a.callbackPriority=0,null;var c=a.callbackNode;if(fd()&&a.callbackNode!==c)return null;var g=pi;return g=fi(a,a===sn?g:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),g===0?null:($n(a,g,s),gd(a,On()),a.callbackNode!=null&&a.callbackNode===c?Lm.bind(null,a):null)}function Qh(a,s){if(fd())return null;$n(a,s,!0)}function vp(){Dp(function(){(Fi&6)!==0?es(ye,Kl):yp()})}function xp(){if(fl===0){var a=$o;a===0&&(a=Et,Et<<=1,(Et&261888)===0&&(Et=256)),fl=a}return fl}function _d(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:qt(""+a)}function yd(a,s){var c=s.ownerDocument.createElement("input");return c.name=s.name,c.value=s.value,a.id&&c.setAttribute("form",a.id),s.parentNode.insertBefore(c,s),a=new FormData(a),c.parentNode.removeChild(c),a}function Jc(a,s,c,g,w){if(s==="submit"&&c&&c.stateNode===w){var M=_d((w[Je]||null).action),L=g.submitter;L&&(s=(s=L[Je]||null)?_d(s.formAction):L.getAttribute("formAction"),s!==null&&(M=s,L=null));var Z=new mu("action","action",null,g,w);a.push({event:Z,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(fl!==0){var ce=L?yd(w,L):new FormData(w);gn(c,{pending:!0,data:ce,method:w.method,action:M},null,ce)}}else typeof M=="function"&&(Z.preventDefault(),ce=L?yd(w,L):new FormData(w),gn(c,{pending:!0,data:ce,method:w.method,action:M},M,ce))},currentTarget:w}]})}}for(var vd=0;vd<Tc.length;vd++){var xd=Tc[vd],bp=xd.toLowerCase(),Bm=xd[0].toUpperCase()+xd.slice(1);ir(bp,"on"+Bm)}ir(Du,"onAnimationEnd"),ir(Pu,"onAnimationIteration"),ir(wc,"onAnimationStart"),ir("dblclick","onDoubleClick"),ir("focusin","onFocus"),ir("focusout","onBlur"),ir(Go,"onTransitionRun"),ir(Iu,"onTransitionStart"),ir(Bl,"onTransitionCancel"),ir(tr,"onTransitionEnd"),Ds("onMouseEnter",["mouseout","mouseover"]),Ds("onMouseLeave",["mouseout","mouseover"]),Ds("onPointerEnter",["pointerout","pointerover"]),Ds("onPointerLeave",["pointerout","pointerover"]),ui("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ui("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ui("onBeforeInput",["compositionend","keypress","textInput","paste"]),ui("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ui("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ui("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Jl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Om=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Jl));function km(a,s){s=(s&4)!==0;for(var c=0;c<a.length;c++){var g=a[c],w=g.event;g=g.listeners;e:{var M=void 0;if(s)for(var L=g.length-1;0<=L;L--){var Z=g[L],ce=Z.instance,Re=Z.currentTarget;if(Z=Z.listener,ce!==M&&w.isPropagationStopped())break e;M=Z,w.currentTarget=Re;try{M(w)}catch(Ue){us(Ue)}w.currentTarget=null,M=ce}else for(L=0;L<g.length;L++){if(Z=g[L],ce=Z.instance,Re=Z.currentTarget,Z=Z.listener,ce!==M&&w.isPropagationStopped())break e;M=Z,w.currentTarget=Re;try{M(w)}catch(Ue){us(Ue)}w.currentTarget=null,M=ce}}}}function mi(a,s){var c=s[Zt];c===void 0&&(c=s[Zt]=new Set);var g=a+"__bubble";c.has(g)||(wd(s,a,2,!1),c.add(g))}function wp(a,s,c){var g=0;s&&(g|=4),wd(c,a,g,s)}var bd="_reactListening"+Math.random().toString(36).slice(2);function Tp(a){if(!a[bd]){a[bd]=!0,wl.forEach(function(c){c!=="selectionchange"&&(Om.has(c)||wp(c,!1,a),wp(c,!0,a))});var s=a.nodeType===9?a:a.ownerDocument;s===null||s[bd]||(s[bd]=!0,wp("selectionchange",!1,s))}}function wd(a,s,c,g){switch(rc(s)){case 2:var w=hf;break;case 8:w=Wm;break;default:w=Gp}c=w.bind(null,s,c,a),w=void 0,!Aa||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(w=!0),g?w!==void 0?a.addEventListener(s,c,{capture:!0,passive:w}):a.addEventListener(s,c,!0):w!==void 0?a.addEventListener(s,c,{passive:w}):a.addEventListener(s,c,!1)}function Eo(a,s,c,g,w){var M=g;if((s&1)===0&&(s&2)===0&&g!==null)e:for(;;){if(g===null)return;var L=g.tag;if(L===3||L===4){var Z=g.stateNode.containerInfo;if(Z===w)break;if(L===4)for(L=g.return;L!==null;){var ce=L.tag;if((ce===3||ce===4)&&L.stateNode.containerInfo===w)return;L=L.return}for(;Z!==null;){if(L=is(Z),L===null)return;if(ce=L.tag,ce===5||ce===6||ce===26||ce===27){g=M=L;continue e}Z=Z.parentNode}}g=g.return}Li(function(){var Re=M,Ue=pu(c),$e=[];e:{var Le=vh.get(a);if(Le!==void 0){var ke=mu,bt=a;switch(a){case"keypress":if(er(c)===0)break e;case"keydown":case"keyup":ke=pn;break;case"focusin":bt="focus",ke=ao;break;case"focusout":bt="blur",ke=ao;break;case"beforeblur":case"afterblur":ke=ao;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ke=Fo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ke=gu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ke=Hd;break;case Du:case Pu:case wc:ke=Ef;break;case tr:ke=pc;break;case"scroll":case"scrollend":ke=ko;break;case"wheel":ke=ph;break;case"copy":case"cut":case"paste":ke=fh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ke=dc;break;case"toggle":case"beforetoggle":ke=zl}var Bt=(s&4)!==0,Zi=!Bt&&(a==="scroll"||a==="scrollend"),xe=Bt?Le!==null?Le+"Capture":null:Le;Bt=[];for(var me=Re,De;me!==null;){var He=me;if(De=He.stateNode,He=He.tag,He!==5&&He!==26&&He!==27||De===null||xe===null||(He=gr(me,xe),He!=null&&Bt.push(eh(me,He,De))),Zi)break;me=me.return}0<Bt.length&&(Le=new ke(Le,bt,null,c,Ue),$e.push({event:Le,listeners:Bt}))}}if((s&7)===0){e:{if(Le=a==="mouseover"||a==="pointerover",ke=a==="mouseout"||a==="pointerout",Le&&c!==hh&&(bt=c.relatedTarget||c.fromElement)&&(is(bt)||bt[jt]))break e;if((ke||Le)&&(Le=Ue.window===Ue?Ue:(Le=Ue.ownerDocument)?Le.defaultView||Le.parentWindow:window,ke?(bt=c.relatedTarget||c.toElement,ke=Re,bt=bt?is(bt):null,bt!==null&&(Zi=_t(bt),Bt=bt.tag,bt!==Zi||Bt!==5&&Bt!==27&&Bt!==6)&&(bt=null)):(ke=null,bt=Re),ke!==bt)){if(Bt=Fo,He="onMouseLeave",xe="onMouseEnter",me="mouse",(a==="pointerout"||a==="pointerover")&&(Bt=dc,He="onPointerLeave",xe="onPointerEnter",me="pointer"),Zi=ke==null?Le:ns(ke),De=bt==null?Le:ns(bt),Le=new Bt(He,me+"leave",ke,c,Ue),Le.target=Zi,Le.relatedTarget=De,He=null,is(Ue)===Re&&(Bt=new Bt(xe,me+"enter",bt,c,Ue),Bt.target=De,Bt.relatedTarget=Zi,He=Bt),Zi=He,ke&&bt)t:{for(Bt=Fm,xe=ke,me=bt,De=0,He=xe;He;He=Bt(He))De++;He=0;for(var Rt=me;Rt;Rt=Bt(Rt))He++;for(;0<De-He;)xe=Bt(xe),De--;for(;0<He-De;)me=Bt(me),He--;for(;De--;){if(xe===me||me!==null&&xe===me.alternate){Bt=xe;break t}xe=Bt(xe),me=Bt(me)}Bt=null}else Bt=null;ke!==null&&Sp($e,Le,ke,Bt,!1),bt!==null&&Zi!==null&&Sp($e,Zi,bt,Bt,!0)}}e:{if(Le=Re?ns(Re):window,ke=Le.nodeName&&Le.nodeName.toLowerCase(),ke==="select"||ke==="input"&&Le.type==="file")var zi=oo;else if(gc(Le))if(mh)zi=Of;else{zi=Bf;var wt=Xd}else ke=Le.nodeName,!ke||ke.toLowerCase()!=="input"||Le.type!=="checkbox"&&Le.type!=="radio"?Re&&Lo(Re.elementType)&&(zi=oo):zi=Mu;if(zi&&(zi=zi(a,Re))){_c($e,zi,c,Ue);break e}wt&&wt(a,Le,Re),a==="focusout"&&Re&&Le.type==="number"&&Re.memoizedProps.value!=null&&du(Le,"number",Le.value)}switch(wt=Re?ns(Re):window,a){case"focusin":(gc(wt)||wt.contentEditable==="true")&&(vr=wt,Cu=Re,zu=null);break;case"focusout":zu=Cu=vr=null;break;case"mousedown":bc=!0;break;case"contextmenu":case"mouseup":case"dragend":bc=!1,kf($e,c,Ue);break;case"selectionchange":if(xc)break;case"keydown":case"keyup":kf($e,c,Ue)}var Dt;if(wn)e:{switch(a){case"compositionstart":var hi="onCompositionStart";break e;case"compositionend":hi="onCompositionEnd";break e;case"compositionupdate":hi="onCompositionUpdate";break e}hi=void 0}else Nr?bu(a,c)&&(hi="onCompositionEnd"):a==="keydown"&&c.keyCode===229&&(hi="onCompositionStart");hi&&(Rl&&c.locale!=="ko"&&(Nr||hi!=="onCompositionStart"?hi==="onCompositionEnd"&&Nr&&(Dt=io()):(Ja=Ue,ss="value"in Ja?Ja.value:Ja.textContent,Nr=!0)),wt=Wh(Re,hi),0<wt.length&&(hi=new dh(hi,a,null,c,Ue),$e.push({event:hi,listeners:wt}),Dt?hi.data=Dt:(Dt=Df(c),Dt!==null&&(hi.data=Dt)))),(Dt=Il?mc(a,c):Pf(a,c))&&(hi=Wh(Re,"onBeforeInput"),0<hi.length&&(wt=new dh("onBeforeInput","beforeinput",null,c,Ue),$e.push({event:wt,listeners:hi}),wt.data=Dt)),Jc($e,a,Re,c,Ue)}km($e,s)})}function eh(a,s,c){return{instance:a,listener:s,currentTarget:c}}function Wh(a,s){for(var c=s+"Capture",g=[];a!==null;){var w=a,M=w.stateNode;if(w=w.tag,w!==5&&w!==26&&w!==27||M===null||(w=gr(a,c),w!=null&&g.unshift(eh(a,w,M)),w=gr(a,s),w!=null&&g.push(eh(a,w,M))),a.tag===3)return g;a=a.return}return[]}function Fm(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function Sp(a,s,c,g,w){for(var M=s._reactName,L=[];c!==null&&c!==g;){var Z=c,ce=Z.alternate,Re=Z.stateNode;if(Z=Z.tag,ce!==null&&ce===g)break;Z!==5&&Z!==26&&Z!==27||Re===null||(ce=Re,w?(Re=gr(c,M),Re!=null&&L.unshift(eh(c,Re,ce))):w||(Re=gr(c,M),Re!=null&&L.push(eh(c,Re,ce)))),c=c.return}L.length!==0&&a.push({event:s,listeners:L})}var Nm=/\r\n?/g,Vm=/\u0000|\uFFFD/g;function Kh(a){return(typeof a=="string"?a:""+a).replace(Nm,`
`).replace(Vm,"")}function Mp(a,s){return s=Kh(s),Kh(a)===s}function Ci(a,s,c,g,w,M){switch(c){case"children":typeof g=="string"?s==="body"||s==="textarea"&&g===""||Ps(a,g):(typeof g=="number"||typeof g=="bigint")&&s!=="body"&&Ps(a,""+g);break;case"className":rs(a,"class",g);break;case"tabIndex":rs(a,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":rs(a,c,g);break;case"style":fc(a,g,M);break;case"data":if(s!=="object"){rs(a,"data",g);break}case"src":case"href":if(g===""&&(s!=="a"||c!=="href")){a.removeAttribute(c);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){a.removeAttribute(c);break}g=qt(""+g),a.setAttribute(c,g);break;case"action":case"formAction":if(typeof g=="function"){a.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof M=="function"&&(c==="formAction"?(s!=="input"&&Ci(a,s,"name",w.name,w,null),Ci(a,s,"formEncType",w.formEncType,w,null),Ci(a,s,"formMethod",w.formMethod,w,null),Ci(a,s,"formTarget",w.formTarget,w,null)):(Ci(a,s,"encType",w.encType,w,null),Ci(a,s,"method",w.method,w,null),Ci(a,s,"target",w.target,w,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){a.removeAttribute(c);break}g=qt(""+g),a.setAttribute(c,g);break;case"onClick":g!=null&&(a.onclick=Fr);break;case"onScroll":g!=null&&mi("scroll",a);break;case"onScrollEnd":g!=null&&mi("scrollend",a);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(fe(61));if(c=g.__html,c!=null){if(w.children!=null)throw Error(fe(60));a.innerHTML=c}}break;case"multiple":a.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":a.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){a.removeAttribute("xlink:href");break}c=qt(""+g),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?a.setAttribute(c,""+g):a.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?a.setAttribute(c,""):a.removeAttribute(c);break;case"capture":case"download":g===!0?a.setAttribute(c,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?a.setAttribute(c,g):a.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?a.setAttribute(c,g):a.removeAttribute(c);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?a.removeAttribute(c):a.setAttribute(c,g);break;case"popover":mi("beforetoggle",a),mi("toggle",a),cu(a,"popover",g);break;case"xlinkActuate":mr(a,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":mr(a,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":mr(a,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":mr(a,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":mr(a,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":mr(a,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":mr(a,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":mr(a,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":mr(a,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":cu(a,"is",g);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=to.get(c)||c,cu(a,c,g))}}function Td(a,s,c,g,w,M){switch(c){case"style":fc(a,g,M);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(fe(61));if(c=g.__html,c!=null){if(w.children!=null)throw Error(fe(60));a.innerHTML=c}}break;case"children":typeof g=="string"?Ps(a,g):(typeof g=="number"||typeof g=="bigint")&&Ps(a,""+g);break;case"onScroll":g!=null&&mi("scroll",a);break;case"onScrollEnd":g!=null&&mi("scrollend",a);break;case"onClick":g!=null&&(a.onclick=Fr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!va.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(w=c.endsWith("Capture"),s=c.slice(2,w?c.length-7:void 0),M=a[Je]||null,M=M!=null?M[c]:null,typeof M=="function"&&a.removeEventListener(s,M,w),typeof g=="function")){typeof M!="function"&&M!==null&&(c in a?a[c]=null:a.hasAttribute(c)&&a.removeAttribute(c)),a.addEventListener(s,g,w);break e}c in a?a[c]=g:g===!0?a.setAttribute(c,""):cu(a,c,g)}}}function da(a,s,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":mi("error",a),mi("load",a);var g=!1,w=!1,M;for(M in c)if(c.hasOwnProperty(M)){var L=c[M];if(L!=null)switch(M){case"src":g=!0;break;case"srcSet":w=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(fe(137,s));default:Ci(a,s,M,L,c,null)}}w&&Ci(a,s,"srcSet",c.srcSet,c,null),g&&Ci(a,s,"src",c.src,c,null);return;case"input":mi("invalid",a);var Z=M=L=w=null,ce=null,Re=null;for(g in c)if(c.hasOwnProperty(g)){var Ue=c[g];if(Ue!=null)switch(g){case"name":w=Ue;break;case"type":L=Ue;break;case"checked":ce=Ue;break;case"defaultChecked":Re=Ue;break;case"value":M=Ue;break;case"defaultValue":Z=Ue;break;case"children":case"dangerouslySetInnerHTML":if(Ue!=null)throw Error(fe(137,s));break;default:Ci(a,s,g,Ue,c,null)}}hc(a,M,Z,ce,Re,L,w,!1);return;case"select":mi("invalid",a),g=L=M=null;for(w in c)if(c.hasOwnProperty(w)&&(Z=c[w],Z!=null))switch(w){case"value":M=Z;break;case"defaultValue":L=Z;break;case"multiple":g=Z;default:Ci(a,s,w,Z,c,null)}s=M,c=L,a.multiple=!!g,s!=null?eo(a,!!g,s,!1):c!=null&&eo(a,!!g,c,!0);return;case"textarea":mi("invalid",a),M=w=g=null;for(L in c)if(c.hasOwnProperty(L)&&(Z=c[L],Z!=null))switch(L){case"value":g=Z;break;case"defaultValue":w=Z;break;case"children":M=Z;break;case"dangerouslySetInnerHTML":if(Z!=null)throw Error(fe(91));break;default:Ci(a,s,L,Z,c,null)}Ml(a,g,w,M);return;case"option":for(ce in c)c.hasOwnProperty(ce)&&(g=c[ce],g!=null)&&(ce==="selected"?a.selected=g&&typeof g!="function"&&typeof g!="symbol":Ci(a,s,ce,g,c,null));return;case"dialog":mi("beforetoggle",a),mi("toggle",a),mi("cancel",a),mi("close",a);break;case"iframe":case"object":mi("load",a);break;case"video":case"audio":for(g=0;g<Jl.length;g++)mi(Jl[g],a);break;case"image":mi("error",a),mi("load",a);break;case"details":mi("toggle",a);break;case"embed":case"source":case"link":mi("error",a),mi("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Re in c)if(c.hasOwnProperty(Re)&&(g=c[Re],g!=null))switch(Re){case"children":case"dangerouslySetInnerHTML":throw Error(fe(137,s));default:Ci(a,s,Re,g,c,null)}return;default:if(Lo(s)){for(Ue in c)c.hasOwnProperty(Ue)&&(g=c[Ue],g!==void 0&&Td(a,s,Ue,g,c,void 0));return}}for(Z in c)c.hasOwnProperty(Z)&&(g=c[Z],g!=null&&Ci(a,s,Z,g,c,null))}function jm(a,s,c,g){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var w=null,M=null,L=null,Z=null,ce=null,Re=null,Ue=null;for(ke in c){var $e=c[ke];if(c.hasOwnProperty(ke)&&$e!=null)switch(ke){case"checked":break;case"value":break;case"defaultValue":ce=$e;default:g.hasOwnProperty(ke)||Ci(a,s,ke,null,g,$e)}}for(var Le in g){var ke=g[Le];if($e=c[Le],g.hasOwnProperty(Le)&&(ke!=null||$e!=null))switch(Le){case"type":M=ke;break;case"name":w=ke;break;case"checked":Re=ke;break;case"defaultChecked":Ue=ke;break;case"value":L=ke;break;case"defaultValue":Z=ke;break;case"children":case"dangerouslySetInnerHTML":if(ke!=null)throw Error(fe(137,s));break;default:ke!==$e&&Ci(a,s,Le,ke,g,$e)}}fu(a,L,Z,ce,Re,Ue,M,w);return;case"select":ke=L=Z=Le=null;for(M in c)if(ce=c[M],c.hasOwnProperty(M)&&ce!=null)switch(M){case"value":break;case"multiple":ke=ce;default:g.hasOwnProperty(M)||Ci(a,s,M,null,g,ce)}for(w in g)if(M=g[w],ce=c[w],g.hasOwnProperty(w)&&(M!=null||ce!=null))switch(w){case"value":Le=M;break;case"defaultValue":Z=M;break;case"multiple":L=M;default:M!==ce&&Ci(a,s,w,M,g,ce)}s=Z,c=L,g=ke,Le!=null?eo(a,!!c,Le,!1):!!g!=!!c&&(s!=null?eo(a,!!c,s,!0):eo(a,!!c,c?[]:"",!1));return;case"textarea":ke=Le=null;for(Z in c)if(w=c[Z],c.hasOwnProperty(Z)&&w!=null&&!g.hasOwnProperty(Z))switch(Z){case"value":break;case"children":break;default:Ci(a,s,Z,null,g,w)}for(L in g)if(w=g[L],M=c[L],g.hasOwnProperty(L)&&(w!=null||M!=null))switch(L){case"value":Le=w;break;case"defaultValue":ke=w;break;case"children":break;case"dangerouslySetInnerHTML":if(w!=null)throw Error(fe(91));break;default:w!==M&&Ci(a,s,L,w,g,M)}Sf(a,Le,ke);return;case"option":for(var bt in c)Le=c[bt],c.hasOwnProperty(bt)&&Le!=null&&!g.hasOwnProperty(bt)&&(bt==="selected"?a.selected=!1:Ci(a,s,bt,null,g,Le));for(ce in g)Le=g[ce],ke=c[ce],g.hasOwnProperty(ce)&&Le!==ke&&(Le!=null||ke!=null)&&(ce==="selected"?a.selected=Le&&typeof Le!="function"&&typeof Le!="symbol":Ci(a,s,ce,Le,g,ke));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Bt in c)Le=c[Bt],c.hasOwnProperty(Bt)&&Le!=null&&!g.hasOwnProperty(Bt)&&Ci(a,s,Bt,null,g,Le);for(Re in g)if(Le=g[Re],ke=c[Re],g.hasOwnProperty(Re)&&Le!==ke&&(Le!=null||ke!=null))switch(Re){case"children":case"dangerouslySetInnerHTML":if(Le!=null)throw Error(fe(137,s));break;default:Ci(a,s,Re,Le,g,ke)}return;default:if(Lo(s)){for(var Zi in c)Le=c[Zi],c.hasOwnProperty(Zi)&&Le!==void 0&&!g.hasOwnProperty(Zi)&&Td(a,s,Zi,void 0,g,Le);for(Ue in g)Le=g[Ue],ke=c[Ue],!g.hasOwnProperty(Ue)||Le===ke||Le===void 0&&ke===void 0||Td(a,s,Ue,Le,g,ke);return}}for(var xe in c)Le=c[xe],c.hasOwnProperty(xe)&&Le!=null&&!g.hasOwnProperty(xe)&&Ci(a,s,xe,null,g,Le);for($e in g)Le=g[$e],ke=c[$e],!g.hasOwnProperty($e)||Le===ke||Le==null&&ke==null||Ci(a,s,$e,Le,g,ke)}function Rr(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function th(){if(typeof performance.getEntriesByType=="function"){for(var a=0,s=0,c=performance.getEntriesByType("resource"),g=0;g<c.length;g++){var w=c[g],M=w.transferSize,L=w.initiatorType,Z=w.duration;if(M&&Z&&Rr(L)){for(L=0,Z=w.responseEnd,g+=1;g<c.length;g++){var ce=c[g],Re=ce.startTime;if(Re>Z)break;var Ue=ce.transferSize,$e=ce.initiatorType;Ue&&Rr($e)&&(ce=ce.responseEnd,L+=Ue*(ce<Z?1:(Z-Re)/(ce-Re)))}if(--g,s+=8*(M+L)/(w.duration/1e3),a++,10<a)break}}if(0<a)return s/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var Jh=null,Ep=null;function ef(a){return a.nodeType===9?a:a.ownerDocument}function eu(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ap(a,s){if(a===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&s==="foreignObject"?0:a}function Sd(a,s){return a==="textarea"||a==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var tu=null;function Md(){var a=window.event;return a&&a.type==="popstate"?a===tu?!1:(tu=a,!0):(tu=null,!1)}var Ed=typeof setTimeout=="function"?setTimeout:void 0,Cp=typeof clearTimeout=="function"?clearTimeout:void 0,zp=typeof Promise=="function"?Promise:void 0,Dp=typeof queueMicrotask=="function"?queueMicrotask:typeof zp<"u"?function(a){return zp.resolve(null).then(a).catch(Pp)}:Ed;function Pp(a){setTimeout(function(){throw a})}function iu(a){return a==="head"}function Um(a,s){var c=s,g=0;do{var w=c.nextSibling;if(a.removeChild(c),w&&w.nodeType===8)if(c=w.data,c==="/$"||c==="/&"){if(g===0){a.removeChild(w),lu(s);return}g--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")g++;else if(c==="html")ih(a.ownerDocument.documentElement);else if(c==="head"){c=a.ownerDocument.head,ih(c);for(var M=c.firstChild;M;){var L=M.nextSibling,Z=M.nodeName;M[Vt]||Z==="SCRIPT"||Z==="STYLE"||Z==="LINK"&&M.rel.toLowerCase()==="stylesheet"||c.removeChild(M),M=L}}else c==="body"&&ih(a.ownerDocument.body);c=w}while(c);lu(s)}function Jt(a,s){var c=a;a=0;do{var g=c.nextSibling;if(c.nodeType===1?s?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(s?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),g&&g.nodeType===8)if(c=g.data,c==="/$"){if(a===0)break;a--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||a++;c=g}while(c)}function Ys(a){var s=a.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var c=s;switch(s=s.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Ys(c),Po(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}a.removeChild(c)}}function wa(a,s,c,g){for(;a.nodeType===1;){var w=c;if(a.nodeName.toLowerCase()!==s.toLowerCase()){if(!g&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(g){if(!a[Vt])switch(s){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(M=a.getAttribute("rel"),M==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(M!==w.rel||a.getAttribute("href")!==(w.href==null||w.href===""?null:w.href)||a.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin)||a.getAttribute("title")!==(w.title==null?null:w.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(M=a.getAttribute("src"),(M!==(w.src==null?null:w.src)||a.getAttribute("type")!==(w.type==null?null:w.type)||a.getAttribute("crossorigin")!==(w.crossOrigin==null?null:w.crossOrigin))&&M&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(s==="input"&&a.type==="hidden"){var M=w.name==null?null:""+w.name;if(w.type==="hidden"&&a.getAttribute("name")===M)return a}else return a;if(a=Wr(a.nextSibling),a===null)break}return null}function Qs(a,s,c){if(s==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!c||(a=Wr(a.nextSibling),a===null))return null;return a}function nu(a,s){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!s||(a=Wr(a.nextSibling),a===null))return null;return a}function qa(a){return a.data==="$?"||a.data==="$~"}function Nn(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function ra(a,s){var c=a.ownerDocument;if(a.data==="$~")a._reactRetry=s;else if(a.data!=="$?"||c.readyState!=="loading")s();else{var g=function(){s(),c.removeEventListener("DOMContentLoaded",g)};c.addEventListener("DOMContentLoaded",g),a._reactRetry=g}}function Wr(a){for(;a!=null;a=a.nextSibling){var s=a.nodeType;if(s===1||s===3)break;if(s===8){if(s=a.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return a}var dr=null;function sa(a){a=a.nextSibling;for(var s=0;a;){if(a.nodeType===8){var c=a.data;if(c==="/$"||c==="/&"){if(s===0)return Wr(a.nextSibling);s--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||s++}a=a.nextSibling}return null}function tf(a){a=a.previousSibling;for(var s=0;a;){if(a.nodeType===8){var c=a.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(s===0)return a;s--}else c!=="/$"&&c!=="/&"||s++}a=a.previousSibling}return null}function Gm(a,s,c){switch(s=ef(c),a){case"html":if(a=s.documentElement,!a)throw Error(fe(452));return a;case"head":if(a=s.head,!a)throw Error(fe(453));return a;case"body":if(a=s.body,!a)throw Error(fe(454));return a;default:throw Error(fe(451))}}function ih(a){for(var s=a.attributes;s.length;)a.removeAttributeNode(s[0]);Po(a)}var Ta=new Map,nc=new Set;function Ad(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Ao=it.d;it.d={f:qm,r:Zm,D:Rp,C:Za,L:Ws,m:Ha,X:Cd,S:ru,M:Lp};function qm(){var a=Ao.f(),s=Xh();return a||s}function Zm(a){var s=zs(a);s!==null&&s.tag===5&&s.type==="form"?ea(s):Ao.r(a)}var au=typeof document>"u"?null:document;function Ip(a,s,c){var g=au;if(g&&typeof s=="string"&&s){var w=Ea(s);w='link[rel="'+a+'"][href="'+w+'"]',typeof c=="string"&&(w+='[crossorigin="'+c+'"]'),nc.has(w)||(nc.add(w),a={rel:a,crossOrigin:c,href:s},g.querySelector(w)===null&&(s=g.createElement("link"),da(s,"link",a),fn(s),g.head.appendChild(s)))}}function Rp(a){Ao.D(a),Ip("dns-prefetch",a,null)}function Za(a,s){Ao.C(a,s),Ip("preconnect",a,s)}function Ws(a,s,c){Ao.L(a,s,c);var g=au;if(g&&a&&s){var w='link[rel="preload"][as="'+Ea(s)+'"]';s==="image"&&c&&c.imageSrcSet?(w+='[imagesrcset="'+Ea(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(w+='[imagesizes="'+Ea(c.imageSizes)+'"]')):w+='[href="'+Ea(a)+'"]';var M=w;switch(s){case"style":M=ac(a);break;case"script":M=dl(a)}Ta.has(M)||(a=ht({rel:"preload",href:s==="image"&&c&&c.imageSrcSet?void 0:a,as:s},c),Ta.set(M,a),g.querySelector(w)!==null||s==="style"&&g.querySelector(nh(M))||s==="script"&&g.querySelector(ah(M))||(s=g.createElement("link"),da(s,"link",a),fn(s),g.head.appendChild(s)))}}function Ha(a,s){Ao.m(a,s);var c=au;if(c&&a){var g=s&&typeof s.as=="string"?s.as:"script",w='link[rel="modulepreload"][as="'+Ea(g)+'"][href="'+Ea(a)+'"]',M=w;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":M=dl(a)}if(!Ta.has(M)&&(a=ht({rel:"modulepreload",href:a},s),Ta.set(M,a),c.querySelector(w)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(ah(M)))return}g=c.createElement("link"),da(g,"link",a),fn(g),c.head.appendChild(g)}}}function ru(a,s,c){Ao.S(a,s,c);var g=au;if(g&&a){var w=as(g).hoistableStyles,M=ac(a);s=s||"default";var L=w.get(M);if(!L){var Z={loading:0,preload:null};if(L=g.querySelector(nh(M)))Z.loading=5;else{a=ht({rel:"stylesheet",href:a,"data-precedence":s},c),(c=Ta.get(M))&&nf(a,c);var ce=L=g.createElement("link");fn(ce),da(ce,"link",a),ce._p=new Promise(function(Re,Ue){ce.onload=Re,ce.onerror=Ue}),ce.addEventListener("load",function(){Z.loading|=1}),ce.addEventListener("error",function(){Z.loading|=2}),Z.loading|=4,pl(L,s,g)}L={type:"stylesheet",instance:L,count:1,state:Z},w.set(M,L)}}}function Cd(a,s){Ao.X(a,s);var c=au;if(c&&a){var g=as(c).hoistableScripts,w=dl(a),M=g.get(w);M||(M=c.querySelector(ah(w)),M||(a=ht({src:a,async:!0},s),(s=Ta.get(w))&&zd(a,s),M=c.createElement("script"),fn(M),da(M,"link",a),c.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},g.set(w,M))}}function Lp(a,s){Ao.M(a,s);var c=au;if(c&&a){var g=as(c).hoistableScripts,w=dl(a),M=g.get(w);M||(M=c.querySelector(ah(w)),M||(a=ht({src:a,async:!0,type:"module"},s),(s=Ta.get(w))&&zd(a,s),M=c.createElement("script"),fn(M),da(M,"link",a),c.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},g.set(w,M))}}function Bp(a,s,c,g){var w=(w=zt.current)?Ad(w):null;if(!w)throw Error(fe(446));switch(a){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(s=ac(c.href),c=as(w).hoistableStyles,g=c.get(s),g||(g={type:"style",instance:null,count:0,state:null},c.set(s,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){a=ac(c.href);var M=as(w).hoistableStyles,L=M.get(a);if(L||(w=w.ownerDocument||w,L={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},M.set(a,L),(M=w.querySelector(nh(a)))&&!M._p&&(L.instance=M,L.state.loading=5),Ta.has(a)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Ta.set(a,c),M||kp(w,a,c,L.state))),s&&g===null)throw Error(fe(528,""));return L}if(s&&g!==null)throw Error(fe(529,""));return null;case"script":return s=c.async,c=c.src,typeof c=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=dl(c),c=as(w).hoistableScripts,g=c.get(s),g||(g={type:"script",instance:null,count:0,state:null},c.set(s,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(fe(444,a))}}function ac(a){return'href="'+Ea(a)+'"'}function nh(a){return'link[rel="stylesheet"]['+a+"]"}function Op(a){return ht({},a,{"data-precedence":a.precedence,precedence:null})}function kp(a,s,c,g){a.querySelector('link[rel="preload"][as="style"]['+s+"]")?g.loading=1:(s=a.createElement("link"),g.preload=s,s.addEventListener("load",function(){return g.loading|=1}),s.addEventListener("error",function(){return g.loading|=2}),da(s,"link",c),fn(s),a.head.appendChild(s))}function dl(a){return'[src="'+Ea(a)+'"]'}function ah(a){return"script[async]"+a}function Fp(a,s,c){if(s.count++,s.instance===null)switch(s.type){case"style":var g=a.querySelector('style[data-href~="'+Ea(c.href)+'"]');if(g)return s.instance=g,fn(g),g;var w=ht({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return g=(a.ownerDocument||a).createElement("style"),fn(g),da(g,"style",w),pl(g,c.precedence,a),s.instance=g;case"stylesheet":w=ac(c.href);var M=a.querySelector(nh(w));if(M)return s.state.loading|=4,s.instance=M,fn(M),M;g=Op(c),(w=Ta.get(w))&&nf(g,w),M=(a.ownerDocument||a).createElement("link"),fn(M);var L=M;return L._p=new Promise(function(Z,ce){L.onload=Z,L.onerror=ce}),da(M,"link",g),s.state.loading|=4,pl(M,c.precedence,a),s.instance=M;case"script":return M=dl(c.src),(w=a.querySelector(ah(M)))?(s.instance=w,fn(w),w):(g=c,(w=Ta.get(M))&&(g=ht({},c),zd(g,w)),a=a.ownerDocument||a,w=a.createElement("script"),fn(w),da(w,"link",g),a.head.appendChild(w),s.instance=w);case"void":return null;default:throw Error(fe(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(g=s.instance,s.state.loading|=4,pl(g,c.precedence,a));return s.instance}function pl(a,s,c){for(var g=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),w=g.length?g[g.length-1]:null,M=w,L=0;L<g.length;L++){var Z=g[L];if(Z.dataset.precedence===s)M=Z;else if(M!==w)break}M?M.parentNode.insertBefore(a,M.nextSibling):(s=c.nodeType===9?c.head:c,s.insertBefore(a,s.firstChild))}function nf(a,s){a.crossOrigin==null&&(a.crossOrigin=s.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=s.referrerPolicy),a.title==null&&(a.title=s.title)}function zd(a,s){a.crossOrigin==null&&(a.crossOrigin=s.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=s.referrerPolicy),a.integrity==null&&(a.integrity=s.integrity)}var Dd=null;function Np(a,s,c){if(Dd===null){var g=new Map,w=Dd=new Map;w.set(c,g)}else w=Dd,g=w.get(c),g||(g=new Map,w.set(c,g));if(g.has(a))return g;for(g.set(a,null),c=c.getElementsByTagName(a),w=0;w<c.length;w++){var M=c[w];if(!(M[Vt]||M[ji]||a==="link"&&M.getAttribute("rel")==="stylesheet")&&M.namespaceURI!=="http://www.w3.org/2000/svg"){var L=M.getAttribute(s)||"";L=a+L;var Z=g.get(L);Z?Z.push(M):g.set(L,[M])}}return g}function af(a,s,c){a=a.ownerDocument||a,a.head.insertBefore(c,s==="title"?a.querySelector("head > title"):null)}function Pd(a,s,c){if(c===1||s.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;return s.rel==="stylesheet"?(a=s.disabled,typeof s.precedence=="string"&&a==null):!0;case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function rf(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function Vp(a,s,c,g){if(c.type==="stylesheet"&&(typeof g.media!="string"||matchMedia(g.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var w=ac(g.href),M=s.querySelector(nh(w));if(M){s=M._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(a.count++,a=of.bind(a),s.then(a,a)),c.state.loading|=4,c.instance=M,fn(M);return}M=s.ownerDocument||s,g=Op(g),(w=Ta.get(w))&&nf(g,w),M=M.createElement("link"),fn(M);var L=M;L._p=new Promise(function(Z,ce){L.onload=Z,L.onerror=ce}),da(M,"link",g),c.instance=M}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(c,s),(s=c.state.preload)&&(c.state.loading&3)===0&&(a.count++,c=of.bind(a),s.addEventListener("load",c),s.addEventListener("error",c))}}var sf=0;function jp(a,s){return a.stylesheets&&a.count===0&&uf(a,a.stylesheets),0<a.count||0<a.imgCount?function(c){var g=setTimeout(function(){if(a.stylesheets&&uf(a,a.stylesheets),a.unsuspend){var M=a.unsuspend;a.unsuspend=null,M()}},6e4+s);0<a.imgBytes&&sf===0&&(sf=62500*th());var w=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&uf(a,a.stylesheets),a.unsuspend)){var M=a.unsuspend;a.unsuspend=null,M()}},(a.imgBytes>sf?50:800)+s);return a.unsuspend=c,function(){a.unsuspend=null,clearTimeout(g),clearTimeout(w)}}:null}function of(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)uf(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var lf=null;function uf(a,s){a.stylesheets=null,a.unsuspend!==null&&(a.count++,lf=new Map,s.forEach(Hm,a),lf=null,of.call(a))}function Hm(a,s){if(!(s.state.loading&4)){var c=lf.get(a);if(c)var g=c.get(null);else{c=new Map,lf.set(a,c);for(var w=a.querySelectorAll("link[data-precedence],style[data-precedence]"),M=0;M<w.length;M++){var L=w[M];(L.nodeName==="LINK"||L.getAttribute("media")!=="not all")&&(c.set(L.dataset.precedence,L),g=L)}g&&c.set(null,g)}w=s.instance,L=w.getAttribute("data-precedence"),M=c.get(L)||g,M===g&&c.set(null,w),c.set(L,w),this.count++,g=of.bind(this),w.addEventListener("load",g),w.addEventListener("error",g),M?M.parentNode.insertBefore(w,M.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(w,a.firstChild)),s.state.loading|=4}}var rh={$$typeof:Ft,Provider:null,Consumer:null,_currentValue:Mt,_currentValue2:Mt,_threadCount:0};function Ag(a,s,c,g,w,M,L,Z,ce){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Vi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vi(0),this.hiddenUpdates=Vi(null),this.identifierPrefix=g,this.onUncaughtError=w,this.onCaughtError=M,this.onRecoverableError=L,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ce,this.incompleteTransitions=new Map}function Up(a,s,c,g,w,M,L,Z,ce,Re,Ue,$e){return a=new Ag(a,s,c,L,ce,Re,Ue,$e,Z),s=1,M===!0&&(s|=24),M=nr(3,null,null,s),a.current=M,M.stateNode=a,s=_s(),s.refCount++,a.pooledCache=s,s.refCount++,M.memoizedState={element:g,isDehydrated:c,cache:s},Oc(M),a}function Xm(a){return a?(a=Gt,a):Gt}function $m(a,s,c,g,w,M){w=Xm(w),g.context===null?g.context=w:g.pendingContext=w,g=ws(s),g.payload={element:c},M=M===void 0?null:M,M!==null&&(g.callback=M),c=Ns(a,g,s),c!==null&&(Ir(c,a,s),Tr(c,a,s))}function Id(a,s){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var c=a.retryLane;a.retryLane=c!==0&&c<s?c:s}}function Rd(a,s){Id(a,s),(a=a.alternate)&&Id(a,s)}function Ym(a){if(a.tag===13||a.tag===31){var s=xr(a,67108864);s!==null&&Ir(s,a,67108864),Rd(a,67108864)}}function Qm(a){if(a.tag===13||a.tag===31){var s=Pr();s=Do(s);var c=xr(a,s);c!==null&&Ir(c,a,s),Rd(a,s)}}var cf=!0;function hf(a,s,c,g){var w=je.T;je.T=null;var M=it.p;try{it.p=2,Gp(a,s,c,g)}finally{it.p=M,je.T=w}}function Wm(a,s,c,g){var w=je.T;je.T=null;var M=it.p;try{it.p=8,Gp(a,s,c,g)}finally{it.p=M,je.T=w}}function Gp(a,s,c,g){if(cf){var w=ff(g);if(w===null)Eo(a,s,g,sh,c),Km(a,g);else if(zg(w,a,s,c,g))g.stopPropagation();else if(Km(a,g),s&4&&-1<Cg.indexOf(a)){for(;w!==null;){var M=zs(w);if(M!==null)switch(M.tag){case 3:if(M=M.stateNode,M.current.memoizedState.isDehydrated){var L=be(M.pendingLanes);if(L!==0){var Z=M;for(Z.pendingLanes|=2,Z.entangledLanes|=2;L;){var ce=1<<31-we(L);Z.entanglements[1]|=ce,L&=~ce}$s(M),(Fi&6)===0&&(Zh=On()+500,Qr(0))}}break;case 31:case 13:Z=xr(M,2),Z!==null&&Ir(Z,M,2),Xh(),Rd(M,2)}if(M=ff(g),M===null&&Eo(a,s,g,sh,c),M===w)break;w=M}w!==null&&g.stopPropagation()}else Eo(a,s,g,null,c)}}function ff(a){return a=pu(a),Ld(a)}var sh=null;function Ld(a){if(sh=null,a=is(a),a!==null){var s=_t(a);if(s===null)a=null;else{var c=s.tag;if(c===13){if(a=O(s),a!==null)return a;a=null}else if(c===31){if(a=d(s),a!==null)return a;a=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;a=null}else s!==a&&(a=null)}}return sh=a,null}function rc(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ua()){case ye:return 2;case j:return 8;case V:case H:return 32;case oe:return 268435456;default:return 32}default:return 32}}var Bd=!1,su=null,Cs=null,ou=null,df=new Map,oh=new Map,ml=[],Cg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Km(a,s){switch(a){case"focusin":case"focusout":su=null;break;case"dragenter":case"dragleave":Cs=null;break;case"mouseover":case"mouseout":ou=null;break;case"pointerover":case"pointerout":df.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":oh.delete(s.pointerId)}}function pf(a,s,c,g,w,M){return a===null||a.nativeEvent!==M?(a={blockedOn:s,domEventName:c,eventSystemFlags:g,nativeEvent:M,targetContainers:[w]},s!==null&&(s=zs(s),s!==null&&Ym(s)),a):(a.eventSystemFlags|=g,s=a.targetContainers,w!==null&&s.indexOf(w)===-1&&s.push(w),a)}function zg(a,s,c,g,w){switch(s){case"focusin":return su=pf(su,a,s,c,g,w),!0;case"dragenter":return Cs=pf(Cs,a,s,c,g,w),!0;case"mouseover":return ou=pf(ou,a,s,c,g,w),!0;case"pointerover":var M=w.pointerId;return df.set(M,pf(df.get(M)||null,a,s,c,g,w)),!0;case"gotpointercapture":return M=w.pointerId,oh.set(M,pf(oh.get(M)||null,a,s,c,g,w)),!0}return!1}function Jm(a){var s=is(a.target);if(s!==null){var c=_t(s);if(c!==null){if(s=c.tag,s===13){if(s=O(c),s!==null){a.blockedOn=s,ya(a.priority,function(){Qm(c)});return}}else if(s===31){if(s=d(c),s!==null){a.blockedOn=s,ya(a.priority,function(){Qm(c)});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){a.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}a.blockedOn=null}function mf(a){if(a.blockedOn!==null)return!1;for(var s=a.targetContainers;0<s.length;){var c=ff(a.nativeEvent);if(c===null){c=a.nativeEvent;var g=new c.constructor(c.type,c);hh=g,c.target.dispatchEvent(g),hh=null}else return s=zs(c),s!==null&&Ym(s),a.blockedOn=c,!1;s.shift()}return!0}function eg(a,s,c){mf(a)&&c.delete(s)}function gf(){Bd=!1,su!==null&&mf(su)&&(su=null),Cs!==null&&mf(Cs)&&(Cs=null),ou!==null&&mf(ou)&&(ou=null),df.forEach(eg),oh.forEach(eg)}function Od(a,s){a.blockedOn===s&&(a.blockedOn=null,Bd||(Bd=!0,te.unstable_scheduleCallback(te.unstable_NormalPriority,gf)))}var kd=null;function tg(a){kd!==a&&(kd=a,te.unstable_scheduleCallback(te.unstable_NormalPriority,function(){kd===a&&(kd=null);for(var s=0;s<a.length;s+=3){var c=a[s],g=a[s+1],w=a[s+2];if(typeof g!="function"){if(Ld(g||c)===null)continue;break}var M=zs(c);M!==null&&(a.splice(s,3),s-=3,gn(M,{pending:!0,data:w,method:c.method,action:g},g,w))}}))}function lu(a){function s(ce){return Od(ce,a)}su!==null&&Od(su,a),Cs!==null&&Od(Cs,a),ou!==null&&Od(ou,a),df.forEach(s),oh.forEach(s);for(var c=0;c<ml.length;c++){var g=ml[c];g.blockedOn===a&&(g.blockedOn=null)}for(;0<ml.length&&(c=ml[0],c.blockedOn===null);)Jm(c),c.blockedOn===null&&ml.shift();if(c=(a.ownerDocument||a).$$reactFormReplay,c!=null)for(g=0;g<c.length;g+=3){var w=c[g],M=c[g+1],L=w[Je]||null;if(typeof M=="function")L||tg(c);else if(L){var Z=null;if(M&&M.hasAttribute("formAction")){if(w=M,L=M[Je]||null)Z=L.formAction;else if(Ld(w)!==null)continue}else Z=L.action;typeof Z=="function"?c[g+1]=Z:(c.splice(g,3),g-=3),tg(c)}}}function qp(){function a(M){M.canIntercept&&M.info==="react-transition"&&M.intercept({handler:function(){return new Promise(function(L){return w=L})},focusReset:"manual",scroll:"manual"})}function s(){w!==null&&(w(),w=null),g||setTimeout(c,20)}function c(){if(!g&&!navigation.transition){var M=navigation.currentEntry;M&&M.url!=null&&navigation.navigate(M.url,{state:M.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var g=!1,w=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(c,100),function(){g=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),w!==null&&(w(),w=null)}}}function Zp(a){this._internalRoot=a}Fd.prototype.render=Zp.prototype.render=function(a){var s=this._internalRoot;if(s===null)throw Error(fe(409));var c=s.current,g=Pr();$m(c,g,a,s,null,null)},Fd.prototype.unmount=Zp.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var s=a.containerInfo;$m(a.current,2,null,a,null,null),Xh(),s[jt]=null}};function Fd(a){this._internalRoot=a}Fd.prototype.unstable_scheduleHydration=function(a){if(a){var s=_a();a={blockedOn:null,target:a,priority:s};for(var c=0;c<ml.length&&s!==0&&s<ml[c].priority;c++);ml.splice(c,0,a),c===0&&Jm(a)}};var Hp=Ee.version;if(Hp!=="19.2.3")throw Error(fe(527,Hp,"19.2.3"));it.findDOMNode=function(a){var s=a._reactInternals;if(s===void 0)throw typeof a.render=="function"?Error(fe(188)):(a=Object.keys(a).join(","),Error(fe(268,a)));return a=Be(s),a=a!==null?ft(a):null,a=a===null?null:a.stateNode,a};var ig={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:je,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Nd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Nd.isDisabled&&Nd.supportsFiber)try{_e=Nd.inject(ig),W=Nd}catch{}}return Kp.createRoot=function(a,s){if(!Ye(a))throw Error(fe(299));var c=!1,g="",w=Vc,M=qs,L=Zs;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(g=s.identifierPrefix),s.onUncaughtError!==void 0&&(w=s.onUncaughtError),s.onCaughtError!==void 0&&(M=s.onCaughtError),s.onRecoverableError!==void 0&&(L=s.onRecoverableError)),s=Up(a,1,!1,null,null,c,g,null,w,M,L,qp),a[jt]=s.current,Tp(a),new Zp(s)},Kp.hydrateRoot=function(a,s,c){if(!Ye(a))throw Error(fe(299));var g=!1,w="",M=Vc,L=qs,Z=Zs,ce=null;return c!=null&&(c.unstable_strictMode===!0&&(g=!0),c.identifierPrefix!==void 0&&(w=c.identifierPrefix),c.onUncaughtError!==void 0&&(M=c.onUncaughtError),c.onCaughtError!==void 0&&(L=c.onCaughtError),c.onRecoverableError!==void 0&&(Z=c.onRecoverableError),c.formState!==void 0&&(ce=c.formState)),s=Up(a,1,!0,s,c??null,g,w,ce,M,L,Z,qp),s.context=Xm(null),c=s.current,g=Pr(),g=Do(g),w=ws(g),w.callback=null,Ns(c,w,g),c=g,s.current.lanes=c,Nt(s,c),$s(s),a[jt]=s.current,Tp(a),new Fd(s)},Kp.version="19.2.3",Kp}var R_;function My(){if(R_)return jg.exports;R_=1;function te(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(te)}catch(Ee){console.error(Ee)}}return te(),jg.exports=Sy(),jg.exports}var Ey=My(),fg={exports:{}};var Ay=fg.exports,L_;function Cy(){return L_||(L_=1,(function(te,Ee){(function(Ne,fe){te.exports=fe()})(Ay,(function(){var Ne={},fe={};function Ye(O,d,ge){if(fe[O]=ge,O==="index"){var Be="var sharedModule = {}; ("+fe.shared+")(sharedModule); ("+fe.worker+")(sharedModule);",ft={};return fe.shared(ft),fe.index(Ne,ft),typeof window<"u"&&Ne.setWorkerUrl(window.URL.createObjectURL(new Blob([Be],{type:"text/javascript"}))),Ne}}Ye("shared",["exports"],(function(O){function d(n,e,i,o){return new(i||(i=Promise))((function(u,f){function p(T){try{x(o.next(T))}catch(E){f(E)}}function y(T){try{x(o.throw(T))}catch(E){f(E)}}function x(T){var E;T.done?u(T.value):(E=T.value,E instanceof i?E:new i((function(C){C(E)}))).then(p,y)}x((o=o.apply(n,e||[])).next())}))}function ge(n,e){this.x=n,this.y=e}function Be(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ft,ht;typeof SuppressedError=="function"&&SuppressedError,ge.prototype={clone(){return new ge(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),i=Math.sin(n),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround(n,e){const i=Math.cos(n),o=Math.sin(n),u=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:ge},ge.convert=function(n){if(n instanceof ge)return n;if(Array.isArray(n))return new ge(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new ge(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var At=(function(){if(ht)return ft;function n(e,i,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=u}return ht=1,ft=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var f=this.sampleCurveX(o)-e;if(Math.abs(f)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=f/p}var y=0,x=1;for(o=e,u=0;u<20&&(f=this.sampleCurveX(o),!(Math.abs(f-e)<i));u++)e>f?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},ft})(),ei=Be(At);let tt,nt;function ve(){return tt==null&&(tt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),tt}function ti(){if(nt==null&&(nt=!1,ve())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<25;o++){const u=4*o;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const i=e.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&i[o]!==o){nt=!0;break}}}return nt||!1}var mt=1e-6,Ft=typeof Float32Array<"u"?Float32Array:Array;function Ot(){var n=new Ft(9);return Ft!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function jn(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ht(){var n=new Ft(3);return Ft!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Ct(n){var e=n[0],i=n[1],o=n[2];return Math.sqrt(e*e+i*i+o*o)}function Pi(n,e,i){var o=new Ft(3);return o[0]=n,o[1]=e,o[2]=i,o}function bn(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function Yn(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function An(n,e,i){var o=e[0],u=e[1],f=e[2],p=i[0],y=i[1],x=i[2];return n[0]=u*x-f*y,n[1]=f*p-o*x,n[2]=o*y-u*p,n}var Gi,Cn=Ct;function ma(n,e,i){var o=e[0],u=e[1],f=e[2],p=e[3];return n[0]=i[0]*o+i[4]*u+i[8]*f+i[12]*p,n[1]=i[1]*o+i[5]*u+i[9]*f+i[13]*p,n[2]=i[2]*o+i[6]*u+i[10]*f+i[14]*p,n[3]=i[3]*o+i[7]*u+i[11]*f+i[15]*p,n}function Hi(){var n=new Ft(4);return Ft!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function je(n,e,i,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",f=Math.PI/360;e*=f,o*=f,i*=f;var p=Math.sin(e),y=Math.cos(e),x=Math.sin(i),T=Math.cos(i),E=Math.sin(o),C=Math.cos(o);switch(u){case"xyz":n[0]=p*T*C+y*x*E,n[1]=y*x*C-p*T*E,n[2]=y*T*E+p*x*C,n[3]=y*T*C-p*x*E;break;case"xzy":n[0]=p*T*C-y*x*E,n[1]=y*x*C-p*T*E,n[2]=y*T*E+p*x*C,n[3]=y*T*C+p*x*E;break;case"yxz":n[0]=p*T*C+y*x*E,n[1]=y*x*C-p*T*E,n[2]=y*T*E-p*x*C,n[3]=y*T*C+p*x*E;break;case"yzx":n[0]=p*T*C+y*x*E,n[1]=y*x*C+p*T*E,n[2]=y*T*E-p*x*C,n[3]=y*T*C-p*x*E;break;case"zxy":n[0]=p*T*C-y*x*E,n[1]=y*x*C+p*T*E,n[2]=y*T*E+p*x*C,n[3]=y*T*C-p*x*E;break;case"zyx":n[0]=p*T*C-y*x*E,n[1]=y*x*C+p*T*E,n[2]=y*T*E-p*x*C,n[3]=y*T*C+p*x*E;break;default:throw new Error("Unknown angle order "+u)}return n}function it(){var n=new Ft(2);return Ft!=Float32Array&&(n[0]=0,n[1]=0),n}function Mt(n,e){var i=new Ft(2);return i[0]=n,i[1]=e,i}Ht(),Gi=new Ft(4),Ft!=Float32Array&&(Gi[0]=0,Gi[1]=0,Gi[2]=0,Gi[3]=0),Ht(),Pi(1,0,0),Pi(0,1,0),Hi(),Hi(),Ot(),it();const St=8192;function Wt(n,e,i){return e*(St/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}function de(n,e){return(n%e+e)%e}function Ze(n,e,i){return n*(1-i)+e*i}function ot(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function yt(n,e,i,o){const u=new ei(n,e,i,o);return f=>u.solve(f)}const xt=yt(.25,.1,.25,1);function zt(n,e,i){return Math.min(i,Math.max(e,n))}function Xt(n,e,i){const o=i-e,u=((n-e)%o+o)%o+e;return u===e?i:u}function ri(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}let wi=1;function Xi(n,e,i){const o={};for(const u in n)o[u]=e.call(this,n[u],u,n);return o}function Un(n,e,i){const o={};for(const u in n)e.call(this,n[u],u,n)&&(o[u]=n[u]);return o}function ga(n){return Array.isArray(n)?n.map(ga):typeof n=="object"&&n?Xi(n,ga):n}const Ya={};function Ii(n){Ya[n]||(typeof console<"u"&&console.warn(n),Ya[n]=!0)}function Qn(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function La(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let $i=null;function Qa(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const Br="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function es(n,e,i,o,u){return d(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(n,{timestamp:0});try{const p=f?.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const y=p.startsWith("BGR"),x=new Uint8ClampedArray(o*u*4);if(yield f.copyTo(x,(function(T,E,C,D,P){const B=4*Math.max(-E,0),k=(Math.max(0,C)-C)*D*4+B,N=4*D,G=Math.max(0,E),ee=Math.max(0,C);return{rect:{x:G,y:ee,width:Math.min(T.width,E+D)-G,height:Math.min(T.height,C+P)-ee},layout:[{offset:k,stride:N}]}})(n,e,i,o,u)),y)for(let T=0;T<x.length;T+=4){const E=x[T];x[T]=x[T+2],x[T+2]=E}return x}finally{f.close()}}))}let Gn,Ba;function Wa(n,e,i,o){return n.addEventListener(e,i,o),{unsubscribe:()=>{n.removeEventListener(e,i,o)}}}function On(n){return n*Math.PI/180}function ua(n){return n/Math.PI*180}const ye={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},j={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},V="AbortError";class H extends Error{constructor(e=V){super(e instanceof Error?e.message:e),this.name=V,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function oe(n){return n.name===V}const ue={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Me(n){return ue.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const _e="global-dispatcher";class W extends Error{constructor(e,i,o,u){super(`AJAXError: ${i} (${e}): ${o}`),this.status=e,this.statusText=i,this.url=o,this.body=u}}const he=()=>La(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,we=function(n,e){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const o=Me(n.url);if(o)return o(n,e);if(La(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:_e},e)}if(!(/^file:/.test(i=n.url)||/^file:/.test(he())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,u){return d(this,void 0,void 0,(function*(){const f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:he(),signal:u.signal});let p,y;o.type!=="json"||f.headers.has("Accept")||f.headers.set("Accept","application/json");try{p=yield fetch(f)}catch(T){throw oe(T)?T:new W(0,T.message,o.url,new Blob)}if(!p.ok){const T=yield p.blob();throw new W(p.status,p.statusText,o.url,T)}y=o.type==="arrayBuffer"||o.type==="image"?p.arrayBuffer():o.type==="json"?p.json():p.text();const x=yield y;return u.signal.throwIfAborted(),{data:x,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}}))})(n,e);if(La(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:_e},e)}var i;return(function(o,u){return new Promise(((f,p)=>{var y;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const T in o.headers)x.setRequestHeader(T,o.headers[T]);o.type==="json"&&(x.responseType="text",!((y=o.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if(!u.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let T=x.response;if(o.type==="json")try{T=JSON.parse(x.response)}catch(E){return void p(E)}f({data:T,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const T=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});p(new W(x.status,x.statusText,o.url,T))}},u.signal.addEventListener("abort",(()=>{x.abort(),p(new H(u.signal.reason))})),x.send(o.body)}))})(n,e)};function Ie(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const e=new URL(n),i=window.location;return e.protocol===i.protocol&&e.host===i.host}function et(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function pt(n,e,i){if(i&&i[n]){const o=i[n].indexOf(e);o!==-1&&i[n].splice(o,1)}}class Et{constructor(e,i={}){ri(this,i),this.type=e}}class li extends Et{constructor(e,i={}){super("error",ri({error:e},i))}}class $t{on(e,i){return this._listeners=this._listeners||{},et(e,i,this._listeners),{unsubscribe:()=>{this.off(e,i)}}}off(e,i){return pt(e,i,this._listeners),pt(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},et(e,i,this._oneTimeListeners),this):new Promise((o=>this.once(e,o)))}fire(e,i){typeof e=="string"&&(e=new Et(e,i||{}));const o=e.type;if(this.listens(o)){e.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of u)y.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of f)pt(o,y,this._oneTimeListeners),y.call(this,e);const p=this._eventedParent;p&&(ri(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof li&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};const fi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ki(n,e){const i={};for(const o in n)o!=="ref"&&(i[o]=n[o]);return fi.forEach((o=>{o in e&&(i[o]=e[o])})),i}function Pt(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Pt(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!Pt(n[i],e[i]))return!1;return!0}return n===e}function ni(n,e){n.push(e)}function Vi(n,e,i){ni(i,{command:"addSource",args:[n,e[n]]})}function Nt(n,e,i){ni(e,{command:"removeSource",args:[n]}),i[n]=!0}function Ji(n,e,i,o){Nt(n,i,o),Vi(n,e,i)}function Ri(n,e,i){let o;for(o in n[i])if(Object.prototype.hasOwnProperty.call(n[i],o)&&o!=="data"&&!Pt(n[i][o],e[i][o]))return!1;for(o in e[i])if(Object.prototype.hasOwnProperty.call(e[i],o)&&o!=="data"&&!Pt(n[i][o],e[i][o]))return!1;return!0}function zn(n,e,i,o,u,f){n=n||{},e=e||{};for(const p in n)Object.prototype.hasOwnProperty.call(n,p)&&(Pt(n[p],e[p])||i.push({command:f,args:[o,p,e[p],u]}));for(const p in e)Object.prototype.hasOwnProperty.call(e,p)&&!Object.prototype.hasOwnProperty.call(n,p)&&(Pt(n[p],e[p])||i.push({command:f,args:[o,p,e[p],u]}))}function bl(n){return n.id}function Do(n,e){return n[e.id]=e,n}class Qe{constructor(e,i,o,u){this.message=(e?`${e}: `:"")+o,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function _a(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}class ya extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Or{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,u]of i)this.bindings[o]=u}concat(e){return new Or(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ji={kind:"null"},Je={kind:"number"},jt={kind:"string"},Zt={kind:"boolean"},Ka={kind:"color"},cc={kind:"projectionDefinition"},ts={kind:"object"},Vt={kind:"value"},Po={kind:"collator"},is={kind:"formatted"},zs={kind:"padding"},ns={kind:"colorArray"},as={kind:"numberArray"},fn={kind:"resolvedImage"},wl={kind:"variableAnchorOffsetCollection"};function va(n,e){return{kind:"array",itemType:n,N:e}}function ui(n){if(n.kind==="array"){const e=ui(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Ds=[ji,Je,jt,Zt,Ka,cc,is,ts,va(Vt),zs,as,ns,fn,wl];function Tl(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Tl(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of Ds)if(!Tl(i,e))return null}}return`Expected ${ui(n)} but found ${ui(e)} instead.`}function Sl(n,e){return e.some((i=>i.kind===n.kind))}function Js(n,e){return e.some((i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n))}function kr(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const cu=.96422,rs=.82521,mr=4/29,gi=6/29,uh=3*gi*gi,wf=gi*gi*gi,Io=Math.PI/180,ch=180/Math.PI;function hu(n){return(n%=360)<0&&(n+=360),n}function Tf([n,e,i,o]){let u,f;const p=fu((.2225045*(n=Ea(n))+.7168786*(e=Ea(e))+.0606169*(i=Ea(i)))/1);n===e&&e===i?u=f=p:(u=fu((.4360747*n+.3850649*e+.1430804*i)/cu),f=fu((.0139322*n+.0971045*e+.7141733*i)/rs));const y=116*p-16;return[y<0?0:y,500*(u-p),200*(p-f),o]}function Ea(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function fu(n){return n>wf?Math.pow(n,1/3):n/uh+mr}function hc([n,e,i,o]){let u=(n+16)/116,f=isNaN(e)?u:u+e/500,p=isNaN(i)?u:u-i/200;return u=1*eo(u),f=cu*eo(f),p=rs*eo(p),[du(3.1338561*f-1.6168667*u-.4906146*p),du(-.9787684*f+1.9161415*u+.033454*p),du(.0719453*f-.2289914*u+1.4052427*p),o]}function du(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function eo(n){return n>gi?n*n*n:uh*(n-mr)}const Sf=Object.hasOwn||function(n,e){return Object.prototype.hasOwnProperty.call(n,e)};function Ml(n,e){return Sf(n,e)?n[e]:void 0}function Ps(n){return parseInt(n.padEnd(2,n),16)/255}function Mf(n,e){return Ro(e?n/100:n,0,1)}function Ro(n,e,i){return Math.min(Math.max(e,n),i)}function fc(n){return!n.some(Number.isNaN)}const Lo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function to(n,e,i){return n+i*(e-n)}function El(n,e,i){return n.map(((o,u)=>to(o,e[u],i)))}class qt{constructor(e,i,o,u=1,f=!0){this.r=e,this.g=i,this.b=o,this.a=u,f||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,i,o,u]))}static parse(e){if(e instanceof qt)return e;if(typeof e!="string")return;const i=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=Ml(Lo,o);if(u){const[p,y,x]=u;return[p/255,y/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const p=o.length<6?1:2;let y=1;return[Ps(o.slice(y,y+=p)),Ps(o.slice(y,y+=p)),Ps(o.slice(y,y+=p)),Ps(o.slice(y,y+p)||"ff")]}if(o.startsWith("rgb")){const p=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[y,x,T,E,C,D,P,B,k,N,G,ee]=p,q=[E||" ",P||" ",N].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const X=[T,D,k].join(""),ne=X==="%%%"?100:X===""?255:0;if(ne){const se=[Ro(+x/ne,0,1),Ro(+C/ne,0,1),Ro(+B/ne,0,1),G?Mf(+G,ee):1];if(fc(se))return se}}return}}const f=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[p,y,x,T,E,C,D,P,B]=f,k=[x||" ",E||" ",D].join("");if(k==="  "||k==="  /"||k===",,"||k===",,,"){const N=[+y,Ro(+T,0,100),Ro(+C,0,100),P?Mf(+P,B):1];if(fc(N))return(function([G,ee,q,X]){function ne(se){const Se=(se+G/30)%12,Ve=ee*Math.min(q,1-q);return q-Ve*Math.max(-1,Math.min(Se-3,9-Se,1))}return G=hu(G),ee/=100,q/=100,[ne(0),ne(8),ne(4),X]})(N)}}})(e);return i?new qt(...i,!1):void 0}get rgb(){const{r:e,g:i,b:o,a:u}=this,f=u||1/0;return this.overwriteGetter("rgb",[e/f,i/f,o/f,u])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[i,o,u,f]=Tf(e),p=Math.sqrt(o*o+u*u);return[Math.round(1e4*p)?hu(Math.atan2(u,o)*ch):NaN,p,i,f]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Tf(this.rgb))}overwriteGetter(e,i){return Object.defineProperty(this,e,{value:i}),i}toString(){const[e,i,o,u]=this.rgb;return`rgba(${[e,i,o].map((f=>Math.round(255*f))).join(",")},${u})`}static interpolate(e,i,o,u="rgb"){switch(u){case"rgb":{const[f,p,y,x]=El(e.rgb,i.rgb,o);return new qt(f,p,y,x,!1)}case"hcl":{const[f,p,y,x]=e.hcl,[T,E,C,D]=i.hcl;let P,B;if(isNaN(f)||isNaN(T))isNaN(f)?isNaN(T)?P=NaN:(P=T,y!==1&&y!==0||(B=E)):(P=f,C!==1&&C!==0||(B=p));else{let q=T-f;T>f&&q>180?q-=360:T<f&&f-T>180&&(q+=360),P=f+o*q}const[k,N,G,ee]=(function([q,X,ne,se]){return q=isNaN(q)?0:q*Io,hc([ne,Math.cos(q)*X,Math.sin(q)*X,se])})([P,B??to(p,E,o),to(y,C,o),to(x,D,o)]);return new qt(k,N,G,ee,!1)}case"lab":{const[f,p,y,x]=hc(El(e.lab,i.lab,o));return new qt(f,p,y,x,!1)}}}}qt.black=new qt(0,0,0,1),qt.white=new qt(1,1,1,1),qt.transparent=new qt(0,0,0,0),qt.red=new qt(1,0,0,1);class Fr{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const hh=["bottom","center","top"];class pu{constructor(e,i,o,u,f,p){this.text=e,this.image=i,this.scale=o,this.fontStack=u,this.textColor=f,this.verticalAlign=p}}class qn{constructor(e){this.sections=e}static fromString(e){return new qn([new pu(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof qn?e:qn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class Dn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Dn)return e;if(typeof e=="number")return new Dn([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const i of e)if(typeof i!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Dn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new Dn(El(e.values,i.values,o))}}class en{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof en)return e;if(typeof e=="number")return new en([e]);if(Array.isArray(e)){for(const i of e)if(typeof i!="number")return;return new en(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new en(El(e.values,i.values,o))}}class It{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof It)return e;if(typeof e=="string"){const o=qt.parse(e);return o?new It([o]):void 0}if(!Array.isArray(e))return;const i=[];for(const o of e){if(typeof o!="string")return;const u=qt.parse(o);if(!u)return;i.push(u)}return new It(i)}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o,u="rgb"){const f=[];if(e.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let p=0;p<e.values.length;p++)f.push(qt.interpolate(e.values[p],i.values[p],o,u));return new It(f)}}class Li extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const gr=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class dn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof dn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let i=0;i<e.length;i+=2){const o=e[i],u=e[i+1];if(typeof o!="string"||!gr.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new dn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){const u=e.values,f=i.values;if(u.length!==f.length)throw new Li(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${i.toString()}`);const p=[];for(let y=0;y<u.length;y+=2){if(u[y]!==f[y])throw new Li(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${u[y]}, to[${y}]: ${f[y]}`);p.push(u[y]);const[x,T]=u[y+1],[E,C]=f[y+1];p.push([to(x,E,o),to(T,C,o)])}return new dn(p)}}class Aa{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Aa({name:e,available:!1}):null}}class Zn{constructor(e,i,o){this.from=e,this.to=i,this.transition=o}static interpolate(e,i,o){return new Zn(e,i,o)}static parse(e){return e instanceof Zn?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new Zn(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new Zn(e.from,e.to,e.transition):typeof e=="string"?new Zn(e,e,1):void 0}}function Ja(n,e,i,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,i,o]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ss(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Zn||n instanceof qt||n instanceof Fr||n instanceof qn||n instanceof Dn||n instanceof en||n instanceof It||n instanceof dn||n instanceof Aa)return!0;if(Array.isArray(n)){for(const e of n)if(!ss(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!ss(n[e]))return!1;return!0}return!1}function tn(n){if(n===null)return ji;if(typeof n=="string")return jt;if(typeof n=="boolean")return Zt;if(typeof n=="number")return Je;if(n instanceof qt)return Ka;if(n instanceof Zn)return cc;if(n instanceof Fr)return Po;if(n instanceof qn)return is;if(n instanceof Dn)return zs;if(n instanceof en)return as;if(n instanceof It)return ns;if(n instanceof dn)return wl;if(n instanceof Aa)return fn;if(Array.isArray(n)){const e=n.length;let i;for(const o of n){const u=tn(o);if(i){if(i===u)continue;i=Vt;break}i=u}return va(i||Vt,e)}return ts}function io(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof qt||n instanceof Zn||n instanceof qn||n instanceof Dn||n instanceof en||n instanceof It||n instanceof dn||n instanceof Aa?n.toString():JSON.stringify(n)}class er{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ss(e[1]))return i.error("invalid value");const o=e[1];let u=tn(o);const f=i.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new er(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Bo={string:jt,number:Je,boolean:Zt,object:ts};class Ca{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,u=1;const f=e[0];if(f==="array"){let y,x;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in Bo)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=Bo[T],u++}else y=Vt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=e[2],u++}o=va(y,x)}else{if(!Bo[f])throw new Error(`Types doesn't contain name = ${f}`);o=Bo[f]}const p=[];for(;u<e.length;u++){const y=i.parse(e[u],u,Vt);if(!y)return null;p.push(y)}return new Ca(o,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!Tl(this.type,tn(o)))return o;if(i===this.args.length-1)throw new Li(`Expected value to be of type ${ui(this.type)}, but found ${ui(tn(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const kn={"to-boolean":Zt,"to-color":Ka,"to-number":Je,"to-string":jt};class za{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0];if(!kn[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");const u=kn[o],f=[];for(let p=1;p<e.length;p++){const y=i.parse(e[p],p,Vt);if(!y)return null;f.push(y)}return new za(u,f)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let i,o;for(const u of this.args){if(i=u.evaluate(e),o=null,i instanceof qt)return i;if(typeof i=="string"){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Ja(i[0],i[1],i[2],i[3]),!o))return new qt(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Li(o||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const o of this.args){i=o.evaluate(e);const u=Dn.parse(i);if(u)return u}throw new Li(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(const o of this.args){i=o.evaluate(e);const u=en.parse(i);if(u)return u}throw new Li(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(const o of this.args){i=o.evaluate(e);const u=It.parse(i);if(u)return u}throw new Li(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const o of this.args){i=o.evaluate(e);const u=dn.parse(i);if(u)return u}throw new Li(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new Li(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return qn.fromString(io(this.args[0].evaluate(e)));case"resolvedImage":return Aa.fromString(io(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return io(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const mu=["Unknown","Point","LineString","Polygon"];class Oo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?mu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let i=this._parseColorCache.get(e);return i||(i=qt.parse(e),this._parseColorCache.set(e,i)),i}}class ko{constructor(e,i,o=[],u,f=new Or,p=[]){this.registry=e,this.path=o,this.key=o.map((y=>`[${y}]`)).join(""),this.scope=f,this.errors=p,this.expectedType=u,this._isConstant=i}parse(e,i,o,u,f={}){return i?this.concat(i,o,u)._parse(e,f):this._parse(e,f)}_parse(e,i){function o(u,f,p){return p==="assert"?new Ca(f,[u]):p==="coerce"?new za(f,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let p=f.parse(e,this);if(!p)return null;if(this.expectedType){const y=this.expectedType,x=p.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value"){if(y.kind==="projectionDefinition"&&["string","array"].includes(x.kind)||["color","formatted","resolvedImage"].includes(y.kind)&&["value","string"].includes(x.kind)||["padding","numberArray"].includes(y.kind)&&["value","number","array"].includes(x.kind)||y.kind==="colorArray"&&["value","string","array"].includes(x.kind)||y.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(x.kind))p=o(p,y,i.typeAnnotation||"coerce");else if(this.checkSubtype(y,x))return null}else p=o(p,y,i.typeAnnotation||"assert")}if(!(p instanceof er)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const y=new Oo;try{p=new er(p.type,p.evaluate(y))}catch(x){return this.error(x.message),null}}return p}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){const u=typeof e=="number"?this.path.concat(e):this.path,f=o?this.scope.concat(o):this.scope;return new ko(this.registry,this._isConstant,u,i||null,f,this.errors)}error(e,...i){const o=`${this.key}${i.map((u=>`[${u}]`)).join("")}`;this.errors.push(new ya(o,e))}checkSubtype(e,i){const o=Tl(e,i);return o&&this.error(o),o}}class Ei{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let f=1;f<e.length-1;f+=2){const p=e[f];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,f);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=i.parse(e[f+1],f+1);if(!y)return null;o.push([p,y])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return u?new Ei(o,u):null}outputDefined(){return this.result.outputDefined()}}class no{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new no(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Kt{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Je),u=i.parse(e[2],2,va(i.expectedType||Vt));return o&&u?new Kt(u.type.itemType,o,u):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Li(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Li(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Li(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Ut{constructor(e,i){this.type=Zt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Vt),u=i.parse(e[2],2,Vt);return o&&u?Sl(o.type,[Zt,jt,Je,ji,Vt])?new Ut(o,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ui(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!Js(i,["boolean","string","number","null"]))throw new Li(`Expected first argument to be of type boolean, string, number or null, but found ${ui(tn(i))} instead.`);if(!Js(o,["string","array"]))throw new Li(`Expected second argument to be of type array or string, but found ${ui(tn(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Fo{constructor(e,i,o){this.type=Je,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Vt),u=i.parse(e[2],2,Vt);if(!o||!u)return null;if(!Sl(o.type,[Zt,jt,Je,ji,Vt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ui(o.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,Je);return f?new Fo(o,u,f):null}return new Fo(o,u)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Js(i,["boolean","string","number","null"]))throw new Li(`Expected first argument to be of type boolean, string, number or null, but found ${ui(tn(i))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(e)),Js(o,["string"])){const f=o.indexOf(i,u);return f===-1?-1:[...o.slice(0,f)].length}if(Js(o,["array"]))return o.indexOf(i,u);throw new Li(`Expected second argument to be of type array or string, but found ${ui(tn(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class ci{constructor(e,i,o,u,f,p){this.inputType=e,this.type=i,this.input=o,this.cases=u,this.outputs=f,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const f={},p=[];for(let T=2;T<e.length-1;T+=2){let E=e[T];const C=e[T+1];Array.isArray(E)||(E=[E]);const D=i.concat(T);if(E.length===0)return D.error("Expected at least one branch label.");for(const B of E){if(typeof B!="number"&&typeof B!="string")return D.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return D.error("Numeric branch labels must be integer values.");if(o){if(D.checkSubtype(o,tn(B)))return null}else o=tn(B);if(f[String(B)]!==void 0)return D.error("Branch labels must be unique.");f[String(B)]=p.length}const P=i.parse(C,T,u);if(!P)return null;u=u||P.type,p.push(P)}const y=i.parse(e[1],1,Vt);if(!y)return null;const x=i.parse(e[e.length-1],e.length-1,u);return x?y.type.kind!=="value"&&i.concat(1).checkSubtype(o,y.type)?null:new ci(o,u,y,f,p,x):null}evaluate(e){const i=this.input.evaluate(e);return(tn(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class gu{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const u=[];for(let p=1;p<e.length-1;p+=2){const y=i.parse(e[p],p,Zt);if(!y)return null;const x=i.parse(e[p+1],p+1,o);if(!x)return null;u.push([y,x]),o=o||x.type}const f=i.parse(e[e.length-1],e.length-1,o);if(!f)return null;if(!o)throw new Error("Can't infer output type");return new gu(o,u,f)}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}}class _r{constructor(e,i,o,u){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Vt),u=i.parse(e[2],2,Je);if(!o||!u)return null;if(!Sl(o.type,[va(Vt),jt,Vt]))return i.error(`Expected first argument to be of type array or string, but found ${ui(o.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,Je);return f?new _r(o.type,o,u,f):null}return new _r(o.type,o,u)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let u;if(this.endIndex&&(u=this.endIndex.evaluate(e)),Js(i,["string"]))return[...i].slice(o,u).join("");if(Js(i,["array"]))return i.slice(o,u);throw new Li(`Expected first argument to be of type array or string, but found ${ui(tn(i))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function ao(n,e){const i=n.length-1;let o,u,f=0,p=i,y=0;for(;f<=p;)if(y=Math.floor((f+p)/2),o=n[y],u=n[y+1],o<=e){if(y===i||e<u)return y;f=y+1}else{if(!(o>e))throw new Li("Input is not a number.");p=y-1}return 0}class ro{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,f]of o)this.labels.push(u),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,Je);if(!o)return null;const u=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let p=1;p<e.length;p+=2){const y=p===1?-1/0:e[p],x=e[p+1],T=p,E=p+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(u.length&&u[u.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const C=i.parse(x,E,f);if(!C)return null;f=f||C.type,u.push([y,C])}return new ro(f,o,u)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const f=i.length;return u>=i[f-1]?o[f-1].evaluate(e):o[ao(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Ef(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var _u,fh,Zd=(function(){if(fh)return _u;function n(e,i,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=u}return fh=1,_u=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var f=this.sampleCurveX(o)-e;if(Math.abs(f)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=f/p}var y=0,x=1;for(o=e,u=0;u<20&&(f=this.sampleCurveX(o),!(Math.abs(f-e)<i));u++)e>f?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},_u})(),dh=Ef(Zd);class Da{constructor(e,i,o,u,f){this.type=e,this.operator=i,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[p,y]of f)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(e,i,o,u){let f=0;if(e.name==="exponential")f=os(i,e.base,o,u);else if(e.name==="linear")f=os(i,1,o,u);else if(e.name==="cubic-bezier"){const p=e.controlPoints;f=new dh(p[0],p[1],p[2],p[3]).solve(os(i,1,o,u))}return f}static parse(e,i){let[o,u,f,...p]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const T=u[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:T}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const T=u.slice(1);if(T.length!==4||T.some((E=>typeof E!="number"||E<0||E>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,Je),!f)return null;const y=[];let x=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||i.expectedType==ns?i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType):x=Ka;for(let T=0;T<p.length;T+=2){const E=p[T],C=p[T+1],D=T+3,P=T+4;if(typeof E!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(y.length&&y[y.length-1][0]>=E)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const B=i.parse(C,P,x);if(!B)return null;x=x||B.type,y.push([E,B])}return kr(x,Je)||kr(x,cc)||kr(x,Ka)||kr(x,zs)||kr(x,as)||kr(x,ns)||kr(x,wl)||kr(x,va(Je))?new Da(x,o,u,f,y):i.error(`Type ${ui(x)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const f=i.length;if(u>=i[f-1])return o[f-1].evaluate(e);const p=ao(i,u),y=Da.interpolationFactor(this.interpolation,u,i[p],i[p+1]),x=o[p].evaluate(e),T=o[p+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return to(x,T,y);case"color":return qt.interpolate(x,T,y);case"padding":return Dn.interpolate(x,T,y);case"colorArray":return It.interpolate(x,T,y);case"numberArray":return en.interpolate(x,T,y);case"variableAnchorOffsetCollection":return dn.interpolate(x,T,y);case"array":return El(x,T,y);case"projectionDefinition":return Zn.interpolate(x,T,y)}case"interpolate-hcl":switch(this.type.kind){case"color":return qt.interpolate(x,T,y,"hcl");case"colorArray":return It.interpolate(x,T,y,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return qt.interpolate(x,T,y,"lab");case"colorArray":return It.interpolate(x,T,y,"lab")}}}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function os(n,e,i,o){const u=o-i,f=n-i;return u===0?0:e===1?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}const nn={color:qt.interpolate,number:to,padding:Dn.interpolate,numberArray:en.interpolate,colorArray:It.interpolate,variableAnchorOffsetCollection:dn.interpolate,array:El};class No{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o=null;const u=i.expectedType;u&&u.kind!=="value"&&(o=u);const f=[];for(const y of e.slice(1)){const x=i.parse(y,1+f.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,f.push(x)}if(!o)throw new Error("No output type");const p=u&&f.some((y=>Tl(u,y.type)));return new No(p?Vt:o,f)}evaluate(e){let i,o=null,u=0;for(const f of this.args)if(u++,o=f.evaluate(e),o&&o instanceof Aa&&!o.available&&(i||(i=o.name),o=null,u===this.args.length&&(o=i)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function yu(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function vu(n,e,i,o){return o.compare(e,i)===0}function pn(n,e,i){const o=n!=="=="&&n!=="!=";return class G_{constructor(f,p,y){this.type=Zt,this.lhs=f,this.rhs=p,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||p.type.kind==="value"}static parse(f,p){if(f.length!==3&&f.length!==4)return p.error("Expected two or three arguments.");const y=f[0];let x=p.parse(f[1],1,Vt);if(!x)return null;if(!yu(y,x.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${ui(x.type)}'.`);let T=p.parse(f[2],2,Vt);if(!T)return null;if(!yu(y,T.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${ui(T.type)}'.`);if(x.type.kind!==T.type.kind&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error(`Cannot compare types '${ui(x.type)}' and '${ui(T.type)}'.`);o&&(x.type.kind==="value"&&T.type.kind!=="value"?x=new Ca(T.type,[x]):x.type.kind!=="value"&&T.type.kind==="value"&&(T=new Ca(x.type,[T])));let E=null;if(f.length===4){if(x.type.kind!=="string"&&T.type.kind!=="string"&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(E=p.parse(f[3],3,Po),!E)return null}return new G_(x,T,E)}evaluate(f){const p=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(o&&this.hasUntypedArgument){const x=tn(p),T=tn(y);if(x.kind!==T.kind||x.kind!=="string"&&x.kind!=="number")throw new Li(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${x.kind}, ${T.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=tn(p),T=tn(y);if(x.kind!=="string"||T.kind!=="string")return e(f,p,y)}return this.collator?i(f,p,y,this.collator.evaluate(f)):e(f,p,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const Af=pn("==",(function(n,e,i){return e===i}),vu),dc=pn("!=",(function(n,e,i){return e!==i}),(function(n,e,i,o){return!vu(0,e,i,o)})),Cf=pn("<",(function(n,e,i){return e<i}),(function(n,e,i,o){return o.compare(e,i)<0})),Hd=pn(">",(function(n,e,i){return e>i}),(function(n,e,i,o){return o.compare(e,i)>0})),Al=pn("<=",(function(n,e,i){return e<=i}),(function(n,e,i,o){return o.compare(e,i)<=0})),pc=pn(">=",(function(n,e,i){return e>=i}),(function(n,e,i,o){return o.compare(e,i)>=0}));class Cl{constructor(e,i,o){this.type=Po,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const u=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Zt);if(!u)return null;const f=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Zt);if(!f)return null;let p=null;return o.locale&&(p=i.parse(o.locale,1,jt),!p)?null:new Cl(u,f,p)}evaluate(e){return new Fr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class ph{constructor(e,i,o,u,f){this.type=jt,this.number=e,this.locale=i,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Je);if(!o)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=i.parse(u.locale,1,jt),!f))return null;let p=null;if(u.currency&&(p=i.parse(u.currency,1,jt),!p))return null;let y=null;if(u["min-fraction-digits"]&&(y=i.parse(u["min-fraction-digits"],1,Je),!y))return null;let x=null;return u["max-fraction-digits"]&&(x=i.parse(u["max-fraction-digits"],1,Je),!x)?null:new ph(o,f,p,y,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class xu{constructor(e){this.type=is,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const u=[];let f=!1;for(let p=1;p<=e.length-1;++p){const y=e[p];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let x=null;if(y["font-scale"]&&(x=i.parse(y["font-scale"],1,Je),!x))return null;let T=null;if(y["text-font"]&&(T=i.parse(y["text-font"],1,va(jt)),!T))return null;let E=null;if(y["text-color"]&&(E=i.parse(y["text-color"],1,Ka),!E))return null;let C=null;if(y["vertical-align"]){if(typeof y["vertical-align"]=="string"&&!hh.includes(y["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${y["vertical-align"]}' instead.`);if(C=i.parse(y["vertical-align"],1,jt),!C)return null}const D=u[u.length-1];D.scale=x,D.font=T,D.textColor=E,D.verticalAlign=C}else{const x=i.parse(e[p],1,Vt);if(!x)return null;const T=x.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:x,scale:null,font:null,textColor:null,verticalAlign:null})}}return new xu(u)}evaluate(e){return new qn(this.sections.map((i=>{const o=i.content.evaluate(e);return tn(o)===fn?new pu("",o,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(e):null):new pu(io(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null,i.verticalAlign?i.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor),i.verticalAlign&&e(i.verticalAlign)}outputDefined(){return!1}}class zl{constructor(e){this.type=fn,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const o=i.parse(e[1],1,jt);return o?new zl(o):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),o=Aa.fromString(i);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(i)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class Dl{constructor(e){this.type=Je,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${ui(o.type)} instead.`):new Dl(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new Li(`Expected value to be of type string or array, but found ${ui(tn(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const wn=8192;function Pl(n,e){const i=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*wn),Math.round(o*u*wn)]}function Il(n,e){const i=Math.pow(2,e.z);return[(u=(n[0]/wn+e.x)/i,360*u-180),(o=(n[1]/wn+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Rl(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function so(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function zf(n,e,i){const o=n[0]-e[0],u=n[1]-e[1],f=n[0]-i[0],p=n[1]-i[1];return o*p-f*u==0&&o*f<=0&&u*p<=0}function bu(n,e,i,o){return(u=[o[0]-i[0],o[1]-i[1]])[0]*(f=[e[0]-n[0],e[1]-n[1]])[1]-u[1]*f[0]!=0&&!(!gc(n,e,i,o)||!gc(i,o,n,e));var u,f}function Df(n,e,i){for(const o of i)for(let u=0;u<o.length-1;++u)if(bu(n,e,o[u],o[u+1]))return!0;return!1}function Nr(n,e,i=!1){let o=!1;for(const y of e)for(let x=0;x<y.length-1;x++){if(zf(n,y[x],y[x+1]))return i;(f=y[x])[1]>(u=n)[1]!=(p=y[x+1])[1]>u[1]&&u[0]<(p[0]-f[0])*(u[1]-f[1])/(p[1]-f[1])+f[0]&&(o=!o)}var u,f,p;return o}function mc(n,e){for(const i of e)if(Nr(n,i))return!0;return!1}function Pf(n,e){for(const i of n)if(!Nr(i,e))return!1;for(let i=0;i<n.length-1;++i)if(Df(n[i],n[i+1],e))return!1;return!0}function If(n,e){for(const i of e)if(Pf(n,i))return!0;return!1}function gc(n,e,i,o){const u=o[0]-i[0],f=o[1]-i[1],p=(n[0]-i[0])*f-u*(n[1]-i[1]),y=(e[0]-i[0])*f-u*(e[1]-i[1]);return p>0&&y<0||p<0&&y>0}function _c(n,e,i){const o=[];for(let u=0;u<n.length;u++){const f=[];for(let p=0;p<n[u].length;p++){const y=Pl(n[u][p],i);Rl(e,y),f.push(y)}o.push(f)}return o}function Vo(n,e,i){const o=[];for(let u=0;u<n.length;u++){const f=_c(n[u],e,i);o.push(f)}return o}function Ll(n,e,i,o){if(n[0]<i[0]||n[0]>i[2]){const u=.5*o;let f=n[0]-i[0]>u?-o:i[0]-n[0]>u?o:0;f===0&&(f=n[0]-i[2]>u?-o:i[2]-n[0]>u?o:0),n[0]+=f}Rl(e,n)}function Rf(n,e,i,o){const u=Math.pow(2,o.z)*wn,f=[o.x*wn,o.y*wn],p=[];for(const y of n)for(const x of y){const T=[x.x+f[0],x.y+f[1]];Ll(T,e,i,u),p.push(T)}return p}function wu(n,e,i,o){const u=Math.pow(2,o.z)*wn,f=[o.x*wn,o.y*wn],p=[];for(const x of n){const T=[];for(const E of x){const C=[E.x+f[0],E.y+f[1]];Rl(e,C),T.push(C)}p.push(T)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of p)for(const T of x)Ll(T,e,i,u)}var y;return p}class oo{constructor(e,i){this.type=Zt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ss(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const u=[];for(const f of o.features){const{type:p,coordinates:y}=f.geometry;p==="Polygon"&&u.push(y),p==="MultiPolygon"&&u.push(...y)}if(u.length)return new oo(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new oo(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new oo(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=_c(o.coordinates,f,p),x=Rf(i.geometry(),u,f,p);if(!so(u,f))return!1;for(const T of x)if(!Nr(T,y))return!1}if(o.type==="MultiPolygon"){const y=Vo(o.coordinates,f,p),x=Rf(i.geometry(),u,f,p);if(!so(u,f))return!1;for(const T of x)if(!mc(T,y))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=_c(o.coordinates,f,p),x=wu(i.geometry(),u,f,p);if(!so(u,f))return!1;for(const T of x)if(!Pf(T,y))return!1}if(o.type==="MultiPolygon"){const y=Vo(o.coordinates,f,p),x=wu(i.geometry(),u,f,p);if(!so(u,f))return!1;for(const T of x)if(!If(T,y))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let mh=class{constructor(n=[],e=(i,o)=>i<o?-1:i>o?1:0){if(this.data=n,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:e,compare:i}=this,o=e[n];for(;n>0;){const u=n-1>>1,f=e[u];if(i(o,f)>=0)break;e[n]=f,n=u}e[n]=o}_down(n){const{data:e,compare:i}=this,o=this.length>>1,u=e[n];for(;n<o;){let f=1+(n<<1);const p=f+1;if(p<this.length&&i(e[p],e[f])<0&&(f=p),i(e[f],u)>=0)break;e[n]=e[f],n=f}e[n]=u}};function Tu(n,e,i=0,o=n.length-1,u=gh){for(;o>i;){if(o-i>600){const x=o-i+1,T=e-i+1,E=Math.log(x),C=.5*Math.exp(2*E/3),D=.5*Math.sqrt(E*C*(x-C)/x)*(T-x/2<0?-1:1);Tu(n,e,Math.max(i,Math.floor(e-T*C/x+D)),Math.min(o,Math.floor(e+(x-T)*C/x+D)),u)}const f=n[e];let p=i,y=o;for(lo(n,i,e),u(n[o],f)>0&&lo(n,i,o);p<y;){for(lo(n,p,y),p++,y--;u(n[p],f)<0;)p++;for(;u(n[y],f)>0;)y--}u(n[i],f)===0?lo(n,i,y):(y++,lo(n,y,o)),y<=e&&(i=y+1),e<=y&&(o=y-1)}}function lo(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function gh(n,e){return n<e?-1:n>e?1:0}function Su(n,e){if(n.length<=1)return[n];const i=[];let o,u;for(const f of n){const p=Xd(f);p!==0&&(f.area=Math.abs(p),u===void 0&&(u=p<0),u===p<0?(o&&i.push(o),o=[f]):o.push(f))}if(o&&i.push(o),e>1)for(let f=0;f<i.length;f++)i[f].length<=e||(Tu(i[f],e,1,i[f].length-1,Lf),i[f]=i[f].slice(0,e));return i}function Lf(n,e){return e.area-n.area}function Xd(n){let e=0;for(let i,o,u=0,f=n.length,p=f-1;u<f;p=u++)i=n[u],o=n[p],e+=(o.x-i.x)*(i.y+o.y);return e}const Bf=1/298.257223563,Mu=Bf*(2-Bf),Of=Math.PI/180;class _h{constructor(e){const i=6378.137*Of*1e3,o=Math.cos(e*Of),u=1/(1-Mu*(1-o*o)),f=Math.sqrt(u);this.kx=i*f*o,this.ky=i*f*u*(1-Mu)}distance(e,i){const o=this.wrap(e[0]-i[0])*this.kx,u=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(e,i){let o,u,f,p,y=1/0;for(let x=0;x<e.length-1;x++){let T=e[x][0],E=e[x][1],C=this.wrap(e[x+1][0]-T)*this.kx,D=(e[x+1][1]-E)*this.ky,P=0;C===0&&D===0||(P=(this.wrap(i[0]-T)*this.kx*C+(i[1]-E)*this.ky*D)/(C*C+D*D),P>1?(T=e[x+1][0],E=e[x+1][1]):P>0&&(T+=C/this.kx*P,E+=D/this.ky*P)),C=this.wrap(i[0]-T)*this.kx,D=(i[1]-E)*this.ky;const B=C*C+D*D;B<y&&(y=B,o=T,u=E,f=x,p=P)}return{point:[o,u],index:f,t:Math.max(0,Math.min(1,p))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Oa(n,e){return e[0]-n[0]}function uo(n){return n[1]-n[0]+1}function yr(n,e){return n[1]>=n[0]&&n[1]<e}function Eu(n,e){if(n[0]>n[1])return[null,null];const i=uo(n);if(e){if(i===2)return[n,null];const u=Math.floor(i/2);return[[n[0],n[0]+u],[n[0]+u,n[1]]]}if(i===1)return[n,null];const o=Math.floor(i/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}function yc(n,e){if(!yr(e,n.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)Rl(i,n[o]);return i}function vc(n){const e=[1/0,1/0,-1/0,-1/0];for(const i of n)for(const o of i)Rl(e,o);return e}function Au(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function xc(n,e,i){if(!Au(n)||!Au(e))return NaN;let o=0,u=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(u=n[1]-e[3]),n[3]<e[1]&&(u=e[1]-n[3]),i.distance([0,0],[o,u])}function vr(n,e,i){const o=i.pointOnLine(e,n);return i.distance(n,o.point)}function Cu(n,e,i,o,u){const f=Math.min(vr(n,[i,o],u),vr(e,[i,o],u)),p=Math.min(vr(i,[n,e],u),vr(o,[n,e],u));return Math.min(f,p)}function zu(n,e,i,o,u){if(!yr(e,n.length)||!yr(o,i.length))return 1/0;let f=1/0;for(let p=e[0];p<e[1];++p){const y=n[p],x=n[p+1];for(let T=o[0];T<o[1];++T){const E=i[T],C=i[T+1];if(bu(y,x,E,C))return 0;f=Math.min(f,Cu(y,x,E,C,u))}}return f}function bc(n,e,i,o,u){if(!yr(e,n.length)||!yr(o,i.length))return NaN;let f=1/0;for(let p=e[0];p<=e[1];++p)for(let y=o[0];y<=o[1];++y)if(f=Math.min(f,u.distance(n[p],i[y])),f===0)return f;return f}function kf(n,e,i){if(Nr(n,e,!0))return 0;let o=1/0;for(const u of e){const f=u[0],p=u[u.length-1];if(f!==p&&(o=Math.min(o,vr(n,[p,f],i)),o===0))return o;const y=i.pointOnLine(u,n);if(o=Math.min(o,i.distance(n,y.point)),o===0)return o}return o}function jo(n,e,i,o){if(!yr(e,n.length))return NaN;for(let f=e[0];f<=e[1];++f)if(Nr(n[f],i,!0))return 0;let u=1/0;for(let f=e[0];f<e[1];++f){const p=n[f],y=n[f+1];for(const x of i)for(let T=0,E=x.length,C=E-1;T<E;C=T++){const D=x[C],P=x[T];if(bu(p,y,D,P))return 0;u=Math.min(u,Cu(p,y,D,P,o))}}return u}function Uo(n,e){for(const i of n)for(const o of i)if(Nr(o,e,!0))return!0;return!1}function yh(n,e,i,o=1/0){const u=vc(n),f=vc(e);if(o!==1/0&&xc(u,f,i)>=o)return o;if(so(u,f)){if(Uo(n,e))return 0}else if(Uo(e,n))return 0;let p=1/0;for(const y of n)for(let x=0,T=y.length,E=T-1;x<T;E=x++){const C=y[E],D=y[x];for(const P of e)for(let B=0,k=P.length,N=k-1;B<k;N=B++){const G=P[N],ee=P[B];if(bu(C,D,G,ee))return 0;p=Math.min(p,Cu(C,D,G,ee,i))}}return p}function _i(n,e,i,o,u,f){if(!f)return;const p=xc(yc(o,f),u,i);p<e&&n.push([p,f,[0,0]])}function ls(n,e,i,o,u,f,p){if(!f||!p)return;const y=xc(yc(o,f),yc(u,p),i);y<e&&n.push([y,f,p])}function Du(n,e,i,o,u=1/0){let f=Math.min(o.distance(n[0],i[0][0]),u);if(f===0)return f;const p=new mh([[0,[0,n.length-1],[0,0]]],Oa),y=vc(i);for(;p.length>0;){const x=p.pop();if(x[0]>=f)continue;const T=x[1],E=e?50:100;if(uo(T)<=E){if(!yr(T,n.length))return NaN;if(e){const C=jo(n,T,i,o);if(isNaN(C)||C===0)return C;f=Math.min(f,C)}else for(let C=T[0];C<=T[1];++C){const D=kf(n[C],i,o);if(f=Math.min(f,D),f===0)return 0}}else{const C=Eu(T,e);_i(p,f,o,n,y,C[0]),_i(p,f,o,n,y,C[1])}}return f}function Pu(n,e,i,o,u,f=1/0){let p=Math.min(f,u.distance(n[0],i[0]));if(p===0)return p;const y=new mh([[0,[0,n.length-1],[0,i.length-1]]],Oa);for(;y.length>0;){const x=y.pop();if(x[0]>=p)continue;const T=x[1],E=x[2],C=e?50:100,D=o?50:100;if(uo(T)<=C&&uo(E)<=D){if(!yr(T,n.length)&&yr(E,i.length))return NaN;let P;if(e&&o)P=zu(n,T,i,E,u),p=Math.min(p,P);else if(e&&!o){const B=n.slice(T[0],T[1]+1);for(let k=E[0];k<=E[1];++k)if(P=vr(i[k],B,u),p=Math.min(p,P),p===0)return p}else if(!e&&o){const B=i.slice(E[0],E[1]+1);for(let k=T[0];k<=T[1];++k)if(P=vr(n[k],B,u),p=Math.min(p,P),p===0)return p}else P=bc(n,T,i,E,u),p=Math.min(p,P)}else{const P=Eu(T,e),B=Eu(E,o);ls(y,p,u,n,i,P[0],B[0]),ls(y,p,u,n,i,P[0],B[1]),ls(y,p,u,n,i,P[1],B[0]),ls(y,p,u,n,i,P[1],B[1])}}return p}function wc(n){return n.type==="MultiPolygon"?n.coordinates.map((e=>({type:"Polygon",coordinates:e}))):n.type==="MultiLineString"?n.coordinates.map((e=>({type:"LineString",coordinates:e}))):n.type==="MultiPoint"?n.coordinates.map((e=>({type:"Point",coordinates:e}))):[n]}class Go{constructor(e,i){this.type=Je,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ss(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new Go(o,o.features.map((u=>wc(u.geometry))).flat());if(o.type==="Feature")return new Go(o,wc(o.geometry));if("type"in o&&"coordinates"in o)return new Go(o,wc(o))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const u=i.geometry(),f=u.flat().map((x=>Il([x.x,x.y],i.canonical)));if(u.length===0)return NaN;const p=new _h(f[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Pu(f,!1,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,Pu(f,!1,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,Du(f,!1,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const u=i.geometry(),f=u.flat().map((x=>Il([x.x,x.y],i.canonical)));if(u.length===0)return NaN;const p=new _h(f[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Pu(f,!0,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,Pu(f,!0,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,Du(f,!0,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(i,o){const u=i.geometry();if(u.length===0||u[0].length===0)return NaN;const f=Su(u,0).map((x=>x.map((T=>T.map((E=>Il([E.x,E.y],i.canonical))))))),p=new _h(f[0][0][0][1]);let y=1/0;for(const x of o)for(const T of f){switch(x.type){case"Point":y=Math.min(y,Du([x.coordinates],!1,T,p,y));break;case"LineString":y=Math.min(y,Du(x.coordinates,!0,T,p,y));break;case"Polygon":y=Math.min(y,yh(T,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Iu{constructor(e){this.type=Vt,this.key=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?i.error("Global state property must be defined."):typeof o!="string"?i.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Iu(o)}evaluate(e){var i;const o=(i=e.globals)===null||i===void 0?void 0:i.globalState;return o&&Object.keys(o).length!==0?Ml(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Bl={"==":Af,"!=":dc,">":Hd,"<":Cf,">=":pc,"<=":Al,array:Ca,at:Kt,boolean:Ca,case:gu,coalesce:No,collator:Cl,format:xu,image:zl,in:Ut,"index-of":Fo,interpolate:Da,"interpolate-hcl":Da,"interpolate-lab":Da,length:Dl,let:Ei,literal:er,match:ci,number:Ca,"number-format":ph,object:Ca,slice:_r,step:ro,string:Ca,"to-boolean":za,"to-color":za,"to-number":za,"to-string":za,var:no,within:oo,distance:Go,"global-state":Iu};class tr{constructor(e,i,o,u){this.name=e,this.type=i,this._evaluate=o,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,i){const o=e[0],u=tr.definitions[o];if(!u)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,p=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=p.filter((([T])=>!Array.isArray(T)||T.length===e.length-1));let x=null;for(const[T,E]of y){x=new ko(i.registry,Pa,i.path,null,i.scope);const C=[];let D=!1;for(let P=1;P<e.length;P++){const B=e[P],k=Array.isArray(T)?T[P-1]:T.type,N=x.parse(B,1+C.length,k);if(!N){D=!0;break}C.push(N)}if(!D)if(Array.isArray(T)&&T.length!==C.length)x.error(`Expected ${T.length} arguments, but found ${C.length} instead.`);else{for(let P=0;P<C.length;P++){const B=Array.isArray(T)?T[P]:T.type,k=C[P];x.concat(P+1).checkSubtype(B,k.type)}if(x.errors.length===0)return new tr(o,f,E,C)}}if(y.length===1)i.errors.push(...x.errors);else{const T=(y.length?y:p).map((([C])=>{return D=C,Array.isArray(D)?`(${D.map(ui).join(", ")})`:`(${ui(D.type)}...)`;var D})).join(" | "),E=[];for(let C=1;C<e.length;C++){const D=i.parse(e[C],1+E.length);if(!D)return null;E.push(ui(D.type))}i.error(`Expected arguments of type ${T}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){tr.definitions=i;for(const o in i)e[o]=tr}}function vh(n,[e,i,o,u]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const f=u?u.evaluate(n):1,p=Ja(e,i,o,f);if(p)throw new Li(p);return new qt(e/255,i/255,o/255,f,!1)}function Tc(n,e){return n in e}function ir(n,e){const i=e[n];return i===void 0?null:i}function us(n){return{type:n}}function Pa(n){if(n instanceof no)return Pa(n.boundExpression);if(n instanceof tr&&n.name==="error"||n instanceof Cl||n instanceof oo||n instanceof Go||n instanceof Iu)return!1;const e=n instanceof za||n instanceof Ca;let i=!0;return n.eachChild((o=>{i=e?i&&Pa(o):i&&o instanceof er})),!!i&&Is(n)&&Zo(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Is(n){if(n instanceof tr&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof oo||n instanceof Go)return!1;let e=!0;return n.eachChild((i=>{e&&!Is(i)&&(e=!1)})),e}function qo(n){if(n instanceof tr&&n.name==="feature-state")return!1;let e=!0;return n.eachChild((i=>{e&&!qo(i)&&(e=!1)})),e}function Zo(n,e){if(n instanceof tr&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild((o=>{i&&!Zo(o,e)&&(i=!1)})),i}function Ru(n){return{result:"success",value:n}}function co(n){return{result:"error",value:n}}function xr(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function xh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Ol(n){return!!n.expression&&n.expression.interpolated}function Gt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function Sc(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&tn(n)===ts}function nr(n){return n}function Mc(n,e){const i=n.stops&&typeof n.stops[0][0]=="object",o=i||!(i||n.property!==void 0),u=n.type||(Ol(e)?"exponential":"interval"),f=(function(E){switch(E.type){case"color":return qt.parse;case"padding":return Dn.parse;case"numberArray":return en.parse;case"colorArray":return It.parse;default:return null}})(e);if(f&&((n=_a({},n)).stops&&(n.stops=n.stops.map((E=>[E[0],f(E[1])]))),n.default=f(n.default?n.default:e.default)),n.colorSpace&&(p=n.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var p;const y=(function(E){switch(E){case"exponential":return ho;case"interval":return Ec;case"categorical":return Ff;case"identity":return bh;default:throw new Error(`Unknown function type "${E}"`)}})(u);let x,T;if(u==="categorical"){x=Object.create(null);for(const E of n.stops)x[E[0]]=E[1];T=typeof n.stops[0][0]}if(i){const E={},C=[];for(let B=0;B<n.stops.length;B++){const k=n.stops[B],N=k[0].zoom;E[N]===void 0&&(E[N]={zoom:N,type:n.type,property:n.property,default:n.default,stops:[]},C.push(N)),E[N].stops.push([k[0].value,k[1]])}const D=[];for(const B of C)D.push([E[B].zoom,Mc(E[B],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Da.interpolationFactor.bind(void 0,P),zoomStops:D.map((B=>B[0])),evaluate:({zoom:B},k)=>ho({stops:D,base:n.base},e,B).evaluate(B,k)}}if(o){const E=u==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Da.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map((C=>C[0])),evaluate:({zoom:C})=>y(n,e,C,x,T)}}return{kind:"source",evaluate(E,C){const D=C&&C.properties?C.properties[n.property]:void 0;return D===void 0?ar(n.default,e.default):y(n,e,D,x,T)}}}function ar(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function Ff(n,e,i,o,u){return ar(typeof i===u?o[i]:void 0,n.default,e.default)}function Ec(n,e,i){if(Gt(i)!=="number")return ar(n.default,e.default);const o=n.stops.length;if(o===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[o-1][0])return n.stops[o-1][1];const u=ao(n.stops.map((f=>f[0])),i);return n.stops[u][1]}function ho(n,e,i){const o=n.base!==void 0?n.base:1;if(Gt(i)!=="number")return ar(n.default,e.default);const u=n.stops.length;if(u===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[u-1][0])return n.stops[u-1][1];const f=ao(n.stops.map((E=>E[0])),i),p=(function(E,C,D,P){const B=P-D,k=E-D;return B===0?0:C===1?k/B:(Math.pow(C,k)-1)/(Math.pow(C,B)-1)})(i,o,n.stops[f][0],n.stops[f+1][0]),y=n.stops[f][1],x=n.stops[f+1][1],T=nn[e.type]||nr;return typeof y.evaluate=="function"?{evaluate(...E){const C=y.evaluate.apply(void 0,E),D=x.evaluate.apply(void 0,E);if(C!==void 0&&D!==void 0)return T(C,D,p,n.colorSpace)}}:T(y,x,p,n.colorSpace)}function bh(n,e,i){switch(e.type){case"color":i=qt.parse(i);break;case"formatted":i=qn.fromString(i.toString());break;case"resolvedImage":i=Aa.fromString(i.toString());break;case"padding":i=Dn.parse(i);break;case"colorArray":i=It.parse(i);break;case"numberArray":i=en.parse(i);break;default:Gt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0)}return ar(i,n.default,e.default)}tr.register(Bl,{error:[{kind:"error"},[jt],(n,[e])=>{throw new Li(e.evaluate(n))}],typeof:[jt,[Vt],(n,[e])=>ui(tn(e.evaluate(n)))],"to-rgba":[va(Je,4),[Ka],(n,[e])=>{const[i,o,u,f]=e.evaluate(n).rgb;return[255*i,255*o,255*u,f]}],rgb:[Ka,[Je,Je,Je],vh],rgba:[Ka,[Je,Je,Je,Je],vh],has:{type:Zt,overloads:[[[jt],(n,[e])=>Tc(e.evaluate(n),n.properties())],[[jt,ts],(n,[e,i])=>Tc(e.evaluate(n),i.evaluate(n))]]},get:{type:Vt,overloads:[[[jt],(n,[e])=>ir(e.evaluate(n),n.properties())],[[jt,ts],(n,[e,i])=>ir(e.evaluate(n),i.evaluate(n))]]},"feature-state":[Vt,[jt],(n,[e])=>ir(e.evaluate(n),n.featureState||{})],properties:[ts,[],n=>n.properties()],"geometry-type":[jt,[],n=>n.geometryType()],id:[Vt,[],n=>n.id()],zoom:[Je,[],n=>n.globals.zoom],"heatmap-density":[Je,[],n=>n.globals.heatmapDensity||0],elevation:[Je,[],n=>n.globals.elevation||0],"line-progress":[Je,[],n=>n.globals.lineProgress||0],accumulated:[Vt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Je,us(Je),(n,e)=>{let i=0;for(const o of e)i+=o.evaluate(n);return i}],"*":[Je,us(Je),(n,e)=>{let i=1;for(const o of e)i*=o.evaluate(n);return i}],"-":{type:Je,overloads:[[[Je,Je],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Je],(n,[e])=>-e.evaluate(n)]]},"/":[Je,[Je,Je],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Je,[Je,Je],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Je,[],()=>Math.LN2],pi:[Je,[],()=>Math.PI],e:[Je,[],()=>Math.E],"^":[Je,[Je,Je],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Je,[Je],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Je,[Je],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Je,[Je],(n,[e])=>Math.log(e.evaluate(n))],log2:[Je,[Je],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Je,[Je],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Je,[Je],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Je,[Je],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Je,[Je],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Je,[Je],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Je,[Je],(n,[e])=>Math.atan(e.evaluate(n))],min:[Je,us(Je),(n,e)=>Math.min(...e.map((i=>i.evaluate(n))))],max:[Je,us(Je),(n,e)=>Math.max(...e.map((i=>i.evaluate(n))))],abs:[Je,[Je],(n,[e])=>Math.abs(e.evaluate(n))],round:[Je,[Je],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Je,[Je],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Je,[Je],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Zt,[jt,Vt],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Zt,[Vt],(n,[e])=>n.id()===e.value],"filter-type-==":[Zt,[jt],(n,[e])=>n.geometryType()===e.value],"filter-<":[Zt,[jt,Vt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Zt,[Vt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Zt,[jt,Vt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o>u}],"filter-id->":[Zt,[Vt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Zt,[jt,Vt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Zt,[Vt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Zt,[jt,Vt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Zt,[Vt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Zt,[Vt],(n,[e])=>e.value in n.properties()],"filter-has-id":[Zt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Zt,[va(jt)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Zt,[va(Vt)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Zt,[jt,va(Vt)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Zt,[jt,va(Vt)],(n,[e,i])=>(function(o,u,f,p){for(;f<=p;){const y=f+p>>1;if(u[y]===o)return!0;u[y]>o?p=y-1:f=y+1}return!1})(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Zt,overloads:[[[Zt,Zt],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[us(Zt),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Zt,overloads:[[[Zt,Zt],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[us(Zt),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Zt,[Zt],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Zt,[jt],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[jt,[jt],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[jt,[jt],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[jt,us(Vt),(n,e)=>e.map((i=>io(i.evaluate(n)))).join("")],"resolved-locale":[jt,[Po],(n,[e])=>e.evaluate(n).resolvedLocale()]});class Ac{constructor(e,i,o){this.expression=e,this._warningHistory={},this._evaluator=new Oo,this._defaultValue=i?(function(u){if(u.type==="color"&&Sc(u.default))return new qt(0,0,0,0);switch(u.type){case"color":return qt.parse(u.default)||null;case"padding":return Dn.parse(u.default)||null;case"numberArray":return en.parse(u.default)||null;case"colorArray":return It.parse(u.default)||null;case"variableAnchorOffsetCollection":return dn.parse(u.default)||null;case"projectionDefinition":return Zn.parse(u.default)||null;default:return u.default===void 0?null:u.default}})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this._globalState=o}evaluateWithoutErrorHandling(e,i,o,u,f,p){return this._globalState&&(e=Wn(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,u,f,p){this._globalState&&(e=Wn(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Li(`Expected value to be one of ${Object.keys(this._enumValues).map((x=>JSON.stringify(x))).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function fo(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Bl}function kl(n,e,i){const o=new ko(Bl,Pa,[],e?(function(f){const p={color:Ka,string:jt,number:Je,enum:jt,boolean:Zt,formatted:is,padding:zs,numberArray:as,colorArray:ns,projectionDefinition:cc,resolvedImage:fn,variableAnchorOffsetCollection:wl};return f.type==="array"?va(p[f.value]||Vt,f.length):p[f.type]})(e):void 0),u=o.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Ru(new Ac(u,e,i)):co(o.errors)}class Ia{constructor(e,i,o){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!qo(i.expression),this.globalStateRefs=Hn(i.expression),this._globalState=o}evaluateWithoutErrorHandling(e,i,o,u,f,p){return this._globalState&&(e=Wn(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,f,p)}evaluate(e,i,o,u,f,p){return this._globalState&&(e=Wn(e,this._globalState)),this._styleExpression.evaluate(e,i,o,u,f,p)}}class po{constructor(e,i,o,u,f){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!qo(i.expression),this.globalStateRefs=Hn(i.expression),this.interpolationType=u,this._globalState=f}evaluateWithoutErrorHandling(e,i,o,u,f,p){return this._globalState&&(e=Wn(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,f,p)}evaluate(e,i,o,u,f,p){return this._globalState&&(e=Wn(e,this._globalState)),this._styleExpression.evaluate(e,i,o,u,f,p)}interpolationFactor(e,i,o){return this.interpolationType?Da.interpolationFactor(this.interpolationType,e,i,o):0}}function mo(n,e,i){const o=kl(n,e,i);if(o.result==="error")return o;const u=o.value.expression,f=Is(u);if(!f&&!xr(e))return co([new ya("","data expressions not supported")]);const p=Zo(u,["zoom"]);if(!p&&!xh(e))return co([new ya("","zoom expressions not supported")]);const y=go(u);return y||p?y instanceof ya?co([y]):y instanceof Da&&!Ol(e)?co([new ya("",'"interpolate" expressions cannot be used with this property')]):Ru(y?new po(f?"camera":"composite",o.value,y.labels,y instanceof Da?y.interpolation:void 0,i):new Ia(f?"constant":"source",o.value,i)):co([new ya("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ho{constructor(e,i){this._parameters=e,this._specification=i,_a(this,Mc(this._parameters,this._specification))}static deserialize(e){return new Ho(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function go(n){let e=null;if(n instanceof Ei)e=go(n.result);else if(n instanceof No){for(const i of n.args)if(e=go(i),e)break}else(n instanceof ro||n instanceof Da)&&n.input instanceof tr&&n.input.name==="zoom"&&(e=n);return e instanceof ya||n.eachChild((i=>{const o=go(i);o instanceof ya?e=o:!e&&o?e=new ya("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new ya("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Hn(n,e=new Set){return n instanceof Iu&&e.add(n.key),n.eachChild((i=>{Hn(i,e)})),e}function Wn(n,e){const{zoom:i,heatmapDensity:o,elevation:u,lineProgress:f,isSupportedScript:p,accumulated:y}=n??{};return{zoom:i,heatmapDensity:o,elevation:u,lineProgress:f,isSupportedScript:p,accumulated:y,globalState:e}}function cs(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!cs(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const hs={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ka(n,e){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};cs(n)||(n=Xo(n));const i=kl(n,hs,e);if(i.result==="error")throw new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,u,f)=>i.value.evaluate(o,u,{},f),needGeometry:wh(n),getGlobalStateRefs:()=>Hn(i.value.expression)}}function Rs(n,e){return n<e?-1:n>e?1:0}function wh(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(wh(n[e]))return!0;return!1}function Xo(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Fl(n[1],n[2],"=="):e==="!="?Bi(Fl(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Fl(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(Xo))):e==="all"?["all"].concat(n.slice(1).map(Xo)):e==="none"?["all"].concat(n.slice(1).map(Xo).map(Bi)):e==="in"?Th(n[1],n.slice(2)):e==="!in"?Bi(Th(n[1],n.slice(2))):e==="has"?Kn(n[1]):e!=="!has"||Bi(Kn(n[1]));var i}function Fl(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function Th(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",n,["literal",e.sort(Rs)]]:["filter-in-small",n,["literal",e]]}}function Kn(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Bi(n){return["!",n]}function si(n){const e=typeof n;if(e==="number"||e==="boolean"||e==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let u="[";for(const f of n)u+=`${si(f)},`;return`${u}]`}const i=Object.keys(n).sort();let o="{";for(let u=0;u<i.length;u++)o+=`${JSON.stringify(i[u])}:${si(n[i[u]])},`;return`${o}}`}function Ls(n){let e="";for(const i of fi)e+=`/${si(n[i])}`;return e}function rr(n){const e=n.value;return e?[new Qe(n.key,e,"constants have been deprecated as of v8")]:[]}function ln(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Fa(n){if(Array.isArray(n))return n.map(Fa);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Fa(n[i]);return e}return ln(n)}function Na(n){const e=n.key,i=n.value,o=n.valueSpec||{},u=n.objectElementValidators||{},f=n.style,p=n.styleSpec,y=n.validateSpec;let x=[];const T=Gt(i);if(T!=="object")return[new Qe(e,i,`object expected, ${T} found`)];for(const E in i){const C=E.split(".")[0],D=Ml(o,C)||o["*"];let P;if(Ml(u,C))P=u[C];else if(Ml(o,C)){if(i[E]===void 0)continue;P=y}else if(u["*"])P=u["*"];else{if(!o["*"]){x.push(new Qe(e,i[E],`unknown property "${E}"`));continue}P=y}x=x.concat(P({key:(e&&`${e}.`)+E,value:i[E],valueSpec:D,style:f,styleSpec:p,object:i,objectKey:E,validateSpec:y},i))}for(const E in o)u[E]||o[E].required&&o[E].default===void 0&&i[E]===void 0&&x.push(new Qe(e,i,`missing required property "${E}"`));return x}function Lu(n){const e=n.value,i=n.valueSpec,o=n.style,u=n.styleSpec,f=n.key,p=n.arrayElementValidator||n.validateSpec;if(Gt(e)!=="array")return[new Qe(f,e,`array expected, ${Gt(e)} found`)];if(i.length&&e.length!==i.length)return[new Qe(f,e,`array length ${i.length} expected, length ${e.length} found`)];let y={type:i.value,values:i.values};u.$version<7&&(y.function=i.function),Gt(i.value)==="object"&&(y=i.value);let x=[];for(let T=0;T<e.length;T++)x=x.concat(p({array:e,arrayIndex:T,value:e[T],valueSpec:y,validateSpec:n.validateSpec,style:o,styleSpec:u,key:`${f}[${T}]`}));return x}function fs(n){const e=n.key,i=n.value,o=n.valueSpec;let u=Gt(i);return u==="number"&&i!=i&&(u="NaN"),u!=="number"?[new Qe(e,i,`number expected, ${u} found`)]:"minimum"in o&&i<o.minimum?[new Qe(e,i,`${i} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&i>o.maximum?[new Qe(e,i,`${i} is greater than the maximum value ${o.maximum}`)]:[]}function ds(n){const e=n.valueSpec,i=ln(n.value.type);let o,u,f,p={};const y=i!=="categorical"&&n.value.property===void 0,x=!y,T=Gt(n.value.stops)==="array"&&Gt(n.value.stops[0])==="array"&&Gt(n.value.stops[0][0])==="object",E=Na({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(P){if(i==="identity")return[new Qe(P.key,P.value,'identity function may not have a "stops" property')];let B=[];const k=P.value;return B=B.concat(Lu({key:P.key,value:k,valueSpec:P.valueSpec,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:C})),Gt(k)==="array"&&k.length===0&&B.push(new Qe(P.key,k,"array must have at least one stop")),B},default:function(P){return P.validateSpec({key:P.key,value:P.value,valueSpec:e,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec})}}});return i==="identity"&&y&&E.push(new Qe(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||E.push(new Qe(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!Ol(n.valueSpec)&&E.push(new Qe(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(x&&!xr(n.valueSpec)?E.push(new Qe(n.key,n.value,"property functions not supported")):y&&!xh(n.valueSpec)&&E.push(new Qe(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!T||n.value.property!==void 0||E.push(new Qe(n.key,n.value,'"property" property is required')),E;function C(P){let B=[];const k=P.value,N=P.key;if(Gt(k)!=="array")return[new Qe(N,k,`array expected, ${Gt(k)} found`)];if(k.length!==2)return[new Qe(N,k,`array length 2 expected, length ${k.length} found`)];if(T){if(Gt(k[0])!=="object")return[new Qe(N,k,`object expected, ${Gt(k[0])} found`)];if(k[0].zoom===void 0)return[new Qe(N,k,"object stop key must have zoom")];if(k[0].value===void 0)return[new Qe(N,k,"object stop key must have value")];if(f&&f>ln(k[0].zoom))return[new Qe(N,k[0].zoom,"stop zoom values must appear in ascending order")];ln(k[0].zoom)!==f&&(f=ln(k[0].zoom),u=void 0,p={}),B=B.concat(Na({key:`${N}[0]`,value:k[0],valueSpec:{zoom:{}},validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:fs,value:D}}))}else B=B.concat(D({key:`${N}[0]`,value:k[0],validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec},k));return fo(Fa(k[1]))?B.concat([new Qe(`${N}[1]`,k[1],"expressions are not allowed in function stops.")]):B.concat(P.validateSpec({key:`${N}[1]`,value:k[1],valueSpec:e,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec}))}function D(P,B){const k=Gt(P.value),N=ln(P.value),G=P.value!==null?P.value:B;if(o){if(k!==o)return[new Qe(P.key,G,`${k} stop domain type must match previous stop domain type ${o}`)]}else o=k;if(k!=="number"&&k!=="string"&&k!=="boolean")return[new Qe(P.key,G,"stop domain value must be a number, string, or boolean")];if(k!=="number"&&i!=="categorical"){let ee=`number expected, ${k} found`;return xr(e)&&i===void 0&&(ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Qe(P.key,G,ee)]}return i!=="categorical"||k!=="number"||isFinite(N)&&Math.floor(N)===N?i!=="categorical"&&k==="number"&&u!==void 0&&N<u?[new Qe(P.key,G,"stop domain values must appear in ascending order")]:(u=N,i==="categorical"&&N in p?[new Qe(P.key,G,"stop domain values must be unique")]:(p[N]=!0,[])):[new Qe(P.key,G,`integer expected, found ${N}`)]}}function ps(n){const e=(n.expressionContext==="property"?mo:kl)(Fa(n.value),n.valueSpec);if(e.result==="error")return e.value.map((o=>new Qe(`${n.key}${o.key}`,n.value,o.message)));const i=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new Qe(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!qo(i))return[new Qe(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!qo(i))return[new Qe(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Zo(i,["zoom","feature-state"]))return[new Qe(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Is(i))return[new Qe(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Bs(n){const e=n.key,i=n.value,o=Gt(i);return o!=="string"?[new Qe(e,i,`color expected, ${o} found`)]:qt.parse(String(i))?[]:[new Qe(e,i,`color expected, "${i}" found`)]}function Os(n){const e=n.key,i=n.value,o=n.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(ln(i))===-1&&u.push(new Qe(e,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(ln(i))===-1&&u.push(new Qe(e,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function br(n){return cs(Fa(n.value))?ps(_a({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ms(n)}function ms(n){const e=n.value,i=n.key;if(Gt(e)!=="array")return[new Qe(i,e,`array expected, ${Gt(e)} found`)];const o=n.styleSpec;let u,f=[];if(e.length<1)return[new Qe(i,e,"filter array must have at least 1 element")];switch(f=f.concat(Os({key:`${i}[0]`,value:e[0],valueSpec:o.filter_operator,style:n.style,styleSpec:n.styleSpec})),ln(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ln(e[1])==="$type"&&f.push(new Qe(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new Qe(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Gt(e[1]),u!=="string"&&f.push(new Qe(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let p=2;p<e.length;p++)u=Gt(e[p]),ln(e[1])==="$type"?f=f.concat(Os({key:`${i}[${p}]`,value:e[p],valueSpec:o.geometry_type,style:n.style,styleSpec:n.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&f.push(new Qe(`${i}[${p}]`,e[p],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)f=f.concat(ms({key:`${i}[${p}]`,value:e[p],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=Gt(e[1]),e.length!==2?f.push(new Qe(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&f.push(new Qe(`${i}[1]`,e[1],`string expected, ${u} found`))}return f}function ks(n,e){const i=n.key,o=n.validateSpec,u=n.style,f=n.styleSpec,p=n.value,y=n.objectKey,x=f[`${e}_${n.layerType}`];if(!x)return[];const T=y.match(/^(.*)-transition$/);if(e==="paint"&&T&&x[T[1]]&&x[T[1]].transition)return o({key:i,value:p,valueSpec:f.transition,style:u,styleSpec:f});const E=n.valueSpec||x[y];if(!E)return[new Qe(i,p,`unknown property "${y}"`)];let C;if(Gt(p)==="string"&&xr(E)&&!E.tokens&&(C=/^{([^}]+)}$/.exec(p)))return[new Qe(i,p,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const D=[];return n.layerType==="symbol"&&y==="text-font"&&Sc(Fa(p))&&ln(p.type)==="identity"&&D.push(new Qe(i,p,'"text-font" does not support identity functions')),D.concat(o({key:n.key,value:p,valueSpec:E,style:u,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:y}))}function gs(n){return ks(n,"paint")}function Cc(n){return ks(n,"layout")}function zc(n){let e=[];const i=n.value,o=n.key,u=n.style,f=n.styleSpec;if(Gt(i)!=="object")return[new Qe(o,i,`object expected, ${Gt(i)} found`)];i.type||i.ref||e.push(new Qe(o,i,'either "type" or "ref" is required'));let p=ln(i.type);const y=ln(i.ref);if(i.id){const x=ln(i.id);for(let T=0;T<n.arrayIndex;T++){const E=u.layers[T];ln(E.id)===x&&e.push(new Qe(o,i.id,`duplicate layer id "${i.id}", previously used at line ${E.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach((T=>{T in i&&e.push(new Qe(o,i[T],`"${T}" is prohibited for ref layers`))})),u.layers.forEach((T=>{ln(T.id)===y&&(x=T)})),x?x.ref?e.push(new Qe(o,i.ref,"ref cannot reference another ref layer")):p=ln(x.type):e.push(new Qe(o,i.ref,`ref layer "${y}" not found`))}else if(p!=="background")if(i.source){const x=u.sources&&u.sources[i.source],T=x&&ln(x.type);x?T==="vector"&&p==="raster"?e.push(new Qe(o,i.source,`layer "${i.id}" requires a raster source`)):T!=="raster-dem"&&p==="hillshade"||T!=="raster-dem"&&p==="color-relief"?e.push(new Qe(o,i.source,`layer "${i.id}" requires a raster-dem source`)):T==="raster"&&p!=="raster"?e.push(new Qe(o,i.source,`layer "${i.id}" requires a vector source`)):T!=="vector"||i["source-layer"]?T==="raster-dem"&&p!=="hillshade"&&p!=="color-relief"?e.push(new Qe(o,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):p!=="line"||!i.paint||!i.paint["line-gradient"]||T==="geojson"&&x.lineMetrics||e.push(new Qe(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Qe(o,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new Qe(o,i.source,`source "${i.source}" not found`))}else e.push(new Qe(o,i,'missing required property "source"'));return e=e.concat(Na({key:o,value:i,valueSpec:f.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${o}.type`,value:i.type,valueSpec:f.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:i,objectKey:"type"}),filter:br,layout:x=>Na({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>Cc(_a({layerType:p},T))}}),paint:x=>Na({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>gs(_a({layerType:p},T))}})}})),e}function sr(n){const e=n.value,i=n.key,o=Gt(e);return o!=="string"?[new Qe(i,e,`string expected, ${o} found`)]:[]}const Nl={promoteId:function({key:n,value:e}){if(Gt(e)==="string")return sr({key:n,value:e});{const i=[];for(const o in e)i.push(...sr({key:`${n}.${o}`,value:e[o]}));return i}}};function Fs(n){const e=n.value,i=n.key,o=n.styleSpec,u=n.style,f=n.validateSpec;if(!e.type)return[new Qe(i,e,'"type" is required')];const p=ln(e.type);let y;switch(p){case"vector":case"raster":return y=Na({key:i,value:e,valueSpec:o[`source_${p.replace("-","_")}`],style:n.style,styleSpec:o,objectElementValidators:Nl,validateSpec:f}),y;case"raster-dem":return y=(function(x){var T;const E=(T=x.sourceName)!==null&&T!==void 0?T:"",C=x.value,D=x.styleSpec,P=D.source_raster_dem,B=x.style;let k=[];const N=Gt(C);if(C===void 0)return k;if(N!=="object")return k.push(new Qe("source_raster_dem",C,`object expected, ${N} found`)),k;const G=ln(C.encoding)==="custom",ee=["redFactor","greenFactor","blueFactor","baseShift"],q=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const X in C)!G&&ee.includes(X)?k.push(new Qe(X,C[X],`In "${E}": "${X}" is only valid when "encoding" is set to "custom". ${q} encoding found`)):P[X]?k=k.concat(x.validateSpec({key:X,value:C[X],valueSpec:P[X],validateSpec:x.validateSpec,style:B,styleSpec:D})):k.push(new Qe(X,C[X],`unknown property "${X}"`));return k})({sourceName:i,value:e,style:n.style,styleSpec:o,validateSpec:f}),y;case"geojson":if(y=Na({key:i,value:e,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:f,objectElementValidators:Nl}),e.cluster)for(const x in e.clusterProperties){const[T,E]=e.clusterProperties[x],C=typeof T=="string"?[T,["accumulated"],["get",x]]:T;y.push(...ps({key:`${i}.${x}.map`,value:E,expressionContext:"cluster-map"})),y.push(...ps({key:`${i}.${x}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return y;case"video":return Na({key:i,value:e,valueSpec:o.source_video,style:u,validateSpec:f,styleSpec:o});case"image":return Na({key:i,value:e,valueSpec:o.source_image,style:u,validateSpec:f,styleSpec:o});case"canvas":return[new Qe(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Os({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Pn(n){const e=n.value,i=n.styleSpec,o=i.light,u=n.style;let f=[];const p=Gt(e);if(e===void 0)return f;if(p!=="object")return f=f.concat([new Qe("light",e,`object expected, ${p} found`)]),f;for(const y in e){const x=y.match(/^(.*)-transition$/);f=f.concat(x&&o[x[1]]&&o[x[1]].transition?n.validateSpec({key:y,value:e[y],valueSpec:i.transition,validateSpec:n.validateSpec,style:u,styleSpec:i}):o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:n.validateSpec,style:u,styleSpec:i}):[new Qe(y,e[y],`unknown property "${y}"`)])}return f}function Bu(n){const e=n.value,i=n.styleSpec,o=i.sky,u=n.style,f=Gt(e);if(e===void 0)return[];if(f!=="object")return[new Qe("sky",e,`object expected, ${f} found`)];let p=[];for(const y in e)p=p.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:i}):[new Qe(y,e[y],`unknown property "${y}"`)]);return p}function Dc(n){const e=n.value,i=n.styleSpec,o=i.terrain,u=n.style;let f=[];const p=Gt(e);if(e===void 0)return f;if(p!=="object")return f=f.concat([new Qe("terrain",e,`object expected, ${p} found`)]),f;for(const y in e)f=f.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:n.validateSpec,style:u,styleSpec:i}):[new Qe(y,e[y],`unknown property "${y}"`)]);return f}function Sh(n){let e=[];const i=n.value,o=n.key;if(Array.isArray(i)){const u=[],f=[];for(const p in i)i[p].id&&u.includes(i[p].id)&&e.push(new Qe(o,i,`all the sprites' ids must be unique, but ${i[p].id} is duplicated`)),u.push(i[p].id),i[p].url&&f.includes(i[p].url)&&e.push(new Qe(o,i,`all the sprites' URLs must be unique, but ${i[p].url} is duplicated`)),f.push(i[p].url),e=e.concat(Na({key:`${o}[${p}]`,value:i[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return e}return sr({key:o,value:i})}function Nf(n){return!!n&&n.constructor===Object}function Mh(n){return Nf(n.value)?[]:[new Qe(n.key,n.value,`object expected, ${Gt(n.value)} found`)]}const Tn={"*":()=>[],array:Lu,boolean:function(n){const e=n.value,i=n.key,o=Gt(e);return o!=="boolean"?[new Qe(i,e,`boolean expected, ${o} found`)]:[]},number:fs,color:Bs,constants:rr,enum:Os,filter:br,function:ds,layer:zc,object:Na,source:Fs,light:Pn,sky:Bu,terrain:Dc,projection:function(n){const e=n.value,i=n.styleSpec,o=i.projection,u=n.style,f=Gt(e);if(e===void 0)return[];if(f!=="object")return[new Qe("projection",e,`object expected, ${f} found`)];let p=[];for(const y in e)p=p.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:i}):[new Qe(y,e[y],`unknown property "${y}"`)]);return p},projectionDefinition:function(n){const e=n.key;let i=n.value;i=i instanceof String?i.valueOf():i;const o=Gt(i);return o!=="array"||(function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"})(i)||(function(u){return!!["interpolate","step","literal"].includes(u[0])})(i)?["array","string"].includes(o)?[]:[new Qe(e,i,`projection expected, invalid type "${o}" found`)]:[new Qe(e,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:sr,formatted:function(n){return sr(n).length===0?[]:ps(n)},resolvedImage:function(n){return sr(n).length===0?[]:ps(n)},padding:function(n){const e=n.key,i=n.value;if(Gt(i)==="array"){if(i.length<1||i.length>4)return[new Qe(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const o={type:"number"};let u=[];for(let f=0;f<i.length;f++)u=u.concat(n.validateSpec({key:`${e}[${f}]`,value:i[f],validateSpec:n.validateSpec,valueSpec:o}));return u}return fs({key:e,value:i,valueSpec:{}})},numberArray:function(n){const e=n.key,i=n.value;if(Gt(i)==="array"){const o={type:"number"};if(i.length<1)return[new Qe(e,i,"array length at least 1 expected, length 0 found")];let u=[];for(let f=0;f<i.length;f++)u=u.concat(n.validateSpec({key:`${e}[${f}]`,value:i[f],validateSpec:n.validateSpec,valueSpec:o}));return u}return fs({key:e,value:i,valueSpec:{}})},colorArray:function(n){const e=n.key,i=n.value;if(Gt(i)==="array"){if(i.length<1)return[new Qe(e,i,"array length at least 1 expected, length 0 found")];let o=[];for(let u=0;u<i.length;u++)o=o.concat(Bs({key:`${e}[${u}]`,value:i[u]}));return o}return Bs({key:e,value:i})},variableAnchorOffsetCollection:function(n){const e=n.key,i=n.value,o=Gt(i),u=n.styleSpec;if(o!=="array"||i.length<1||i.length%2!=0)return[new Qe(e,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let p=0;p<i.length;p+=2)f=f.concat(Os({key:`${e}[${p}]`,value:i[p],valueSpec:u.layout_symbol["text-anchor"]})),f=f.concat(Lu({key:`${e}[${p+1}]`,value:i[p+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:u}));return f},sprite:Sh,state:Mh,fontFaces:function(n){const e=n.key,i=n.value,o=n.validateSpec,u=n.styleSpec,f=n.style;if(!Nf(i))return[new Qe(e,i,`object expected, ${Gt(i)} found`)];const p=[];for(const y in i){const x=i[y],T=Gt(x);if(T==="string")p.push(...sr({key:`${e}.${y}`,value:x}));else if(T==="array"){const E={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(const[C,D]of x.entries())p.push(...Na({key:`${e}.${y}[${C}]`,value:D,valueSpec:E,styleSpec:u,style:f,validateSpec:o}))}else p.push(new Qe(`${e}.${y}`,x,`string or array expected, ${T} found`))}return p}};function _s(n){const e=n.value,i=n.valueSpec,o=n.styleSpec;return n.validateSpec=_s,i.expression&&Sc(ln(e))?ds(n):i.expression&&fo(Fa(e))?ps(n):i.type&&Tn[i.type]?Tn[i.type](n):Na(_a({},n,{valueSpec:i.type?o[i.type]:i}))}function Vl(n){const e=n.value,i=n.key,o=sr(n);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Qe(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Qe(i,e,'"glyphs" url must include a "{range}" token'))),o}function xa(n,e=be){let i=[];return i=i.concat(_s({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,validateSpec:_s,objectElementValidators:{glyphs:Vl,"*":()=>[]}})),n.constants&&(i=i.concat(rr({key:"constants",value:n.constants}))),$o(i)}function or(n){return function(e){return n(Object.assign({},e,{validateSpec:_s}))}}function $o(n){return[].concat(n).sort(((e,i)=>e.line-i.line))}function ba(n){return function(...e){return $o(n.apply(this,e))}}xa.source=ba(or(Fs)),xa.sprite=ba(or(Sh)),xa.glyphs=ba(or(Vl)),xa.light=ba(or(Pn)),xa.sky=ba(or(Bu)),xa.terrain=ba(or(Dc)),xa.state=ba(or(Mh)),xa.layer=ba(or(zc)),xa.filter=ba(or(br)),xa.paintProperty=ba(or(gs)),xa.layoutProperty=ba(or(Cc));const $d={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class jl{constructor(e,i){this._globalState=i,this.setValue(e)}evaluate(){var e;return(e=this._literalValue)!==null&&e!==void 0?e:this._compiledValue.evaluate({})}setValue(e){if(e==null||e==="visible"||e==="none")return this._literalValue=e==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);const i=kl(e,$d,this._globalState);if(i.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));this._literalValue=void 0,this._compiledValue=i.value,this._globalStateRefs=Hn(i.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}const Ou=be,Xn=xa,Vr=Xn.light,Pc=Xn.sky,Ic=Xn.paintProperty,Vf=Xn.layoutProperty;function jr(n,e){let i=!1;if(e&&e.length)for(const o of e)n.fire(new li(new Error(o.message))),i=!0;return i}class _o{constructor(e,i,o){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(i=p[1])+2*(o=p[2]);for(let x=0;x<this.d*this.d;x++){const T=p[3+x],E=p[3+x+1];u.push(T===E?null:p.subarray(T,E))}const y=p[3+u.length+1];this.keys=p.subarray(p[3+u.length],y),this.bboxes=p.subarray(y),this.insert=this._insertReadonly}else{this.d=i+2*o;for(let p=0;p<this.d*this.d;p++)u.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=e,this.padding=o,this.scale=i/e,this.uid=0;const f=o/i*e;this.min=-f,this.max=e+f}insert(e,i,o,u,f){this._forEachCell(i,o,u,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,i,o,u,f,p){this.cells[f].push(p)}query(e,i,o,u,f){const p=this.min,y=this.max;if(e<=p&&i<=p&&y<=o&&y<=u&&!f)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(e,i,o,u,this._queryCell,x,{},f),x}}_queryCell(e,i,o,u,f,p,y,x){const T=this.cells[f];if(T!==null){const E=this.keys,C=this.bboxes;for(let D=0;D<T.length;D++){const P=T[D];if(y[P]===void 0){const B=4*P;(x?x(C[B+0],C[B+1],C[B+2],C[B+3]):e<=C[B+2]&&i<=C[B+3]&&o>=C[B+0]&&u>=C[B+1])?(y[P]=!0,p.push(E[P])):y[P]=!1}}}}_forEachCell(e,i,o,u,f,p,y,x){const T=this._convertToCellCoord(e),E=this._convertToCellCoord(i),C=this._convertToCellCoord(o),D=this._convertToCellCoord(u);for(let P=T;P<=C;P++)for(let B=E;B<=D;B++){const k=this.d*B+P;if((!x||x(this._convertFromCellCoord(P),this._convertFromCellCoord(B),this._convertFromCellCoord(P+1),this._convertFromCellCoord(B+1)))&&f.call(this,e,i,o,u,k,p,y,x))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,i=3+this.cells.length+1+1;let o=0;for(let p=0;p<this.cells.length;p++)o+=this.cells[p].length;const u=new Int32Array(i+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let f=i;for(let p=0;p<e.length;p++){const y=e[p];u[3+p]=f,u.set(y,f),f+=y.length}return u[3+e.length]=f,u.set(this.keys,f),f+=this.keys.length,u[3+e.length+1]=f,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer}static serialize(e,i){const o=e.toArrayBuffer();return i&&i.push(o),{buffer:o}}static deserialize(e){return new _o(e.buffer)}}const Va={};function lt(n,e,i={}){if(Va[n])throw new Error(`${n} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),Va[n]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}lt("Object",Object),lt("Set",Set),lt("TransferableGridIndex",_o),lt("Color",qt),lt("Error",Error),lt("AJAXError",W),lt("ResolvedImage",Aa),lt("StylePropertyFunction",Ho),lt("StyleExpression",Ac,{omit:["_evaluator"]}),lt("ZoomDependentExpression",po),lt("ZoomConstantExpression",Ia),lt("CompoundExpression",tr,{omit:["_evaluate"]});for(const n in Bl)Bl[n]._classRegistryKey||lt(`Expression_${n}`,Bl[n]);function ku(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Rc(n){return n.$name||n.constructor._classRegistryKey}function wr(n){return!(function(e){if(e===null||typeof e!="object")return!1;const i=Rc(e);return!(!i||i==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||ku(n)||Qa(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function Ur(n,e){if(wr(n))return(ku(n)||Qa(n))&&e&&e.push(n),ArrayBuffer.isView(n)&&e&&e.push(n.buffer),n instanceof ImageData&&e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const f=[];for(const p of n)f.push(Ur(p,e));return f}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const i=Rc(n);if(!i)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!Va[i])throw new Error(`${i} is not registered.`);const{klass:o}=Va[i],u=o.serialize?o.serialize(n,e):{};if(o.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in n){if(!n.hasOwnProperty(f)||Va[i].omit.indexOf(f)>=0)continue;const p=n[f];u[f]=Va[i].shallow.indexOf(f)>=0?p:Ur(p,e)}n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(u.$name=i),u}function Ul(n){if(wr(n))return n;if(Array.isArray(n))return n.map(Ul);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const e=Rc(n)||"Object";if(!Va[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=Va[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const o=Object.create(i.prototype);for(const u of Object.keys(n)){if(u==="$name")continue;const f=n[u];o[u]=Va[e].shallow.indexOf(u)>=0?f:Ul(f)}return o}class Lc{constructor(){this.first=!0}update(e,i){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}function ys(n){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function Yo(n){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function Fu(n){return/\s/u.test(String.fromCodePoint(n))}function vs(n){for(const e of n)if(Yo(e.codePointAt(0)))return!0;return!1}function Bc(n){for(const e of n)if(!Eh(e.codePointAt(0)))return!1;return!0}function Nu(n){const e=n.map((i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}})).filter((i=>i));return new RegExp(e.join("|"),"u")}const xs=Nu(["Arab","Dupl","Mong","Ougr","Syrc"]);function Eh(n){return!xs.test(String.fromCodePoint(n))}function bs(n){return!(Yo(n)||(e=n,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const Oc=Nu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Vu(n){return Oc.test(String.fromCodePoint(n))}function ws(n,e){return!(!e&&Vu(n)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(n)))}function Ns(n){for(const e of n)if(Vu(e.codePointAt(0)))return!0;return!1}const Tr=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(Tr.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,e){return d(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const i=n.pluginURL,o=new Promise((f=>{this.loadScriptResolve=f}));e(i);const u=new Promise((f=>setTimeout((()=>f()),this.TIMEOUT)));if(yield Promise.race([o,u]),this.isParsed()){const f={pluginStatus:"loaded",pluginURL:i};return this.setState(f),f}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)}))}};class Ti{constructor(e,i){this.isSupportedScript=Ah,this.zoom=e,i?(this.now=i.now||0,this.fadeDuration=i.fadeDuration||0,this.zoomHistory=i.zoomHistory||new Lc,this.transition=i.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Lc,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}function Ah(n){return(function(e,i){for(const o of e)if(!ws(o.codePointAt(0),i))return!1;return!0})(n,Tr.getRTLTextPluginStatus()==="loaded")}const Vs="-transition";class yo{constructor(e,i,o){this.property=e,this.value=i,this.expression=(function(u,f,p){if(Sc(u))return new Ho(u,f);if(fo(u)){const y=mo(u,f,p);if(y.result==="error")throw new Error(y.value.map((x=>`${x.key}: ${x.message}`)).join(", "));return y.value}{let y=u;return f.type==="color"&&typeof u=="string"?y=qt.parse(u):f.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?f.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?f.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?y=dn.parse(u):f.type==="projectionDefinition"&&typeof u=="string"&&(y=Zn.parse(u)):y=It.parse(u):y=en.parse(u):y=Dn.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>y}}})(i===void 0?e.specification.default:i,e.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class ju{constructor(e,i){this.property=e,this.value=new yo(e,void 0,i)}transitioned(e,i){return new Qo(this.property,this.value,i,ri({},e.transition,this.transition),e.now)}untransitioned(){return new Qo(this.property,this.value,null,{},0)}}class kc{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=i}getValue(e){return ga(this._values[e].value.value)}setValue(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ju(this._values[e].property,this._globalState)),this._values[e].value=new yo(this._values[e].property,i===null?void 0:ga(i),this._globalState)}getTransition(e){return ga(this._values[e].transition)}setTransition(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ju(this._values[e].property,this._globalState)),this._values[e].transition=ga(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const u=this.getTransition(i);u!==void 0&&(e[`${i}${Vs}`]=u)}return e}transitioned(e,i){const o=new Uu(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(e,i._values[u]);return o}untransitioned(){const e=new Uu(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Qo{constructor(e,i,o,u,f){this.property=e,this.value=i,this.begin=f+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const u=e.now||0,f=this.value.possiblyEvaluate(e,i,o),p=this.prior;if(p){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return p.possiblyEvaluate(e,i,o);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,o),f,ot(y))}}return f}}class Uu{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const u=new Wo(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,o);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ch{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=i}hasValue(e){return this._values[e].value!==void 0}getValue(e){return ga(this._values[e].value)}setValue(e,i){this._values[e]=new yo(this._values[e].property,i===null?void 0:ga(i),this._globalState)}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const u=new Wo(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,o);return u}}class lr{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,u){return this.property.evaluate(this.value,this.parameters,e,i,o,u)}}class Wo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ct{constructor(e){this.specification=e}possiblyEvaluate(e,i){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(i)}interpolate(e,i,o){const u=nn[this.specification.type];return u?u(e,i,o):e}}class vt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,u){return new lr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,u)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new lr(this,{kind:"constant",value:void 0},e.parameters);const u=nn[this.specification.type];if(u){const f=u(e.value.value,i.value.value,o);return new lr(this,{kind:"constant",value:f},e.parameters)}return e}evaluate(e,i,o,u,f,p){return e.kind==="constant"?e.value:e.evaluate(i,o,u,f,p)}}class Sr extends vt{possiblyEvaluate(e,i,o,u){if(e.value===void 0)return new lr(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const f=e.expression.evaluate(i,null,{},o,u),p=e.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,y=this._calculate(p,p,p,i);return new lr(this,{kind:"constant",value:y},i)}if(e.expression.kind==="camera"){const f=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new lr(this,{kind:"constant",value:f},i)}return new lr(this,e.expression,i)}evaluate(e,i,o,u,f,p){if(e.kind==="source"){const y=e.evaluate(i,o,u,f,p);return this._calculate(y,y,y,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},o,u),e.evaluate({zoom:Math.floor(i.zoom)},o,u),e.evaluate({zoom:Math.floor(i.zoom)+1},o,u),i):e.value}_calculate(e,i,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class Gl{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const f=e.expression.evaluate(i,null,{},o,u);return this._calculate(f,f,f,i)}return this._calculate(e.expression.evaluate(new Ti(Math.floor(i.zoom-1),i)),e.expression.evaluate(new Ti(Math.floor(i.zoom),i)),e.expression.evaluate(new Ti(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class Gu{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){return!!e.expression.evaluate(i,null,{},o,u)}interpolate(){return!1}}class Sn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const o=e[i];o.specification.overridable&&this.overridableProperties.push(i);const u=this.defaultPropertyValues[i]=new yo(o,void 0,void 0),f=this.defaultTransitionablePropertyValues[i]=new ju(o,void 0);this.defaultTransitioningPropertyValues[i]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=u.possiblyEvaluate({})}}}lt("DataDrivenProperty",vt),lt("DataConstantProperty",ct),lt("CrossFadedDataDrivenProperty",Sr),lt("CrossFadedProperty",Gl),lt("ColorRampProperty",Gu);class un extends $t{constructor(e,i,o){if(super(),this.id=e.id,this.type=e.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this._visibilityExpression=(function(u,f){return new jl(u,f)})(this.visibility,o),e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=ka(e.filter,o)),i.layout&&(this._unevaluatedLayout=new Ch(i.layout,o)),i.paint)){this._transitionablePaint=new kc(i.paint,o);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Wo(i.paint)}}setFilter(e){this.filter=e,this._featureFilter=ka(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;for(const i of this._visibilityExpression.getGlobalStateRefs())e.add(i);if(this._unevaluatedLayout)for(const i in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[i];for(const u of o.getGlobalStateRefs())e.add(u)}for(const i of this._featureFilter.getGlobalStateRefs())e.add(i);return e}getPaintAffectingGlobalStateRefs(){var e;const i=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const u=this._transitionablePaint._values[o].value;for(const f of u.getGlobalStateRefs()){const p=(e=i.get(f))!==null&&e!==void 0?e:[];p.push({name:o,value:u.value}),i.set(f,p)}}return i}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(e,i,o={}){if(i==null||!this._validate(Vf,`layers.${this.id}.layout.${e}`,e,i,o))return e==="visibility"?(this.visibility=i,this._visibilityExpression.setValue(i),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(e,i)}getPaintProperty(e){return e.endsWith(Vs)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,o={}){if(i!=null&&this._validate(Ic,`layers.${this.id}.paint.${e}`,e,i,o))return!1;if(e.endsWith(Vs))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const u=this._transitionablePaint._values[e],f=u.property.specification["property-type"]==="cross-faded-data-driven",p=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||p||f||this._handleOverridablePaintPropertyUpdate(e,y,x)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e=this.minzoom,i=!1){return!!(this.minzoom&&e<(i?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Un(e,((i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length)))}_validate(e,i,o,u,f={}){return(!f||f.validate!==!1)&&jr(this,e.call(Xn,{key:i,layerType:this.type,objectKey:o,value:u,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof lr&&xr(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}let mn;var qu={get paint(){return mn=mn||new Sn({"raster-opacity":new ct(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new ct(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ct(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ct(be.paint_raster["raster-brightness-max"]),"raster-saturation":new ct(be.paint_raster["raster-saturation"]),"raster-contrast":new ct(be.paint_raster["raster-contrast"]),"raster-resampling":new ct(be.paint_raster["raster-resampling"]),"raster-fade-duration":new ct(be.paint_raster["raster-fade-duration"])})}};class js extends un{constructor(e,i){super(e,qu,i)}}const Qt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class xi{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Yt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function an(n,e=1){let i=0,o=0;return{members:n.map((u=>{const f=Qt[u.type].BYTES_PER_ELEMENT,p=i=Mr(i,Math.max(e,f)),y=u.components||1;return o=Math.max(o,f),i+=f*y,{name:u.name,type:u.type,components:y,offset:p}})),size:Mr(i,Math.max(o,e)),alignment:e}}function Mr(n,e){return Math.ceil(n/e)*e}class Gr extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=o,e}}Gr.prototype.bytesPerElement=4,lt("StructArrayLayout2i4",Gr);class Ko extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=u,e}}Ko.prototype.bytesPerElement=6,lt("StructArrayLayout3i6",Ko);class Jo extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,u)}emplace(e,i,o,u,f){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=o,this.int16[p+2]=u,this.int16[p+3]=f,e}}Jo.prototype.bytesPerElement=8,lt("StructArrayLayout4i8",Jo);class Us extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,p)}emplace(e,i,o,u,f,p,y){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=f,this.int16[x+4]=p,this.int16[x+5]=y,e}}Us.prototype.bytesPerElement=12,lt("StructArrayLayout2i4i12",Us);class zh extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,p)}emplace(e,i,o,u,f,p,y){const x=4*e,T=8*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.uint8[T+4]=u,this.uint8[T+5]=f,this.uint8[T+6]=p,this.uint8[T+7]=y,e}}zh.prototype.bytesPerElement=8,lt("StructArrayLayout2i4ub8",zh);class Yi extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=o,e}}Yi.prototype.bytesPerElement=8,lt("StructArrayLayout2f8",Yi);class qr extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T,E){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,u,f,p,y,x,T,E)}emplace(e,i,o,u,f,p,y,x,T,E,C){const D=10*e;return this.uint16[D+0]=i,this.uint16[D+1]=o,this.uint16[D+2]=u,this.uint16[D+3]=f,this.uint16[D+4]=p,this.uint16[D+5]=y,this.uint16[D+6]=x,this.uint16[D+7]=T,this.uint16[D+8]=E,this.uint16[D+9]=C,e}}qr.prototype.bytesPerElement=20,lt("StructArrayLayout10ui20",qr);class ql extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,o,u,f,p,y,x)}emplace(e,i,o,u,f,p,y,x,T){const E=8*e;return this.uint16[E+0]=i,this.uint16[E+1]=o,this.uint16[E+2]=u,this.uint16[E+3]=f,this.uint16[E+4]=p,this.uint16[E+5]=y,this.uint16[E+6]=x,this.uint16[E+7]=T,e}}ql.prototype.bytesPerElement=16,lt("StructArrayLayout8ui16",ql);class Zl extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T,E,C,D){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,o,u,f,p,y,x,T,E,C,D)}emplace(e,i,o,u,f,p,y,x,T,E,C,D,P){const B=12*e;return this.int16[B+0]=i,this.int16[B+1]=o,this.int16[B+2]=u,this.int16[B+3]=f,this.uint16[B+4]=p,this.uint16[B+5]=y,this.uint16[B+6]=x,this.uint16[B+7]=T,this.int16[B+8]=E,this.int16[B+9]=C,this.int16[B+10]=D,this.int16[B+11]=P,e}}Zl.prototype.bytesPerElement=24,lt("StructArrayLayout4i4ui4i24",Zl);class Zu extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=u,e}}Zu.prototype.bytesPerElement=12,lt("StructArrayLayout3f12",Zu);class Hu extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Hu.prototype.bytesPerElement=4,lt("StructArrayLayout1ul4",Hu);class Xu extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,o,u,f,p,y,x,T)}emplace(e,i,o,u,f,p,y,x,T,E){const C=10*e,D=5*e;return this.int16[C+0]=i,this.int16[C+1]=o,this.int16[C+2]=u,this.int16[C+3]=f,this.int16[C+4]=p,this.int16[C+5]=y,this.uint32[D+3]=x,this.uint16[C+8]=T,this.uint16[C+9]=E,e}}Xu.prototype.bytesPerElement=20,lt("StructArrayLayout6i1ul2ui20",Xu);class vo extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,p)}emplace(e,i,o,u,f,p,y){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=f,this.int16[x+4]=p,this.int16[x+5]=y,e}}vo.prototype.bytesPerElement=12,lt("StructArrayLayout2i2i2i12",vo);class Gs extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,u,f)}emplace(e,i,o,u,f,p){const y=4*e,x=8*e;return this.float32[y+0]=i,this.float32[y+1]=o,this.float32[y+2]=u,this.int16[x+6]=f,this.int16[x+7]=p,e}}Gs.prototype.bytesPerElement=16,lt("StructArrayLayout2f1f2i16",Gs);class ca extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,p)}emplace(e,i,o,u,f,p,y){const x=16*e,T=4*e,E=8*e;return this.uint8[x+0]=i,this.uint8[x+1]=o,this.float32[T+1]=u,this.float32[T+2]=f,this.int16[E+6]=p,this.int16[E+7]=y,e}}ca.prototype.bytesPerElement=16,lt("StructArrayLayout2ub2f2i16",ca);class rn extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=o,this.uint16[f+2]=u,e}}rn.prototype.bytesPerElement=6,lt("StructArrayLayout3ui6",rn);class Ts extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T,E,C,D,P,B,k,N,G){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,i,o,u,f,p,y,x,T,E,C,D,P,B,k,N,G)}emplace(e,i,o,u,f,p,y,x,T,E,C,D,P,B,k,N,G,ee){const q=24*e,X=12*e,ne=48*e;return this.int16[q+0]=i,this.int16[q+1]=o,this.uint16[q+2]=u,this.uint16[q+3]=f,this.uint32[X+2]=p,this.uint32[X+3]=y,this.uint32[X+4]=x,this.uint16[q+10]=T,this.uint16[q+11]=E,this.uint16[q+12]=C,this.float32[X+7]=D,this.float32[X+8]=P,this.uint8[ne+36]=B,this.uint8[ne+37]=k,this.uint8[ne+38]=N,this.uint32[X+10]=G,this.int16[q+22]=ee,e}}Ts.prototype.bytesPerElement=48,lt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ts);class el extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T,E,C,D,P,B,k,N,G,ee,q,X,ne,se,Se,Ve,Oe,qe,rt,Xe){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,e,i,o,u,f,p,y,x,T,E,C,D,P,B,k,N,G,ee,q,X,ne,se,Se,Ve,Oe,qe,rt,Xe)}emplace(e,i,o,u,f,p,y,x,T,E,C,D,P,B,k,N,G,ee,q,X,ne,se,Se,Ve,Oe,qe,rt,Xe,Fe){const Pe=32*e,dt=16*e;return this.int16[Pe+0]=i,this.int16[Pe+1]=o,this.int16[Pe+2]=u,this.int16[Pe+3]=f,this.int16[Pe+4]=p,this.int16[Pe+5]=y,this.int16[Pe+6]=x,this.int16[Pe+7]=T,this.uint16[Pe+8]=E,this.uint16[Pe+9]=C,this.uint16[Pe+10]=D,this.uint16[Pe+11]=P,this.uint16[Pe+12]=B,this.uint16[Pe+13]=k,this.uint16[Pe+14]=N,this.uint16[Pe+15]=G,this.uint16[Pe+16]=ee,this.uint16[Pe+17]=q,this.uint16[Pe+18]=X,this.uint16[Pe+19]=ne,this.uint16[Pe+20]=se,this.uint16[Pe+21]=Se,this.uint16[Pe+22]=Ve,this.uint32[dt+12]=Oe,this.float32[dt+13]=qe,this.float32[dt+14]=rt,this.uint16[Pe+30]=Xe,this.uint16[Pe+31]=Fe,e}}el.prototype.bytesPerElement=64,lt("StructArrayLayout8i15ui1ul2f2ui64",el);class tl extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}tl.prototype.bytesPerElement=4,lt("StructArrayLayout1f4",tl);class Hl extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.uint16[6*e+0]=i,this.float32[f+1]=o,this.float32[f+2]=u,e}}Hl.prototype.bytesPerElement=12,lt("StructArrayLayout1ui2f12",Hl);class Zr extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=4*e;return this.uint32[2*e+0]=i,this.uint16[f+2]=o,this.uint16[f+3]=u,e}}Zr.prototype.bytesPerElement=8,lt("StructArrayLayout1ul2ui8",Zr);class m extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=o,e}}m.prototype.bytesPerElement=4,lt("StructArrayLayout2ui4",m);class t extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}t.prototype.bytesPerElement=2,lt("StructArrayLayout1ui2",t);class r extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,u)}emplace(e,i,o,u,f){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=u,this.float32[p+3]=f,e}}r.prototype.bytesPerElement=16,lt("StructArrayLayout4f16",r);class l extends xi{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ge(this.anchorPointX,this.anchorPointY)}}l.prototype.size=20;class h extends Xu{get(e){return new l(this,e)}}lt("CollisionBoxArray",h);class _ extends xi{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}_.prototype.size=48;class v extends Ts{get(e){return new _(this,e)}}lt("PlacedSymbolArray",v);class b extends xi{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}b.prototype.size=64;class S extends el{get(e){return new b(this,e)}}lt("SymbolInstanceArray",S);class A extends tl{getoffsetX(e){return this.float32[1*e+0]}}lt("GlyphOffsetArray",A);class z extends Ko{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}lt("SymbolLineVertexArray",z);class R extends xi{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}R.prototype.size=12;class I extends Hl{get(e){return new R(this,e)}}lt("TextAnchorOffsetArray",I);class F extends xi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}F.prototype.size=8;class U extends Zr{get(e){return new F(this,e)}}lt("FeatureIndexArray",U);class $ extends Gr{}class Q extends Gr{}class Y extends Gr{}class J extends Us{}class re extends zh{}class K extends Yi{}class ae extends qr{}class le extends ql{}class ie extends Zl{}class pe extends Zu{}class ze extends Hu{}class Te extends vo{}class Ae extends ca{}class Ce extends rn{}class We extends m{}const Ke=an([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ge}=Ke;class at{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,i,o,u){const f=this.segments[this.segments.length-1];return e>at.MAX_VERTEX_ARRAY_LENGTH&&Ii(`Max vertices per segment is ${at.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${at.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!f||f.vertexLength+e>at.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u?this.createNewSegment(i,o,u):f}createNewSegment(e,i,o){const u={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(u.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(e,i,o){return this.prepareSegment(0,e,i,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,u){return new at([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function kt(n,e){return 256*(n=zt(Math.floor(n),0,255))+zt(Math.floor(e),0,255)}at.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,lt("SegmentVector",at);const bi=an([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ui=an([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Oi,Qi,Ai,cn={exports:{}},Wi={exports:{}},Jn={exports:{}},gn=(function(){if(Ai)return cn.exports;Ai=1;var n=(Oi||(Oi=1,Wi.exports=function(i,o){var u,f,p,y,x,T,E,C;for(f=i.length-(u=3&i.length),p=o,x=3432918353,T=461845907,C=0;C<f;)E=255&i.charCodeAt(C)|(255&i.charCodeAt(++C))<<8|(255&i.charCodeAt(++C))<<16|(255&i.charCodeAt(++C))<<24,++C,p=27492+(65535&(y=5*(65535&(p=(p^=E=(65535&(E=(E=(65535&E)*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(E=0,u){case 3:E^=(255&i.charCodeAt(C+2))<<16;case 2:E^=(255&i.charCodeAt(C+1))<<8;case 1:p^=E=(65535&(E=(E=(65535&(E^=255&i.charCodeAt(C)))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),Wi.exports),e=(Qi||(Qi=1,Jn.exports=function(i,o){for(var u,f=i.length,p=o^f,y=0;f>=4;)u=1540483477*(65535&(u=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++y;switch(f){case 3:p^=(255&i.charCodeAt(y+2))<<16;case 2:p^=(255&i.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),Jn.exports);return cn.exports=n,cn.exports.murmur3=n,cn.exports.murmur2=e,cn.exports})(),_n=Be(gn);class ea{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,o,u){this.ids.push(Ss(e)),this.positions.push(i,o,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=Ss(e);let o=0,u=this.ids.length-1;for(;o<u;){const p=o+u>>1;this.ids[p]>=i?u=p:o=p+1}const f=[];for(;this.ids[o]===i;)f.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return f}static serialize(e,i){const o=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Ms(o,u,0,o.length-1),i&&i.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(e){const i=new ea;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function Ss(n){const e=+n;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:_n(String(n))}function Ms(n,e,i,o){for(;i<o;){const u=n[i+o>>1];let f=i-1,p=o+1;for(;;){do f++;while(n[f]<u);do p--;while(n[p]>u);if(f>=p)break;Hr(n,f,p),Hr(e,3*f,3*p),Hr(e,3*f+1,3*p+1),Hr(e,3*f+2,3*p+2)}p-i<o-p?(Ms(n,e,i,p),i=p+1):(Ms(n,e,p+1,o),o=p)}}function Hr(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}lt("FeaturePositionMap",ea);class ja{constructor(e,i){this.gl=e.gl,this.location=i}}class il extends ja{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Xl extends ja{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Xr extends ja{constructor(e,i){super(e,i),this.current=qt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Ua=new Float32Array(16);function ur(n){return[kt(255*n.r,255*n.g),kt(255*n.b,255*n.a)]}class Er{constructor(e,i,o){this.value=e,this.uniformNames=i.map((u=>`u_${u}`)),this.type=o}setUniform(e,i,o){e.set(o.constantOr(this.value))}getBinding(e,i,o){return this.type==="color"?new Xr(e,i):new il(e,i)}}class Ar{constructor(e,i){this.uniformNames=i.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,i){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,i.y,i.height,i.width]}setUniform(e,i,o,u){let f=null;u==="u_pattern_to"?f=this.patternTo:u==="u_pattern_from"?f=this.patternFrom:u==="u_dasharray_to"?f=this.dashTo:u==="u_dasharray_from"?f=this.dashFrom:u==="u_pixel_ratio_to"?f=this.pixelRatioTo:u==="u_pixel_ratio_from"&&(f=this.pixelRatioFrom),f!==null&&e.set(f)}getBinding(e,i,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new Xl(e,i):new il(e,i)}}class Si{constructor(e,i,o,u){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map((f=>({name:`a_${f}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(e,i,o){const u=this.paintVertexArray.length,f=this.expression.evaluate(new Ti(0,o),i,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(u,e,f)}updatePaintArray(e,i,o,u,f){const p=this.expression.evaluate(new Ti(0,f),o,u);this._setPaintValue(e,i,p)}_setPaintValue(e,i,o){if(this.type==="color"){const u=ur(o);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ki{constructor(e,i,o,u,f,p){this.expression=e,this.uniformNames=i.map((y=>`u_${y}_t`)),this.type=o,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map((y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new p}populatePaintArray(e,i,o){const u=this.expression.evaluate(new Ti(this.zoom,o),i,{},o.canonical,[],o.formattedSection),f=this.expression.evaluate(new Ti(this.zoom+1,o),i,{},o.canonical,[],o.formattedSection),p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(p,e,u,f)}updatePaintArray(e,i,o,u,f){const p=this.expression.evaluate(new Ti(this.zoom,f),o,u),y=this.expression.evaluate(new Ti(this.zoom+1,f),o,u);this._setPaintValue(e,i,p,y)}_setPaintValue(e,i,o,u){if(this.type==="color"){const f=ur(o),p=ur(u);for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,f[0],f[1],p[0],p[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,u=zt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,i,o){return new il(e,i)}}class In{constructor(e,i,o,u,f,p){this.expression=e,this.type=i,this.useIntegerZoom=o,this.zoom=u,this.layerId=p,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,i,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,this.getPositionIds(i),o)}updatePaintArray(e,i,o,u,f){this._setPaintValues(e,i,this.getPositionIds(o),f)}_setPaintValues(e,i,o,u){const f=this.getPositions(u);if(!f||!o)return;const p=f[o.min],y=f[o.mid],x=f[o.max];if(p&&y&&x)for(let T=e;T<i;T++)this.emplace(this.zoomInPaintVertexArray,T,y,p),this.emplace(this.zoomOutPaintVertexArray,T,y,x)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const i=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,i,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,i,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Fn extends In{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return bi.members}emplace(e,i,o,u){e.emplace(i,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],o.pixelRatio,u.pixelRatio)}}class Fc extends In{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return Ui.members}emplace(e,i,o,u){e.emplace(i,0,o.y,o.height,o.width,0,u.y,u.height,u.width)}}class Nc{constructor(e,i,o){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!o(f))continue;const p=e.paint.get(f);if(!(p instanceof lr&&xr(p.property.specification)))continue;const y=jf(f,e.type),x=p.value,T=p.property.specification.type,E=p.property.useIntegerZoom,C=p.property.specification["property-type"],D=C==="cross-faded"||C==="cross-faded-data-driven";if(x.kind==="constant")this.binders[f]=D?new Ar(x.value,y):new Er(x.value,y,T),u.push(`/u_${f}`);else if(x.kind==="source"||D){const P=bo(f,T,"source");this.binders[f]=D?f==="line-dasharray"?new Fc(x,T,E,i,P,e.id):new Fn(x,T,E,i,P,e.id):new Si(x,y,T,P),u.push(`/a_${f}`)}else{const P=bo(f,T,"composite");this.binders[f]=new ki(x,y,T,E,i,P),u.push(`/z_${f}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Si||i instanceof ki?i.maxValue:0}populatePaintArrays(e,i,o){for(const u in this.binders){const f=this.binders[u];(f instanceof Si||f instanceof ki||f instanceof In)&&f.populatePaintArray(e,i,o)}}setConstantPatternPositions(e,i){for(const o in this.binders){const u=this.binders[o];u instanceof Ar&&u.setConstantPatternPositions(e,i)}}setConstantDashPositions(e,i){for(const o in this.binders){const u=this.binders[o];u instanceof Ar&&u.setConstantDashPositions(e,i)}}updatePaintArrays(e,i,o,u,f){let p=!1;for(const y in e){const x=i.getPositions(y);for(const T of x){const E=o.feature(T.index);for(const C in this.binders){const D=this.binders[C];if((D instanceof Si||D instanceof ki||D instanceof In)&&D.expression.isStateDependent===!0){const P=u.paint.get(C);D.expression=P.value,D.updatePaintArray(T.start,T.end,E,e[y],f),p=!0}}}}return p}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Er||o instanceof Ar)&&e.push(...o.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Si||o instanceof ki)for(let u=0;u<o.paintVertexAttributes.length;u++)e.push(o.paintVertexAttributes[u].name);else if(o instanceof In){const u=o.getVertexAttributes();for(const f of u)e.push(f.name)}}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Er||o instanceof Ar||o instanceof ki)for(const u of o.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Er||f instanceof Ar||f instanceof ki){for(const p of f.uniformNames)if(i[p]){const y=f.getBinding(e,i[p],p);o.push({name:p,property:u,binding:y})}}}return o}setUniforms(e,i,o,u){for(const{name:f,property:p,binding:y}of i)this.binders[p].setUniform(y,u,o.get(p),f)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(e&&o instanceof In){const u=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Si||o instanceof ki)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof Si||o instanceof ki||o instanceof In)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Si||i instanceof ki||i instanceof In)&&i.destroy()}}}class xo{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Nc(u,i,o);this.needsUpload=!1,this._featureMap=new ea,this._bufferOffset=0}populatePaintArrays(e,i,o,u){for(const f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(e,i,u);i.id!==void 0&&this._featureMap.add(i.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,u){for(const f of o)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,i,f,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function jf(n,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}function bo(n,e,i){const o={color:{source:Yi,composite:r},number:{source:tl,composite:Yi}},u=(function(f){return{"line-pattern":{source:ae,composite:ae},"fill-pattern":{source:ae,composite:ae},"fill-extrusion-pattern":{source:ae,composite:ae},"line-dasharray":{source:le,composite:le}}[f]})(n);return u&&u[i]||o[e][i]}lt("ConstantBinder",Er),lt("CrossFadedConstantBinder",Ar),lt("SourceExpressionBinder",Si),lt("CrossFadedPatternBinder",Fn),lt("CrossFadedDasharrayBinder",Fc),lt("CompositeExpressionBinder",ki),lt("ProgramConfiguration",Nc,{omit:["_buffers"]}),lt("ProgramConfigurationSet",xo);const Vc=Math.pow(2,14)-1,qs=-Vc-1;function Zs(n){const e=St/n.extent,i=n.loadGeometry();for(let o=0;o<i.length;o++){const u=i[o];for(let f=0;f<u.length;f++){const p=u[f],y=Math.round(p.x*e),x=Math.round(p.y*e);p.x=zt(y,qs,Vc),p.y=zt(x,qs,Vc),(y<p.x||y>p.x+1||x<p.y||x>p.y+1)&&Ii("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function $r(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Zs(n):[]}}const jc=-32768;function $u(n,e,i,o,u){n.emplaceBack(jc+8*e+o,jc+8*i+u)}class Yu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new Q,this.indexArray=new Ce,this.segments=new at,this.programConfigurations=new xo(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){const u=this.layers[0],f=[];let p=null,y=!1,x=u.type==="heatmap";if(u.type==="circle"){const E=u;p=E.layout.get("circle-sort-key"),y=!p.isConstant(),x=x||E.paint.get("circle-pitch-alignment")==="map"}const T=x?i.subdivisionGranularity.circle:1;for(const{feature:E,id:C,index:D,sourceLayerIndex:P}of e){const B=this.layers[0]._featureFilter.needGeometry,k=$r(E,B);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),k,o))continue;const N=y?p.evaluate(k,{},o):void 0,G={id:C,properties:E.properties,type:E.type,sourceLayerIndex:P,index:D,geometry:B?k.geometry:Zs(E),patterns:{},sortKey:N};f.push(G)}y&&f.sort(((E,C)=>E.sortKey-C.sortKey));for(const E of f){const{geometry:C,index:D,sourceLayerIndex:P}=E,B=e[D].feature;this.addFeature(E,C,D,o,T),i.featureIndex.insert(B,C,D,P,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ge),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,u,f=1){let p;switch(f){case 1:p=[0,7];break;case 3:p=[0,2,5,7];break;case 5:p=[0,1,3,4,6,7];break;case 7:p=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${f}; valid values are 1, 3, 5, 7.`)}const y=p.length;for(const x of i)for(const T of x){const E=T.x,C=T.y;if(E<0||E>=St||C<0||C>=St)continue;const D=this.segments.prepareSegment(y*y,this.layoutVertexArray,this.indexArray,e.sortKey),P=D.vertexLength;for(let B=0;B<y;B++)for(let k=0;k<y;k++)$u(this.layoutVertexArray,E,C,p[k],p[B]);for(let B=0;B<y-1;B++)for(let k=0;k<y-1;k++){const N=P+B*y+k,G=P+(B+1)*y+k;this.indexArray.emplaceBack(N,G+1,N+1),this.indexArray.emplaceBack(N,G,G+1)}D.vertexLength+=y*y,D.primitiveLength+=(y-1)*(y-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:{},canonical:u})}}function Qu(n,e){for(let i=0;i<n.length;i++)if(wo(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(wo(n,e[i]))return!0;return!!ha(n,e)}function Uf(n,e,i){return!!wo(n,e)||!!qf(e,n,i)}function Gf(n,e){if(n.length===1)return Qd(e,n[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let u=0;u<o.length;u++)if(wo(n,o[u]))return!0}for(let i=0;i<n.length;i++)if(Qd(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(ha(n,e[i]))return!0;return!1}function ta(n,e,i){if(n.length>1){if(ha(n,e))return!0;for(let o=0;o<e.length;o++)if(qf(e[o],n,i))return!0}for(let o=0;o<n.length;o++)if(qf(n[o],e,i))return!0;return!1}function ha(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const o=n[i],u=n[i+1];for(let f=0;f<e.length-1;f++)if(rm(o,u,e[f],e[f+1]))return!0}return!1}function rm(n,e,i,o){return Qn(n,i,o)!==Qn(e,i,o)&&Qn(n,e,i)!==Qn(n,e,o)}function qf(n,e,i){const o=i*i;if(e.length===1)return n.distSqr(e[0])<o;for(let u=1;u<e.length;u++)if(Yd(n,e[u-1],e[u])<o)return!0;return!1}function Yd(n,e,i){const o=e.distSqr(i);if(o===0)return n.distSqr(e);const u=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/o;return n.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function Qd(n,e){let i,o,u,f=!1;for(let p=0;p<n.length;p++){i=n[p];for(let y=0,x=i.length-1;y<i.length;x=y++)o=i[y],u=i[x],o.y>e.y!=u.y>e.y&&e.x<(u.x-o.x)*(e.y-o.y)/(u.y-o.y)+o.x&&(f=!f)}return f}function wo(n,e){let i=!1;for(let o=0,u=n.length-1;o<n.length;u=o++){const f=n[o],p=n[u];f.y>e.y!=p.y>e.y&&e.x<(p.x-f.x)*(e.y-f.y)/(p.y-f.y)+f.x&&(i=!i)}return i}function sm(n,e,i){const o=i[0],u=i[2];if(n.x<o.x&&e.x<o.x||n.x>u.x&&e.x>u.x||n.y<o.y&&e.y<o.y||n.y>u.y&&e.y>u.y)return!1;const f=Qn(n,e,i[0]);return f!==Qn(n,e,i[1])||f!==Qn(n,e,i[2])||f!==Qn(n,e,i[3])}function nl(n,e,i){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(n)}function Dh(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Zf(n,e,i,o,u){if(!e[0]&&!e[1])return n;const f=ge.convert(e)._mult(u);i==="viewport"&&f._rotate(-o);const p=[];for(let y=0;y<n.length;y++)p.push(n[y].sub(f));return p}function Hf(n){const e=[];for(let i=0;i<n.length;i++){const o=n[i],u=e.at(-1);(i===0||u&&!o.equals(u))&&e.push(o)}return e}function Wd({queryGeometry:n,size:e},i){return Uf(n,i,e)}function om({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},f){return Uf(n,f,e*(i.projectTileCoordinates(f.x,f.y,o,u).signedDistanceFromCamera/i.cameraToCenterDistance))}function lm({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},f){const p=i.projectTileCoordinates(f.x,f.y,o,u).signedDistanceFromCamera,y=e*(i.cameraToCenterDistance/p);return Uf(n,Ph(f,i,o,u),y)}function um({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},f){return Uf(n,Ph(f,i,o,u),e)}function Xf({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u,pitchAlignment:f="map",pitchScale:p="map"},y){const x=f==="map"?p==="map"?Wd:om:p==="map"?lm:um,T={queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u};for(const E of y)for(const C of E)if(x(T,C))return!0;return!1}function Ph(n,e,i,o){const u=e.projectTileCoordinates(n.x,n.y,i,o).point;return new ge((.5*u.x+.5)*e.width,(.5*-u.y+.5)*e.height)}let $f,Kd;lt("CircleBucket",Yu,{omit:["layers"]});var Jd={get paint(){return Kd=Kd||new Sn({"circle-radius":new vt(be.paint_circle["circle-radius"]),"circle-color":new vt(be.paint_circle["circle-color"]),"circle-blur":new vt(be.paint_circle["circle-blur"]),"circle-opacity":new vt(be.paint_circle["circle-opacity"]),"circle-translate":new ct(be.paint_circle["circle-translate"]),"circle-translate-anchor":new ct(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ct(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ct(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new vt(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new vt(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new vt(be.paint_circle["circle-stroke-opacity"])})},get layout(){return $f=$f||new Sn({"circle-sort-key":new vt(be.layout_circle["circle-sort-key"])})}};class Yf extends un{constructor(e,i){super(e,Jd,i)}createBucket(e){return new Yu(e)}queryRadius(e){const i=e;return nl("circle-radius",this,i)+nl("circle-stroke-width",this,i)+Dh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:f,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){const T=Zf(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-f.bearingInRadians,p),E=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o),C=this.paint.get("circle-pitch-scale"),D=this.paint.get("circle-pitch-alignment");let P,B;return D==="map"?(P=T,B=E*p):(P=(function(k,N,G,ee){return k.map((q=>Ph(q,N,G,ee)))})(T,f,y,x),B=E),Xf({queryGeometry:P,size:B,transform:f,unwrappedTileID:y,getElevation:x,pitchAlignment:D,pitchScale:C},u)}}class Qf extends Yu{}let ep;lt("HeatmapBucket",Qf,{omit:["layers"]});var tp={get paint(){return ep=ep||new Sn({"heatmap-radius":new vt(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new vt(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ct(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gu(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ct(be.paint_heatmap["heatmap-opacity"])})}};function Wf(n,{width:e,height:i},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*i*o}`)}else u=new Uint8Array(e*i*o);return n.width=e,n.height=i,n.data=u,n}function To(n,{width:e,height:i},o){if(e===n.width&&i===n.height)return;const u=Wf({},{width:e,height:i},o);Ih(n,u,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,i)},o),n.width=e,n.height=i,n.data=u.data}function Ih(n,e,i,o,u,f){if(u.width===0||u.height===0)return e;if(u.width>n.width||u.height>n.height||i.x>n.width-u.width||i.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||o.x>e.width-u.width||o.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const p=n.data,y=e.data;if(p===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<u.height;x++){const T=((i.y+x)*n.width+i.x)*f,E=((o.y+x)*e.width+o.x)*f;for(let C=0;C<u.width*f;C++)y[E+C]=p[T+C]}return e}class Rh{constructor(e,i){Wf(this,e,1,i)}resize(e){To(this,e,1)}clone(){return new Rh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,f){Ih(e,i,o,u,f,1)}}class Ga{constructor(e,i){Wf(this,e,4,i)}resize(e){To(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ga({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,f){Ih(e,i,o,u,f,4)}setPixel(e,i,o){const u=4*(e*this.width+i);this.data[u+0]=Math.round(255*o.r/o.a),this.data[u+1]=Math.round(255*o.g/o.a),this.data[u+2]=Math.round(255*o.b/o.a),this.data[u+3]=Math.round(255*o.a)}}function So(n){const e={},i=n.resolution||256,o=n.clips?n.clips.length:1,u=n.image||new Ga({width:i,height:o});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const f=(p,y,x)=>{e[n.evaluationKey]=x;const T=n.expression.evaluate(e);u.setPixel(p/4/i,y/4,T)};if(n.clips)for(let p=0,y=0;p<o;++p,y+=4*i)for(let x=0,T=0;x<i;x++,T+=4){const E=x/(i-1),{start:C,end:D}=n.clips[p];f(y,T,C*(1-E)+D*E)}else for(let p=0,y=0;p<i;p++,y+=4)f(0,y,p/(i-1));return u}lt("AlphaImage",Rh),lt("RGBAImage",Ga);const Lh="big-fb";class cm extends un{createBucket(e){return new Qf(e)}constructor(e,i){super(e,tp,i),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=So({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Lh)&&this.heatmapFbos.delete(Lh)}queryRadius(e){return nl("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:f,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){return Xf({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(i,o)*p,transform:f,unwrappedTileID:y,getElevation:x},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let Bh;var Oh={get paint(){return Bh=Bh||new Sn({"hillshade-illumination-direction":new ct(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new ct(be.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new ct(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ct(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ct(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ct(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ct(be.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new ct(be.paint_hillshade["hillshade-method"])})}};class yn extends un{constructor(e,i){super(e,Oh,i),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const f=Math.max(e.length,i.length,o.length,u.length);e=e.concat(Array(f-e.length).fill(e.at(-1))),i=i.concat(Array(f-i.length).fill(i.at(-1))),o=o.concat(Array(f-o.length).fill(o.at(-1))),u=u.concat(Array(f-u.length).fill(u.at(-1)));const p=i.map(On);return{directionRadians:e.map(On),altitudeRadians:p,shadowColor:u,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let hm;var wg={get paint(){return hm=hm||new Sn({"color-relief-opacity":new ct(be["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Gu(be["paint_color-relief"]["color-relief-color"])})}};class Kf{constructor(e,i,o,u){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,o){const{width:u,height:f}=e,p=!(this.size&&this.size[0]===u&&this.size[1]===f||o),{context:y}=this,{gl:x}=y;if(this.useMipmap=!!(i&&i.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||i.premultiply!==!1)),p)this.size=[u,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Qa(e)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,u,f,0,this.format,x.UNSIGNED_BYTE,e.data);else{const{x:T,y:E}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Qa(e)?x.texSubImage2D(x.TEXTURE_2D,0,T,E,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,T,E,u,f,x.RGBA,x.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D),y.pixelStoreUnpackFlipY.setDefault(),y.pixelStoreUnpack.setDefault(),y.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,i,o){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),o!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,o||e),this.filter=e),i!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Uc{constructor(e,i,o,u=1,f=1,p=1,y=0){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Ii(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const x=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=f,this.blueFactor=p,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<x;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(x,T)]=this.data[this._idx(x-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,x)]=this.data[this._idx(T,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<x;T++)for(let E=0;E<x;E++){const C=this.get(T,E);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(e,i){const o=new Uint8Array(this.data.buffer),u=4*this._idx(e,i);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${e}, y: ${i}, dim: ${this.dim}`);return(i+1)*this.stride+(e+1)}unpack(e,i,o){return e*this.redFactor+i*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return al(e,this.getUnpackVector())}getPixels(){return new Ga({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,f=i*this.dim+this.dim,p=o*this.dim,y=o*this.dim+this.dim;switch(i){case-1:u=f-1;break;case 1:f=u+1}switch(o){case-1:p=y-1;break;case 1:y=p+1}const x=-i*this.dim,T=-o*this.dim;for(let E=p;E<y;E++)for(let C=u;C<f;C++)this.data[this._idx(C,E)]=e.data[this._idx(C+x,E+T)]}}function al(n,e){const i=e[0],o=e[1],u=e[2],f=e[3],p=Math.min(i,o,u),y=Math.round((n+f)/p);return{r:Math.floor(y*p/i)%256,g:Math.floor(y*p/o)%256,b:Math.floor(y*p/u)%256}}lt("DEMData",Uc);class fm extends un{constructor(e,i){super(e,wg,i)}_createColorRamp(e){const i={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof Ia&&o._styleExpression.expression instanceof Da){this.colorRampExpression=o;const p=o._styleExpression.expression;i.elevationStops=p.labels,i.colorStops=[];for(const y of i.elevationStops)i.colorStops.push(p.evaluate({globals:{elevation:y}}))}if(i.elevationStops.length<1&&(i.elevationStops=[0],i.colorStops=[qt.transparent]),i.elevationStops.length<2&&(i.elevationStops.push(i.elevationStops[0]+1),i.colorStops.push(i.colorStops[0])),i.elevationStops.length<=e)return i;const u={elevationStops:[],colorStops:[]},f=(i.elevationStops.length-1)/(e-1);for(let p=0;p<i.elevationStops.length-.5;p+=f)u.elevationStops.push(i.elevationStops[Math.round(p)]),u.colorStops.push(i.colorStops[Math.round(p)]);return Ii(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${i.elevationStops.length}`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,i,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(i),f=new Ga({width:u.colorStops.length,height:1}),p=new Ga({width:u.colorStops.length,height:1});for(let y=0;y<u.elevationStops.length;y++){const x=al(u.elevationStops[y],o);p.setPixel(0,y,new qt(x.r/255,x.g/255,x.b/255,1)),f.setPixel(0,y,u.colorStops[y])}return this.colorRampTextures={elevationTexture:new Kf(e,p,e.gl.RGBA),colorTexture:new Kf(e,f,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}const dm=an([{name:"a_pos",components:2,type:"Int16"}],4),{members:kh}=dm;function Yr(n,e,i){const o=i.patternDependencies;let u=!1;for(const f of e){const p=f.paint.get(`${n}-pattern`);p.isConstant()||(u=!0);const y=p.constantOr(null);y&&(u=!0,o[y.to]=!0,o[y.from]=!0)}return u}function Jf(n,e,i,o,u){const{zoom:f}=o,p=u.patternDependencies;for(const y of e){const x=y.paint.get(`${n}-pattern`).value;if(x.kind!=="constant"){let T=x.evaluate({zoom:f-1},i,{},u.availableImages),E=x.evaluate({zoom:f},i,{},u.availableImages),C=x.evaluate({zoom:f+1},i,{},u.availableImages);T=T&&T.name?T.name:T,E=E&&E.name?E.name:E,C=C&&C.name?C.name:C,p[T]=!0,p[E]=!0,p[C]=!0,i.patterns[y.id]={min:T,mid:E,max:C}}}return i}function ed(n,e,i,o,u){let f;if(u===(function(p,y,x,T){let E=0;for(let C=y,D=x-T;C<x;C+=T)E+=(p[D]-p[C])*(p[C+1]+p[D+1]),D=C;return E})(n,e,i,o)>0)for(let p=e;p<i;p+=o)f=cr(p/o|0,n[p],n[p+1],f);else for(let p=i-o;p>=e;p-=o)f=cr(p/o|0,n[p],n[p+1],f);return f&&Cr(f,f.next)&&(hr(f),f=f.next),f}function $l(n,e){if(!n)return n;e||(e=n);let i,o=n;do if(i=!1,o.steiner||!Cr(o,o.next)&&yi(o.prev,o,o.next)!==0)o=o.next;else{if(hr(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function Wu(n,e,i,o,u,f,p){if(!n)return;!p&&f&&(function(x,T,E,C){let D=x;do D.z===0&&(D.z=na(D.x,D.y,T,E,C)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==x);D.prevZ.nextZ=null,D.prevZ=null,(function(P){let B,k=1;do{let N,G=P;P=null;let ee=null;for(B=0;G;){B++;let q=G,X=0;for(let se=0;se<k&&(X++,q=q.nextZ,q);se++);let ne=k;for(;X>0||ne>0&&q;)X!==0&&(ne===0||!q||G.z<=q.z)?(N=G,G=G.nextZ,X--):(N=q,q=q.nextZ,ne--),ee?ee.nextZ=N:P=N,N.prevZ=ee,ee=N;G=q}ee.nextZ=null,k*=2}while(B>1)})(D)})(n,o,u,f);let y=n;for(;n.prev!==n.next;){const x=n.prev,T=n.next;if(f?td(n,o,u,f):ip(n))e.push(x.i,n.i,T.i),hr(n),n=T.next,y=T.next;else if((n=T)===y){p?p===1?Wu(n=pm($l(n),e),e,i,o,u,f,2):p===2&&rl(n,e,i,o,u,f):Wu($l(n),e,i,o,u,f,1);break}}}function ip(n){const e=n.prev,i=n,o=n.next;if(yi(e,i,o)>=0)return!1;const u=e.x,f=i.x,p=o.x,y=e.y,x=i.y,T=o.y,E=Math.min(u,f,p),C=Math.min(y,x,T),D=Math.max(u,f,p),P=Math.max(y,x,T);let B=o.next;for(;B!==e;){if(B.x>=E&&B.x<=D&&B.y>=C&&B.y<=P&&Gc(u,y,f,x,p,T,B.x,B.y)&&yi(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function td(n,e,i,o){const u=n.prev,f=n,p=n.next;if(yi(u,f,p)>=0)return!1;const y=u.x,x=f.x,T=p.x,E=u.y,C=f.y,D=p.y,P=Math.min(y,x,T),B=Math.min(E,C,D),k=Math.max(y,x,T),N=Math.max(E,C,D),G=na(P,B,e,i,o),ee=na(k,N,e,i,o);let q=n.prevZ,X=n.nextZ;for(;q&&q.z>=G&&X&&X.z<=ee;){if(q.x>=P&&q.x<=k&&q.y>=B&&q.y<=N&&q!==u&&q!==p&&Gc(y,E,x,C,T,D,q.x,q.y)&&yi(q.prev,q,q.next)>=0||(q=q.prevZ,X.x>=P&&X.x<=k&&X.y>=B&&X.y<=N&&X!==u&&X!==p&&Gc(y,E,x,C,T,D,X.x,X.y)&&yi(X.prev,X,X.next)>=0))return!1;X=X.nextZ}for(;q&&q.z>=G;){if(q.x>=P&&q.x<=k&&q.y>=B&&q.y<=N&&q!==u&&q!==p&&Gc(y,E,x,C,T,D,q.x,q.y)&&yi(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;X&&X.z<=ee;){if(X.x>=P&&X.x<=k&&X.y>=B&&X.y<=N&&X!==u&&X!==p&&Gc(y,E,x,C,T,D,X.x,X.y)&&yi(X.prev,X,X.next)>=0)return!1;X=X.nextZ}return!0}function pm(n,e){let i=n;do{const o=i.prev,u=i.next.next;!Cr(o,u)&&rp(o,i,i.next,u)&&Vh(o,u)&&Vh(u,o)&&(e.push(o.i,i.i,u.i),hr(i),hr(i.next),i=n=u),i=i.next}while(i!==n);return $l(i)}function rl(n,e,i,o,u,f){let p=n;do{let y=p.next.next;for(;y!==p.prev;){if(p.i!==y.i&&Mn(p,y)){let x=jh(p,y);return p=$l(p,p.next),x=$l(x,x.next),Wu(p,e,i,o,u,f,0),void Wu(x,e,i,o,u,f,0)}y=y.next}p=p.next}while(p!==n)}function ia(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function np(n,e){const i=(function(u,f){let p=f;const y=u.x,x=u.y;let T,E=-1/0;if(Cr(u,p))return p;do{if(Cr(u,p.next))return p.next;if(x<=p.y&&x>=p.next.y&&p.next.y!==p.y){const k=p.x+(x-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(k<=y&&k>E&&(E=k,T=p.x<p.next.x?p:p.next,k===y))return T}p=p.next}while(p!==f);if(!T)return null;const C=T,D=T.x,P=T.y;let B=1/0;p=T;do{if(y>=p.x&&p.x>=D&&y!==p.x&&ap(x<P?y:E,x,D,P,x<P?E:y,x,p.x,p.y)){const k=Math.abs(x-p.y)/(y-p.x);Vh(p,u)&&(k<B||k===B&&(p.x>T.x||p.x===T.x&&mm(T,p)))&&(T=p,B=k)}p=p.next}while(p!==C);return T})(n,e);if(!i)return e;const o=jh(i,n);return $l(o,o.next),$l(i,i.next)}function mm(n,e){return yi(n.prev,n,e.prev)<0&&yi(e.next,n,n.next)<0}function na(n,e,i,o,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*u|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Tg(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function ap(n,e,i,o,u,f,p,y){return(u-p)*(e-y)>=(n-p)*(f-y)&&(n-p)*(o-y)>=(i-p)*(e-y)&&(i-p)*(f-y)>=(u-p)*(o-y)}function Gc(n,e,i,o,u,f,p,y){return!(n===p&&e===y)&&ap(n,e,i,o,u,f,p,y)}function Mn(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!(function(i,o){let u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==o.i&&u.next.i!==o.i&&rp(u,u.next,i,o))return!0;u=u.next}while(u!==i);return!1})(n,e)&&(Vh(n,e)&&Vh(e,n)&&(function(i,o){let u=i,f=!1;const p=(i.x+o.x)/2,y=(i.y+o.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&p<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==i);return f})(n,e)&&(yi(n.prev,n,e.prev)||yi(n,e.prev,e))||Cr(n,e)&&yi(n.prev,n,n.next)>0&&yi(e.prev,e,e.next)>0)}function yi(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Cr(n,e){return n.x===e.x&&n.y===e.y}function rp(n,e,i,o){const u=Nh(yi(n,e,i)),f=Nh(yi(n,e,o)),p=Nh(yi(i,o,n)),y=Nh(yi(i,o,e));return u!==f&&p!==y||!(u!==0||!Fh(n,i,e))||!(f!==0||!Fh(n,o,e))||!(p!==0||!Fh(i,n,o))||!(y!==0||!Fh(i,e,o))}function Fh(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Nh(n){return n>0?1:n<0?-1:0}function Vh(n,e){return yi(n.prev,n,n.next)<0?yi(n,e,n.next)>=0&&yi(n,n.prev,e)>=0:yi(n,e,n.prev)<0||yi(n,n.next,e)<0}function jh(n,e){const i=id(n.i,n.x,n.y),o=id(e.i,e.x,e.y),u=n.next,f=e.prev;return n.next=e,e.prev=n,i.next=u,u.prev=i,o.next=i,i.prev=o,f.next=o,o.prev=f,o}function cr(n,e,i,o){const u=id(n,e,i);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function hr(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function id(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class fa{constructor(e,i){if(i>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=i}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Uh{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Uh.noSubdivision=new Uh({fill:new fa(0,0),line:new fa(0,0),tile:new fa(0,0),stencil:new fa(0,0),circle:1}),lt("SubdivisionGranularityExpression",fa),lt("SubdivisionGranularitySetting",Uh);const zr=-32768,Hs=32767;class sl{constructor(e,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=St/e,this._canonical=i}_getKey(e,i){return(e+=32768)<<16|i+32768}_vertexToIndex(e,i){if(e<-32768||i<-32768||e>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(e),u=0|Math.round(i),f=this._getKey(o,u);if(this._vertexDictionary.has(f))return this._vertexDictionary.get(f);const p=this._vertexBuffer.length/2;return this._vertexDictionary.set(f,p),this._vertexBuffer.push(o,u),p}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(u,f){const p=[];for(let y=0;y<f.length;y+=3){const x=f[y],T=f[y+1],E=f[y+2],C=u[2*x],D=u[2*x+1];(u[2*T]-C)*(u[2*E+1]-D)-(u[2*T+1]-D)*(u[2*E]-C)>0?(p.push(x),p.push(E),p.push(T)):(p.push(x),p.push(T),p.push(E))}return p})(this._vertexBuffer,e);const i=[],o=e.length;for(let u=0;u<o;u+=3){const f=[e[u+0],e[u+1],e[u+2]],p=[this._vertexBuffer[2*e[u+0]+0],this._vertexBuffer[2*e[u+0]+1],this._vertexBuffer[2*e[u+1]+0],this._vertexBuffer[2*e[u+1]+1],this._vertexBuffer[2*e[u+2]+0],this._vertexBuffer[2*e[u+2]+1]];let y=1/0,x=1/0,T=-1/0,E=-1/0;for(let k=0;k<3;k++){const N=p[2*k],G=p[2*k+1];y=Math.min(y,N),T=Math.max(T,N),x=Math.min(x,G),E=Math.max(E,G)}if(y===T||x===E)continue;const C=Math.floor(y/this._granularityCellSize),D=Math.ceil(T/this._granularityCellSize),P=Math.floor(x/this._granularityCellSize),B=Math.ceil(E/this._granularityCellSize);if(C!==D||P!==B)for(let k=P;k<B;k++){const N=this._scanlineGenerateVertexRingForCellRow(k,p,f);Xs(this._vertexBuffer,N,i)}else i.push(...f)}return i}_scanlineGenerateVertexRingForCellRow(e,i,o){const u=e*this._granularityCellSize,f=u+this._granularityCellSize,p=[];for(let y=0;y<3;y++){const x=i[2*y],T=i[2*y+1],E=i[2*(y+1)%6],C=i[(2*(y+1)+1)%6],D=i[2*(y+2)%6],P=i[(2*(y+2)+1)%6],B=E-x,k=C-T,N=B===0,G=k===0,ee=(u-T)/k,q=(f-T)/k,X=Math.min(ee,q),ne=Math.max(ee,q);if(!G&&(X>=1||ne<=0)||G&&(T<u||T>f)){C>=u&&C<=f&&p.push(o[(y+1)%3]);continue}!G&&X>0&&p.push(this._vertexToIndex(x+B*X,T+k*X));const se=x+B*Math.max(X,0),Se=x+B*Math.min(ne,1);N||this._generateIntraEdgeVertices(p,x,T,E,C,se,Se),!G&&ne<1&&p.push(this._vertexToIndex(x+B*ne,T+k*ne)),(G||C>=u&&C<=f)&&p.push(o[(y+1)%3]),!G&&(C<=u||C>=f)&&this._generateInterEdgeVertices(p,x,T,E,C,D,P,Se,u,f)}return p}_generateIntraEdgeVertices(e,i,o,u,f,p,y){const x=u-i,T=f-o,E=T===0,C=E?Math.min(i,u):Math.min(p,y),D=E?Math.max(i,u):Math.max(p,y),P=Math.floor(C/this._granularityCellSize)+1,B=Math.ceil(D/this._granularityCellSize)-1;if(E?i<u:p<y)for(let k=P;k<=B;k++){const N=k*this._granularityCellSize;e.push(this._vertexToIndex(N,o+T*(N-i)/x))}else for(let k=B;k>=P;k--){const N=k*this._granularityCellSize;e.push(this._vertexToIndex(N,o+T*(N-i)/x))}}_generateInterEdgeVertices(e,i,o,u,f,p,y,x,T,E){const C=f-o,D=p-u,P=y-f,B=(T-f)/P,k=(E-f)/P,N=Math.min(B,k),G=Math.max(B,k),ee=u+D*N;let q=Math.floor(Math.min(ee,x)/this._granularityCellSize)+1,X=Math.ceil(Math.max(ee,x)/this._granularityCellSize)-1,ne=x<ee;const se=P===0;if(se&&(y===T||y===E))return;if(se||N>=1||G<=0){const Ve=o-y,Oe=p+(i-p)*Math.min((T-y)/Ve,(E-y)/Ve);q=Math.floor(Math.min(Oe,x)/this._granularityCellSize)+1,X=Math.ceil(Math.max(Oe,x)/this._granularityCellSize)-1,ne=x<Oe}const Se=C>0?E:T;if(ne)for(let Ve=q;Ve<=X;Ve++)e.push(this._vertexToIndex(Ve*this._granularityCellSize,Se));else for(let Ve=X;Ve>=q;Ve--)e.push(this._vertexToIndex(Ve*this._granularityCellSize,Se))}_generateOutline(e){const i=[];for(const o of e){const u=ol(o,this._granularity,!0),f=this._pointArrayToIndices(u),p=[];for(let y=1;y<f.length;y++)p.push(f[y-1]),p.push(f[y]);i.push(p)}return i}_handlePoles(e){let i=!1,o=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(i||o)&&this._fillPoles(e,i,o)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let i=0;i<e.length;i+=2){const o=e[i+1];o===zr&&(e[i+1]=-32767),o===Hs&&(e[i+1]=32766)}}_generatePoleQuad(e,i,o,u,f,p){u>f!=(p===zr)?(e.push(i),e.push(o),e.push(this._vertexToIndex(u,p)),e.push(o),e.push(this._vertexToIndex(f,p)),e.push(this._vertexToIndex(u,p))):(e.push(o),e.push(i),e.push(this._vertexToIndex(u,p)),e.push(this._vertexToIndex(f,p)),e.push(o),e.push(this._vertexToIndex(u,p)))}_fillPoles(e,i,o){const u=this._vertexBuffer,f=St,p=e.length;for(let y=2;y<p;y+=3){const x=e[y-2],T=e[y-1],E=e[y],C=u[2*x],D=u[2*x+1],P=u[2*T],B=u[2*T+1],k=u[2*E],N=u[2*E+1];i&&(D===0&&B===0&&this._generatePoleQuad(e,x,T,C,P,zr),B===0&&N===0&&this._generatePoleQuad(e,T,E,P,k,zr),N===0&&D===0&&this._generatePoleQuad(e,E,x,k,C,zr)),o&&(D===f&&B===f&&this._generatePoleQuad(e,x,T,C,P,Hs),B===f&&N===f&&this._generatePoleQuad(e,T,E,P,k,Hs),N===f&&D===f&&this._generatePoleQuad(e,E,x,k,C,Hs))}}_initializeVertices(e){for(let i=0;i<e.length;i+=2)this._vertexToIndex(e[i],e[i+1])}subdividePolygonInternal(e,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:u}=(function(y){const x=[],T=[];for(const E of y)if(E.length!==0){E!==y[0]&&x.push(T.length/2);for(let C=0;C<E.length;C++)T.push(E[C].x),T.push(E[C].y)}return{flattened:T,holeIndices:x}})(e);let f;this._initializeVertices(o);try{const y=(function(T,E,C=2){const D=E&&E.length,P=D?E[0]*C:T.length;let B=ed(T,0,P,C,!0);const k=[];if(!B||B.next===B.prev)return k;let N,G,ee;if(D&&(B=(function(q,X,ne,se){const Se=[];for(let Ve=0,Oe=X.length;Ve<Oe;Ve++){const qe=ed(q,X[Ve]*se,Ve<Oe-1?X[Ve+1]*se:q.length,se,!1);qe===qe.next&&(qe.steiner=!0),Se.push(Tg(qe))}Se.sort(ia);for(let Ve=0;Ve<Se.length;Ve++)ne=np(Se[Ve],ne);return ne})(T,E,B,C)),T.length>80*C){N=T[0],G=T[1];let q=N,X=G;for(let ne=C;ne<P;ne+=C){const se=T[ne],Se=T[ne+1];se<N&&(N=se),Se<G&&(G=Se),se>q&&(q=se),Se>X&&(X=Se)}ee=Math.max(q-N,X-G),ee=ee!==0?32767/ee:0}return Wu(B,k,C,N,G,ee,0),k})(o,u),x=this._convertIndices(o,y);f=this._subdivideTrianglesScanline(x)}catch(y){console.error(y)}let p=[];return i&&(p=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(f),{verticesFlattened:this._vertexBuffer,indicesTriangles:f,indicesLineList:p}}_convertIndices(e,i){const o=[];for(let u=0;u<i.length;u++)o.push(this._vertexToIndex(e[2*i[u]],e[2*i[u]+1]));return o}_pointArrayToIndices(e){const i=[];for(let o=0;o<e.length;o++){const u=e[o];i.push(this._vertexToIndex(u.x,u.y))}return i}}function nd(n,e,i,o=!0){return new sl(i,e).subdividePolygonInternal(n,o)}function ol(n,e,i=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const o=n[0],u=n[n.length-1],f=i&&(o.x!==u.x||o.y!==u.y);if(e<2)return f?[...n,n[0]]:[...n];const p=Math.floor(St/e),y=[];y.push(new ge(n[0].x,n[0].y));const x=n.length,T=f?x:x-1;for(let E=0;E<T;E++){const C=n[E],D=E<x-1?n[E+1]:n[0],P=C.x,B=C.y,k=D.x,N=D.y,G=P!==k,ee=B!==N;if(!G&&!ee)continue;const q=k-P,X=N-B,ne=Math.abs(q),se=Math.abs(X);let Se=P,Ve=B;for(;;){const qe=q>0?(Math.floor(Se/p)+1)*p:(Math.ceil(Se/p)-1)*p,rt=X>0?(Math.floor(Ve/p)+1)*p:(Math.ceil(Ve/p)-1)*p,Xe=Math.abs(Se-qe),Fe=Math.abs(Ve-rt),Pe=Math.abs(Se-k),dt=Math.abs(Ve-N),ut=G?Xe/ne:Number.POSITIVE_INFINITY,gt=ee?Fe/se:Number.POSITIVE_INFINITY;if((Pe<=Xe||!G)&&(dt<=Fe||!ee))break;if(ut<gt&&G||!ee){Se=qe,Ve+=X*ut;const st=new ge(Se,Math.round(Ve));y[y.length-1].x===st.x&&y[y.length-1].y===st.y||y.push(st)}else{Se+=q*gt,Ve=rt;const st=new ge(Math.round(Se),Ve);y[y.length-1].x===st.x&&y[y.length-1].y===st.y||y.push(st)}}const Oe=new ge(k,N);y[y.length-1].x===Oe.x&&y[y.length-1].y===Oe.y||y.push(Oe)}return y}function Xs(n,e,i){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,u=n[2*e[0]];for(let x=1;x<e.length;x++){const T=n[2*e[x]];T<u&&(u=T,o=x)}const f=e.length;let p=o,y=(p+1)%f;for(;;){const x=p-1>=0?p-1:f-1,T=(y+1)%f,E=n[2*e[x]],C=n[2*e[T]],D=n[2*e[p]],P=n[2*e[p]+1],B=n[2*e[y]+1];let k=!1;if(E<C)k=!0;else if(E>C)k=!1;else{const N=B-P,G=-(n[2*e[y]]-D),ee=P<B?1:-1;((E-D)*N+(n[2*e[x]+1]-P)*G)*ee>((C-D)*N+(n[2*e[T]+1]-P)*G)*ee&&(k=!0)}if(k){const N=e[x],G=e[p],ee=e[y];N!==G&&N!==ee&&G!==ee&&i.push(ee,G,N),p--,p<0&&(p=f-1)}else{const N=e[T],G=e[p],ee=e[y];N!==G&&N!==ee&&G!==ee&&i.push(ee,G,N),y++,y>=f&&(y=0)}if(x===T)break}}function sp(n,e,i,o,u,f,p,y,x){const T=u.length/2,E=p&&y&&x;if(T<at.MAX_VERTEX_ARRAY_LENGTH){const C=e.prepareSegment(T,i,o),D=C.vertexLength;for(let k=0;k<f.length;k+=3)o.emplaceBack(D+f[k],D+f[k+1],D+f[k+2]);let P,B;C.vertexLength+=T,C.primitiveLength+=f.length/3,E&&(B=p.prepareSegment(T,i,y),P=B.vertexLength,B.vertexLength+=T);for(let k=0;k<u.length;k+=2)n(u[k],u[k+1]);if(E)for(let k=0;k<x.length;k++){const N=x[k];for(let G=1;G<N.length;G+=2)y.emplaceBack(P+N[G-1],P+N[G]);B.primitiveLength+=N.length/2}}else(function(C,D,P,B,k,N){const G=[];for(let se=0;se<B.length/2;se++)G.push(-1);const ee={count:0};let q=0,X=C.getOrCreateLatestSegment(D,P),ne=X.vertexLength;for(let se=2;se<k.length;se+=3){const Se=k[se-2],Ve=k[se-1],Oe=k[se];let qe=G[Se]<q,rt=G[Ve]<q,Xe=G[Oe]<q;X.vertexLength+((qe?1:0)+(rt?1:0)+(Xe?1:0))>at.MAX_VERTEX_ARRAY_LENGTH&&(X=C.createNewSegment(D,P),q=ee.count,qe=!0,rt=!0,Xe=!0,ne=0);const Fe=Mo(G,B,N,ee,Se,qe,X),Pe=Mo(G,B,N,ee,Ve,rt,X),dt=Mo(G,B,N,ee,Oe,Xe,X);P.emplaceBack(ne+Fe-q,ne+Pe-q,ne+dt-q),X.primitiveLength++}})(e,i,o,u,f,n),E&&(function(C,D,P,B,k,N){const G=[];for(let se=0;se<B.length/2;se++)G.push(-1);const ee={count:0};let q=0,X=C.getOrCreateLatestSegment(D,P),ne=X.vertexLength;for(let se=0;se<k.length;se++){const Se=k[se];for(let Ve=1;Ve<k[se].length;Ve+=2){const Oe=Se[Ve-1],qe=Se[Ve];let rt=G[Oe]<q,Xe=G[qe]<q;X.vertexLength+((rt?1:0)+(Xe?1:0))>at.MAX_VERTEX_ARRAY_LENGTH&&(X=C.createNewSegment(D,P),q=ee.count,rt=!0,Xe=!0,ne=0);const Fe=Mo(G,B,N,ee,Oe,rt,X),Pe=Mo(G,B,N,ee,qe,Xe,X);P.emplaceBack(ne+Fe-q,ne+Pe-q),X.primitiveLength++}}})(p,i,y,u,x,n),e.forceNewSegmentOnNextPrepare(),p?.forceNewSegmentOnNextPrepare()}function Mo(n,e,i,o,u,f,p){if(f){const y=o.count;return i(e[2*u],e[2*u+1]),n[u]=o.count,o.count++,p.vertexLength++,y}return n[u]}class Ku{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Y,this.indexArray=new Ce,this.indexArray2=new We,this.programConfigurations=new xo(e.layers,e.zoom),this.segments=new at,this.segments2=new at,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=Yr("fill",this.layers,i);const u=this.layers[0].layout.get("fill-sort-key"),f=!u.isConstant(),p=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:E}of e){const C=this.layers[0]._featureFilter.needGeometry,D=$r(y,C);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),D,o))continue;const P=f?u.evaluate(D,{},o,i.availableImages):void 0,B={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:C?D.geometry:Zs(y),patterns:{},sortKey:P};p.push(B)}f&&p.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of p){const{geometry:x,index:T,sourceLayerIndex:E}=y;if(this.hasDependencies){const C=Jf("fill",this.layers,y,{zoom:this.zoom},i);this.patternFeatures.push(C)}else this.addFeature(y,x,T,o,{},i.subdivisionGranularity);i.featureIndex.insert(e[T].feature,x,T,E,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}addFeatures(e,i,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,i,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,u,f,p){for(const y of Su(i,500)){const x=nd(y,u,p.fill.getGranularityForZoomLevel(u.z)),T=this.layoutVertexArray;sp(((E,C)=>{T.emplaceBack(E,C)}),this.segments,this.layoutVertexArray,this.indexArray,x.verticesFlattened,x.indicesTriangles,this.segments2,this.indexArray2,x.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:f,canonical:u})}}let qc,Ju;lt("FillBucket",Ku,{omit:["layers","patternFeatures"]});var gm={get paint(){return Ju=Ju||new Sn({"fill-antialias":new ct(be.paint_fill["fill-antialias"]),"fill-opacity":new vt(be.paint_fill["fill-opacity"]),"fill-color":new vt(be.paint_fill["fill-color"]),"fill-outline-color":new vt(be.paint_fill["fill-outline-color"]),"fill-translate":new ct(be.paint_fill["fill-translate"]),"fill-translate-anchor":new ct(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new Sr(be.paint_fill["fill-pattern"])})},get layout(){return qc=qc||new Sn({"fill-sort-key":new vt(be.layout_fill["fill-sort-key"])})}};class _m extends un{constructor(e,i){super(e,gm,i)}recalculate(e,i){super.recalculate(e,i);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Ku(e)}queryRadius(){return Dh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:i,transform:o,pixelsToTileUnits:u}){return Gf(Zf(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,u),i)}isTileClipped(){return!0}}const Gh=an([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ym=an([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ad}=Gh;class Zc{constructor(e,i,o,u,f){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=f,e.readFields(Sg,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,o=[];let u,f=1,p=0,y=0,x=0;for(;e.pos<i;){if(p<=0){const T=e.readVarint();f=7&T,p=T>>3}if(p--,f===1||f===2)y+=e.readSVarint(),x+=e.readSVarint(),f===1&&(u&&o.push(u),u=[]),u&&u.push(new ge(y,x));else{if(f!==7)throw new Error(`unknown command ${f}`);u&&u.push(u[0].clone())}}return u&&o.push(u),o}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let o=1,u=0,f=0,p=0,y=1/0,x=-1/0,T=1/0,E=-1/0;for(;e.pos<i;){if(u<=0){const C=e.readVarint();o=7&C,u=C>>3}if(u--,o===1||o===2)f+=e.readSVarint(),p+=e.readSVarint(),f<y&&(y=f),f>x&&(x=f),p<T&&(T=p),p>E&&(E=p);else if(o!==7)throw new Error(`unknown command ${o}`)}return[y,T,x,E]}toGeoJSON(e,i,o){const u=this.extent*Math.pow(2,o),f=this.extent*e,p=this.extent*i,y=this.loadGeometry();function x(D){return[360*(D.x+f)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+p)/u)*Math.PI))-90]}function T(D){return D.map(x)}let E;if(this.type===1){const D=[];for(const B of y)D.push(B[0]);const P=T(D);E=D.length===1?{type:"Point",coordinates:P[0]}:{type:"MultiPoint",coordinates:P}}else if(this.type===2){const D=y.map(T);E=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{const D=vm(y),P=[];for(const B of D)P.push(B.map(T));E=P.length===1?{type:"Polygon",coordinates:P[0]}:{type:"MultiPolygon",coordinates:P}}}const C={type:"Feature",geometry:E,properties:this.properties};return this.id!=null&&(C.id=this.id),C}}function Sg(n,e,i){n===1?e.id=i.readVarint():n===2?(function(o,u){const f=o.readVarint()+o.pos;for(;o.pos<f;){const p=u._keys[o.readVarint()],y=u._values[o.readVarint()];u.properties[p]=y}})(i,e):n===3?e.type=i.readVarint():n===4&&(e._geometry=i.pos)}function vm(n){const e=n.length;if(e<=1)return[n];const i=[];let o,u;for(let f=0;f<e;f++){const p=Fi(n[f]);p!==0&&(u===void 0&&(u=p<0),u===p<0?(o&&i.push(o),o=[n[f]]):o&&o.push(n[f]))}return o&&i.push(o),i}function Fi(n){let e=0;for(let i,o,u=0,f=n.length,p=f-1;u<f;p=u++)i=n[u],o=n[p],e+=(o.x-i.x)*(i.y+o.y);return e}Zc.types=["Unknown","Point","LineString","Polygon"];class sn{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(di,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new Zc(this._pbf,i,this.extent,this._keys,this._values)}}function di(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push((function(o){let u=null;const f=o.readVarint()+o.pos;for(;o.pos<f;){const p=o.readVarint()>>3;u=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(i))}class pi{constructor(e,i){this.layers=e.readFields(qi,{},i)}}function qi(n,e,i){if(n===3){const o=new sn(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}const fr=Math.pow(2,13);function Es(n,e,i,o,u,f,p,y){n.emplaceBack(e,i,2*Math.floor(o*fr)+p,u*fr*2,f*fr*2,Math.round(y))}class Yl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new J,this.centroidVertexArray=new $,this.indexArray=new Ce,this.programConfigurations=new xo(e.layers,e.zoom),this.segments=new at,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.features=[],this.hasDependencies=Yr("fill-extrusion",this.layers,i);for(const{feature:u,id:f,index:p,sourceLayerIndex:y}of e){const x=this.layers[0]._featureFilter.needGeometry,T=$r(u,x);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),T,o))continue;const E={id:f,sourceLayerIndex:y,index:p,geometry:x?T.geometry:Zs(u),properties:u.properties,type:u.type,patterns:{}};this.hasDependencies?this.features.push(Jf("fill-extrusion",this.layers,E,{zoom:this.zoom},i)):this.addFeature(E,E.geometry,p,o,{},i.subdivisionGranularity),i.featureIndex.insert(u,E.geometry,p,y,this.index,!0)}}addFeatures(e,i,o){for(const u of this.features){const{geometry:f}=u;this.addFeature(u,f,u.index,i,o,e.subdivisionGranularity)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ad),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,ym.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,i,o,u,f,p){for(const y of Su(i,500)){const x={x:0,y:0,sampleCount:0},T=this.layoutVertexArray.length;this.processPolygon(x,u,e,y,p);const E=this.layoutVertexArray.length-T,C=Math.floor(x.x/x.sampleCount),D=Math.floor(x.y/x.sampleCount);for(let P=0;P<E;P++)this.centroidVertexArray.emplaceBack(C,D)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:f,canonical:u})}processPolygon(e,i,o,u,f){if(u.length<1||Rn(u[0]))return;for(const C of u)C.length!==0&&op(e,C);const p={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},y=f.fill.getGranularityForZoomLevel(i.z),x=Zc.types[o.type]==="Polygon";for(const C of u){if(C.length===0||Rn(C))continue;const D=ol(C,y,x);this._generateSideFaces(D,p)}if(!x)return;const T=nd(u,i,y,!1),E=this.layoutVertexArray;sp(((C,D)=>{Es(E,C,D,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles)}_generateSideFaces(e,i){let o=0;for(let u=1;u<e.length;u++){const f=e[u],p=e[u-1];if(ll(f,p))continue;i.segment.vertexLength+4>at.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const y=f.sub(p)._perp()._unit(),x=p.dist(f);o+x>32768&&(o=0),Es(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,0,o),Es(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,1,o),o+=x,Es(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,0,o),Es(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,1,o);const T=i.segment.vertexLength;this.indexArray.emplaceBack(T,T+2,T+1),this.indexArray.emplaceBack(T+1,T+2,T+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function op(n,e){for(let i=0;i<e.length;i++){const o=e[i];i===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(n.x+=o.x,n.y+=o.y,n.sampleCount++)}}function ll(n,e){return n.x===e.x&&(n.x<0||n.x>St)||n.y===e.y&&(n.y<0||n.y>St)}function Rn(n){return n.every((e=>e.x<0))||n.every((e=>e.x>St))||n.every((e=>e.y<0))||n.every((e=>e.y>St))}let ul;lt("FillExtrusionBucket",Yl,{omit:["layers","features"]});var ec={get paint(){return ul=ul||new Sn({"fill-extrusion-opacity":new ct(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new vt(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ct(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ct(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Sr(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new vt(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new vt(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ct(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class lp extends un{constructor(e,i){super(e,ec,i)}createBucket(e){return new Yl(e)}queryRadius(){return Dh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:f,pixelsToTileUnits:p,pixelPosMatrix:y}){const x=Zf(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-f.bearingInRadians,p),T=this.paint.get("fill-extrusion-height").evaluate(i,o),E=this.paint.get("fill-extrusion-base").evaluate(i,o),C=(function(P,B){const k=[];for(const N of P){const G=[N.x,N.y,0,1];ma(G,G,B),k.push(new ge(G[0]/G[3],G[1]/G[3]))}return k})(x,y),D=(function(P,B,k,N){const G=[],ee=[],q=N[8]*B,X=N[9]*B,ne=N[10]*B,se=N[11]*B,Se=N[8]*k,Ve=N[9]*k,Oe=N[10]*k,qe=N[11]*k;for(const rt of P){const Xe=[],Fe=[];for(const Pe of rt){const dt=Pe.x,ut=Pe.y,gt=N[0]*dt+N[4]*ut+N[12],st=N[1]*dt+N[5]*ut+N[13],Tt=N[2]*dt+N[6]*ut+N[14],vi=N[3]*dt+N[7]*ut+N[15],ai=Tt+ne,vn=vi+se,Xa=gt+Se,oa=st+Ve,xn=Tt+Oe,hn=vi+qe,Di=new ge((gt+q)/vn,(st+X)/vn);Di.z=ai/vn,Xe.push(Di);const Ln=new ge(Xa/hn,oa/hn);Ln.z=xn/hn,Fe.push(Ln)}G.push(Xe),ee.push(Fe)}return[G,ee]})(u,E,T,y);return(function(P,B,k){let N=1/0;Gf(k,B)&&(N=tc(k,B[0]));for(let G=0;G<B.length;G++){const ee=B[G],q=P[G];for(let X=0;X<ee.length-1;X++){const ne=ee[X],se=[ne,ee[X+1],q[X+1],q[X],ne];Qu(k,se)&&(N=Math.min(N,tc(k,se)))}}return N!==1/0&&N})(D[0],D[1],C)}}function Ra(n,e){return n.x*e.x+n.y*e.y}function tc(n,e){if(n.length===1){let i=0;const o=e[i++];let u;for(;!u||o.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const f=e[i],p=n[0],y=u.sub(o),x=f.sub(o),T=p.sub(o),E=Ra(y,y),C=Ra(y,x),D=Ra(x,x),P=Ra(T,y),B=Ra(T,x),k=E*D-C*C,N=(D*P-C*B)/k,G=(E*B-C*P)/k,ee=o.z*(1-N-G)+u.z*N+f.z*G;if(isFinite(ee))return ee}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}const qh=an([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Dr}=qh,up=an([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:rd}=up,xm=Math.cos(Math.PI/180*37.5),Zh=Math.pow(2,14)/.5;class Hc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new re,this.layoutVertexArray2=new K,this.indexArray=new Ce,this.programConfigurations=new xo(e.layers,e.zoom),this.segments=new at,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=Yr("line",this.layers,i)||this.hasLineDasharray(this.layers);const u=this.layers[0].layout.get("line-sort-key"),f=!u.isConstant(),p=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:E}of e){const C=this.layers[0]._featureFilter.needGeometry,D=$r(y,C);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),D,o))continue;const P=f?u.evaluate(D,{},o):void 0,B={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:C?D.geometry:Zs(y),patterns:{},dashes:{},sortKey:P};p.push(B)}f&&p.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of p){const{geometry:x,index:T,sourceLayerIndex:E}=y;this.hasDependencies?(Yr("line",this.layers,i)?Jf("line",this.layers,y,{zoom:this.zoom},i):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,y,this.zoom,i),this.patternFeatures.push(y)):this.addFeature(y,x,T,o,{},{},i.subdivisionGranularity),i.featureIndex.insert(e[T].feature,x,T,E,this.index)}}update(e,i,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o,dashPositions:u})}addFeatures(e,i,o,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,o,u,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,rd)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dr),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,u,f,p,y){const x=this.layers[0].layout,T=x.get("line-join").evaluate(e,{}),E=x.get("line-cap"),C=x.get("line-miter-limit"),D=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of i)this.addLine(P,e,T,E,C,D,u,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:f,dashPositions:p,canonical:u})}addLine(e,i,o,u,f,p,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=ol(e,y?x.line.getGranularityForZoomLevel(y.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let q=0;q<e.length-1;q++)this.totalDistance+=e[q].dist(e[q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=Zc.types[i.type]==="Polygon";let E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let C=0;for(;C<E-1&&e[C].equals(e[C+1]);)C++;if(E<(T?3:2))return;o==="bevel"&&(f=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let B,k,N,G,ee;this.e1=this.e2=-1,T&&(B=e[E-2],ee=e[C].sub(B)._unit()._perp());for(let q=C;q<E;q++){if(N=q===E-1?T?e[C+1]:void 0:e[q+1],N&&e[q].equals(N))continue;ee&&(G=ee),B&&(k=B),B=e[q],ee=N?N.sub(B)._unit()._perp():G,G=G||ee;let X=G.add(ee);X.x===0&&X.y===0||X._unit();const ne=G.x*ee.x+G.y*ee.y,se=X.x*ee.x+X.y*ee.y,Se=se!==0?1/se:1/0,Ve=2*Math.sqrt(2-2*se),Oe=se<xm&&k&&N,qe=G.x*ee.y-G.y*ee.x>0;if(Oe&&q>C){const Fe=B.dist(k);if(Fe>2*D){const Pe=B.sub(B.sub(k)._mult(D/Fe)._round());this.updateDistance(k,Pe),this.addCurrentVertex(Pe,G,0,0,P),k=Pe}}const rt=k&&N;let Xe=rt?o:T?"butt":u;if(rt&&Xe==="round"&&(Se<p?Xe="miter":Se<=2&&(Xe="fakeround")),Xe==="miter"&&Se>f&&(Xe="bevel"),Xe==="bevel"&&(Se>2&&(Xe="flipbevel"),Se<f&&(Xe="miter")),k&&this.updateDistance(k,B),Xe==="miter")X._mult(Se),this.addCurrentVertex(B,X,0,0,P);else if(Xe==="flipbevel"){if(Se>100)X=ee.mult(-1);else{const Fe=Se*G.add(ee).mag()/G.sub(ee).mag();X._perp()._mult(Fe*(qe?-1:1))}this.addCurrentVertex(B,X,0,0,P),this.addCurrentVertex(B,X.mult(-1),0,0,P)}else if(Xe==="bevel"||Xe==="fakeround"){const Fe=-Math.sqrt(Se*Se-1),Pe=qe?Fe:0,dt=qe?0:Fe;if(k&&this.addCurrentVertex(B,G,Pe,dt,P),Xe==="fakeround"){const ut=Math.round(180*Ve/Math.PI/20);for(let gt=1;gt<ut;gt++){let st=gt/ut;if(st!==.5){const vi=st-.5;st+=st*vi*(st-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*vi*vi+(.848013+ne*(.215638*ne-1.06021)))}const Tt=ee.sub(G)._mult(st)._add(G)._unit()._mult(qe?-1:1);this.addHalfVertex(B,Tt.x,Tt.y,!1,qe,0,P)}}N&&this.addCurrentVertex(B,ee,-Pe,-dt,P)}else if(Xe==="butt")this.addCurrentVertex(B,X,0,0,P);else if(Xe==="square"){const Fe=k?1:-1;this.addCurrentVertex(B,X,Fe,Fe,P)}else Xe==="round"&&(k&&(this.addCurrentVertex(B,G,0,0,P),this.addCurrentVertex(B,G,1,1,P,!0)),N&&(this.addCurrentVertex(B,ee,-1,-1,P,!0),this.addCurrentVertex(B,ee,0,0,P)));if(Oe&&q<E-1){const Fe=B.dist(N);if(Fe>2*D){const Pe=B.add(N.sub(B)._mult(D/Fe)._round());this.updateDistance(B,Pe),this.addCurrentVertex(Pe,ee,0,0,P),B=Pe}}}}addCurrentVertex(e,i,o,u,f,p=!1){const y=i.y*u-i.x,x=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,p,!1,o,f),this.addHalfVertex(e,y,x,p,!0,-u,f),this.distance>Zh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,i,o,u,f,p))}addHalfVertex({x:e,y:i},o,u,f,p,y,x){const T=.5*(this.lineClips?this.scaledDistance*(Zh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,E,this.e2),x.primitiveLength++),p?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}hasLineDasharray(e){for(const i of e){const o=i.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(e,i,o,u){for(const f of e){const p=f.paint.get("line-dasharray");if(!p||p.value.kind==="constant")continue;const y=f.layout.get("line-cap")==="round",x={dasharray:p.value.evaluate({zoom:o-1},i,{}),round:y},T={dasharray:p.value.evaluate({zoom:o},i,{}),round:y},E={dasharray:p.value.evaluate({zoom:o+1},i,{}),round:y},C=`${x.dasharray.join(",")},${x.round}`,D=`${T.dasharray.join(",")},${T.round}`,P=`${E.dasharray.join(",")},${E.round}`;u.dashDependencies[C]=x,u.dashDependencies[D]=T,u.dashDependencies[P]=E,i.dashes[f.id]={min:C,mid:D,max:P}}}}let cl,aa;lt("LineBucket",Hc,{omit:["layers","patternFeatures"]});var hl={get paint(){return aa=aa||new Sn({"line-opacity":new vt(be.paint_line["line-opacity"]),"line-color":new vt(be.paint_line["line-color"]),"line-translate":new ct(be.paint_line["line-translate"]),"line-translate-anchor":new ct(be.paint_line["line-translate-anchor"]),"line-width":new vt(be.paint_line["line-width"]),"line-gap-width":new vt(be.paint_line["line-gap-width"]),"line-offset":new vt(be.paint_line["line-offset"]),"line-blur":new vt(be.paint_line["line-blur"]),"line-dasharray":new Sr(be.paint_line["line-dasharray"]),"line-pattern":new Sr(be.paint_line["line-pattern"]),"line-gradient":new Gu(be.paint_line["line-gradient"])})},get layout(){return cl=cl||new Sn({"line-cap":new ct(be.layout_line["line-cap"]),"line-join":new vt(be.layout_line["line-join"]),"line-miter-limit":new ct(be.layout_line["line-miter-limit"]),"line-round-limit":new ct(be.layout_line["line-round-limit"]),"line-sort-key":new vt(be.layout_line["line-sort-key"])})}};class Xc extends vt{possiblyEvaluate(e,i){return i=new Ti(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,u){return i=ri({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,u)}}let As;class cp extends un{constructor(e,i){super(e,hl,i),this.gradientVersion=0,As||(As=new Xc(hl.paint.properties["line-width"].specification),As.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(i)&&i._styleExpression.expression instanceof ro,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,i){super.recalculate(e,i),this.paint._values["line-floorwidth"]=As.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Hc(e)}queryRadius(e){const i=e,o=sd(nl("line-width",this,i),nl("line-gap-width",this,i)),u=nl("line-offset",this,i);return o/2+Math.abs(u)+Dh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:f,pixelsToTileUnits:p}){const y=Zf(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-f.bearingInRadians,p),x=p/2*sd(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),T=this.paint.get("line-offset").evaluate(i,o);return T&&(u=(function(E,C){const D=[];for(let P=0;P<E.length;P++){const B=Hf(E[P]),k=[];for(let N=0;N<B.length;N++){const G=B[N],ee=B[N-1],q=B[N+1],X=N===0?new ge(0,0):G.sub(ee)._unit()._perp(),ne=N===B.length-1?new ge(0,0):q.sub(G)._unit()._perp(),se=X._add(ne)._unit(),Se=se.x*ne.x+se.y*ne.y;Se!==0&&se._mult(1/Se),k.push(se._mult(C)._add(G))}D.push(k)}return D})(u,T*p)),(function(E,C,D){for(let P=0;P<C.length;P++){const B=C[P];if(E.length>=3){for(let k=0;k<B.length;k++)if(wo(E,B[k]))return!0}if(ta(E,B,D))return!0}return!1})(y,u,x)}isTileClipped(){return!0}}function sd(n,e){return e>0?e+2*n:n}const bm=an([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hh=an([{name:"a_projected_pos",components:3,type:"Float32"}],4);an([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const hp=an([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);an([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Pr=an([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),wm=an([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ir(n,e,i){return n.sections.forEach((o=>{o.text=(function(u,f,p){const y=f.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),Tr.applyArabicShaping&&(u=Tr.applyArabicShaping(u)),u})(o.text,e,i)})),n}an([{name:"triangle",components:3,type:"Uint16"}]),an([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),an([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),an([{type:"Float32",name:"offsetX"}]),an([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),an([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var $n=24;const $c={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},Mg={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Ql={40:!0};function Xh(n,e,i,o,u,f){if("fontStack"in e){const p=i[e.fontStack],y=p&&p[n];return y?y.metrics.advance*e.scale+u:0}{const p=o[e.imageName];return p?p.displaySize[0]*e.scale*$n/f+u:0}}function od(n,e,i,o){const u=Math.pow(n-e,2);return o?n<e?u/2:2*u:u+Math.abs(i)*i}function Yc(n,e,i){let o=0;return n===10&&(o-=1e4),i&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function fp(n,e,i,o,u,f){let p=null,y=od(e,i,u,f);for(const x of o){const T=od(e-x.x,i,u,f)+x.badness;T<=y&&(p=x,y=T)}return{index:n,x:e,priorBreak:p,badness:y}}function dp(n){return n?dp(n.priorBreak).concat(n.index):[]}class ic{constructor(e="",i=[],o=[]){this.text=e,this.sections=i,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(e,i){const o=new ic;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?o.addImageSection(f):o.addTextSection(f,i)}return o}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let i="",o={premature:!0,value:void 0};const u=e[Symbol.iterator]();let f=u.next();const p=e[Symbol.iterator]();p.next();let y=p.next();for(;!f.done;)i+=!y.done&&bs(y.value.codePointAt(0))&&!$c[y.value]||!o.premature&&bs(o.value.codePointAt(0))&&!$c[o.value]||!$c[f.value]?f.value:$c[f.value],o={value:f.value,premature:!1},f=u.next(),y=p.next();return i})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),i=e?e[0].length:0,o=this.text.match(/\S\s*$/),u=o?o[0].length-1:0;this.text=this.text.substring(i,this.text.length-u),this.sectionIndex=this.sectionIndex.slice(i,this.sectionIndex.length-u)}substring(e,i){const o=[...this.text].slice(e,i).join(""),u=this.sectionIndex.slice(e,i);return new ic(o,this.sections,u)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}getMaxImageSize(e){let i=0,o=0;for(let u=0;u<this.length();u++){const f=this.getSection(u);if("imageName"in f){const p=e[f.imageName];if(!p)continue;const y=p.displaySize;i=Math.max(i,y[0]),o=Math.max(o,y[1])}}return{maxImageWidth:i,maxImageHeight:o}}addTextSection(e,i){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||i});const o=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>o)))}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void Ii("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:i}),this.sectionIndex.push(this.sections.length-1)):Ii("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,i,o,u,f){const p=[],y=this.determineAverageLineWidth(e,i,o,u,f),x=this.hasZeroWidthSpaces();let T=0,E=0;const C=this.text[Symbol.iterator]();let D=C.next();const P=this.text[Symbol.iterator]();P.next();let B=P.next();const k=this.text[Symbol.iterator]();k.next(),k.next();let N=k.next();for(;!D.done;){const G=this.getSection(E),ee=D.value.codePointAt(0);if(Fu(ee)||(T+=Xh(ee,G,o,u,e,f)),!B.done){const q=ys(ee),X=B.value.codePointAt(0);(Mg[ee]||q||"imageName"in G||!N.done&&Ql[X])&&p.push(fp(E+1,T,y,p,Yc(ee,X,q&&x),!1))}E++,D=C.next(),B=P.next(),N=k.next()}return dp(fp(this.length(),T,y,p,0,!0))}determineAverageLineWidth(e,i,o,u,f){let p=0,y=0;for(const x of this.text){const T=this.getSection(y);p+=Xh(x.codePointAt(0),T,o,u,e,f),y++}return p/Math.max(1,Math.ceil(p/i))}}const ld=4294967296,$h=1/ld,ud=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class cd{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,i,o=this.length){for(;this.pos<o;){const u=this.readVarint(),f=u>>3,p=this.pos;this.type=7&u,e(f,i,this),this.pos===p&&this.skip(u)}return i}readMessage(e,i){return this.readFields(e,i,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*ld;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*ld;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const i=this.buf;let o,u;return u=i[this.pos++],o=127&u,u<128?o:(u=i[this.pos++],o|=(127&u)<<7,u<128?o:(u=i[this.pos++],o|=(127&u)<<14,u<128?o:(u=i[this.pos++],o|=(127&u)<<21,u<128?o:(u=i[this.pos],o|=(15&u)<<28,(function(f,p,y){const x=y.buf;let T,E;if(E=x[y.pos++],T=(112&E)>>4,E<128||(E=x[y.pos++],T|=(127&E)<<3,E<128)||(E=x[y.pos++],T|=(127&E)<<10,E<128)||(E=x[y.pos++],T|=(127&E)<<17,E<128)||(E=x[y.pos++],T|=(127&E)<<24,E<128)||(E=x[y.pos++],T|=(1&E)<<31,E<128))return Qc(f,T,p);throw new Error("Expected varint not more than 10 bytes")})(o,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,i=this.pos;return this.pos=e,e-i>=12&&ud?ud.decode(this.buf.subarray(i,e)):(function(o,u,f){let p="",y=u;for(;y<f;){const x=o[y];let T,E,C,D=null,P=x>239?4:x>223?3:x>191?2:1;if(y+P>f)break;P===1?x<128&&(D=x):P===2?(T=o[y+1],(192&T)==128&&(D=(31&x)<<6|63&T,D<=127&&(D=null))):P===3?(T=o[y+1],E=o[y+2],(192&T)==128&&(192&E)==128&&(D=(15&x)<<12|(63&T)<<6|63&E,(D<=2047||D>=55296&&D<=57343)&&(D=null))):P===4&&(T=o[y+1],E=o[y+2],C=o[y+3],(192&T)==128&&(192&E)==128&&(192&C)==128&&(D=(15&x)<<18|(63&T)<<12|(63&E)<<6|63&C,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,P=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),y+=P}return p})(this.buf,i,e)}readBytes(){const e=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,e);return this.pos=e,i}readPackedVarint(e=[],i){const o=this.readPackedEnd();for(;this.pos<o;)e.push(this.readVarint(i));return e}readPackedSVarint(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const i=7&e;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(e,i){this.writeVarint(e<<3|i)}realloc(e){let i=this.length||16;for(;i<this.pos+e;)i*=2;if(i!==this.length){const o=new Uint8Array(i);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*$h),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*$h),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(i,o){let u,f;if(i>=0?(u=i%4294967296|0,f=i/4294967296|0):(u=~(-i%4294967296),f=~(-i/4294967296),4294967295^u?u=u+1|0:(u=0,f=f+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(p,y,x){x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7)})(u,0,o),(function(p,y){const x=(7&p)<<4;y.buf[y.pos++]|=x|((p>>>=3)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p)))))})(f,o)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const i=this.pos;this.pos=(function(u,f,p){for(let y,x,T=0;T<f.length;T++){if(y=f.charCodeAt(T),y>55295&&y<57344){if(!x){y>56319||T+1===f.length?(u[p++]=239,u[p++]=191,u[p++]=189):x=y;continue}if(y<56320){u[p++]=239,u[p++]=191,u[p++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(u[p++]=239,u[p++]=191,u[p++]=189,x=null);y<128?u[p++]=y:(y<2048?u[p++]=y>>6|192:(y<65536?u[p++]=y>>12|224:(u[p++]=y>>18|240,u[p++]=y>>12&63|128),u[p++]=y>>6&63|128),u[p++]=63&y|128)}return p})(this.buf,e,this.pos);const o=this.pos-i;o>=128&&Tm(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const i=e.length;this.writeVarint(i),this.realloc(i);for(let o=0;o<i;o++)this.buf[this.pos++]=e[o]}writeRawMessage(e,i){this.pos++;const o=this.pos;e(i,this);const u=this.pos-o;u>=128&&Tm(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u}writeMessage(e,i,o){this.writeTag(e,2),this.writeRawMessage(i,o)}writePackedVarint(e,i){i.length&&this.writeMessage(e,Sm,i)}writePackedSVarint(e,i){i.length&&this.writeMessage(e,Mm,i)}writePackedBoolean(e,i){i.length&&this.writeMessage(e,Em,i)}writePackedFloat(e,i){i.length&&this.writeMessage(e,Wc,i)}writePackedDouble(e,i){i.length&&this.writeMessage(e,hd,i)}writePackedFixed32(e,i){i.length&&this.writeMessage(e,Am,i)}writePackedSFixed32(e,i){i.length&&this.writeMessage(e,Cm,i)}writePackedFixed64(e,i){i.length&&this.writeMessage(e,zm,i)}writePackedSFixed64(e,i){i.length&&this.writeMessage(e,Dm,i)}writeBytesField(e,i){this.writeTag(e,2),this.writeBytes(i)}writeFixed32Field(e,i){this.writeTag(e,5),this.writeFixed32(i)}writeSFixed32Field(e,i){this.writeTag(e,5),this.writeSFixed32(i)}writeFixed64Field(e,i){this.writeTag(e,1),this.writeFixed64(i)}writeSFixed64Field(e,i){this.writeTag(e,1),this.writeSFixed64(i)}writeVarintField(e,i){this.writeTag(e,0),this.writeVarint(i)}writeSVarintField(e,i){this.writeTag(e,0),this.writeSVarint(i)}writeStringField(e,i){this.writeTag(e,2),this.writeString(i)}writeFloatField(e,i){this.writeTag(e,5),this.writeFloat(i)}writeDoubleField(e,i){this.writeTag(e,1),this.writeDouble(i)}writeBooleanField(e,i){this.writeVarintField(e,+i)}}function Qc(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function Tm(n,e,i){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(let u=i.pos-1;u>=n;u--)i.buf[u+o]=i.buf[u]}function Sm(n,e){for(let i=0;i<n.length;i++)e.writeVarint(n[i])}function Mm(n,e){for(let i=0;i<n.length;i++)e.writeSVarint(n[i])}function Wc(n,e){for(let i=0;i<n.length;i++)e.writeFloat(n[i])}function hd(n,e){for(let i=0;i<n.length;i++)e.writeDouble(n[i])}function Em(n,e){for(let i=0;i<n.length;i++)e.writeBoolean(n[i])}function Am(n,e){for(let i=0;i<n.length;i++)e.writeFixed32(n[i])}function Cm(n,e){for(let i=0;i<n.length;i++)e.writeSFixed32(n[i])}function zm(n,e){for(let i=0;i<n.length;i++)e.writeFixed64(n[i])}function Dm(n,e){for(let i=0;i<n.length;i++)e.writeSFixed64(n[i])}function Pm(n,e,i){n===1&&i.readMessage(fd,e)}function fd(n,e,i){if(n===3){const{id:o,bitmap:u,width:f,height:p,left:y,top:x,advance:T}=i.readMessage(Im,{});e.push({id:o,bitmap:new Rh({width:f+6,height:p+6},u),metrics:{width:f,height:p,left:y,top:x,advance:T}})}}function Im(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}function pp(n){let e=0,i=0;for(const p of n)e+=p.w*p.h,i=Math.max(i,p.w);n.sort(((p,y)=>y.h-p.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,f=0;for(const p of n)for(let y=o.length-1;y>=0;y--){const x=o[y];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,f=Math.max(f,p.y+p.h),u=Math.max(u,p.x+p.w),p.w===x.w&&p.h===x.h){const T=o.pop();T&&y<o.length&&(o[y]=T)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(o.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}class Ni{constructor(e,{pixelRatio:i,version:o,stretchX:u,stretchY:f,content:p,textFitWidth:y,textFitHeight:x}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=f,this.content=p,this.version=o,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class dd{constructor(e,i){const o={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,o,f),this.addImages(i,u,f);const{w:p,h:y}=pp(f),x=new Ga({width:p||1,height:y||1});for(const T in e){const E=e[T],C=o[T].paddedRect;Ga.copy(E.data,x,{x:0,y:0},{x:C.x+1,y:C.y+1},E.data)}for(const T in i){const E=i[T],C=u[T].paddedRect,D=C.x+1,P=C.y+1,B=E.data.width,k=E.data.height;Ga.copy(E.data,x,{x:0,y:0},{x:D,y:P},E.data),Ga.copy(E.data,x,{x:0,y:k-1},{x:D,y:P-1},{width:B,height:1}),Ga.copy(E.data,x,{x:0,y:0},{x:D,y:P+k},{width:B,height:1}),Ga.copy(E.data,x,{x:B-1,y:0},{x:D-1,y:P},{width:1,height:k}),Ga.copy(E.data,x,{x:0,y:0},{x:D+B,y:P},{width:1,height:k})}this.image=x,this.iconPositions=o,this.patternPositions=u}addImages(e,i,o){for(const u in e){const f=e[u],p={x:0,y:0,w:f.data.width+2,h:f.data.height+2};o.push(p),i[u]=new Ni(p,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,f]=e.tl;o.update(i.data,void 0,{x:u,y:f})}}var Wl;function Yh(n,e,i,o,u,f,p,y,x,T,E,C,D,P,B){const k=ic.fromFeature(n,u);let N;C===O.az.vertical&&k.verticalizePunctuation();let G=k.determineLineBreaks(T,f,e,o,P);const{processBidirectionalText:ee,processStyledBidirectionalText:q}=Tr;if(ee&&k.sections.length===1){N=[],G=G.map((Se=>k.toCodeUnitIndex(Se)));const se=ee(k.toString(),G);for(const Se of se){const Ve=[...Se].map((()=>0));N.push(new ic(Se,k.sections,Ve))}}else if(q){N=[],G=G.map((Oe=>k.toCodeUnitIndex(Oe)));let se=0;const Se=[];for(const Oe of k.text)Se.push(...Array(Oe.length).fill(k.sectionIndex[se])),se++;const Ve=q(k.text,Se,G);for(const Oe of Ve){const qe=[];let rt="";for(const Xe of Oe[0])qe.push(Oe[1][rt.length]),rt+=Xe;N.push(new ic(Oe[0],k.sections,qe))}}else N=(function(se,Se){const Ve=[];let Oe=0;for(const qe of Se)Ve.push(se.substring(Oe,qe)),Oe=qe;return Oe<se.length()&&Ve.push(se.substring(Oe,se.length())),Ve})(k,G);const X=[],ne={positionedLines:X,text:k.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:C,iconsInText:!1,verticalizable:!1};return(function(se,Se,Ve,Oe,qe,rt,Xe,Fe,Pe,dt,ut,gt){let st=0,Tt=0,vi=0,ai=0;const vn=Fe==="right"?1:Fe==="left"?0:.5,Xa=$n/gt;let oa=0;for(const Di of qe){Di.trim();const Ln=Di.getMaxScale(),Vn={positionedGlyphs:[],lineOffset:0};se.positionedLines[oa]=Vn;const on=Vn.positionedGlyphs;let Kr=0;if(!Di.length()){Tt+=rt,++oa;continue}const $a=Eg(Oe,Di,Xa);let Jr=0;for(const Sa of Di.text){const En=Di.getSection(Jr),la=Sa.codePointAt(0),Bn=pd(Pe,ut,la),Ma={glyph:la,imageName:null,x:st,y:Tt+-17,vertical:Bn,scale:1,fontStack:"",sectionIndex:Di.getSectionIndex(Jr),metrics:null,rect:null};let sc;if("fontStack"in En){if(sc=Kc(En,la,Bn,$a,Se,Ve),!sc)continue;Ma.fontStack=En.fontStack}else{if(se.iconsInText=!0,En.scale*=Xa,sc=gp(En,Bn,Ln,$a,Oe),!sc)continue;Kr=Math.max(Kr,sc.imageOffset),Ma.imageName=En.imageName}const{rect:_l,metrics:Qp,baselineOffset:lh}=sc;Ma.y+=lh,Ma.scale=En.scale,Ma.metrics=Qp,Ma.rect=_l,on.push(Ma),Bn?(se.verticalizable=!0,st+=("imageName"in En?Qp.advance:$n)*En.scale+dt):st+=Qp.advance*En.scale+dt,Jr++}on.length!==0&&(vi=Math.max(st-dt,vi),md(on,0,on.length-1,vn)),st=0,Vn.lineOffset=Math.max(Kr,(Ln-1)*$n);const Co=rt*Ln+Kr;Tt+=Co,ai=Math.max(Co,ai),++oa}const{horizontalAlign:xn,verticalAlign:hn}=mp(Xe);(function(Di,Ln,Vn,on,Kr,$a,Jr,Co,Sa){const En=(Ln-Vn)*Kr;let la=0;la=$a!==Jr?-Co*on- -17:-on*Sa*Jr+.5*Jr;for(const Bn of Di)for(const Ma of Bn.positionedGlyphs)Ma.x+=En,Ma.y+=la})(se.positionedLines,vn,xn,hn,vi,ai,rt,Tt,qe.length),se.top+=-hn*Tt,se.bottom=se.top+Tt,se.left+=-xn*vi,se.right=se.left+vi})(ne,e,i,o,N,p,y,x,C,T,D,B),!(function(se){for(const Se of se)if(Se.positionedGlyphs.length!==0)return!1;return!0})(X)&&ne}function mp(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Eg(n,e,i){const o=e.getMaxScale()*$n,{maxImageWidth:u,maxImageHeight:f}=e.getMaxImageSize(n),p=Math.max(o,f*i);return{verticalLineContentWidth:Math.max(o,u*i),horizontalLineContentHeight:p}}function Rm(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function pd(n,e,i){return!(n===O.az.horizontal||!e&&!Yo(i)||e&&(Fu(i)||(o=i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Kc(n,e,i,o,u,f){const p=f[n.fontStack],y=(function(T,E,C,D){if(T&&T.rect)return T;const P=E[C.fontStack],B=P&&P[D];return B?{rect:null,metrics:B.metrics}:null})(p&&p[e],u,n,e);if(y===null)return null;let x;if(i)x=o.verticalLineContentWidth-n.scale*$n;else{const T=Rm(n.verticalAlign);x=(o.horizontalLineContentHeight-n.scale*$n)*T}return{rect:y.rect,metrics:y.metrics,baselineOffset:x}}function gp(n,e,i,o,u){const f=u[n.imageName];if(!f)return null;const p=f.paddedRect,y=f.displaySize,x={width:y[0],height:y[1],left:1,top:-3,advance:e?y[1]:y[0]};let T;if(e)T=o.verticalLineContentWidth-y[1]*n.scale;else{const E=Rm(n.verticalAlign);T=(o.horizontalLineContentHeight-y[1]*n.scale)*E}return{rect:p,metrics:x,baselineOffset:T,imageOffset:(e?y[0]:y[1])*n.scale-$n*i}}function md(n,e,i,o){if(o===0)return;const u=n[i],f=(n[i].x+u.metrics.advance*u.scale)*o;for(let p=e;p<=i;p++)n[p].x-=f}function _p(n,e,i){const{horizontalAlign:o,verticalAlign:u}=mp(i),f=e[0]-n.displaySize[0]*o,p=e[1]-n.displaySize[1]*u;return{image:n,top:p,bottom:p+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function fl(n){var e,i;let o=n.left,u=n.top,f=n.right-o,p=n.bottom-u;const y=(e=n.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",x=(i=n.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",T=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&f/p<T||y==="proportional"){const E=Math.ceil(p*T);o*=E/f,f=E}}else if(y==="proportional"&&x==="stretchOnly"&&T!==0&&f/p>T){const E=Math.ceil(f/T);u*=E/p,p=E}return{x1:o,y1:u,x2:o+f,y2:u+p}}function $s(n,e,i,o,u,f){const p=n.image;let y;if(p.content){const N=p.content,G=p.pixelRatio||1;y=[N[0]/G,N[1]/G,p.displaySize[0]-N[2]/G,p.displaySize[1]-N[3]/G]}const x=e.left*f,T=e.right*f;let E,C,D,P;i==="width"||i==="both"?(P=u[0]+x-o[3],C=u[0]+T+o[1]):(P=u[0]+(x+T-p.displaySize[0])/2,C=P+p.displaySize[0]);const B=e.top*f,k=e.bottom*f;return i==="height"||i==="both"?(E=u[1]+B-o[0],D=u[1]+k+o[2]):(E=u[1]+(B+k-p.displaySize[1])/2,D=E+p.displaySize[1]),{image:p,top:E,right:C,bottom:D,left:P,collisionPadding:y}}lt("ImagePosition",Ni),lt("ImageAtlas",dd),O.az=void 0,(Wl=O.az||(O.az={}))[Wl.none=0]="none",Wl[Wl.horizontal=1]="horizontal",Wl[Wl.vertical=2]="vertical",Wl[Wl.horizontalOnly=3]="horizontalOnly";const Qr=128,Kl=32640;function yp(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Ti(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=i;let f=0;for(;f<o.length&&o[f]<=n;)f++;f=Math.max(0,f-1);let p=f;for(;p<o.length&&o[p]<n+1;)p++;p=Math.min(o.length-1,p);const y=o[f],x=o[p];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:x,minSize:i.evaluate(new Ti(y)),maxSize:i.evaluate(new Ti(x)),interpolationType:u}}}function gd(n,e,i){let o="never";const u=n.get(e);return u?o=u:n.get(i)&&(o="always"),o}const Lm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Qh(n,e,i,o,u,f,p,y,x,T,E,C,D){const P=y?Math.min(Kl,Math.round(y[0])):0,B=y?Math.min(Kl,Math.round(y[1])):0;n.emplaceBack(e,i,Math.round(32*o),Math.round(32*u),f,p,(P<<1)+(x?1:0),B,16*T,16*E,256*C,256*D)}function vp(n,e,i){n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i)}function xp(n){for(const e of n.sections)if(Ns(e.text))return!0;return!1}class _d{constructor(e){this.layoutVertexArray=new ie,this.indexArray=new Ce,this.programConfigurations=e,this.segments=new at,this.dynamicLayoutVertexArray=new pe,this.opacityVertexArray=new ze,this.hasVisibleVertices=!1,this.placedSymbolArray=new v}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Hh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Lm,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}lt("SymbolBuffers",_d);class yd{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new at,this.collisionVertexArray=new Ae}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,hp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}lt("CollisionBuffers",yd);class Jc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((p=>p.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=yp(this.zoom,i["text-size"]),this.iconSizeData=yp(this.zoom,i["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),f=o.get("symbol-z-order");this.canOverlap=gd(o,"text-overlap","text-allow-overlap")!=="never"||gd(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((p=>O.az[p]))),this.stateDependentLayerIds=this.layers.filter((p=>p.isStateDependent())).map((p=>p.id)),this.sourceID=e.sourceID}createArrays(){this.text=new _d(new xo(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new _d(new xo(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new A,this.lineVertexArray=new z,this.symbolInstances=new S,this.textAnchorOffsets=new I}calculateGlyphDependencies(e,i,o,u,f){for(const p of e)if(i[p.codePointAt(0)]=!0,(o||u)&&f){const y=$c[p];y&&(i[y.codePointAt(0)]=!0)}}populate(e,i,o){const u=this.layers[0],f=u.layout,p=f.get("text-font"),y=f.get("text-field"),x=f.get("icon-image"),T=(y.value.kind!=="constant"||y.value.value instanceof qn&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),E=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,C=f.get("symbol-sort-key");if(this.features=[],!T&&!E)return;const D=i.iconDependencies,P=i.glyphDependencies,B=i.availableImages,k=new Ti(this.zoom);for(const{feature:N,id:G,index:ee,sourceLayerIndex:q}of e){const X=u._featureFilter.needGeometry,ne=$r(N,X);if(!u._featureFilter.filter(k,ne,o))continue;let se,Se;if(X||(ne.geometry=Zs(N)),T){const Oe=u.getValueAndResolveTokens("text-field",ne,o,B),qe=qn.factory(Oe),rt=this.hasRTLText=this.hasRTLText||xp(qe);(!rt||Tr.getRTLTextPluginStatus()==="unavailable"||rt&&Tr.isParsed())&&(se=Ir(qe,u,ne))}if(E){const Oe=u.getValueAndResolveTokens("icon-image",ne,o,B);Se=Oe instanceof Aa?Oe:Aa.fromString(Oe)}if(!se&&!Se)continue;const Ve=this.sortFeaturesByKey?C.evaluate(ne,{},o):void 0;if(this.features.push({id:G,text:se,icon:Se,index:ee,sourceLayerIndex:q,geometry:ne.geometry,properties:N.properties,type:Zc.types[N.type],sortKey:Ve}),Se&&(D[Se.name]=!0),se){const Oe=p.evaluate(ne,{},o).join(","),qe=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(O.az.vertical)>=0;for(const rt of se.sections)if(rt.image)D[rt.image.name]=!0;else{const Xe=vs(se.toString()),Fe=rt.fontStack||Oe,Pe=P[Fe]=P[Fe]||{};this.calculateGlyphDependencies(rt.text,Pe,qe,this.allowVerticalPlacement,Xe)}}}f.get("symbol-placement")==="line"&&(this.features=(function(N){const G={},ee={},q=[];let X=0;function ne(Oe){q.push(N[Oe]),X++}function se(Oe,qe,rt){const Xe=ee[Oe];return delete ee[Oe],ee[qe]=Xe,q[Xe].geometry[0].pop(),q[Xe].geometry[0]=q[Xe].geometry[0].concat(rt[0]),Xe}function Se(Oe,qe,rt){const Xe=G[qe];return delete G[qe],G[Oe]=Xe,q[Xe].geometry[0].shift(),q[Xe].geometry[0]=rt[0].concat(q[Xe].geometry[0]),Xe}function Ve(Oe,qe,rt){const Xe=rt?qe[0][qe[0].length-1]:qe[0][0];return`${Oe}:${Xe.x}:${Xe.y}`}for(let Oe=0;Oe<N.length;Oe++){const qe=N[Oe],rt=qe.geometry,Xe=qe.text?qe.text.toString():null;if(!Xe){ne(Oe);continue}const Fe=Ve(Xe,rt),Pe=Ve(Xe,rt,!0);if(Fe in ee&&Pe in G&&ee[Fe]!==G[Pe]){const dt=Se(Fe,Pe,rt),ut=se(Fe,Pe,q[dt].geometry);delete G[Fe],delete ee[Pe],ee[Ve(Xe,q[ut].geometry,!0)]=ut,q[dt].geometry=null}else Fe in ee?se(Fe,Pe,rt):Pe in G?Se(Fe,Pe,rt):(ne(Oe),G[Fe]=X-1,ee[Pe]=X-1)}return q.filter((Oe=>Oe.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((N,G)=>N.sortKey-G.sortKey))}update(e,i,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(i[e.segment+1]),f=e.dist(i[e.segment]);const p={};for(let y=e.segment+1;y<i.length;y++)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:u},y<i.length-1&&(u+=i[y+1].dist(i[y]));for(let y=e.segment||0;y>=0;y--)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:f},y>0&&(f+=i[y-1].dist(i[y]));for(let y=0;y<i.length;y++){const x=p[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,u,f,p,y,x,T,E,C,D){const P=e.indexArray,B=e.layoutVertexArray,k=e.segments.prepareSegment(4*i.length,B,P,this.canOverlap?p.sortKey:void 0),N=this.glyphOffsetArray.length,G=k.vertexLength,ee=this.allowVerticalPlacement&&y===O.az.vertical?Math.PI/2:0,q=p.text&&p.text.sections;for(let X=0;X<i.length;X++){const{tl:ne,tr:se,bl:Se,br:Ve,tex:Oe,pixelOffsetTL:qe,pixelOffsetBR:rt,minFontScaleX:Xe,minFontScaleY:Fe,glyphOffset:Pe,isSDF:dt,sectionIndex:ut}=i[X],gt=k.vertexLength,st=Pe[1];Qh(B,x.x,x.y,ne.x,st+ne.y,Oe.x,Oe.y,o,dt,qe.x,qe.y,Xe,Fe),Qh(B,x.x,x.y,se.x,st+se.y,Oe.x+Oe.w,Oe.y,o,dt,rt.x,qe.y,Xe,Fe),Qh(B,x.x,x.y,Se.x,st+Se.y,Oe.x,Oe.y+Oe.h,o,dt,qe.x,rt.y,Xe,Fe),Qh(B,x.x,x.y,Ve.x,st+Ve.y,Oe.x+Oe.w,Oe.y+Oe.h,o,dt,rt.x,rt.y,Xe,Fe),vp(e.dynamicLayoutVertexArray,x,ee),P.emplaceBack(gt,gt+2,gt+1),P.emplaceBack(gt+1,gt+2,gt+3),k.vertexLength+=4,k.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Pe[0]),X!==i.length-1&&ut===i[X+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,p,p.index,{imagePositions:{},canonical:D,formattedSection:q&&q[ut]})}e.placedSymbolArray.emplaceBack(x.x,x.y,N,this.glyphOffsetArray.length-N,G,T,E,x.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],y,0,!1,0,C)}_addCollisionDebugVertex(e,i,o,u,f,p){return i.emplaceBack(0,0),e.emplaceBack(o.x,o.y,u,f,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,i,o,u,f,p,y){const x=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),T=x.vertexLength,E=f.layoutVertexArray,C=f.collisionVertexArray,D=y.anchorX,P=y.anchorY;this._addCollisionDebugVertex(E,C,p,D,P,new ge(e,i)),this._addCollisionDebugVertex(E,C,p,D,P,new ge(o,i)),this._addCollisionDebugVertex(E,C,p,D,P,new ge(o,u)),this._addCollisionDebugVertex(E,C,p,D,P,new ge(e,u)),x.vertexLength+=4;const B=f.indexArray;B.emplaceBack(T,T+1),B.emplaceBack(T+1,T+2),B.emplaceBack(T+2,T+3),B.emplaceBack(T+3,T),x.primitiveLength+=4}addDebugCollisionBoxes(e,i,o,u){for(let f=e;f<i;f++){const p=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,u?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new yd(Te,Pr.members,We),this.iconCollisionBox=new yd(Te,Pr.members,We);for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(e,i,o,u,f,p,y,x,T){const E={};for(let C=i;C<o;C++){const D=e.get(C);E.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.textFeatureIndex=D.featureIndex;break}for(let C=u;C<f;C++){const D=e.get(C);E.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.verticalTextFeatureIndex=D.featureIndex;break}for(let C=p;C<y;C++){const D=e.get(C);E.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.iconFeatureIndex=D.featureIndex;break}for(let C=x;C<T;C++){const D=e.get(C);E.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.verticalIconFeatureIndex=D.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),u=o.vertexStartIndex+4*o.numGlyphs;for(let f=o.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+2,f+1),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),u=[],f=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const x=this.symbolInstances.get(y);u.push(0|Math.round(i*x.anchorX+o*x.anchorY)),f.push(x.featureIndex)}return p.sort(((y,x)=>u[y]-u[x]||f[x]-f[y])),p}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((u,f,p)=>{u>=0&&p.indexOf(u)===f&&this.addIndicesForPlacedSymbol(this.text,u)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let vd,xd;lt("SymbolBucket",Jc,{omit:["layers","collisionBoxArray","features","compareText"]}),Jc.MAX_GLYPHS=65535,Jc.addDynamicAttributes=vp;var bp={get paint(){return xd=xd||new Sn({"icon-opacity":new vt(be.paint_symbol["icon-opacity"]),"icon-color":new vt(be.paint_symbol["icon-color"]),"icon-halo-color":new vt(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new vt(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new vt(be.paint_symbol["icon-halo-blur"]),"icon-translate":new ct(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new ct(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new vt(be.paint_symbol["text-opacity"]),"text-color":new vt(be.paint_symbol["text-color"],{runtimeType:Ka,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new vt(be.paint_symbol["text-halo-color"]),"text-halo-width":new vt(be.paint_symbol["text-halo-width"]),"text-halo-blur":new vt(be.paint_symbol["text-halo-blur"]),"text-translate":new ct(be.paint_symbol["text-translate"]),"text-translate-anchor":new ct(be.paint_symbol["text-translate-anchor"])})},get layout(){return vd=vd||new Sn({"symbol-placement":new ct(be.layout_symbol["symbol-placement"]),"symbol-spacing":new ct(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ct(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new vt(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ct(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ct(be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ct(be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ct(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new ct(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ct(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new vt(be.layout_symbol["icon-size"]),"icon-text-fit":new ct(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ct(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new vt(be.layout_symbol["icon-image"]),"icon-rotate":new vt(be.layout_symbol["icon-rotate"]),"icon-padding":new vt(be.layout_symbol["icon-padding"]),"icon-keep-upright":new ct(be.layout_symbol["icon-keep-upright"]),"icon-offset":new vt(be.layout_symbol["icon-offset"]),"icon-anchor":new vt(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ct(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ct(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ct(be.layout_symbol["text-rotation-alignment"]),"text-field":new vt(be.layout_symbol["text-field"]),"text-font":new vt(be.layout_symbol["text-font"]),"text-size":new vt(be.layout_symbol["text-size"]),"text-max-width":new vt(be.layout_symbol["text-max-width"]),"text-line-height":new ct(be.layout_symbol["text-line-height"]),"text-letter-spacing":new vt(be.layout_symbol["text-letter-spacing"]),"text-justify":new vt(be.layout_symbol["text-justify"]),"text-radial-offset":new vt(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ct(be.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new vt(be.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new vt(be.layout_symbol["text-anchor"]),"text-max-angle":new ct(be.layout_symbol["text-max-angle"]),"text-writing-mode":new ct(be.layout_symbol["text-writing-mode"]),"text-rotate":new vt(be.layout_symbol["text-rotate"]),"text-padding":new ct(be.layout_symbol["text-padding"]),"text-keep-upright":new ct(be.layout_symbol["text-keep-upright"]),"text-transform":new vt(be.layout_symbol["text-transform"]),"text-offset":new vt(be.layout_symbol["text-offset"]),"text-allow-overlap":new ct(be.layout_symbol["text-allow-overlap"]),"text-overlap":new ct(be.layout_symbol["text-overlap"]),"text-ignore-placement":new ct(be.layout_symbol["text-ignore-placement"]),"text-optional":new ct(be.layout_symbol["text-optional"])})}};class Bm{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:ji,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}lt("FormatSectionOverride",Bm,{omit:["defaultValue"]});class Jl extends un{constructor(e,i){super(e,bp,i)}recalculate(e,i){if(super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const f of o)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,i,o,u){const f=this.layout.get(e).evaluate(i,{},o,u),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||fo(p.value)||!f?f:(function(y,x){return x.replace(/{([^{}]+)}/g,((T,E)=>y&&E in y?String(y[E]):""))})(i.properties,f)}createBucket(e){return new Jc(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of bp.paint.overridableProperties){if(!Jl.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new Bm(i),u=new Ac(o,i.property.specification);let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new Ia("source",u):new po("composite",u,i.value.zoomStops),this.paint._values[e]=new lr(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&Jl.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),u=bp.paint.properties[i];let f=!1;const p=y=>{for(const x of y)if(u.overrides&&u.overrides.hasOverride(x))return void(f=!0)};if(o.value.kind==="constant"&&o.value.value instanceof qn)p(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const y=T=>{f||(T instanceof er&&tn(T.value)===is?p(T.value.sections):T instanceof xu?p(T.sections):T.eachChild(y))},x=o.value;x._styleExpression&&y(x._styleExpression.expression)}return f}}let Om;var km={get paint(){return Om=Om||new Sn({"background-color":new ct(be.paint_background["background-color"]),"background-pattern":new Gl(be.paint_background["background-pattern"]),"background-opacity":new ct(be.paint_background["background-opacity"])})}};class mi extends un{constructor(e,i){super(e,km,i)}}class wp extends un{constructor(e,i){super(e,{},i),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class bd{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Tp={once:!0},wd=63710088e-1;class Eo{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Eo(Xt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,u=e.lat*i,f=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return wd*Math.acos(Math.min(f,1))}static convert(e){if(e instanceof Eo)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Eo(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Eo(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const eh=2*Math.PI*wd;function Wh(n){return eh*Math.cos(n*Math.PI/180)}function Fm(n){return(180+n)/360}function Sp(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Nm(n,e){return n/Wh(e)}function Vm(n){return 360*n-180}function Kh(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Mp(n,e){return n*Wh(Kh(e))}class Ci{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=Eo.convert(e);return new Ci(Fm(o.lng),Sp(o.lat),Nm(i,o.lat))}toLngLat(){return new Eo(Vm(this.x),Kh(this.y))}toAltitude(){return Mp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/eh*(e=Kh(this.y),1/Math.cos(e*Math.PI/180));var e}}function Td(n,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class da{constructor(e,i,o){if(!(function(u,f,p){return!(u<0||u>25||p<0||p>=Math.pow(2,u)||f<0||f>=Math.pow(2,u))})(e,i,o))throw new Error(`x=${i}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=i,this.y=o,this.key=th(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i,o){const u=(function(p,y,x){var T=Td(256*p,256*(y=Math.pow(2,x)-y-1),x),E=Td(256*(p+1),256*(y+1),x);return T[0]+","+T[1]+","+E[0]+","+E[1]})(this.x,this.y,this.z),f=(function(p,y,x){let T,E="";for(let C=p;C>0;C--)T=1<<C-1,E+=(y&T?1:0)+(x&T?2:0);return E})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,f).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const i=this.z-e.z;return i>0&&e.x===this.x>>i&&e.y===this.y>>i}getTilePoint(e){const i=Math.pow(2,this.z);return new ge((e.x*i-this.x)*St,(e.y*i-this.y)*St)}toString(){return`${this.z}/${this.x}/${this.y}`}}class jm{constructor(e,i){this.wrap=e,this.canonical=i,this.key=th(e,i.z,i.z,i.x,i.y)}}class Rr{constructor(e,i,o,u,f){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=i,this.canonical=new da(o,+u,+f),this.key=th(i,e,o,u,f)}clone(){return new Rr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-e;return e>this.canonical.z?new Rr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rr(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,i){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?th(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y):th(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const i=this.canonical.z-e.canonical.z;return!(i<0)&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Rr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new Rr(i,this.wrap,i,o,u),new Rr(i,this.wrap,i,o+1,u),new Rr(i,this.wrap,i,o,u+1),new Rr(i,this.wrap,i,o+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Rr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Rr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new jm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Ci(e.x-this.wrap,e.y))}}function th(n,e,i,o,u){(n*=2)<0&&(n=-1*n-1);const f=1<<i;return(f*f*n+f*u+o).toString(36)+i.toString(36)+e.toString(36)}function Jh(n,e){return e?n.properties[e]:n.id}function Ep(n,e){const i={id:n.id};if(e.removeAllProperties&&(delete n.removeProperties,delete n.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const o of e.removeProperties){const u=n.addOrUpdateProperties.findIndex((f=>f.key===o));u>-1&&n.addOrUpdateProperties.splice(u,1)}return(n.removeAllProperties||e.removeAllProperties)&&(i.removeAllProperties=!0),(n.removeProperties||e.removeProperties)&&(i.removeProperties=[...n.removeProperties||[],...e.removeProperties||[]]),(n.addOrUpdateProperties||e.addOrUpdateProperties)&&(i.addOrUpdateProperties=[...n.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(n.newGeometry||e.newGeometry)&&(i.newGeometry=e.newGeometry||n.newGeometry),i}function ef(n){var e,i;if(!n)return{};const o={};return o.removeAll=n.removeAll,o.remove=new Set(n.remove||[]),o.add=new Map((e=n.add)===null||e===void 0?void 0:e.map((u=>[u.id,u]))),o.update=new Map((i=n.update)===null||i===void 0?void 0:i.map((u=>[u.id,u]))),o}lt("CanonicalTileID",da),lt("OverscaledTileID",Rr,{omit:["terrainRttPosMatrix32f"]});class eu{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const i=new eu;return i.extend(e(new ge(this.minX,this.minY))),i.extend(e(new ge(this.maxX,this.minY))),i.extend(e(new ge(this.minX,this.maxY))),i.extend(e(new ge(this.maxX,this.maxY))),i}static fromPoints(e){const i=new eu;for(const o of e)i.extend(o);return i}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Ap{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Sd{constructor(e,i,o,u,f){this.type="Feature",this._vectorTileFeature=e,this._x=o,this._y=u,this._z=i,this.properties=e.properties,this.id=f}projectPoint(e,i,o,u){return[360*(e.x+i)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/u)*Math.PI))-90]}projectLine(e,i,o,u){return e.map((f=>this.projectPoint(f,i,o,u)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,i=e.extent*Math.pow(2,this._z),o=e.extent*this._x,u=e.extent*this._y,f=e.loadGeometry();switch(e.type){case 1:{const p=[];for(const x of f)p.push(x[0]);const y=this.projectLine(p,o,u,i);this._geometry=p.length===1?{type:"Point",coordinates:y[0]}:{type:"MultiPoint",coordinates:y};break}case 2:{const p=f.map((y=>this.projectLine(y,o,u,i)));this._geometry=p.length===1?{type:"LineString",coordinates:p[0]}:{type:"MultiLineString",coordinates:p};break}case 3:{const p=vm(f),y=[];for(const x of p)y.push(x.map((T=>this.projectLine(T,o,u,i))));this._geometry=y.length===1?{type:"Polygon",coordinates:y[0]}:{type:"MultiPolygon",coordinates:y};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&i!=="_x"&&i!=="_y"&&i!=="_z"&&(e[i]=this[i]);return e}}class tu{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,i,o){this._name=e,this.dataBuffer=i,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class Md extends tu{}class Ed extends Md{getValueFromBuffer(e){return this.dataBuffer[e]}}class Cp extends Md{getValueFromBuffer(e){return this.dataBuffer[e]}}class zp extends tu{delta;constructor(e,i,o,u){super(e,i,u),this.delta=o}}class Dp extends zp{constructor(e,i,o,u){super(e,Int32Array.of(i),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Pp extends tu{constructor(e,i,o){super(e,Int32Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}class iu{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,i,o,u,f=4096){this._name=e,this._geometryVector=i,this._idVector=o,this._propertyVectors=u,this._extent=f}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((i=>[i.name,i])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let i=0;for(;i<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(i)):this.idVector.getValue(i));const u=e?.next().value,f={};for(const p of this.propertyVectors){if(!p)continue;const y=p.name,x=p.getValue(i);x!==null&&(f[y]=x)}i++,yield{id:o,geometry:u,properties:f}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],i=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let u;this.idVector&&(u=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const f={coordinates:i[o],type:this.geometryVector.geometryType(o)},p={};for(const y of this.propertyVectors){if(!y)continue;const x=y.name,T=y.getValue(o);T!==null&&(p[x]=T)}e.push({id:u,geometry:f,properties:p})}return e}containsMaxSaveIntegerValues(e){return e instanceof Ed||e instanceof Pp&&e instanceof Dp||e instanceof Cp}}class Um{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var Jt,Ys,wa,Qs,nu,qa,Nn,ra,Wr,dr;function sa(n,e,i){const o=new Int32Array(i);let u=0,f=e.get();for(let p=0;p<o.length;p++){let y=n[f++],x=127&y;y<128||(y=n[f++],x|=(127&y)<<7,y<128||(y=n[f++],x|=(127&y)<<14,y<128||(y=n[f++],x|=(127&y)<<21,y<128||(y=n[f++],x|=(15&y)<<28)))),o[u++]=x}return e.set(f),o}function tf(n,e,i){const o=new BigInt64Array(i);for(let u=0;u<o.length;u++)o[u]=Ad(n,e);return o}function Gm(n,e){let i,o;return o=n[e.get()],e.increment(),i=127&o,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<7,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<14,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<21,o<128?i:(o=n[e.get()],i|=(15&o)<<28,(function(u,f,p){let y,x;if(x=f[p.get()],p.increment(),y=(112&x)>>4,x<128||(x=f[p.get()],p.increment(),y|=(127&x)<<3,x<128)||(x=f[p.get()],p.increment(),y|=(127&x)<<10,x<128)||(x=f[p.get()],p.increment(),y|=(127&x)<<17,x<128)||(x=f[p.get()],p.increment(),y|=(127&x)<<24,x<128)||(x=f[p.get()],p.increment(),y|=(1&x)<<31,x<128))return 4294967296*y+(u>>>0);throw new Error("Expected varint not more than 10 bytes")})(i,n,e)))))}function ih(n,e,i,o){throw new Error("FastPFor is not implemented yet.")}function Ta(n){return n>>>1^-(1&n)}function nc(n){return n>>1n^-(1n&n)}function Ad(n,e){let i=0n,o=0,u=e.get();for(;u<n.length;){const f=n[u++];if(i|=BigInt(127&f)<<BigInt(o),!(128&f))break;if(o+=7,o>=64)throw new Error("Varint too long")}return e.set(u),i}function Ao(n,e,i){const o=new Int32Array(i);let u=0;for(let f=0;f<e;f++){const p=n[f];o.fill(n[f+e],u,u+p),u+=p}return o}function qm(n,e,i){const o=new BigInt64Array(i);let u=0;for(let f=0;f<e;f++){const p=Number(n[f]);o.fill(n[f+e],u,u+p),u+=p}return o}function Zm(n,e,i){const o=new Float64Array(i);let u=0;for(let f=0;f<e;f++){const p=n[f];o.fill(n[f+e],u,u+p),u+=p}return o}function au(n){const e=n.length/4*4;let i=1;if(e>=4)for(let o=n[0];i<e-4;i+=4)o=n[i]+=o,o=n[i+1]+=o,o=n[i+2]+=o,o=n[i+3]+=o;for(;i!=n.length;)n[i]+=n[i-1],++i}function Ip(n){n[0]=n[0]>>>1^-(1&n[0]),n[1]=n[1]>>>1^-(1&n[1]);const e=n.length/4*4;let i=2;if(e>=4)for(;i<e-4;i+=4){const o=n[i],u=n[i+1],f=n[i+2],p=n[i+3];n[i]=(o>>>1^-(1&o))+n[i-2],n[i+1]=(u>>>1^-(1&u))+n[i-1],n[i+2]=(f>>>1^-(1&f))+n[i],n[i+3]=(p>>>1^-(1&p))+n[i+1]}for(;i!=n.length;i+=2)n[i]=(n[i]>>>1^-(1&n[i]))+n[i-2],n[i+1]=(n[i+1]>>>1^-(1&n[i+1]))+n[i-1]}(function(n){n.NONE="NONE",n.DELTA="DELTA",n.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",n.RLE="RLE",n.MORTON="MORTON",n.PDE="PDE"})(Jt||(Jt={})),(function(n){n.NONE="NONE",n.FAST_PFOR="FAST_PFOR",n.VARINT="VARINT",n.ALP="ALP"})(Ys||(Ys={})),(function(n){n.PRESENT="PRESENT",n.DATA="DATA",n.OFFSET="OFFSET",n.LENGTH="LENGTH"})(wa||(wa={}));class Rp{_dictionaryType;_offsetType;_lengthType;constructor(e,i,o){this._dictionaryType=e,this._offsetType=i,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Za(n,e){const i=(function(o,u){const f=o[u.get()],p=Object.values(wa)[f>>4];let y=null;switch(p){case wa.DATA:y=new Rp(Object.values(Qs)[15&f]);break;case wa.OFFSET:y=new Rp(null,Object.values(nu)[15&f]);break;case wa.LENGTH:y=new Rp(null,null,Object.values(qa)[15&f])}u.increment();const x=o[u.get()],T=Object.values(Jt)[x>>5],E=Object.values(Jt)[x>>2&7],C=Object.values(Ys)[3&x];u.increment();const D=sa(o,u,2),P=D[0];return{physicalStreamType:p,logicalStreamType:y,logicalLevelTechnique1:T,logicalLevelTechnique2:E,physicalLevelTechnique:C,numValues:P,byteLength:D[1],decompressedCount:P}})(n,e);return i.logicalLevelTechnique1===Jt.MORTON?(function(o,u,f){const p=sa(u,f,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:o.decompressedCount,numBits:p[0],coordinateShift:p[1]}})(i,n,e):Jt.RLE!==i.logicalLevelTechnique1&&Jt.RLE!==i.logicalLevelTechnique2||Ys.NONE===i.physicalLevelTechnique?i:(function(o,u,f){const p=sa(u,f,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:p[1],runs:p[0],numRleValues:p[1]}})(i,n,e)}(function(n){n.NONE="NONE",n.SINGLE="SINGLE",n.SHARED="SHARED",n.VERTEX="VERTEX",n.MORTON="MORTON",n.FSST="FSST"})(Qs||(Qs={})),(function(n){n.VERTEX="VERTEX",n.INDEX="INDEX",n.STRING="STRING",n.KEY="KEY"})(nu||(nu={})),(function(n){n.VAR_BINARY="VAR_BINARY",n.GEOMETRIES="GEOMETRIES",n.PARTS="PARTS",n.RINGS="RINGS",n.TRIANGLES="TRIANGLES",n.SYMBOL="SYMBOL",n.DICTIONARY="DICTIONARY"})(qa||(qa={})),(function(n){n[n.FLAT=0]="FLAT",n[n.CONST=1]="CONST",n[n.SEQUENCE=2]="SEQUENCE",n[n.DICTIONARY=3]="DICTIONARY",n[n.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Nn||(Nn={}));class Ws{values;_size;constructor(e,i){this.values=e,this._size=i}get(e){const i=Math.floor(e/8);return(this.values[i]>>e%8&1)==1}set(e,i){const o=Math.floor(e/8);this.values[o]=this.values[o]|(i?1:0)<<e%8}getInt(e){const i=Math.floor(e/8);return this.values[i]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Ha(n,e,i,o,u){return(function(f,p,y){switch(p.logicalLevelTechnique1){case Jt.DELTA:return p.logicalLevelTechnique2===Jt.RLE?(function(x,T,E){const C=new Int32Array(E);let D=0,P=0;for(let B=0;B<T;B++){const k=x[B],N=Ta(x[B+T]);for(let G=0;G<k;G++)P+=N,C[D++]=P}return C})(f,p.runs,p.numRleValues):((function(x){x[0]=x[0]>>>1^-(1&x[0]);const T=x.length/4*4;let E=1;if(T>=4)for(;E<T-4;E+=4){const C=x[E],D=x[E+1],P=x[E+2],B=x[E+3];x[E]=(C>>>1^-(1&C))+x[E-1],x[E+1]=(D>>>1^-(1&D))+x[E],x[E+2]=(P>>>1^-(1&P))+x[E+1],x[E+3]=(B>>>1^-(1&B))+x[E+2]}for(;E!=x.length;++E)x[E]=(x[E]>>>1^-(1&x[E]))+x[E-1]})(f),f);case Jt.RLE:return(function(x,T,E){return E?(function(C,D,P){const B=new Int32Array(P);let k=0;for(let N=0;N<D;N++){const G=C[N];let ee=C[N+D];ee=ee>>>1^-(1&ee),B.fill(ee,k,k+G),k+=G}return B})(x,T.runs,T.numRleValues):Ao(x,T.runs,T.numRleValues)})(f,p,y);case Jt.MORTON:return au(f),f;case Jt.COMPONENTWISE_DELTA:return Ip(f),f;case Jt.NONE:return y&&(function(x){for(let T=0;T<x.length;T++){const E=x[T];x[T]=E>>>1^-(1&E)}})(f),f;default:throw new Error(`The specified Logical level technique is not supported: ${p.logicalLevelTechnique1}`)}})(Cd(n,e,i),i,o)}function ru(n,e,i){return(function(o,u){if(u.logicalLevelTechnique1===Jt.DELTA&&u.logicalLevelTechnique2===Jt.NONE)return(function(p){const y=new Int32Array(p.length+1);y[0]=0,y[1]=Ta(p[0]);let x=y[1],T=2;for(;T!=y.length;++T){const E=p[T-1];x+=E>>>1^-(1&E),y[T]=y[T-1]+x}return y})(o);if(u.logicalLevelTechnique1===Jt.RLE&&u.logicalLevelTechnique2===Jt.NONE)return(function(p,y,x){const T=new Int32Array(x+1);T[0]=0;let E=1,C=T[0];for(let D=0;D<y;D++){const P=p[D],B=p[D+y];for(let k=E;k<E+P;k++)T[k]=B+C,C=T[k];E+=P}return T})(o,u.runs,u.numRleValues);if(u.logicalLevelTechnique1===Jt.NONE&&u.logicalLevelTechnique2===Jt.NONE){(function(p){let y=0;for(let x=0;x<p.length;x++)p[x]+=y,y=p[x]})(o);const f=new Int32Array(u.numValues+1);return f[0]=0,f.set(o,1),f}if(u.logicalLevelTechnique1===Jt.DELTA&&u.logicalLevelTechnique2===Jt.RLE){const f=(function(p,y,x){const T=new Int32Array(x+1);T[0]=0;let E=1,C=T[0];for(let D=0;D<y;D++){const P=p[D];let B=p[D+y];B=B>>>1^-(1&B);for(let k=E;k<E+P;k++)T[k]=B+C,C=T[k];E+=P}return T})(o,u.runs,u.numRleValues);return au(f),f}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(Cd(n,e,i),i)}function Cd(n,e,i){const o=i.physicalLevelTechnique;if(o===Ys.FAST_PFOR)return ih();if(o===Ys.VARINT)return sa(n,e,i.numValues);if(o===Ys.NONE){const u=e.get();e.add(i.byteLength);const f=n.subarray(u,e.get());return new Int32Array(f)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Lp(n,e,i,o){const u=Cd(n,e,i);if(u.length===1){const f=u[0];return o?Ta(f):f}return o?(function(f){return Ta(f[1])})(u):(function(f){return f[1]})(u)}function Bp(n,e,i){return(function(o){if(o.length==2){const u=Ta(o[1]);return[u,u]}return[Ta(o[2]),Ta(o[3])]})(Cd(n,e,i))}function ac(n,e,i){return(function(o){if(o.length==2){const u=nc(o[1]);return[u,u]}return[nc(o[2]),nc(o[3])]})(tf(n,e,i.numValues))}function nh(n,e,i,o){return(function(u,f,p){switch(f.logicalLevelTechnique1){case Jt.DELTA:return f.logicalLevelTechnique2===Jt.RLE?(function(y,x,T){const E=new BigInt64Array(T);let C=0,D=0n;for(let P=0;P<x;P++){const B=Number(y[P]),k=nc(y[P+x]);for(let N=0;N<B;N++)D+=k,E[C++]=D}return E})(u,f.runs,f.numRleValues):((function(y){y[0]=y[0]>>1n^-(1n&y[0]);const x=y.length/4*4;let T=1;if(x>=4)for(;T<x-4;T+=4){const E=y[T],C=y[T+1],D=y[T+2],P=y[T+3];y[T]=(E>>1n^-(1n&E))+y[T-1],y[T+1]=(C>>1n^-(1n&C))+y[T],y[T+2]=(D>>1n^-(1n&D))+y[T+1],y[T+3]=(P>>1n^-(1n&P))+y[T+2]}for(;T!=y.length;++T)y[T]=(y[T]>>1n^-(1n&y[T]))+y[T-1]})(u),u);case Jt.RLE:return(function(y,x,T){return T?(function(E,C,D){const P=new BigInt64Array(D);let B=0;for(let k=0;k<C;k++){const N=Number(E[k]);let G=E[k+C];G=G>>1n^-(1n&G),P.fill(G,B,B+N),B+=N}return P})(y,x.runs,x.numRleValues):qm(y,x.runs,x.numRleValues)})(u,f,p);case Jt.NONE:return p&&(function(y){for(let x=0;x<y.length;x++){const T=y[x];y[x]=T>>1n^-(1n&T)}})(u),u;default:throw new Error(`The specified Logical level technique is not supported: ${f.logicalLevelTechnique1}`)}})(tf(n,e,i.numValues),i,o)}function Op(n,e,i,o){const u=tf(n,e,i.numValues);if(u.length===1){const f=u[0];return o?nc(f):f}return o?(function(f){return nc(f[1])})(u):(function(f){return f[1]})(u)}function kp(n,e,i,o,u){return(function(f,p,y,x){switch(p.logicalLevelTechnique1){case Jt.DELTA:return p.logicalLevelTechnique2===Jt.RLE&&(f=Ao(f,p.runs,p.numRleValues)),(function(T,E){const C=new Int32Array(T.size());let D=0;T.get(0)?(C[0]=T.get(0)?E[0]>>>1^-(1&E[0]):0,D=1):C[0]=0;let P=1;for(;P!=C.length;++P)C[P]=T.get(P)?C[P-1]+(E[D]>>>1^-(1&E[D++])):C[P-1];return C})(x,f);case Jt.RLE:return(function(T,E,C,D){const P=E;return C?(function(B,k,N){const G=new Int32Array(B.size());let ee=0;for(let q=0;q<N;q++){const X=k[q];let ne=k[q+N];ne=ne>>>1^-(1&ne);for(let se=ee;se<ee+X;se++)B.get(se)?G[se]=ne:(G[se]=0,ee++);ee+=X}return G})(D,T,P.runs):(function(B,k,N){const G=new Int32Array(B.size());let ee=0;for(let q=0;q<N;q++){const X=k[q],ne=k[q+N];for(let se=ee;se<ee+X;se++)B.get(se)?G[se]=ne:(G[se]=0,ee++);ee+=X}return G})(D,T,P.runs)})(f,p,y,x);case Jt.MORTON:return au(f),f;case Jt.COMPONENTWISE_DELTA:return Ip(f),f;case Jt.NONE:return f=y?(function(T,E){const C=new Int32Array(T.size());let D=0,P=0;for(;P!=C.length;++P)if(T.get(P)){const B=E[D++];C[P]=B>>>1^-(1&B)}else C[P]=0;return C})(x,f):(function(T,E){const C=new Int32Array(T.size());let D=0,P=0;for(;P!=C.length;++P)C[P]=T.get(P)?E[D++]:0;return C})(x,f),f;default:throw new Error("The specified Logical level technique is not supported")}})(i.physicalLevelTechnique===Ys.FAST_PFOR?ih():sa(n,e,i.numValues),i,o,u)}function dl(n,e,i,o){const u=n.logicalLevelTechnique1;if(u===Jt.RLE)return n.runs===1?Nn.CONST:Nn.FLAT;const f=e instanceof Ws?e.size():e;if(u===Jt.DELTA&&n.logicalLevelTechnique2===Jt.RLE){const p=n.runs,y=2;if(n.numRleValues!==f)return Nn.FLAT;if(p===1)return Nn.SEQUENCE;if(p===2){const x=o.get();let T;if(n.physicalLevelTechnique===Ys.VARINT)T=sa(i,o,4);else{const E=o.get();T=new Int32Array(i.buffer,i.byteOffset+E,4)}if(o.set(x),T[2]===y&&T[3]===y)return Nn.SEQUENCE}}return n.numValues===1?Nn.CONST:Nn.FLAT}class ah extends Md{getValueFromBuffer(e){return this.dataBuffer[e]}}class Fp extends zp{constructor(e,i,o,u){super(e,BigInt64Array.of(i),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class pl{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,i,o){this._geometryOffsets=e,this._partOffsets=i,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function nf(n,e,i){return{x:zd(n,e)-i,y:zd(n>>1,e)-i}}function zd(n,e){let i=0;for(let o=0;o<e;o++)i|=(n&1<<2*o)>>o;return i}(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON",n[n.MULTIPOINT=3]="MULTIPOINT",n[n.MULTILINESTRING=4]="MULTILINESTRING",n[n.MULTIPOLYGON=5]="MULTIPOLYGON"})(ra||(ra={})),(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON"})(Wr||(Wr={})),(function(n){n[n.MORTON=0]="MORTON",n[n.VEC_2=1]="VEC_2",n[n.VEC_3=2]="VEC_3"})(dr||(dr={}));class Dd{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((i=>[i]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,i){return[e].concat(i)}createMultiPolygon(e){return e.flat()}}function Np(n){const e=new Array(n.numGeometries);let i=1,o=1,u=1,f=0;const p=new Dd;let y=0,x=0;const T=n.mortonSettings,E=n.topologyVector,C=E.geometryOffsets,D=E.partOffsets,P=E.ringOffsets,B=n.vertexOffsets,k=n.containsPolygonGeometry(),N=n.vertexBuffer;for(let G=0;G<n.numGeometries;G++){const ee=n.geometryType(G);if(ee===ra.POINT){if(B&&B.length!==0)if(n.vertexBufferType===dr.VEC_2){const q=2*B[x++],X=new ge(N[q],N[q+1]);e[f++]=p.createPoint(X)}else{const q=nf(N[B[x++]],T.numBits,T.coordinateShift),X=new ge(q.x,q.y);e[f++]=p.createPoint(X)}else{const q=new ge(N[y++],N[y++]);e[f++]=p.createPoint(q)}C&&u++,D&&i++,P&&o++}else if(ee===ra.MULTIPOINT){const q=C[u]-C[u-1];u++;const X=new Array(q);if(B&&B.length!==0){for(let ne=0;ne<q;ne++){const se=2*B[x++];X[ne]=new ge(N[se],N[se+1])}e[f++]=p.createMultiPoint(X)}else{for(let ne=0;ne<q;ne++){const se=N[y++],Se=N[y++];X[ne]=new ge(se,Se)}e[f++]=p.createMultiPoint(X)}}else if(ee===ra.LINESTRING){let q,X=0;k?(X=P[o]-P[o-1],o++):X=D[i]-D[i-1],i++,B&&B.length!==0?(q=n.vertexBufferType===dr.VEC_2?sf(N,B,x,X,!1):jp(N,B,x,X,!1,T),x+=X):(q=Vp(N,y,X,!1),y+=2*X),e[f++]=p.createLineString(q),C&&u++}else if(ee===ra.POLYGON){const q=D[i]-D[i-1];i++;const X=new Array(q-1);let ne=P[o]-P[o-1];if(o++,B&&B.length!==0){const se=n.vertexBufferType===dr.VEC_2?Pd(N,B,x,ne):rf(N,B,x,ne,0,T);x+=ne;for(let Se=0;Se<X.length;Se++)ne=P[o]-P[o-1],o++,X[Se]=n.vertexBufferType===dr.VEC_2?Pd(N,B,x,ne):rf(N,B,x,ne,0,T),x+=ne;e[f++]=p.createPolygon(se,X)}else{const se=af(N,y,ne);y+=2*ne;for(let Se=0;Se<X.length;Se++)ne=P[o]-P[o-1],o++,X[Se]=af(N,y,ne),y+=2*ne;e[f++]=p.createPolygon(se,X)}C&&u++}else if(ee===ra.MULTILINESTRING){const q=C[u]-C[u-1];u++;const X=new Array(q);if(B&&B.length!==0){for(let ne=0;ne<q;ne++){let se=0;k?(se=P[o]-P[o-1],o++):se=D[i]-D[i-1],i++;const Se=n.vertexBufferType===dr.VEC_2?sf(N,B,x,se,!1):jp(N,B,x,se,!1,T);X[ne]=Se,x+=se}e[f++]=p.createMultiLineString(X)}else{for(let ne=0;ne<q;ne++){let se=0;k?(se=P[o]-P[o-1],o++):se=D[i]-D[i-1],i++,X[ne]=Vp(N,y,se,!1),y+=2*se}e[f++]=p.createMultiLineString(X)}}else{if(ee!==ra.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const q=C[u]-C[u-1];u++;const X=new Array(q);let ne=0;if(B&&B.length!==0){for(let se=0;se<q;se++){const Se=D[i]-D[i-1];i++;const Ve=new Array(Se-1);ne=P[o]-P[o-1],o++;const Oe=n.vertexBufferType===dr.VEC_2?Pd(N,B,x,ne):rf(N,B,x,ne,0,T);x+=ne;for(let qe=0;qe<Ve.length;qe++)ne=P[o]-P[o-1],o++,Ve[qe]=n.vertexBufferType===dr.VEC_2?Pd(N,B,x,ne):rf(N,B,x,ne,0,T),x+=ne;X[se]=p.createPolygon(Oe,Ve)}e[f++]=p.createMultiPolygon(X)}else{for(let se=0;se<q;se++){const Se=D[i]-D[i-1];i++;const Ve=new Array(Se-1);ne=P[o]-P[o-1],o++;const Oe=af(N,y,ne);y+=2*ne;for(let qe=0;qe<Ve.length;qe++){const rt=P[o]-P[o-1];o++,Ve[qe]=af(N,y,rt),y+=2*rt}X[se]=p.createPolygon(Oe,Ve)}e[f++]=p.createMultiPolygon(X)}}}}return e}function af(n,e,i){return Vp(n,e,i,!0)}function Pd(n,e,i,o){return sf(n,e,i,o,!0)}function rf(n,e,i,o,u,f){return jp(n,e,i,o,!0,f)}function Vp(n,e,i,o){const u=new Array(o?i+1:i);for(let f=0;f<2*i;f+=2)u[f/2]=new ge(n[e+f],n[e+f+1]);return o&&(u[u.length-1]=u[0]),u}function sf(n,e,i,o,u){const f=new Array(u?o+1:o);for(let p=0;p<2*o;p+=2){const y=2*e[i+p/2];f[p/2]=new ge(n[y],n[y+1])}return u&&(f[f.length-1]=f[0]),f}function jp(n,e,i,o,u,f){const p=new Array(u?o+1:o);for(let y=0;y<o;y++){const x=nf(n[e[i+y]],f.numBits,f.coordinateShift);p[y]=new ge(x.x,x.y)}return u&&(p[p.length-1]=p[0]),p}class of{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,i,o,u,f){this._vertexBufferType=e,this._topologyVector=i,this._vertexOffsets=o,this._vertexBuffer=u,this._mortonSettings=f}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Np(this);let i=0;for(;i<this.numGeometries;)yield{coordinates:e[i],type:this.geometryType(i)},i++}getSimpleEncodedVertex(e){const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const o=nf(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getGeometries(){return Np(this)}get mortonSettings(){return this._mortonSettings}}class lf extends of{_numGeometries;_geometryType;constructor(e,i,o,u,f,p,y){super(o,u,f,p,y),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===ra.POLYGON||this._geometryType===ra.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class uf extends of{_geometryTypes;constructor(e,i,o,u,f,p){super(e,o,u,f,p),this._geometryTypes=i}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===ra.POLYGON||this.geometryType(e)===ra.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Hm{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,i,o,u){this._triangleOffsets=e,this._indexBuffer=i,this._vertexBuffer=o,this._topologyVector=u}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),i=this._topologyVector,o=i.partOffsets,u=i.ringOffsets,f=i.geometryOffsets;let p=0,y=1,x=1,T=1;for(let E=0;E<this.numGeometries;E++)switch(this.geometryType(E)){case ra.POLYGON:{const C=o[y]-o[y-1];y++;const D=[];for(let P=0;P<C;P++){const B=u[x]-u[x-1];x++;const k=[];for(let N=0;N<B;N++){const G=this._vertexBuffer[p++],ee=this._vertexBuffer[p++];k.push(new ge(G,ee))}k.length>0&&k.push(k[0]),D.push(k)}e[E]=D,f&&T++}break;case ra.MULTIPOLYGON:{const C=f[T]-f[T-1];T++;const D=[];for(let P=0;P<C;P++){const B=o[y]-o[y-1];y++;for(let k=0;k<B;k++){const N=u[x]-u[x-1];x++;const G=[];for(let ee=0;ee<N;ee++){const q=this._vertexBuffer[p++],X=this._vertexBuffer[p++];G.push(new ge(q,X))}G.length>0&&G.push(G[0]),D.push(G)}}e[E]=D}}return e}[Symbol.iterator](){return null}}function rh(n,e,i,o,u,f){return new Ag(n,e,i,o,u,f)}class Ag extends Hm{_numGeometries;_geometryType;constructor(e,i,o,u,f,p){super(o,u,f,p),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function Up(n,e,i,o,u){return new Xm(n,e,i,o,u)}class Xm extends Hm{_geometryTypes;constructor(e,i,o,u,f){super(i,o,u,f),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function $m(n,e,i,o,u){const f=Za(n,i);let p=null,y=null,x=null,T=null,E=null,C=null,D=null,P=null;if(dl(f,o,n,i)===Nn.CONST){const k=Lp(n,i,f,!1);for(let N=0;N<e-1;N++){const G=Za(n,i);switch(G.physicalStreamType){case wa.LENGTH:switch(G.logicalStreamType.lengthType){case qa.GEOMETRIES:p=ru(n,i,G);break;case qa.PARTS:y=ru(n,i,G);break;case qa.RINGS:x=ru(n,i,G);break;case qa.TRIANGLES:D=ru(n,i,G)}break;case wa.OFFSET:switch(G.logicalStreamType.offsetType){case nu.VERTEX:T=Ha(n,i,G,!1);break;case nu.INDEX:P=Ha(n,i,G,!1)}break;case wa.DATA:Qs.VERTEX===G.logicalStreamType.dictionaryType?E=Ha(n,i,G,!0):(C={numBits:G.numBits,coordinateShift:G.coordinateShift},E=Ha(n,i,G,!1))}}return P!==null?p!=null||y!=null?rh(o,k,D,P,E,new pl(p,y,x)):rh(o,k,D,P,E):C===null?(function(N,G,ee,q,X){return new lf(N,G,dr.VEC_2,ee,q,X)})(o,k,new pl(p,y,x),T,E):(function(N,G,ee,q,X,ne){return new lf(N,G,dr.MORTON,ee,q,X,ne)})(o,k,new pl(p,y,x),T,E,C)}const B=Ha(n,i,f,!1);for(let k=0;k<e-1;k++){const N=Za(n,i);switch(N.physicalStreamType){case wa.LENGTH:switch(N.logicalStreamType.lengthType){case qa.GEOMETRIES:p=Ha(n,i,N,!1);break;case qa.PARTS:y=Ha(n,i,N,!1);break;case qa.RINGS:x=Ha(n,i,N,!1);break;case qa.TRIANGLES:D=ru(n,i,N)}break;case wa.OFFSET:switch(N.logicalStreamType.offsetType){case nu.VERTEX:T=Ha(n,i,N,!1);break;case nu.INDEX:P=Ha(n,i,N,!1)}break;case wa.DATA:Qs.VERTEX===N.logicalStreamType.dictionaryType?E=Ha(n,i,N,!0):(C={numBits:N.numBits,coordinateShift:N.coordinateShift},E=Ha(n,i,N,!1))}}return P!==null&&y===null?Up(B,D,P,E):(p!==null?(p=Id(B,p,2),y!==null&&x!==null?(y=Rd(B,p,y,!1),x=(function(k,N,G,ee){const q=new Int32Array(G[G.length-1]+1);let X=0;q[0]=X;let ne=1,se=1,Se=0;for(let Ve=0;Ve<k.length;Ve++){const Oe=k[Ve],qe=N[Ve+1]-N[Ve];if(Oe!==0&&Oe!==3)for(let rt=0;rt<qe;rt++){const Xe=G[ne]-G[ne-1];ne++;for(let Fe=0;Fe<Xe;Fe++)X=q[se++]=X+ee[Se++]}else for(let rt=0;rt<qe;rt++)q[se++]=++X,ne++}return q})(B,p,y,x)):y!==null&&(y=(function(k,N,G){const ee=new Int32Array(N[N.length-1]+1);let q=0;ee[0]=q;let X=1,ne=0;for(let se=0;se<k.length;se++){const Se=k[se],Ve=N[se+1]-N[se];if(Se===4||Se===1)for(let Oe=0;Oe<Ve;Oe++)q=ee[X++]=q+G[ne++];else for(let Oe=0;Oe<Ve;Oe++)ee[X++]=++q}return ee})(B,p,y))):y!==null&&x!==null?(y=Id(B,y,1),x=Rd(B,y,x,!0)):y!==null&&(y=Id(B,y,0)),P!==null?Up(B,D,P,E,new pl(p,y,x)):C===null?(function(k,N,G,ee){return new uf(dr.VEC_2,k,N,G,ee)})(B,new pl(p,y,x),T,E):(function(k,N,G,ee,q){return new uf(dr.MORTON,k,N,G,ee,q)})(B,new pl(p,y,x),T,E,C))}function Id(n,e,i){const o=new Int32Array(n.length+1);let u=0;o[0]=u;let f=0;for(let p=0;p<n.length;p++)u=o[p+1]=u+(n[p]>i?e[f++]:1);return o}function Rd(n,e,i,o){const u=new Int32Array(e[e.length-1]+1);let f=0;u[0]=f;let p=1,y=0;for(let x=0;x<n.length;x++){const T=n[x],E=e[x+1]-e[x];if(T===5||T===2||o&&(T===4||T===1))for(let C=0;C<E;C++)f=u[p++]=f+i[y++];else for(let C=0;C<E;C++)u[p++]=++f}return u}class Ym extends tu{dataVector;constructor(e,i,o){super(e,i.getBuffer(),o),this.dataVector=i}getValueFromBuffer(e){return this.dataVector.get(e)}}class Qm extends Md{getValueFromBuffer(e){return this.dataBuffer[e]}}class cf extends tu{constructor(e,i,o){super(e,BigInt64Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}function hf(n,e,i){return Wm(n,Math.ceil(e/8),i)}function Wm(n,e,i){const o=new Uint8Array(e);let u=0;for(;u<e;){const f=n[i.increment()];if(f<=127){const p=f+3,y=n[i.increment()],x=u+p;o.fill(y,u,x),u=x}else{const p=256-f;for(let y=0;y<p;y++)o[u++]=n[i.increment()]}}return o}const Gp=new TextDecoder;function ff(n,e,i){return i-e>=12?Gp.decode(n.subarray(e,i)):(function(o,u,f){let p="",y=u;for(;y<f;){const x=o[y];let T,E,C,D=null,P=x>239?4:x>223?3:x>191?2:1;if(y+P>f)break;P===1?x<128&&(D=x):P===2?(T=o[y+1],(192&T)==128&&(D=(31&x)<<6|63&T,D<=127&&(D=null))):P===3?(T=o[y+1],E=o[y+2],(192&T)==128&&(192&E)==128&&(D=(15&x)<<12|(63&T)<<6|63&E,(D<=2047||D>=55296&&D<=57343)&&(D=null))):P===4&&(T=o[y+1],E=o[y+2],C=o[y+3],(192&T)==128&&(192&E)==128&&(192&C)==128&&(D=(15&x)<<18|(63&T)<<12|(63&E)<<6|63&C,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,P=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),y+=P}return p})(n,e,i)}class sh extends tu{offsetBuffer;constructor(e,i,o,u){super(e,o,u),this.offsetBuffer=i}}class Ld extends sh{textEncoder;constructor(e,i,o,u){super(e,i,o,u??i.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return ff(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class rc extends sh{indexBuffer;textEncoder;constructor(e,i,o,u,f){super(e,o,u,f??i.length),this.indexBuffer=i,this.indexBuffer=i,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const i=this.indexBuffer[e];return ff(this.dataBuffer,this.offsetBuffer[i],this.offsetBuffer[i+1])}}class Bd extends sh{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,i,o,u,f,p,y){super(e,o,u,y),this.indexBuffer=i,this.symbolOffsetBuffer=f,this.symbolTableBuffer=p,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(o,u,f){const p=[],y=new Array(u.length).fill(0);for(let x=1;x<u.length;x++)y[x]=y[x-1]+u[x-1];for(let x=0;x<f.length;x++)if(f[x]===255)p.push(f[++x]);else{const T=u[f[x]],E=y[f[x]];for(let C=0;C<T;C++)p.push(o[E+C])}return new Uint8Array(p)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const i=this.indexBuffer[e];return ff(this.decodedDictionary,this.offsetBuffer[i],this.offsetBuffer[i+1])}offsetToLengthBuffer(e){const i=new Uint32Array(e.length-1);let o=e[0];for(let u=1;u<e.length;u++){const f=e[u];i[u-1]=f-o,o=f}return i}}function su(n,e,i,o,u,f){return i.type==="scalarType"?(function(p,y,x,T,E,C){let D=null,P=0;if(p===0)return null;if(C.nullable){const k=Za(y,x);P=k.numValues;const N=x.get(),G=hf(y,P,x);x.set(N+k.byteLength),D=new Ws(G,k.numValues)}const B=D??T;switch(E.physicalType){case 4:case 3:return(function(k,N,G,ee,q){const X=Za(k,N),ne=dl(X,q,k,N),se=ee.physicalType===3;if(ne===Nn.FLAT){const Se=Cs(q)?kp(k,N,X,se,q):Ha(k,N,X,se);return new Ed(G.name,Se,q)}if(ne===Nn.SEQUENCE){const Se=Bp(k,N,X);return new Dp(G.name,Se[0],Se[1],X.numRleValues)}{const Se=Lp(k,N,X,se);return new Pp(G.name,Se,q)}})(y,x,C,E,B);case 9:return(function(k,N,G,ee,q){let X=null,ne=null,se=null,Se=null,Ve=null,Oe=null,qe=null,rt=null;for(let Xe=0;Xe<ee;Xe++){const Fe=Za(N,G);if(Fe.byteLength!==0)switch(Fe.physicalStreamType){case wa.PRESENT:{const Pe=hf(N,Fe.numValues,G);Oe=new Ws(Pe,Fe.numValues);break}case wa.OFFSET:ne=q!=null||Oe!=null?kp(N,G,Fe,!1,q??Oe):Ha(N,G,Fe,!1);break;case wa.LENGTH:{const Pe=ru(N,G,Fe);qa.DICTIONARY===Fe.logicalStreamType.lengthType?X=Pe:qa.SYMBOL===Fe.logicalStreamType.lengthType?Se=Pe:qe=Pe;break}case wa.DATA:{const Pe=N.subarray(G.get(),G.get()+Fe.byteLength);G.add(Fe.byteLength);const dt=Fe.logicalStreamType.dictionaryType;Qs.FSST===dt?Ve=Pe:Qs.SINGLE===dt||Qs.SHARED===dt?se=Pe:Qs.NONE===dt&&(rt=Pe);break}}}return(function(Xe,Fe,Pe,dt,ut,gt,st){return Fe?new Bd(Xe,Pe,dt,ut,gt,Fe,st):null})(k,Ve,ne,X,se,Se,q??Oe)??(function(Xe,Fe,Pe,dt,ut){return Fe?ut?new rc(Xe,Pe,dt,Fe,ut):new rc(Xe,Pe,dt,Fe):null})(k,se,ne,X,q??Oe)??(function(Xe,Fe,Pe,dt,ut){if(!Fe||!Pe)return null;if(dt)return ut?new rc(Xe,dt,Fe,Pe,ut):new rc(Xe,dt,Fe,Pe);if(ut&&ut.size()!==Fe.length-1){const gt=new Int32Array(ut.size());let st=0;for(let Tt=0;Tt<ut.size();Tt++)gt[Tt]=ut.get(Tt)?st++:0;return new rc(Xe,gt,Fe,Pe,ut)}return ut?new Ld(Xe,Fe,Pe,ut):new Ld(Xe,Fe,Pe)})(k,qe,rt,ne,q??Oe)})(C.name,y,x,C.nullable?p-1:p,D);case 0:return(function(k,N,G,ee,q){const X=Za(k,N),ne=X.numValues,se=N.get(),Se=Cs(q)?(function(Oe,qe,rt,Xe){const Fe=Wm(Oe,Math.ceil(qe/8),rt),Pe=new Ws(Fe,qe),dt=Xe.size(),ut=new Ws(new Uint8Array(dt),dt);let gt=0;for(let st=0;st<Xe.size();st++){const Tt=!!Xe.get(st)&&Pe.get(gt++);ut.set(st,Tt)}return ut.getBuffer()})(k,ne,N,q):hf(k,ne,N);N.set(se+X.byteLength);const Ve=new Ws(Se,ne);return new Ym(G.name,Ve,q)})(y,x,C,0,B);case 6:case 5:return(function(k,N,G,ee,q){const X=Za(k,N),ne=dl(X,ee,k,N),se=q.physicalType===5;if(ne===Nn.FLAT){const Se=Cs(ee)?(function(Ve,Oe,qe,rt,Xe){return(function(Fe,Pe,dt,ut){switch(Pe.logicalLevelTechnique1){case Jt.DELTA:return Pe.logicalLevelTechnique2===Jt.RLE&&(Fe=qm(Fe,Pe.runs,Pe.numRleValues)),(function(gt,st){const Tt=new BigInt64Array(gt.size());let vi=0;gt.get(0)?(Tt[0]=gt.get(0)?st[0]>>1n^-(1n&st[0]):0n,vi=1):Tt[0]=0n;let ai=1;for(;ai!=Tt.length;++ai)Tt[ai]=gt.get(ai)?Tt[ai-1]+(st[vi]>>1n^-(1n&st[vi++])):Tt[ai-1];return Tt})(ut,Fe);case Jt.RLE:return(function(gt,st,Tt,vi){const ai=st;return Tt?(function(vn,Xa,oa){const xn=new BigInt64Array(vn.size());let hn=0;for(let Di=0;Di<oa;Di++){const Ln=Number(Xa[Di]);let Vn=Xa[Di+oa];Vn=Vn>>1n^-(1n&Vn);for(let on=hn;on<hn+Ln;on++)vn.get(on)?xn[on]=Vn:(xn[on]=0n,hn++);hn+=Ln}return xn})(vi,gt,ai.runs):(function(vn,Xa,oa){const xn=new BigInt64Array(vn.size());let hn=0;for(let Di=0;Di<oa;Di++){const Ln=Number(Xa[Di]),Vn=Xa[Di+oa];for(let on=hn;on<hn+Ln;on++)vn.get(on)?xn[on]=Vn:(xn[on]=0n,hn++);hn+=Ln}return xn})(vi,gt,ai.runs)})(Fe,Pe,dt,ut);case Jt.NONE:return Fe=dt?(function(gt,st){const Tt=new BigInt64Array(gt.size());let vi=0,ai=0;for(;ai!=Tt.length;++ai)if(gt.get(ai)){const vn=st[vi++];Tt[ai]=vn>>1n^-(1n&vn)}else Tt[ai]=0n;return Tt})(ut,Fe):(function(gt,st){const Tt=new BigInt64Array(gt.size());let vi=0,ai=0;for(;ai!=Tt.length;++ai)Tt[ai]=gt.get(ai)?st[vi++]:0n;return Tt})(ut,Fe),Fe;default:throw new Error("The specified Logical level technique is not supported")}})(tf(Ve,Oe,qe.numValues),qe,rt,Xe)})(k,N,X,se,ee):nh(k,N,X,se);return new ah(G.name,Se,ee)}if(ne===Nn.SEQUENCE){const Se=ac(k,N,X);return new Fp(G.name,Se[0],Se[1],X.numRleValues)}{const Se=Op(k,N,X,se);return new cf(G.name,Se,ee)}})(y,x,C,B,E);case 7:return(function(k,N,G,ee){const q=Za(k,N),X=Cs(ee)?(function(ne,se,Se,Ve){const Oe=se.get(),qe=Oe+Ve*Float32Array.BYTES_PER_ELEMENT,rt=new Uint8Array(ne.subarray(Oe,qe)).buffer,Xe=new Float32Array(rt);se.set(qe);const Fe=Se.size(),Pe=new Float32Array(Fe);let dt=0;for(let ut=0;ut<Fe;ut++)Pe[ut]=Se.get(ut)?Xe[dt++]:0;return Pe})(k,N,ee,q.numValues):(function(ne,se,Se){const Ve=se.get(),Oe=Ve+Se*Float32Array.BYTES_PER_ELEMENT,qe=new Uint8Array(ne.subarray(Ve,Oe)).buffer,rt=new Float32Array(qe);return se.set(Oe),rt})(k,N,q.numValues);return new Qm(G.name,X,ee)})(y,x,C,B);case 8:return(function(k,N,G,ee){const q=Za(k,N),X=Cs(ee)?(function(ne,se,Se,Ve){const Oe=se.get(),qe=Oe+Ve*Float64Array.BYTES_PER_ELEMENT,rt=new Uint8Array(ne.subarray(Oe,qe)).buffer,Xe=new Float64Array(rt);se.set(qe);const Fe=Se.size(),Pe=new Float64Array(Fe);let dt=0;for(let ut=0;ut<Fe;ut++)Pe[ut]=Se.get(ut)?Xe[dt++]:0;return Pe})(k,N,ee,q.numValues):(function(ne,se,Se){const Ve=se.get(),Oe=Ve+Se*Float64Array.BYTES_PER_ELEMENT,qe=new Uint8Array(ne.subarray(Ve,Oe)).buffer,rt=new Float64Array(qe);return se.set(Oe),rt})(k,N,q.numValues);return new Cp(G.name,X,ee)})(y,x,C,B);default:throw new Error(`The specified data type for the field is currently not supported: ${E}`)}})(o,n,e,u,i.scalarType,i):o!=1?null:(function(p,y,x,T){let E=null,C=null,D=null,P=null,B=!1;for(;!B;){const ee=Za(p,y);switch(ee.physicalStreamType){case wa.LENGTH:qa.DICTIONARY===ee.logicalStreamType.lengthType?E=ru(p,y,ee):D=ru(p,y,ee);break;case wa.DATA:Qs.SINGLE===ee.logicalStreamType.dictionaryType||Qs.SHARED===ee.logicalStreamType.dictionaryType?(C=p.subarray(y.get(),y.get()+ee.byteLength),B=!0):P=p.subarray(y.get(),y.get()+ee.byteLength),y.add(ee.byteLength)}}const k=x.complexType.children,N=[];let G=0;for(const ee of k){const q=sa(p,y,1)[0];if(q==0)continue;const X=`${x.name}${ee.name==="default"?"":":"+ee.name}`;if(q!==2||ee.type!=="scalarField"||ee.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const ne=Za(p,y),se=hf(p,ne.numValues,y),Se=Za(p,y),Ve=Se.decompressedCount!==T?kp(p,y,Se,!1,new Ws(se,ne.numValues)):Ha(p,y,Se,!1);N[G++]=P?new Bd(X,Ve,E,C,D,P,new Ws(se,ne.numValues)):new rc(X,Ve,E,C,new Ws(se,ne.numValues))}return N})(n,e,i,u)}function Cs(n){return n instanceof Ws}function ou(n){if(n.name==="id")return!1;if(n.type==="scalarType"){const e=n.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(n.type==="complexType"){const e=n.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",n),!1}const df=new TextDecoder;function oh(n,e){const i=sa(n,e,1)[0];if(i===0)return"";const o=e.get(),u=n.subarray(o,o+i);return e.add(i),df.decode(u)}function ml(n,e){const i=sa(n,e,1)[0]>>>0,o=!!(4&i),u=!!(2&i),f=sa(n,e,1)[0]>>>0,p={};if(1&i&&(p.nullable=!0),u){const y={};if(o?(y.type="logicalType",y.logicalType=f):(y.type="physicalType",y.physicalType=f),8&i){const x=sa(n,e,1)[0]>>>0;y.children=new Array(x);for(let T=0;T<x;T++)y.children[T]=ml(n,e)}p.type="complexField",p.complexField=y}else{const y={};o?(y.type="logicalType",y.logicalType=f):(y.type="physicalType",y.physicalType=f),p.type="scalarField",p.scalarField=y}return p}function Cg(n,e){const i=sa(n,e,1)[0]>>>0,o=(function(u){switch(u){case 0:case 1:case 2:case 3:{const f={};f.nullable=!!(1&u),f.columnScope=0;const p={};return p.physicalType=u>1?6:4,p.type="physicalType",f.scalarType=p,f.type="scalarType",f}case 4:{const f={nullable:!1,columnScope:0},p={type:"physicalType",physicalType:0};return f.type="complexType",f.complexType=p,f}case 30:{const f={nullable:!1,columnScope:0},p={type:"physicalType",physicalType:1};return f.type="complexType",f.complexType=p,f}default:return(function(f){let p=null;switch(f){case 10:case 11:p=0;break;case 12:case 13:p=1;break;case 14:case 15:p=2;break;case 16:case 17:p=3;break;case 18:case 19:p=4;break;case 20:case 21:p=5;break;case 22:case 23:p=6;break;case 24:case 25:p=7;break;case 26:case 27:p=8;break;case 28:case 29:p=9;break;default:return null}const y={};y.nullable=!!(1&f),y.columnScope=0;const x={type:"physicalType"};return x.physicalType=p,y.type="scalarType",y.scalarType=x,y})(u)}})(i);if(!o)throw new Error(`Unsupported column type code: ${i}`);if((function(u){return u>=10})(i)?o.name=oh(n,e):i>=0&&i<=3?o.name="id":i===4&&(o.name="geometry"),(function(u){return u===30})(i)){const u=sa(n,e,1)[0]>>>0,f=o.complexType;f.children=new Array(u);for(let p=0;p<u;p++)f.children[p]=ml(n,e)}return o}function Km(n,e){const i={featureTables:[]},o={};o.name=oh(n,e);const u=sa(n,e,1)[0]>>>0,f=sa(n,e,1)[0]>>>0;o.columns=new Array(f);for(let p=0;p<f;p++)o.columns[p]=Cg(n,e);return i.featureTables.push(o),[i,u]}function pf(n,e,i,o,u,f,p=!1){const y=e.scalarType.physicalType,x=dl(u,f,n,i);if(y===4)switch(x){case Nn.FLAT:{const T=Ha(n,i,u,!1);return new Ed(o,T,f)}case Nn.SEQUENCE:{const T=Bp(n,i,u);return new Dp(o,T[0],T[1],u.numRleValues)}case Nn.CONST:{const T=Lp(n,i,u,!1);return new Pp(o,T,f)}}else switch(x){case Nn.FLAT:{if(p){const E=(function(C,D,P,B){const k=(function(N,G,ee){const q=new Float64Array(G);for(let X=0;X<G;X++)q[X]=Gm(N,ee);return q})(C,P.numValues,D);return(function(N,G,ee){switch(G.logicalLevelTechnique1){case Jt.DELTA:return G.logicalLevelTechnique2===Jt.RLE&&(N=Zm(N,G.runs,G.numRleValues)),(function(q){q[0]=q[0]%2==1?(q[0]+1)/-2:q[0]/2;const X=q.length/4*4;let ne=1;if(X>=4)for(;ne<X-4;ne+=4){const se=q[ne],Se=q[ne+1],Ve=q[ne+2],Oe=q[ne+3];q[ne]=(se%2==1?(se+1)/-2:se/2)+q[ne-1],q[ne+1]=(Se%2==1?(Se+1)/-2:Se/2)+q[ne],q[ne+2]=(Ve%2==1?(Ve+1)/-2:Ve/2)+q[ne+1],q[ne+3]=(Oe%2==1?(Oe+1)/-2:Oe/2)+q[ne+2]}for(;ne!=q.length;++ne)q[ne]=(q[ne]%2==1?(q[ne]+1)/-2:q[ne]/2)+q[ne-1]})(N),N;case Jt.RLE:return(function(q,X,ne){return Zm(q,X.runs,X.numRleValues)})(N,G);case Jt.NONE:return N;default:throw new Error(`The specified Logical level technique is not supported: ${G.logicalLevelTechnique1}`)}})(k,P)})(n,i,u);return new Cp(o,E,f)}const T=nh(n,i,u,!1);return new ah(o,T,f)}case Nn.SEQUENCE:{const T=ac(n,i,u);return new Fp(o,T[0],T[1],u.numRleValues)}case Nn.CONST:{const T=Op(n,i,u,!1);return new cf(o,T,f)}}throw new Error("Vector type not supported for id column.")}class zg{constructor(e,i){var o;switch(this._featureData=e,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case ra.POINT:case ra.MULTIPOINT:this.type=1;break;case ra.LINESTRING:case ra.MULTILINESTRING:this.type=2;break;case ra.POLYGON:case ra.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=i,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const i of this._featureData.geometry.coordinates){const o=[];for(const u of i)o.push(new ge(u.x,u.y));e.push(o)}return e}}class Jm{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new zg(this.features[e],this.extent)}}class mf{constructor(e){this.layers={};const i=(function(o,u,f=!0){const p=new Um(0),y=[];for(;p.get()<o.length;){const x=sa(o,p,1)[0]>>>0,T=p.get()+x;if(T>o.length)throw new Error(`Block overruns tile: ${T} > ${o.length}`);if(sa(o,p,1)[0]>>>0!=1){p.set(T);continue}const E=Km(o,p),C=E[1],D=E[0].featureTables[0];let P=null,B=null;const k=[];let N=0;for(const ee of D.columns){const q=ee.name;if(q==="id"){let X=null;if(ee.nullable){const se=Za(o,p),Se=p.get(),Ve=hf(o,se.numValues,p);p.set(Se+se.byteLength),X=new Ws(Ve,se.numValues)}const ne=Za(o,p);N=ne.decompressedCount,P=pf(o,ee,p,q,ne,X??N,f)}else if(q==="geometry"){const X=sa(o,p,1)[0];if(N===0){const ne=p.get();N=Za(o,p).decompressedCount,p.set(ne)}B=$m(o,X,p,N)}else{const X=ou(ee)?sa(o,p,1)[0]:1;if(X===0&&ee.type==="scalarType")continue;const ne=su(o,p,ee,X,N);if(ne)if(Array.isArray(ne))for(const se of ne)k.push(se);else k.push(ne)}}const G=new iu(D.name,B,P,k,C);y.push(G),p.set(T)}return y})(new Uint8Array(e));this.layers=i.reduce(((o,u)=>Object.assign(Object.assign({},o),{[u.name]:new Jm(u)})),{})}}class eg{constructor(e,i){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=i,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],i=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const o of i){const u=[];for(const f of o)u.push(new ge(f[0],f[1]));e.push(u)}return e}}const gf="_geojsonTileLayer";function Od(n,e){e.writeVarintField(15,n.version||1),e.writeStringField(1,n.name||""),e.writeVarintField(5,n.extent||4096);const i={keys:[],values:[],keycache:{},valuecache:{}};for(let f=0;f<n.length;f++)i.feature=n.feature(f),e.writeMessage(2,kd,i);const o=i.keys;for(const f of o)e.writeStringField(3,f);const u=i.values;for(const f of u)e.writeMessage(4,Fd,f)}function kd(n,e){if(!n.feature)return;const i=n.feature;i.id!==void 0&&e.writeVarintField(1,i.id),e.writeMessage(2,tg,n),e.writeVarintField(3,i.type),e.writeMessage(4,Zp,i)}function tg(n,e){for(const i in n.feature?.properties){let o=n.feature.properties[i],u=n.keycache[i];if(o==null)continue;u===void 0&&(n.keys.push(i),u=n.keys.length-1,n.keycache[i]=u),e.writeVarint(u),typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"&&(o=JSON.stringify(o));const f=typeof o+":"+o;let p=n.valuecache[f];p===void 0&&(n.values.push(o),p=n.values.length-1,n.valuecache[f]=p),e.writeVarint(p)}}function lu(n,e){return(e<<3)+(7&n)}function qp(n){return n<<1^n>>31}function Zp(n,e){const i=n.loadGeometry(),o=n.type;let u=0,f=0;for(const p of i){let y=1;o===1&&(y=p.length),e.writeVarint(lu(1,y));const x=o===3?p.length-1:p.length;for(let T=0;T<x;T++){T===1&&o!==1&&e.writeVarint(lu(2,x-1));const E=p[T].x-u,C=p[T].y-f;e.writeVarint(qp(E)),e.writeVarint(qp(C)),u+=E,f+=C}n.type===3&&e.writeVarint(lu(7,1))}}function Fd(n,e){const i=typeof n;i==="string"?e.writeStringField(1,n):i==="boolean"?e.writeBooleanField(7,n):i==="number"&&(n%1!=0?e.writeDoubleField(3,n):n<0?e.writeSVarintField(6,n):e.writeVarintField(5,n))}class Hp{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new _o(St,16,0),this.grid3D=new _o(St,16,0),this.featureIndexArray=new U,this.promoteId=i}insert(e,i,o,u,f,p){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,f);const x=p?this.grid3D:this.grid;for(let T=0;T<i.length;T++){const E=i[T],C=[1/0,1/0,-1/0,-1/0];for(let D=0;D<E.length;D++){const P=E[D];C[0]=Math.min(C[0],P.x),C[1]=Math.min(C[1],P.y),C[2]=Math.max(C[2],P.x),C[3]=Math.max(C[3],P.y)}C[0]<St&&C[1]<St&&C[2]>=0&&C[3]>=0&&x.insert(y,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new pi(new cd(this.rawTileData)).layers:new mf(this.rawTileData).layers,this.sourceLayerCoder=new Ap(this.vtLayers?Object.keys(this.vtLayers).sort():[gf])),this.vtLayers}query(e,i,o,u){this.loadVTLayers();const f=e.params,p=St/e.tileSize/e.scale,y=ka(f.filter,f.globalState),x=e.queryGeometry,T=e.queryPadding*p,E=eu.fromPoints(x),C=this.grid.query(E.minX-T,E.minY-T,E.maxX+T,E.maxY+T),D=eu.fromPoints(e.cameraQueryGeometry).expandBy(T),P=this.grid3D.query(D.minX,D.minY,D.maxX,D.maxY,((N,G,ee,q)=>(function(X,ne,se,Se,Ve){for(const qe of X)if(ne<=qe.x&&se<=qe.y&&Se>=qe.x&&Ve>=qe.y)return!0;const Oe=[new ge(ne,se),new ge(ne,Ve),new ge(Se,Ve),new ge(Se,se)];if(X.length>2){for(const qe of Oe)if(wo(X,qe))return!0}for(let qe=0;qe<X.length-1;qe++)if(sm(X[qe],X[qe+1],Oe))return!0;return!1})(e.cameraQueryGeometry,N-T,G-T,ee+T,q+T)));for(const N of P)C.push(N);C.sort(Nd);const B={};let k;for(let N=0;N<C.length;N++){const G=C[N];if(G===k)continue;k=G;const ee=this.featureIndexArray.get(G);let q=null;this.loadMatchingFeature(B,ee.bucketIndex,ee.sourceLayerIndex,ee.featureIndex,y,f.layers,f.availableImages,i,o,u,((X,ne,se)=>(q||(q=Zs(X)),ne.queryIntersectsFeature({queryGeometry:x,feature:X,featureState:se,geometry:q,zoom:this.z,transform:e.transform,pixelsToTileUnits:p,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return B}loadMatchingFeature(e,i,o,u,f,p,y,x,T,E,C){const D=this.bucketLayerIDs[i];if(p&&!D.some((N=>p.has(N))))return;const P=this.sourceLayerCoder.decode(o),B=this.vtLayers[P].feature(u);if(f.needGeometry){const N=$r(B,!0);if(!f.filter(new Ti(this.tileID.overscaledZ),N,this.tileID.canonical))return}else if(!f.filter(new Ti(this.tileID.overscaledZ),B))return;const k=this.getId(B,P);for(let N=0;N<D.length;N++){const G=D[N];if(p&&!p.has(G))continue;const ee=x[G];if(!ee)continue;let q={};k&&E&&(q=E.getState(ee.sourceLayer||gf,k));const X=ri({},T[G]);X.paint=ig(X.paint,ee.paint,B,q,y),X.layout=ig(X.layout,ee.layout,B,q,y);const ne=!C||C(B,ee,q);if(!ne)continue;const se=new Sd(B,this.z,this.x,this.y,k);se.layer=X;let Se=e[G];Se===void 0&&(Se=e[G]=[]),Se.push({featureIndex:u,feature:se,intersectionZ:ne})}}lookupSymbolFeatures(e,i,o,u,f,p,y,x){const T={};this.loadVTLayers();const E=ka(f.filterSpec,f.globalState);for(const C of e)this.loadMatchingFeature(T,o,u,C,E,p,y,x,i);return T}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){var o;let u=e.id;return this.promoteId&&(u=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(u=Number(e.properties.cluster_id))),u}}function ig(n,e,i,o,u){return Xi(n,((f,p)=>{const y=e instanceof Wo?e.get(p):null;return y&&y.evaluate?y.evaluate(i,o,u):y}))}function Nd(n,e){return e-n}function a(n,e,i,o,u){const f=[];for(let p=0;p<n.length;p++){const y=n[p];let x;for(let T=0;T<y.length-1;T++){let E=y[T],C=y[T+1];E.x<e&&C.x<e||(E.x<e?E=new ge(e,E.y+(e-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x<e&&(C=new ge(e,E.y+(e-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y<i&&C.y<i||(E.y<i?E=new ge(E.x+(i-E.y)/(C.y-E.y)*(C.x-E.x),i)._round():C.y<i&&(C=new ge(E.x+(i-E.y)/(C.y-E.y)*(C.x-E.x),i)._round()),E.x>=o&&C.x>=o||(E.x>=o?E=new ge(o,E.y+(o-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x>=o&&(C=new ge(o,E.y+(o-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y>=u&&C.y>=u||(E.y>=u?E=new ge(E.x+(u-E.y)/(C.y-E.y)*(C.x-E.x),u)._round():C.y>=u&&(C=new ge(E.x+(u-E.y)/(C.y-E.y)*(C.x-E.x),u)._round()),x&&E.equals(x[x.length-1])||(x=[E],f.push(x)),x.push(C)))))}}return f}function s(n,e,i,o,u){switch(e){case 1:return(function(f,p,y,x){const T=[];for(const E of f)for(const C of E){const D=x===0?C.x:C.y;D>=p&&D<=y&&T.push([C])}return T})(n,i,o,u);case 2:return g(n,i,o,u,!1);case 3:return g(n,i,o,u,!0)}return[]}function c(n,e,i,o,u){const f=o===0?w:M;let p=[];const y=[];for(let E=0;E<n.length-1;E++){const C=n[E],D=n[E+1],P=o===0?C.x:C.y,B=o===0?D.x:D.y;let k=!1;P<e?B>e&&p.push(f(C,D,e)):P>i?B<i&&p.push(f(C,D,i)):p.push(C),B<e&&P>=e&&(p.push(f(C,D,e)),k=!0),B>i&&P<=i&&(p.push(f(C,D,i)),k=!0),!u&&k&&(y.push(p),p=[])}const x=n.length-1,T=o===0?n[x].x:n[x].y;return T>=e&&T<=i&&p.push(n[x]),u&&p.length>0&&!p[0].equals(p[p.length-1])&&p.push(new ge(p[0].x,p[0].y)),p.length>0&&y.push(p),y}function g(n,e,i,o,u){const f=[];for(const p of n){const y=c(p,e,i,o,u);y.length>0&&f.push(...y)}return f}function w(n,e,i){return new ge(i,n.y+(i-n.x)/(e.x-n.x)*(e.y-n.y))}function M(n,e,i){return new ge(n.x+(i-n.y)/(e.y-n.y)*(e.x-n.x),i)}lt("FeatureIndex",Hp,{omit:["rawTileData","sourceLayerCoder"]});class L extends ge{constructor(e,i,o,u){super(e,i),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new L(this.x,this.y,this.angle,this.segment)}}function Z(n,e,i,o,u){if(e.segment===void 0||i===0)return!0;let f=e,p=e.segment+1,y=0;for(;y>-i/2;){if(p--,p<0)return!1;y-=n[p].dist(f),f=n[p]}y+=n[p].dist(n[p+1]),p++;const x=[];let T=0;for(;y<i/2;){const E=n[p],C=n[p+1];if(!C)return!1;let D=n[p-1].angleTo(E)-E.angleTo(C);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:D}),T+=D;y-x[0].distance>o;)T-=x.shift().angleDelta;if(T>u)return!1;p++,y+=E.dist(C)}return!0}function ce(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function Re(n,e,i){return n?.6*e*i:0}function Ue(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function $e(n,e,i,o,u,f){const p=Re(i,u,f),y=Ue(i,o)*f;let x=0;const T=ce(n)/2;for(let E=0;E<n.length-1;E++){const C=n[E],D=n[E+1],P=C.dist(D);if(x+P>T){const B=(T-x)/P,k=nn.number(C.x,D.x,B),N=nn.number(C.y,D.y,B),G=new L(k,N,D.angleTo(C),E);return G._round(),!p||Z(n,G,y,p,e)?G:void 0}x+=P}}function Le(n,e,i,o,u,f,p,y,x){const T=Re(o,f,p),E=Ue(o,u),C=E*p,D=n[0].x===0||n[0].x===x||n[0].y===0||n[0].y===x;return e-C<e/4&&(e=C+e/4),ke(n,D?e/2*y%e:(E/2+2*f)*p*y%e,e,T,i,C,D,!1,x)}function ke(n,e,i,o,u,f,p,y,x){const T=f/2,E=ce(n);let C=0,D=e-i,P=[];for(let B=0;B<n.length-1;B++){const k=n[B],N=n[B+1],G=k.dist(N),ee=N.angleTo(k);for(;D+i<C+G;){D+=i;const q=(D-C)/G,X=nn.number(k.x,N.x,q),ne=nn.number(k.y,N.y,q);if(X>=0&&X<x&&ne>=0&&ne<x&&D-T>=0&&D+T<=E){const se=new L(X,ne,ee,B);se._round(),o&&!Z(n,se,f,o,u)||P.push(se)}}C+=G}return y||P.length||p||(P=ke(n,C/2,i,o,u,f,p,!0,x)),P}function bt(n,e,i,o){const u=[],f=n.image,p=f.pixelRatio,y=f.paddedRect.w-2,x=f.paddedRect.h-2;let T={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const E=f.stretchX||[[0,y]],C=f.stretchY||[[0,x]],D=(Pe,dt)=>Pe+dt[1]-dt[0],P=E.reduce(D,0),B=C.reduce(D,0),k=y-P,N=x-B;let G=0,ee=P,q=0,X=B,ne=0,se=k,Se=0,Ve=N;if(f.content&&o){const Pe=f.content,dt=Pe[2]-Pe[0],ut=Pe[3]-Pe[1];(f.textFitWidth||f.textFitHeight)&&(T=fl(n)),G=Bt(E,0,Pe[0]),q=Bt(C,0,Pe[1]),ee=Bt(E,Pe[0],Pe[2]),X=Bt(C,Pe[1],Pe[3]),ne=Pe[0]-G,Se=Pe[1]-q,se=dt-ee,Ve=ut-X}const Oe=T.x1,qe=T.y1,rt=T.x2-Oe,Xe=T.y2-qe,Fe=(Pe,dt,ut,gt)=>{const st=xe(Pe.stretch-G,ee,rt,Oe),Tt=me(Pe.fixed-ne,se,Pe.stretch,P),vi=xe(dt.stretch-q,X,Xe,qe),ai=me(dt.fixed-Se,Ve,dt.stretch,B),vn=xe(ut.stretch-G,ee,rt,Oe),Xa=me(ut.fixed-ne,se,ut.stretch,P),oa=xe(gt.stretch-q,X,Xe,qe),xn=me(gt.fixed-Se,Ve,gt.stretch,B),hn=new ge(st,vi),Di=new ge(vn,vi),Ln=new ge(vn,oa),Vn=new ge(st,oa),on=new ge(Tt/p,ai/p),Kr=new ge(Xa/p,xn/p),$a=e*Math.PI/180;if($a){const Sa=Math.sin($a),En=Math.cos($a),la=[En,-Sa,Sa,En];hn._matMult(la),Di._matMult(la),Vn._matMult(la),Ln._matMult(la)}const Jr=Pe.stretch+Pe.fixed,Co=dt.stretch+dt.fixed;return{tl:hn,tr:Di,bl:Vn,br:Ln,tex:{x:f.paddedRect.x+1+Jr,y:f.paddedRect.y+1+Co,w:ut.stretch+ut.fixed-Jr,h:gt.stretch+gt.fixed-Co},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:on,pixelOffsetBR:Kr,minFontScaleX:se/p/rt,minFontScaleY:Ve/p/Xe,isSDF:i}};if(o&&(f.stretchX||f.stretchY)){const Pe=Zi(E,k,P),dt=Zi(C,N,B);for(let ut=0;ut<Pe.length-1;ut++){const gt=Pe[ut],st=Pe[ut+1];for(let Tt=0;Tt<dt.length-1;Tt++)u.push(Fe(gt,dt[Tt],st,dt[Tt+1]))}}else u.push(Fe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return u}function Bt(n,e,i){let o=0;for(const u of n)o+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return o}function Zi(n,e,i){const o=[{fixed:-1,stretch:0}];for(const[u,f]of n){const p=o[o.length-1];o.push({fixed:u-p.stretch,stretch:p.stretch}),o.push({fixed:u-p.stretch,stretch:p.stretch+(f-u)})}return o.push({fixed:e+1,stretch:i}),o}function xe(n,e,i,o){return n/e*i+o}function me(n,e,i,o){return n-e*i/o}lt("Anchor",L);class De{constructor(e,i,o,u,f,p,y,x,T,E){var C;if(this.boxStartIndex=e.length,T){let D=p.top,P=p.bottom;const B=p.collisionPadding;B&&(D-=B[1],P+=B[3]);let k=P-D;k>0&&(k=Math.max(10,k),this.circleDiameter=k)}else{const D=!((C=p.image)===null||C===void 0)&&C.content&&(p.image.textFitWidth||p.image.textFitHeight)?fl(p):{x1:p.left,y1:p.top,x2:p.right,y2:p.bottom};D.y1=D.y1*y-x[0],D.y2=D.y2*y+x[2],D.x1=D.x1*y-x[3],D.x2=D.x2*y+x[1];const P=p.collisionPadding;if(P&&(D.x1-=P[0]*y,D.y1-=P[1]*y,D.x2+=P[2]*y,D.y2+=P[3]*y),E){const B=new ge(D.x1,D.y1),k=new ge(D.x2,D.y1),N=new ge(D.x1,D.y2),G=new ge(D.x2,D.y2),ee=E*Math.PI/180;B._rotate(ee),k._rotate(ee),N._rotate(ee),G._rotate(ee),D.x1=Math.min(B.x,k.x,N.x,G.x),D.x2=Math.max(B.x,k.x,N.x,G.x),D.y1=Math.min(B.y,k.y,N.y,G.y),D.y2=Math.max(B.y,k.y,N.y,G.y)}e.emplaceBack(i.x,i.y,D.x1,D.y1,D.x2,D.y2,o,u,f)}this.boxEndIndex=e.length}}class He{constructor(e=[],i=(o,u)=>o<u?-1:o>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,u=i[e];for(;e>0;){const f=e-1>>1,p=i[f];if(o(u,p)>=0)break;i[e]=p,e=f}i[e]=u}_down(e){const{data:i,compare:o}=this,u=this.length>>1,f=i[e];for(;e<u;){let p=1+(e<<1);const y=p+1;if(y<this.length&&o(i[y],i[p])<0&&(p=y),o(i[p],f)>=0)break;i[e]=i[p],e=p}i[e]=f}}function Rt(n,e=1,i=!1){const o=eu.fromPoints(n[0]),u=Math.min(o.width(),o.height());let f=u/2;const p=new He([],zi),{minX:y,minY:x,maxX:T,maxY:E}=o;if(u===0)return new ge(y,x);for(let P=y;P<T;P+=u)for(let B=x;B<E;B+=u)p.push(new wt(P+f,B+f,f,n));let C=(function(P){let B=0,k=0,N=0;const G=P[0];for(let ee=0,q=G.length,X=q-1;ee<q;X=ee++){const ne=G[ee],se=G[X],Se=ne.x*se.y-se.x*ne.y;k+=(ne.x+se.x)*Se,N+=(ne.y+se.y)*Se,B+=3*Se}return new wt(k/B,N/B,0,P)})(n),D=p.length;for(;p.length;){const P=p.pop();(P.d>C.d||!C.d)&&(C=P,i&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,D)),P.max-C.d<=e||(f=P.h/2,p.push(new wt(P.p.x-f,P.p.y-f,f,n)),p.push(new wt(P.p.x+f,P.p.y-f,f,n)),p.push(new wt(P.p.x-f,P.p.y+f,f,n)),p.push(new wt(P.p.x+f,P.p.y+f,f,n)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${C.d}`)),C.p}function zi(n,e){return e.max-n.max}function wt(n,e,i,o){this.p=new ge(n,e),this.h=i,this.d=(function(u,f){let p=!1,y=1/0;for(let x=0;x<f.length;x++){const T=f[x];for(let E=0,C=T.length,D=C-1;E<C;D=E++){const P=T[E],B=T[D];P.y>u.y!=B.y>u.y&&u.x<(B.x-P.x)*(u.y-P.y)/(B.y-P.y)+P.x&&(p=!p),y=Math.min(y,Yd(u,P,B))}}return(p?1:-1)*Math.sqrt(y)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Dt;O.aP=void 0,(Dt=O.aP||(O.aP={}))[Dt.center=1]="center",Dt[Dt.left=2]="left",Dt[Dt.right=3]="right",Dt[Dt.top=4]="top",Dt[Dt.bottom=5]="bottom",Dt[Dt["top-left"]=6]="top-left",Dt[Dt["top-right"]=7]="top-right",Dt[Dt["bottom-left"]=8]="bottom-left",Dt[Dt["bottom-right"]=9]="bottom-right";const hi=Number.POSITIVE_INFINITY;function Mi(n,e){return e[1]!==hi?(function(i,o,u){let f=0,p=0;switch(o=Math.abs(o),u=Math.abs(u),i){case"top-right":case"top-left":case"top":p=u-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-u}switch(i){case"top-right":case"bottom-right":case"right":f=-o;break;case"top-left":case"bottom-left":case"left":f=o}return[f,p]})(n,e[0],e[1]):(function(i,o){let u=0,f=0;o<0&&(o=0);const p=o/Math.SQRT2;switch(i){case"top-right":case"top-left":f=p-7;break;case"bottom-right":case"bottom-left":f=7-p;break;case"bottom":f=7-o;break;case"top":f=o-7}switch(i){case"top-right":case"bottom-right":u=-p;break;case"top-left":case"bottom-left":u=p;break;case"left":u=o;break;case"right":u=-o}return[u,f]})(n,e[0])}function gl(n,e,i){var o;const u=n.layout,f=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},i);if(f){const y=f.values,x=[];for(let T=0;T<y.length;T+=2){const E=x[T]=y[T],C=y[T+1].map((D=>D*$n));E.startsWith("top")?C[1]-=7:E.startsWith("bottom")&&(C[1]+=7),x[T+1]=C}return new dn(x)}const p=u.get("text-variable-anchor");if(p){let y;y=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},i)*$n,hi]:u.get("text-offset").evaluate(e,{},i).map((T=>T*$n));const x=[];for(const T of p)x.push(T,Mi(T,y));return new dn(x)}return null}function Xp(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function iy(n,e,i,o,u,f,p,y,x,T,E,C){let D=f.textMaxSize.evaluate(e,{});D===void 0&&(D=p);const P=n.layers[0].layout,B=P.get("icon-offset").evaluate(e,{},E),k=d_(i.horizontal),N=p/24,G=n.tilePixelRatio*N,ee=n.tilePixelRatio*D/24,q=n.tilePixelRatio*y,X=n.tilePixelRatio*P.get("symbol-spacing"),ne=P.get("text-padding")*n.tilePixelRatio,se=(function(ut,gt,st,Tt=1){const vi=ut.get("icon-padding").evaluate(gt,{},st),ai=vi&&vi.values;return[ai[0]*Tt,ai[1]*Tt,ai[2]*Tt,ai[3]*Tt]})(P,e,E,n.tilePixelRatio),Se=P.get("text-max-angle")/180*Math.PI,Ve=P.get("text-rotation-alignment")!=="viewport"&&P.get("symbol-placement")!=="point",Oe=P.get("icon-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",qe=P.get("symbol-placement"),rt=X/2,Xe=P.get("icon-text-fit");let Fe;o&&Xe!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(Fe=$s(o,i.vertical,Xe,P.get("icon-text-fit-padding"),B,N)),k&&(o=$s(o,k,Xe,P.get("icon-text-fit-padding"),B,N)));const Pe=E?C.line.getGranularityForZoomLevel(E.z):1,dt=(ut,gt)=>{gt.x<0||gt.x>=St||gt.y<0||gt.y>=St||(function(st,Tt,vi,ai,vn,Xa,oa,xn,hn,Di,Ln,Vn,on,Kr,$a,Jr,Co,Sa,En,la,Bn,Ma,sc,_l,Qp){const lh=st.addToLineVertexArray(Tt,vi);let _f,Vd,jd,Ud,__=0,y_=0,v_=0,x_=0,kg=-1,Fg=-1;const oc={};let b_=_n("");if(st.allowVerticalPlacement&&ai.vertical){const pr=xn.layout.get("text-rotate").evaluate(Bn,{},_l)+90;jd=new De(hn,Tt,Di,Ln,Vn,ai.vertical,on,Kr,$a,pr),oa&&(Ud=new De(hn,Tt,Di,Ln,Vn,oa,Co,Sa,$a,pr))}if(vn){const pr=xn.layout.get("icon-rotate").evaluate(Bn,{}),Ks=xn.layout.get("icon-text-fit")!=="none",yf=bt(vn,pr,sc,Ks),vl=oa?bt(oa,pr,sc,Ks):void 0;Vd=new De(hn,Tt,Di,Ln,Vn,vn,Co,Sa,!1,pr),__=4*yf.length;const vf=st.iconSizeData;let uu=null;vf.kind==="source"?(uu=[Qr*xn.layout.get("icon-size").evaluate(Bn,{})],uu[0]>Kl&&Ii(`${st.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):vf.kind==="composite"&&(uu=[Qr*Ma.compositeIconSizes[0].evaluate(Bn,{},_l),Qr*Ma.compositeIconSizes[1].evaluate(Bn,{},_l)],(uu[0]>Kl||uu[1]>Kl)&&Ii(`${st.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),st.addSymbols(st.icon,yf,uu,la,En,Bn,O.az.none,Tt,lh.lineStartIndex,lh.lineLength,-1,_l),kg=st.icon.placedSymbolArray.length-1,vl&&(y_=4*vl.length,st.addSymbols(st.icon,vl,uu,la,En,Bn,O.az.vertical,Tt,lh.lineStartIndex,lh.lineLength,-1,_l),Fg=st.icon.placedSymbolArray.length-1)}const w_=Object.keys(ai.horizontal);for(const pr of w_){const Ks=ai.horizontal[pr];if(!_f){b_=_n(Ks.text);const vl=xn.layout.get("text-rotate").evaluate(Bn,{},_l);_f=new De(hn,Tt,Di,Ln,Vn,Ks,on,Kr,$a,vl)}const yf=Ks.positionedLines.length===1;if(v_+=f_(st,Tt,Ks,Xa,xn,$a,Bn,Jr,lh,ai.vertical?O.az.horizontal:O.az.horizontalOnly,yf?w_:[pr],oc,kg,Ma,_l),yf)break}ai.vertical&&(x_+=f_(st,Tt,ai.vertical,Xa,xn,$a,Bn,Jr,lh,O.az.vertical,["vertical"],oc,Fg,Ma,_l));const ry=_f?_f.boxStartIndex:st.collisionBoxArray.length,sy=_f?_f.boxEndIndex:st.collisionBoxArray.length,oy=jd?jd.boxStartIndex:st.collisionBoxArray.length,ly=jd?jd.boxEndIndex:st.collisionBoxArray.length,uy=Vd?Vd.boxStartIndex:st.collisionBoxArray.length,cy=Vd?Vd.boxEndIndex:st.collisionBoxArray.length,hy=Ud?Ud.boxStartIndex:st.collisionBoxArray.length,fy=Ud?Ud.boxEndIndex:st.collisionBoxArray.length;let yl=-1;const ag=(pr,Ks)=>pr&&pr.circleDiameter?Math.max(pr.circleDiameter,Ks):Ks;yl=ag(_f,yl),yl=ag(jd,yl),yl=ag(Vd,yl),yl=ag(Ud,yl);const T_=yl>-1?1:0;T_&&(yl*=Qp/$n),st.glyphOffsetArray.length>=Jc.MAX_GLYPHS&&Ii("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Bn.sortKey!==void 0&&st.addToSortKeyRanges(st.symbolInstances.length,Bn.sortKey);const dy=gl(xn,Bn,_l),[py,my]=(function(pr,Ks){const yf=pr.length,vl=Ks?.values;if(vl?.length>0)for(let vf=0;vf<vl.length;vf+=2){const uu=vl[vf+1];pr.emplaceBack(O.aP[vl[vf]],uu[0],uu[1])}return[yf,pr.length]})(st.textAnchorOffsets,dy);st.symbolInstances.emplaceBack(Tt.x,Tt.y,oc.right>=0?oc.right:-1,oc.center>=0?oc.center:-1,oc.left>=0?oc.left:-1,oc.vertical||-1,kg,Fg,b_,ry,sy,oy,ly,uy,cy,hy,fy,Di,v_,x_,__,y_,T_,0,on,yl,py,my)})(n,gt,ut,i,o,u,Fe,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,G,[ne,ne,ne,ne],Ve,x,q,se,Oe,B,e,f,T,E,p)};if(qe==="line")for(const ut of a(e.geometry,0,0,St,St)){const gt=ol(ut,Pe),st=Le(gt,X,Se,i.vertical||k,o,24,ee,n.overscaling,St);for(const Tt of st)k&&ny(n,k.text,rt,Tt)||dt(gt,Tt)}else if(qe==="line-center"){for(const ut of e.geometry)if(ut.length>1){const gt=ol(ut,Pe),st=$e(gt,Se,i.vertical||k,o,24,ee);st&&dt(gt,st)}}else if(e.type==="Polygon")for(const ut of Su(e.geometry,0)){const gt=Rt(ut,16);dt(ol(ut[0],Pe,!0),new L(gt.x,gt.y,0))}else if(e.type==="LineString")for(const ut of e.geometry){const gt=ol(ut,Pe);dt(gt,new L(gt[0].x,gt[0].y,0))}else if(e.type==="Point")for(const ut of e.geometry)for(const gt of ut)dt([gt],new L(gt.x,gt.y,0))}function f_(n,e,i,o,u,f,p,y,x,T,E,C,D,P,B){const k=(function(ee,q,X,ne,se,Se,Ve,Oe){const qe=ne.layout.get("text-rotate").evaluate(Se,{})*Math.PI/180,rt=[];for(const Xe of q.positionedLines)for(const Fe of Xe.positionedGlyphs){if(!Fe.rect)continue;const Pe=Fe.rect||{};let dt=4,ut=!0,gt=1,st=0;const Tt=(se||Oe)&&Fe.vertical,vi=Fe.metrics.advance*Fe.scale/2;if(Oe&&q.verticalizable&&(st=Xe.lineOffset/2-(Fe.imageName?-($n-Fe.metrics.width*Fe.scale)/2:(Fe.scale-1)*$n)),Fe.imageName){const Sa=Ve[Fe.imageName];ut=Sa.sdf,gt=Sa.pixelRatio,dt=1/gt}const ai=se?[Fe.x+vi,Fe.y]:[0,0];let vn=se?[0,0]:[Fe.x+vi+X[0],Fe.y+X[1]-st],Xa=[0,0];Tt&&(Xa=vn,vn=[0,0]);const oa=Fe.metrics.isDoubleResolution?2:1,xn=(Fe.metrics.left-dt)*Fe.scale-vi+vn[0],hn=(-Fe.metrics.top-dt)*Fe.scale+vn[1],Di=xn+Pe.w/oa*Fe.scale/gt,Ln=hn+Pe.h/oa*Fe.scale/gt,Vn=new ge(xn,hn),on=new ge(Di,hn),Kr=new ge(xn,Ln),$a=new ge(Di,Ln);if(Tt){const Sa=new ge(-vi,vi- -17),En=-Math.PI/2,la=12-vi,Bn=new ge(22-la,-(Fe.imageName?la:0)),Ma=new ge(...Xa);Vn._rotateAround(En,Sa)._add(Bn)._add(Ma),on._rotateAround(En,Sa)._add(Bn)._add(Ma),Kr._rotateAround(En,Sa)._add(Bn)._add(Ma),$a._rotateAround(En,Sa)._add(Bn)._add(Ma)}if(qe){const Sa=Math.sin(qe),En=Math.cos(qe),la=[En,-Sa,Sa,En];Vn._matMult(la),on._matMult(la),Kr._matMult(la),$a._matMult(la)}const Jr=new ge(0,0),Co=new ge(0,0);rt.push({tl:Vn,tr:on,bl:Kr,br:$a,tex:Pe,writingMode:q.writingMode,glyphOffset:ai,sectionIndex:Fe.sectionIndex,isSDF:ut,pixelOffsetTL:Jr,pixelOffsetBR:Co,minFontScaleX:0,minFontScaleY:0})}return rt})(0,i,y,u,f,p,o,n.allowVerticalPlacement),N=n.textSizeData;let G=null;N.kind==="source"?(G=[Qr*u.layout.get("text-size").evaluate(p,{})],G[0]>Kl&&Ii(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):N.kind==="composite"&&(G=[Qr*P.compositeTextSizes[0].evaluate(p,{},B),Qr*P.compositeTextSizes[1].evaluate(p,{},B)],(G[0]>Kl||G[1]>Kl)&&Ii(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,k,G,y,f,p,T,e,x.lineStartIndex,x.lineLength,D,B);for(const ee of E)C[ee]=n.text.placedSymbolArray.length-1;return 4*k.length}function d_(n){for(const e in n)return n[e];return null}function ny(n,e,i,o){const u=n.compareText;if(e in u){const f=u[e];for(let p=f.length-1;p>=0;p--)if(o.dist(f[p])<i)return!0}else u[e]=[];return u[e].push(o),!1}const p_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Dg{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=p_[15&o];if(!f)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Dg(y,p,f,e)}constructor(e,i=64,o=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=p_.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Pg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:p,nodeSize:y}=this,x=[0,f.length-1,0],T=[];for(;x.length;){const E=x.pop()||0,C=x.pop()||0,D=x.pop()||0;if(C-D<=y){for(let N=D;N<=C;N++){const G=p[2*N],ee=p[2*N+1];G>=e&&G<=o&&ee>=i&&ee<=u&&T.push(f[N])}continue}const P=D+C>>1,B=p[2*P],k=p[2*P+1];B>=e&&B<=o&&k>=i&&k<=u&&T.push(f[P]),(E===0?e<=B:i<=k)&&(x.push(D),x.push(P-1),x.push(1-E)),(E===0?o>=B:u>=k)&&(x.push(P+1),x.push(C),x.push(1-E))}return T}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:p}=this,y=[0,u.length-1,0],x=[],T=o*o;for(;y.length;){const E=y.pop()||0,C=y.pop()||0,D=y.pop()||0;if(C-D<=p){for(let N=D;N<=C;N++)g_(f[2*N],f[2*N+1],e,i)<=T&&x.push(u[N]);continue}const P=D+C>>1,B=f[2*P],k=f[2*P+1];g_(B,k,e,i)<=T&&x.push(u[P]),(E===0?e-o<=B:i-o<=k)&&(y.push(D),y.push(P-1),y.push(1-E)),(E===0?e+o>=B:i+o>=k)&&(y.push(P+1),y.push(C),y.push(1-E))}return x}}function Pg(n,e,i,o,u,f){if(u-o<=i)return;const p=o+u>>1;m_(n,e,p,o,u,f),Pg(n,e,i,o,p-1,1-f),Pg(n,e,i,p+1,u,1-f)}function m_(n,e,i,o,u,f){for(;u>o;){if(u-o>600){const T=u-o+1,E=i-o+1,C=Math.log(T),D=.5*Math.exp(2*C/3),P=.5*Math.sqrt(C*D*(T-D)/T)*(E-T/2<0?-1:1);m_(n,e,i,Math.max(o,Math.floor(i-E*D/T+P)),Math.min(u,Math.floor(i+(T-E)*D/T+P)),f)}const p=e[2*i+f];let y=o,x=u;for($p(n,e,o,i),e[2*u+f]>p&&$p(n,e,o,u);y<x;){for($p(n,e,y,x),y++,x--;e[2*y+f]<p;)y++;for(;e[2*x+f]>p;)x--}e[2*o+f]===p?$p(n,e,o,x):(x++,$p(n,e,x,u)),x<=i&&(o=x+1),i<=x&&(u=x-1)}}function $p(n,e,i,o){Ig(n,i,o),Ig(e,2*i,2*o),Ig(e,2*i+1,2*o+1)}function Ig(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function g_(n,e,i,o){const u=n-i,f=e-o;return u*u+f*f}var Rg;O.cH=void 0,(Rg=O.cH||(O.cH={})).create="create",Rg.load="load",Rg.fullLoad="fullLoad";let ng=null,Yp=[];const Lg=1e3/60,Bg="loadTime",Og="fullLoadTime",ay={mark(n){performance.mark(n)},frame(n){const e=n;ng!=null&&Yp.push(e-ng),ng=e},clearMetrics(){ng=null,Yp=[],performance.clearMeasures(Bg),performance.clearMeasures(Og);for(const n in O.cH)performance.clearMarks(O.cH[n])},getPerformanceMetrics(){performance.measure(Bg,O.cH.create,O.cH.load),performance.measure(Og,O.cH.create,O.cH.fullLoad);const n=performance.getEntriesByName(Bg)[0].duration,e=performance.getEntriesByName(Og)[0].duration,i=Yp.length,o=1/(Yp.reduce(((f,p)=>f+p),0)/i/1e3),u=Yp.filter((f=>f>Lg)).reduce(((f,p)=>f+(p-Lg)/Lg),0);return{loadTime:n,fullLoadTime:e,fps:o,percentDroppedFrames:u/(i+u)*100,totalFrames:i}}};O.$=ve,O.A=Ft,O.B=jr,O.C=Xn,O.D=ct,O.E=$t,O.F=function([n,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:n*Math.cos(e)*Math.sin(i),y:n*Math.sin(e)*Math.sin(i),z:n*Math.cos(i)}},O.G=nn,O.H=Ti,O.I=Ni,O.J=Pc,O.K=function(n){if($i==null){const e=n.navigator?n.navigator.userAgent:null;$i=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return $i},O.L=class{constructor(n,e){this.target=n,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new bd((()=>this.process())),this.subscription=Wa(this.target,"message",(i=>this.receive(i)),!1),this.globalScope=La(self)?n:window}registerMessageHandler(n,e){this.messageHandlers[n]=e}unregisterMessageHandler(n){delete this.messageHandlers[n]}sendAsync(n,e){return new Promise(((i,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),f=e?Wa(e.signal,"abort",(()=>{f?.unsubscribe(),delete this.resolveRejects[u];const x={id:u,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)}),Tp):null;this.resolveRejects[u]={resolve:x=>{f?.unsubscribe(),i(x)},reject:x=>{f?.unsubscribe(),o(x)}};const p=[],y=Object.assign(Object.assign({},n),{id:u,sourceMapId:this.mapId,origin:location.origin,data:Ur(n.data,p)});this.target.postMessage(y,{transfer:p})}))}receive(n){const e=n.data,i=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[i];const o=this.abortControllers[i];return delete this.abortControllers[i],void(o&&o.abort())}if(La(self)||e.mustQueue)return this.tasks[i]=e,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,e)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),e=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(n,e)}processTask(n,e){return d(this,void 0,void 0,(function*(){if(e.type==="<response>"){const u=this.resolveRejects[n];return delete this.resolveRejects[n],u?void(e.error?u.reject(Ul(e.error)):u.resolve(Ul(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=Ul(e.data),o=new AbortController;this.abortControllers[n]=o;try{const u=yield this.messageHandlers[e.type](e.sourceMapId,i,o);this.completeTask(n,null,u)}catch(u){this.completeTask(n,u)}}))}completeTask(n,e,i){const o=[];delete this.abortControllers[n];const u={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Ur(e):null,data:Ur(i,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},O.M=_e,O.N=function(){var n=new Ft(16);return Ft!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},O.O=function(n,e,i){var o,u,f,p,y,x,T,E,C,D,P,B,k=i[0],N=i[1],G=i[2];return e===n?(n[12]=e[0]*k+e[4]*N+e[8]*G+e[12],n[13]=e[1]*k+e[5]*N+e[9]*G+e[13],n[14]=e[2]*k+e[6]*N+e[10]*G+e[14],n[15]=e[3]*k+e[7]*N+e[11]*G+e[15]):(u=e[1],f=e[2],p=e[3],y=e[4],x=e[5],T=e[6],E=e[7],C=e[8],D=e[9],P=e[10],B=e[11],n[0]=o=e[0],n[1]=u,n[2]=f,n[3]=p,n[4]=y,n[5]=x,n[6]=T,n[7]=E,n[8]=C,n[9]=D,n[10]=P,n[11]=B,n[12]=o*k+y*N+C*G+e[12],n[13]=u*k+x*N+D*G+e[13],n[14]=f*k+T*N+P*G+e[14],n[15]=p*k+E*N+B*G+e[15]),n},O.P=ge,O.Q=function(n,e,i){var o=i[0],u=i[1],f=i[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*f,n[9]=e[9]*f,n[10]=e[10]*f,n[11]=e[11]*f,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},O.R=Ga,O.S=function(n,e,i){var o=e[0],u=e[1],f=e[2],p=e[3],y=e[4],x=e[5],T=e[6],E=e[7],C=e[8],D=e[9],P=e[10],B=e[11],k=e[12],N=e[13],G=e[14],ee=e[15],q=i[0],X=i[1],ne=i[2],se=i[3];return n[0]=q*o+X*y+ne*C+se*k,n[1]=q*u+X*x+ne*D+se*N,n[2]=q*f+X*T+ne*P+se*G,n[3]=q*p+X*E+ne*B+se*ee,n[4]=(q=i[4])*o+(X=i[5])*y+(ne=i[6])*C+(se=i[7])*k,n[5]=q*u+X*x+ne*D+se*N,n[6]=q*f+X*T+ne*P+se*G,n[7]=q*p+X*E+ne*B+se*ee,n[8]=(q=i[8])*o+(X=i[9])*y+(ne=i[10])*C+(se=i[11])*k,n[9]=q*u+X*x+ne*D+se*N,n[10]=q*f+X*T+ne*P+se*G,n[11]=q*p+X*E+ne*B+se*ee,n[12]=(q=i[12])*o+(X=i[13])*y+(ne=i[14])*C+(se=i[15])*k,n[13]=q*u+X*x+ne*D+se*N,n[14]=q*f+X*T+ne*P+se*G,n[15]=q*p+X*E+ne*B+se*ee,n},O.T=Kf,O.U=function(n,e){const i={};for(let o=0;o<e.length;o++){const u=e[o];u in n&&(i[u]=n[u])}return i},O.V=Eo,O.W=Xt,O.X=Sp,O.Y=Fm,O.Z=oe,O._=d,O.a=H,O.a$=Yn,O.a0=ti,O.a1=es,O.a2=Rr,O.a3=Vm,O.a4=Kh,O.a5=St,O.a6=function(n,e,i){if(!n)return e||{};if(!e)return n||{};const o=ef(n),u=ef(e);(function(p,y){y.removeAll&&(p.add.clear(),p.update.clear(),p.remove.clear(),y.remove.clear());for(const x of y.remove)p.add.delete(x),p.update.delete(x);for(const[x,T]of y.update){const E=p.update.get(x);E&&(y.update.set(x,Ep(E,T)),p.update.delete(x))}})(o,u);const f={};if((o.removeAll||u.removeAll)&&(f.removeAll=!0),f.remove=new Set([...o.remove,...u.remove]),f.add=new Map([...o.add,...u.add]),f.update=new Map([...o.update,...u.update]),f.remove.size&&f.add.size)for(const p of f.add.keys())f.remove.delete(p);return(function(p){const y={};return p.removeAll&&(y.removeAll=p.removeAll),p.remove&&(y.remove=Array.from(p.remove)),p.add&&(y.add=Array.from(p.add.values())),p.update&&(y.update=Array.from(p.update.values())),y})(f)},O.a7=function(n,e){const i=new Map;if(n==null||n.type==null)return i;if(n.type==="Feature"){const o=Jh(n,e);return o==null?void 0:(i.set(o,n),i)}if(n.type==="FeatureCollection"){const o=new Set;for(const u of n.features){const f=Jh(u,e);if(f==null||o.has(f))return;o.add(f),i.set(f,u)}return i}},O.a8=function(n,e,i){var o,u;const f=[];if(e.removeAll)n.clear();else if(e.remove)for(const p of e.remove){const y=n.get(p);y&&(f.push(y.geometry),n.delete(p))}if(e.add)for(const p of e.add){const y=Jh(p,i);if(y==null)continue;const x=n.get(y);x&&f.push(x.geometry),f.push(p.geometry),n.set(y,p)}if(e.update)for(const p of e.update){const y=n.get(p.id);if(!y)continue;const x=!!p.newGeometry,T=p.removeAllProperties||((o=p.removeProperties)===null||o===void 0?void 0:o.length)>0||((u=p.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0;if(!x&&!T)continue;f.push(y.geometry);const E=Object.assign({},y);if(n.set(p.id,E),x&&(f.push(p.newGeometry),E.geometry=p.newGeometry),T){if(E.properties=p.removeAllProperties?{}:Object.assign({},E.properties||{}),p.removeProperties)for(const C of p.removeProperties)delete E.properties[C];if(p.addOrUpdateProperties)for(const{key:C,value:D}of p.addOrUpdateProperties)E.properties[C]=D}}return f},O.a9=Ci,O.aA=function(n,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:u}){return n.kind==="source"?o/Qr:n.kind==="composite"?nn.number(o/Qr,u/Qr,i):e},O.aB=function(n,e){var i=e[0],o=e[1],u=e[2],f=e[3],p=e[4],y=e[5],x=e[6],T=e[7],E=e[8],C=e[9],D=e[10],P=e[11],B=e[12],k=e[13],N=e[14],G=e[15],ee=i*y-o*p,q=i*x-u*p,X=i*T-f*p,ne=o*x-u*y,se=o*T-f*y,Se=u*T-f*x,Ve=E*k-C*B,Oe=E*N-D*B,qe=E*G-P*B,rt=C*N-D*k,Xe=C*G-P*k,Fe=D*G-P*N,Pe=ee*Fe-q*Xe+X*rt+ne*qe-se*Oe+Se*Ve;return Pe?(n[0]=(y*Fe-x*Xe+T*rt)*(Pe=1/Pe),n[1]=(u*Xe-o*Fe-f*rt)*Pe,n[2]=(k*Se-N*se+G*ne)*Pe,n[3]=(D*se-C*Se-P*ne)*Pe,n[4]=(x*qe-p*Fe-T*Oe)*Pe,n[5]=(i*Fe-u*qe+f*Oe)*Pe,n[6]=(N*X-B*Se-G*q)*Pe,n[7]=(E*Se-D*X+P*q)*Pe,n[8]=(p*Xe-y*qe+T*Ve)*Pe,n[9]=(o*qe-i*Xe-f*Ve)*Pe,n[10]=(B*se-k*X+G*ee)*Pe,n[11]=(C*X-E*se-P*ee)*Pe,n[12]=(y*Oe-p*rt-x*Ve)*Pe,n[13]=(i*rt-o*Oe+u*Ve)*Pe,n[14]=(k*q-B*ne-N*ee)*Pe,n[15]=(E*ne-C*q+D*ee)*Pe,n):null},O.aC=it,O.aD=function(n){var e=n[0],i=n[1];return Math.sqrt(e*e+i*i)},O.aE=function(n){return n[0]=0,n[1]=0,n},O.aF=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n},O.aG=vp,O.aH=ma,O.aI=function(n,e,i,o){const u=e.y-n.y,f=e.x-n.x,p=o.y-i.y,y=o.x-i.x,x=p*f-y*u;if(x===0)return null;const T=(y*(n.y-i.y)-p*(n.x-i.x))/x;return new ge(n.x+T*f,n.y+T*u)},O.aJ=a,O.aK=Qu,O.aL=function(n){let e=1/0,i=1/0,o=-1/0,u=-1/0;for(const f of n)e=Math.min(e,f.x),i=Math.min(i,f.y),o=Math.max(o,f.x),u=Math.max(u,f.y);return[e,i,o,u]},O.aM=$n,O.aN=Wt,O.aO=function(n,e,i,o,u=!1){if(!i[0]&&!i[1])return[0,0];const f=u?o==="map"?-n.bearingInRadians:0:o==="viewport"?n.bearingInRadians:0;if(f){const p=Math.sin(f),y=Math.cos(f);i=[i[0]*y-i[1]*p,i[0]*p+i[1]*y]}return[u?i[0]:Wt(e,i[0],n.zoom),u?i[1]:Wt(e,i[1],n.zoom)]},O.aQ=gd,O.aR=Xp,O.aS=mp,O.aT=Dg,O.aU=an,O.aV=Uh,O.aW=$,O.aX=at,O.aY=Ce,O.aZ=ua,O.a_=Mp,O.aa=eu,O.ab=25,O.ac=da,O.ad=n=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((i=>{e.onloadstart=()=>{i(e)};for(const o of n){const u=window.document.createElement("source");Ie(o)||(e.crossOrigin="Anonymous"),u.src=o,e.appendChild(u)}}))},O.ae=Qe,O.af=function(){return wi++},O.ag=h,O.ah=Jc,O.ai=gf,O.aj=ka,O.ak=$r,O.al=Sd,O.am=function(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,o,u,f)=>{const p=u||f;return e[o]=!p||p.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e},O.an=zt,O.ao=85.051129,O.ap=On,O.aq=function(n){return Math.pow(2,n)},O.ar=jn,O.as=Nm,O.at=function(n){return Math.log(n)/Math.LN2},O.au=function(n){var e=n[0],i=n[1];return e*e+i*i},O.av=function(n){if(!n.length)return new Set;const e=Math.max(...n.map((x=>x.canonical.z)));let i=1/0,o=-1/0,u=1/0,f=-1/0;const p=[];for(const x of n){const{x:T,y:E,z:C}=x.canonical,D=Math.pow(2,e-C),P=T*D,B=E*D;p.push({id:x,x:P,y:B}),P<i&&(i=P),P>o&&(o=P),B<u&&(u=B),B>f&&(f=B)}const y=new Set;for(const x of p)x.x!==i&&x.x!==o&&x.y!==u&&x.y!==f||y.add(x.id);return y},O.aw=function(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||o-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x},O.ax=class{constructor(n,e){this.max=n,this.onRemove=e,this.reset()}reset(){for(const n in this.data)for(const e of this.data[n])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(n,e,i){const o=n.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const u={value:e,timeout:void 0};if(i!==void 0&&(u.timeout=setTimeout((()=>{this.remove(n,u)}),i)),this.data[o].push(u),this.order.push(o),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const e=this.data[n].shift();return e.timeout&&clearTimeout(e.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),e.value}getByKey(n){const e=this.data[n];return e?e[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,e){if(!this.has(n))return this;const i=n.wrapped().key,o=e===void 0?0:this.data[i].indexOf(e),u=this.data[i][o];return this.data[i].splice(o,1),u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(u.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(n){const e=[];for(const i in this.data)for(const o of this.data[i])n(o.value)||e.push(o);for(const i of e)this.remove(i.value.tileID,i)}},O.ay=function(n,e){let i=0,o=0;if(n.kind==="constant")o=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:u,minZoom:f,maxZoom:p}=n,y=u?zt(Da.interpolationFactor(u,e,f,p),0,1):0;n.kind==="camera"?o=nn.number(n.minSize,n.maxSize,y):i=y}return{uSizeT:i,uSize:o}},O.b=Qa,O.b$=Xr,O.b0=bn,O.b1=function(n){var e=new Ft(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},O.b2=function(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n},O.b3=function(n,e){var i=e[0],o=e[1],u=e[2],f=i*i+o*o+u*u;return f>0&&(f=1/Math.sqrt(f)),n[0]=e[0]*f,n[1]=e[1]*f,n[2]=e[2]*f,n},O.b4=An,O.b5=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]},O.b6=function(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n[3]=e[3]*i[3],n},O.b7=Ct,O.b8=function(n,e,i){const o=e[0]*i[0]+e[1]*i[1]+e[2]*i[2];return o===0?null:(-(n[0]*i[0]+n[1]*i[1]+n[2]*i[2])-i[3])/o},O.b9=Cn,O.bA=function(n,e,i,o){return n[0]=e[0]+i[0]*o,n[1]=e[1]+i[1]*o,n[2]=e[2]+i[2]*o,n},O.bB=je,O.bC=function(n,e,i){var o=i[0],u=i[1],f=i[2],p=i[3],y=e[0],x=e[1],T=e[2],E=u*T-f*x,C=f*y-o*T,D=o*x-u*y;return n[0]=y+p*(E+=E)+u*(D+=D)-f*(C+=C),n[1]=x+p*C+f*E-o*D,n[2]=T+p*D+o*C-u*E,n},O.bD=function(n,e,i){const o=(function(x){var T=x[3],E=x[4],C=x[5],D=x[6],P=x[7],B=x[8];return x[0]*(B*E-C*P)+x[1]*(-B*T+C*D)+x[2]*(P*T-E*D)})([n[0],n[1],n[2],e[0],e[1],e[2],i[0],i[1],i[2]]);if(o===0)return null;const u=An([],[e[0],e[1],e[2]],[i[0],i[1],i[2]]),f=An([],[i[0],i[1],i[2]],[n[0],n[1],n[2]]),p=An([],[n[0],n[1],n[2]],[e[0],e[1],e[2]]),y=Yn([],u,-n[3]);return bn(y,y,Yn([],f,-e[3])),bn(y,y,Yn([],p,-i[3])),Yn(y,y,1/o),y},O.bE=wd,O.bF=function(){return new Float64Array(4)},O.bG=function(n,e,i,o){var u=[],f=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],f[0]=u[0]*Math.cos(o)-u[1]*Math.sin(o),f[1]=u[0]*Math.sin(o)+u[1]*Math.cos(o),f[2]=u[2],n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n},O.bH=function(n,e,i,o){var u=[],f=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],f[0]=u[0],f[1]=u[1]*Math.cos(o)-u[2]*Math.sin(o),f[2]=u[1]*Math.sin(o)+u[2]*Math.cos(o),n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n},O.bI=function(n,e,i,o){var u=[],f=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],f[0]=u[2]*Math.sin(o)+u[0]*Math.cos(o),f[1]=u[1],f[2]=u[2]*Math.cos(o)-u[0]*Math.sin(o),n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n},O.bJ=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),f=e[0],p=e[1],y=e[2],x=e[3],T=e[8],E=e[9],C=e[10],D=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u-T*o,n[1]=p*u-E*o,n[2]=y*u-C*o,n[3]=x*u-D*o,n[8]=f*o+T*u,n[9]=p*o+E*u,n[10]=y*o+C*u,n[11]=x*o+D*u,n},O.bK=function(n,e){const i=de(n,360),o=de(e,360),u=o-i,f=o>i?u-360:u+360;return Math.abs(u)<Math.abs(f)?u:f},O.bL=function(n){return n[0]=0,n[1]=0,n[2]=0,n},O.bM=function(n,e,i,o){const u=Math.sqrt(n*n+e*e),f=Math.sqrt(i*i+o*o);n/=u,e/=u,i/=f,o/=f;const p=Math.acos(n*i+e*o);return-e*i+n*o>0?p:-p},O.bN=function(n,e){const i=de(n,2*Math.PI),o=de(e,2*Math.PI);return Math.min(Math.abs(i-o),Math.abs(i-o+2*Math.PI),Math.abs(i-o-2*Math.PI))},O.bO=function(){const n={},e=be.$version;for(const i in be.$root){const o=be.$root[i];if(o.required){let u=null;u=i==="version"?e:o.type==="array"?[]:{},u!=null&&(n[i]=u)}}return n},O.bP=he,O.bQ=Lc,O.bR=function n(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let o=0;o<e.length;o++)if(!n(e[o],i[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&i!==null){if(typeof i!="object"||Object.keys(e).length!==Object.keys(i).length)return!1;for(const o in e)if(!n(e[o],i[o]))return!1;return!0}return e===i},O.bS=function(n){n=n.slice();const e=Object.create(null);for(let i=0;i<n.length;i++)e[n[i].id]=n[i];for(let i=0;i<n.length;i++)"ref"in n[i]&&(n[i]=Ki(n[i],e[n[i].ref]));return n},O.bT=function(n,e){if(n.type==="custom")return new wp(n,e);switch(n.type){case"background":return new mi(n,e);case"circle":return new Yf(n,e);case"color-relief":return new fm(n,e);case"fill":return new _m(n,e);case"fill-extrusion":return new lp(n,e);case"heatmap":return new cm(n,e);case"hillshade":return new yn(n,e);case"line":return new cp(n,e);case"raster":return new js(n,e);case"symbol":return new Jl(n,e)}},O.bU=n=>n.type==="raster",O.bV=ga,O.bW=function(n,e){if(!n)return[{command:"setStyle",args:[e]}];let i=[];try{if(!Pt(n.version,e.version))return[{command:"setStyle",args:[e]}];Pt(n.center,e.center)||i.push({command:"setCenter",args:[e.center]}),Pt(n.state,e.state)||i.push({command:"setGlobalState",args:[e.state]}),Pt(n.centerAltitude,e.centerAltitude)||i.push({command:"setCenterAltitude",args:[e.centerAltitude]}),Pt(n.zoom,e.zoom)||i.push({command:"setZoom",args:[e.zoom]}),Pt(n.bearing,e.bearing)||i.push({command:"setBearing",args:[e.bearing]}),Pt(n.pitch,e.pitch)||i.push({command:"setPitch",args:[e.pitch]}),Pt(n.roll,e.roll)||i.push({command:"setRoll",args:[e.roll]}),Pt(n.sprite,e.sprite)||i.push({command:"setSprite",args:[e.sprite]}),Pt(n.glyphs,e.glyphs)||i.push({command:"setGlyphs",args:[e.glyphs]}),Pt(n.transition,e.transition)||i.push({command:"setTransition",args:[e.transition]}),Pt(n.light,e.light)||i.push({command:"setLight",args:[e.light]}),Pt(n.terrain,e.terrain)||i.push({command:"setTerrain",args:[e.terrain]}),Pt(n.sky,e.sky)||i.push({command:"setSky",args:[e.sky]}),Pt(n.projection,e.projection)||i.push({command:"setProjection",args:[e.projection]});const o={},u=[];(function(p,y,x,T){let E;for(E in y=y||{},p=p||{})Object.prototype.hasOwnProperty.call(p,E)&&(Object.prototype.hasOwnProperty.call(y,E)||Nt(E,x,T));for(E in y)Object.prototype.hasOwnProperty.call(y,E)&&(Object.prototype.hasOwnProperty.call(p,E)?Pt(p[E],y[E])||(p[E].type==="geojson"&&y[E].type==="geojson"&&Ri(p,y,E)?ni(x,{command:"setGeoJSONSourceData",args:[E,y[E].data]}):Ji(E,y,x,T)):Vi(E,y,x))})(n.sources,e.sources,u,o);const f=[];n.layers&&n.layers.forEach((p=>{"source"in p&&o[p.source]?i.push({command:"removeLayer",args:[p.id]}):f.push(p)})),i=i.concat(u),(function(p,y,x){y=y||[];const T=(p=p||[]).map(bl),E=y.map(bl),C=p.reduce(Do,{}),D=y.reduce(Do,{}),P=T.slice(),B=Object.create(null);let k,N,G,ee,q;for(let X=0,ne=0;X<T.length;X++)k=T[X],Object.prototype.hasOwnProperty.call(D,k)?ne++:(ni(x,{command:"removeLayer",args:[k]}),P.splice(P.indexOf(k,ne),1));for(let X=0,ne=0;X<E.length;X++)k=E[E.length-1-X],P[P.length-1-X]!==k&&(Object.prototype.hasOwnProperty.call(C,k)?(ni(x,{command:"removeLayer",args:[k]}),P.splice(P.lastIndexOf(k,P.length-ne),1)):ne++,ee=P[P.length-X],ni(x,{command:"addLayer",args:[D[k],ee]}),P.splice(P.length-X,0,k),B[k]=!0);for(let X=0;X<E.length;X++)if(k=E[X],N=C[k],G=D[k],!B[k]&&!Pt(N,G))if(Pt(N.source,G.source)&&Pt(N["source-layer"],G["source-layer"])&&Pt(N.type,G.type)){for(q in zn(N.layout,G.layout,x,k,null,"setLayoutProperty"),zn(N.paint,G.paint,x,k,null,"setPaintProperty"),Pt(N.filter,G.filter)||ni(x,{command:"setFilter",args:[k,G.filter]}),Pt(N.minzoom,G.minzoom)&&Pt(N.maxzoom,G.maxzoom)||ni(x,{command:"setLayerZoomRange",args:[k,G.minzoom,G.maxzoom]}),N)Object.prototype.hasOwnProperty.call(N,q)&&q!=="layout"&&q!=="paint"&&q!=="filter"&&q!=="metadata"&&q!=="minzoom"&&q!=="maxzoom"&&(q.indexOf("paint.")===0?zn(N[q],G[q],x,k,q.slice(6),"setPaintProperty"):Pt(N[q],G[q])||ni(x,{command:"setLayerProperty",args:[k,q,G[q]]}));for(q in G)Object.prototype.hasOwnProperty.call(G,q)&&!Object.prototype.hasOwnProperty.call(N,q)&&q!=="layout"&&q!=="paint"&&q!=="filter"&&q!=="metadata"&&q!=="minzoom"&&q!=="maxzoom"&&(q.indexOf("paint.")===0?zn(N[q],G[q],x,k,q.slice(6),"setPaintProperty"):Pt(N[q],G[q])||ni(x,{command:"setLayerProperty",args:[k,q,G[q]]}))}else ni(x,{command:"removeLayer",args:[k]}),ee=P[P.lastIndexOf(k)+1],ni(x,{command:"addLayer",args:[G,ee]})})(f,e.layers,i)}catch(o){console.warn("Unable to compute style diff:",o),i=[{command:"setStyle",args:[e]}]}return i},O.bX=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},O.bY=Xi,O.bZ=Un,O.b_=class extends ja{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},O.ba=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n},O.bb=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]},O.bc=jm,O.bd=th,O.be=function(n,e,i,o,u){var f=1/Math.tan(e/2);if(n[0]=f/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,u!=null&&u!==1/0){var p=1/(o-u);n[10]=(u+o)*p,n[14]=2*u*o*p}else n[10]=-1,n[14]=-2*o;return n},O.bf=function(n){var e=new Ft(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},O.bg=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),f=e[0],p=e[1],y=e[2],x=e[3],T=e[4],E=e[5],C=e[6],D=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u+T*o,n[1]=p*u+E*o,n[2]=y*u+C*o,n[3]=x*u+D*o,n[4]=T*u-f*o,n[5]=E*u-p*o,n[6]=C*u-y*o,n[7]=D*u-x*o,n},O.bh=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),f=e[4],p=e[5],y=e[6],x=e[7],T=e[8],E=e[9],C=e[10],D=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=f*u+T*o,n[5]=p*u+E*o,n[6]=y*u+C*o,n[7]=x*u+D*o,n[8]=T*u-f*o,n[9]=E*u-p*o,n[10]=C*u-y*o,n[11]=D*u-x*o,n},O.bi=function(){const n=new Float32Array(16);return jn(n),n},O.bj=function(){const n=new Float64Array(16);return jn(n),n},O.bk=function(){return new Float64Array(16)},O.bl=function(n,e,i){const o=new Float64Array(4);return je(o,n,e-90,i),o},O.bm=function(n,e,i,o){var u,f,p,y,x,T=e[0],E=e[1],C=e[2],D=e[3],P=i[0],B=i[1],k=i[2],N=i[3];return(f=T*P+E*B+C*k+D*N)<0&&(f=-f,P=-P,B=-B,k=-k,N=-N),1-f>mt?(u=Math.acos(f),p=Math.sin(u),y=Math.sin((1-o)*u)/p,x=Math.sin(o*u)/p):(y=1-o,x=o),n[0]=y*T+x*P,n[1]=y*E+x*B,n[2]=y*C+x*k,n[3]=y*D+x*N,n},O.bn=function(n){const e=new Float64Array(9);(function(f,p){var y=p[0],x=p[1],T=p[2],E=p[3],C=y+y,D=x+x,P=T+T,B=y*C,k=x*C,N=x*D,G=T*C,ee=T*D,q=T*P,X=E*C,ne=E*D,se=E*P;f[0]=1-N-q,f[3]=k-se,f[6]=G+ne,f[1]=k+se,f[4]=1-B-q,f[7]=ee-X,f[2]=G-ne,f[5]=ee+X,f[8]=1-B-N})(e,n);const i=ua(-Math.asin(zt(e[2],-1,1)));let o,u;return Math.hypot(e[5],e[8])<.001?(o=0,u=-ua(Math.atan2(e[3],e[4]))):(o=ua(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),u=ua(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:o,pitch:i+90,bearing:u}},O.bo=function(n,e){return n.roll==e.roll&&n.pitch==e.pitch&&n.bearing==e.bearing},O.bp=qt,O.bq=il,O.br=zr,O.bs=Hs,O.bt=fa,O.bu=Ze,O.bv=ot,O.bw=Zn,O.bx=function(n,e,i,o,u){return Ze(o,u,zt((n-e)/(i-e),0,1))},O.by=de,O.bz=function(){return new Float64Array(3)},O.c=ue,O.c$=function(n,e,i,o,u){return d(this,void 0,void 0,(function*(){if(ti())try{return yield es(n,e,i,o,u)}catch{}return(function(f,p,y,x,T){const E=f.width,C=f.height;Gn&&Ba||(Gn=new OffscreenCanvas(E,C),Ba=Gn.getContext("2d",{willReadFrequently:!0})),Gn.width=E,Gn.height=C,Ba.drawImage(f,0,0,E,C);const D=Ba.getImageData(p,y,x,T);return Ba.clearRect(0,0,E,C),D.data})(n,e,i,o,u)}))},O.c0=class extends ja{constructor(n,e){super(n,e),this.current=Ua}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},O.c1=Xl,O.c2=class extends ja{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},O.c3=class extends ja{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},O.c4=Ot,O.c5=function(n,e){var i=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=i,n[2]=0,n[3]=-i,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},O.c6=function(n,e,i){var o=e[0],u=e[1],f=e[2];return n[0]=o*i[0]+u*i[3]+f*i[6],n[1]=o*i[1]+u*i[4]+f*i[7],n[2]=o*i[2]+u*i[5]+f*i[8],n},O.c7=function(n,e,i,o,u,f,p){var y=1/(e-i),x=1/(o-u),T=1/(f-p);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*T,n[11]=0,n[12]=(e+i)*y,n[13]=(u+o)*x,n[14]=(p+f)*T,n[15]=1,n},O.c8=class extends ja{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(4*n.length);for(let i=0;i<n.length;i++)e[4*i]=n[i].r,e[4*i+1]=n[i].g,e[4*i+2]=n[i].b,e[4*i+3]=n[i].a;this.gl.uniform4fv(this.location,e)}}},O.c9=class extends ja{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(n);this.gl.uniform1fv(this.location,e)}}},O.cA=function(n,e){return ye[e]&&"touches"in n},O.cB=function(n){return ye[n]||j[n]},O.cC=function(n,e,i){var o=e[0],u=e[1];return n[0]=i[0]*o+i[4]*u+i[12],n[1]=i[1]*o+i[5]*u+i[13],n},O.cD=function(n,e){const{x:i,y:o}=Ci.fromLngLat(e);return!(n<0||n>25||o<0||o>=1||i<0||i>=1)},O.cE=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},O.cF=class extends Ko{},O.cG=ay,O.cI=W,O.cJ=function(n,e){ue.REGISTERED_PROTOCOLS[n]=e},O.cK=function(n){delete ue.REGISTERED_PROTOCOLS[n]},O.cL=function(n,e){const i={};for(let u=0;u<n.length;u++){const f=e&&e[n[u].id]||Ls(n[u]);e&&(e[n[u].id]=f);let p=i[f];p||(p=i[f]=[]),p.push(n[u])}const o=[];for(const u in i)o.push(i[u]);return o},O.cM=lt,O.cN=Ap,O.cO=Hp,O.cP=dd,O.cQ=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=St/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const e=n.bucket.layers[0],i=e.layout,o=e._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new Ti(n.bucket.zoom+1),n.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Ti(n.bucket.zoom+1),n.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Ti(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=n.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Ti(T),n.canonical),o["text-size"].possiblyEvaluate(new Ti(E),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=n.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Ti(T),n.canonical),o["icon-size"].possiblyEvaluate(new Ti(E),n.canonical)]}const f=i.get("text-line-height")*$n,p=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",y=i.get("text-keep-upright"),x=i.get("text-size");for(const T of n.bucket.features){const E=i.get("text-font").evaluate(T,{},n.canonical).join(","),C=x.evaluate(T,{},n.canonical),D=u.layoutTextSize.evaluate(T,{},n.canonical),P=u.layoutIconSize.evaluate(T,{},n.canonical),B={horizontal:{},vertical:void 0},k=T.text;let N,G=[0,0];if(k){const X=k.toString(),ne=i.get("text-letter-spacing").evaluate(T,{},n.canonical)*$n,se=Bc(X)?ne:0,Se=i.get("text-anchor").evaluate(T,{},n.canonical),Ve=gl(e,T,n.canonical);if(!Ve){const Xe=i.get("text-radial-offset").evaluate(T,{},n.canonical);G=Xe?Mi(Se,[Xe*$n,hi]):i.get("text-offset").evaluate(T,{},n.canonical).map((Fe=>Fe*$n))}let Oe=p?"center":i.get("text-justify").evaluate(T,{},n.canonical);const qe=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(T,{},n.canonical)*$n:1/0,rt=()=>{n.bucket.allowVerticalPlacement&&vs(X)&&(B.vertical=Yh(k,n.glyphMap,n.glyphPositions,n.imagePositions,E,qe,f,Se,"left",se,G,O.az.vertical,!0,D,C))};if(!p&&Ve){const Xe=new Set;if(Oe==="auto")for(let Pe=0;Pe<Ve.values.length;Pe+=2)Xe.add(Xp(Ve.values[Pe]));else Xe.add(Oe);let Fe=!1;for(const Pe of Xe)if(!B.horizontal[Pe])if(Fe)B.horizontal[Pe]=B.horizontal[0];else{const dt=Yh(k,n.glyphMap,n.glyphPositions,n.imagePositions,E,qe,f,"center",Pe,se,G,O.az.horizontal,!1,D,C);dt&&(B.horizontal[Pe]=dt,Fe=dt.positionedLines.length===1)}rt()}else{Oe==="auto"&&(Oe=Xp(Se));const Xe=Yh(k,n.glyphMap,n.glyphPositions,n.imagePositions,E,qe,f,Se,Oe,se,G,O.az.horizontal,!1,D,C);Xe&&(B.horizontal[Oe]=Xe),rt(),vs(X)&&p&&y&&(B.vertical=Yh(k,n.glyphMap,n.glyphPositions,n.imagePositions,E,qe,f,Se,Oe,se,G,O.az.vertical,!1,D,C))}}let ee=!1;if(T.icon&&T.icon.name){const X=n.imageMap[T.icon.name];X&&(N=_p(n.imagePositions[T.icon.name],i.get("icon-offset").evaluate(T,{},n.canonical),i.get("icon-anchor").evaluate(T,{},n.canonical)),ee=!!X.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=ee:n.bucket.sdfIcons!==ee&&Ii("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(X.pixelRatio!==n.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const q=d_(B.horizontal)||B.vertical;n.bucket.iconsInText=!!q&&q.iconsInText,(q||N)&&iy(n.bucket,T,B,N,n.imageMap,u,D,P,G,ee,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},O.cR=Ku,O.cS=Yl,O.cT=Hc,O.cU=function(n){const e=new cd;return(function(i,o){for(const u in i.layers)o.writeMessage(3,Od,i.layers[u])})(n,e),e.finish()},O.cV=function(n,e,i,o,u,f){let p=s(n,e,i,u,0);return p=s(p,e,o,f,1),p},O.cW=class{constructor(n){this.maxEntries=n,this.map=new Map}get(n){const e=this.map.get(n);return e!==void 0&&(this.map.delete(n),this.map.set(n,e)),e}set(n,e){if(this.map.has(n))this.map.delete(n);else if(this.map.size>=this.maxEntries){const i=this.map.keys().next().value;this.map.delete(i)}this.map.set(n,e)}clear(){this.map.clear()}},O.cX=pi,O.cY=cd,O.cZ=mf,O.c_=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},O.ca=class extends Gs{},O.cb=wm,O.cc=class extends rn{},O.cd=Lh,O.ce=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},O.cf=So,O.cg=function(n,e,i){var o=e[0],u=e[1],f=e[2],p=i[3]*o+i[7]*u+i[11]*f+i[15];return n[0]=(i[0]*o+i[4]*u+i[8]*f+i[12])/(p=p||1),n[1]=(i[1]*o+i[5]*u+i[9]*f+i[13])/p,n[2]=(i[2]*o+i[6]*u+i[10]*f+i[14])/p,n},O.ch=class extends Jo{},O.ci=class extends t{},O.cj=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15]},O.ck=function(n,e){var i=n[0],o=n[1],u=n[2],f=n[3],p=n[4],y=n[5],x=n[6],T=n[7],E=n[8],C=n[9],D=n[10],P=n[11],B=n[12],k=n[13],N=n[14],G=n[15],ee=e[0],q=e[1],X=e[2],ne=e[3],se=e[4],Se=e[5],Ve=e[6],Oe=e[7],qe=e[8],rt=e[9],Xe=e[10],Fe=e[11],Pe=e[12],dt=e[13],ut=e[14],gt=e[15];return Math.abs(i-ee)<=mt*Math.max(1,Math.abs(i),Math.abs(ee))&&Math.abs(o-q)<=mt*Math.max(1,Math.abs(o),Math.abs(q))&&Math.abs(u-X)<=mt*Math.max(1,Math.abs(u),Math.abs(X))&&Math.abs(f-ne)<=mt*Math.max(1,Math.abs(f),Math.abs(ne))&&Math.abs(p-se)<=mt*Math.max(1,Math.abs(p),Math.abs(se))&&Math.abs(y-Se)<=mt*Math.max(1,Math.abs(y),Math.abs(Se))&&Math.abs(x-Ve)<=mt*Math.max(1,Math.abs(x),Math.abs(Ve))&&Math.abs(T-Oe)<=mt*Math.max(1,Math.abs(T),Math.abs(Oe))&&Math.abs(E-qe)<=mt*Math.max(1,Math.abs(E),Math.abs(qe))&&Math.abs(C-rt)<=mt*Math.max(1,Math.abs(C),Math.abs(rt))&&Math.abs(D-Xe)<=mt*Math.max(1,Math.abs(D),Math.abs(Xe))&&Math.abs(P-Fe)<=mt*Math.max(1,Math.abs(P),Math.abs(Fe))&&Math.abs(B-Pe)<=mt*Math.max(1,Math.abs(B),Math.abs(Pe))&&Math.abs(k-dt)<=mt*Math.max(1,Math.abs(k),Math.abs(dt))&&Math.abs(N-ut)<=mt*Math.max(1,Math.abs(N),Math.abs(ut))&&Math.abs(G-gt)<=mt*Math.max(1,Math.abs(G),Math.abs(gt))},O.cl=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},O.cm=n=>n.type==="symbol",O.cn=n=>n.type==="circle",O.co=n=>n.type==="heatmap",O.cp=n=>n.type==="line",O.cq=n=>n.type==="fill",O.cr=n=>n.type==="fill-extrusion",O.cs=n=>n.type==="hillshade",O.ct=n=>n.type==="color-relief",O.cu=n=>n.type==="background",O.cv=n=>n.type==="custom",O.cw=yt,O.cx=function(n,e,i){const o=Mt(e.x-i.x,e.y-i.y),u=Mt(n.x-i.x,n.y-i.y),f=Math.atan2(o[0]*u[1]-o[1]*u[0],(function(p,y){return p[0]*y[0]+p[1]*y[1]})(o,u));return ua(f)},O.cy=xt,O.cz=function(n,e){return j[e]&&(n instanceof MouseEvent||n instanceof WheelEvent)},O.d=Ie,O.d0=Uc,O.d1=Be,O.d2=class{constructor(n,e){this.layers={[gf]:this},this.name=gf,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=n.length,this.features=n}feature(n){return new eg(this.features[n],this.extent)}},O.d3=kl,O.d4=Tr,O.e=ri,O.f=n=>d(void 0,void 0,void 0,(function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(e)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),O.g=Me,O.h=n=>new Promise(((e,i)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=Br}))},o.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(n)],{type:"image/png"});o.src=n.byteLength?URL.createObjectURL(u):Br})),O.i=La,O.j=(n,e)=>we(ri(n,{type:"json"}),e),O.k=li,O.l=Et,O.m=we,O.n=(n,e)=>we(ri(n,{type:"arrayBuffer"}),e),O.o=function(n){return new cd(n).readFields(Pm,[])},O.p=pp,O.q=function(n){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))},O.r=Rh,O.s=Wa,O.t=Sn,O.u=be,O.v=Ou,O.w=Ii,O.x=kc,O.y=Vr,O.z=Vs})),Ye("worker",["./shared"],(function(O){class d{constructor(j,V){this.keyCache={},j&&this.replace(j,V)}replace(j,V){this._layerConfigs={},this._layers={},this.update(j,[],V)}update(j,V,H){for(const ue of j){this._layerConfigs[ue.id]=ue;const Me=this._layers[ue.id]=O.bT(ue,H);Me._featureFilter=O.aj(Me.filter,H),this.keyCache[ue.id]&&delete this.keyCache[ue.id]}for(const ue of V)delete this.keyCache[ue],delete this._layerConfigs[ue],delete this._layers[ue];this.familiesBySource={};const oe=O.cL(Object.values(this._layerConfigs),this.keyCache);for(const ue of oe){const Me=ue.map((et=>this._layers[et.id])),_e=Me[0];if(_e.isHidden())continue;const W=_e.source||"";let he=this.familiesBySource[W];he||(he=this.familiesBySource[W]={});const we=_e.sourceLayer||O.ai;let Ie=he[we];Ie||(Ie=he[we]=[]),Ie.push(Me)}}}class ge{constructor(j){const V={},H=[];for(const _e in j){const W=j[_e],he=V[_e]={};for(const we in W){const Ie=W[+we];if(!Ie||Ie.bitmap.width===0||Ie.bitmap.height===0)continue;const et={x:0,y:0,w:Ie.bitmap.width+2,h:Ie.bitmap.height+2};H.push(et),he[we]={rect:et,metrics:Ie.metrics}}}const{w:oe,h:ue}=O.p(H),Me=new O.r({width:oe||1,height:ue||1});for(const _e in j){const W=j[_e];for(const he in W){const we=W[+he];if(!we||we.bitmap.width===0||we.bitmap.height===0)continue;const Ie=V[_e][he].rect;O.r.copy(we.bitmap,Me,{x:0,y:0},{x:Ie.x+1,y:Ie.y+1},we.bitmap)}}this.image=Me,this.positions=V}}O.cM("GlyphAtlas",ge);class Be{constructor(j){this.tileID=new O.a2(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[]}parse(j,V,H,oe,ue){return O._(this,void 0,void 0,(function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new O.ag;const Me=new O.cN(Object.keys(j.layers).sort()),_e=new O.cO(this.tileID,this.promoteId);_e.bucketLayerIDs=[];const W={},he={featureIndex:_e,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:H,subdivisionGranularity:ue},we=V.familiesBySource[this.source];for(const Ri in we){const zn=j.layers[Ri];if(!zn)continue;zn.version===1&&O.w(`Vector tile source "${this.source}" layer "${Ri}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const bl=Me.encode(Ri),Do=[];for(let Qe=0;Qe<zn.length;Qe++){const _a=zn.feature(Qe),ya=_e.getId(_a,Ri);Do.push({feature:_a,id:ya,index:Qe,sourceLayerIndex:bl})}for(const Qe of we[Ri]){const _a=Qe[0];_a.source!==this.source&&O.w(`layer.source = ${_a.source} does not equal this.source = ${this.source}`),_a.isHidden(this.zoom,!0)||(ft(Qe,this.zoom,H),(W[_a.id]=_a.createBucket({index:_e.bucketLayerIDs.length,layers:Qe,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:bl,sourceID:this.source})).populate(Do,he,this.tileID.canonical),_e.bucketLayerIDs.push(Qe.map((ya=>ya.id))))}}const Ie=O.bY(he.glyphDependencies,(Ri=>Object.keys(Ri).map(Number)));this.inFlightDependencies.forEach((Ri=>Ri?.abort())),this.inFlightDependencies=[];let et=Promise.resolve({});if(Object.keys(Ie).length){const Ri=new AbortController;this.inFlightDependencies.push(Ri),et=oe.sendAsync({type:"GG",data:{stacks:Ie,source:this.source,tileID:this.tileID,type:"glyphs"}},Ri)}const pt=Object.keys(he.iconDependencies);let Et=Promise.resolve({});if(pt.length){const Ri=new AbortController;this.inFlightDependencies.push(Ri),Et=oe.sendAsync({type:"GI",data:{icons:pt,source:this.source,tileID:this.tileID,type:"icons"}},Ri)}const li=Object.keys(he.patternDependencies);let $t=Promise.resolve({});if(li.length){const Ri=new AbortController;this.inFlightDependencies.push(Ri),$t=oe.sendAsync({type:"GI",data:{icons:li,source:this.source,tileID:this.tileID,type:"patterns"}},Ri)}const be=he.dashDependencies;let fi=Promise.resolve({});if(Object.keys(be).length){const Ri=new AbortController;this.inFlightDependencies.push(Ri),fi=oe.sendAsync({type:"GDA",data:{dashes:be}},Ri)}const[Ki,Pt,ni,Vi]=yield Promise.all([et,Et,$t,fi]),Nt=new ge(Ki),Ji=new O.cP(Pt,ni);for(const Ri in W){const zn=W[Ri];zn instanceof O.ah?(ft(zn.layers,this.zoom,H),O.cQ({bucket:zn,glyphMap:Ki,glyphPositions:Nt.positions,imageMap:Pt,imagePositions:Ji.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:he.subdivisionGranularity})):zn.hasDependencies&&(zn instanceof O.cR||zn instanceof O.cS||zn instanceof O.cT)&&(ft(zn.layers,this.zoom,H),zn.addFeatures(he,this.tileID.canonical,Ji.patternPositions,Vi))}return this.status="done",{buckets:Object.values(W).filter((Ri=>!Ri.isEmpty())),featureIndex:_e,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Nt.image,imageAtlas:Ji,dashPositions:Vi,glyphMap:this.returnDependencies?Ki:null,iconMap:this.returnDependencies?Pt:null,glyphPositions:this.returnDependencies?Nt.positions:null}}))}}function ft(ye,j,V){const H=new O.H(j);for(const oe of ye)oe.recalculate(H,V)}class ht{constructor(j,V,H,oe,ue){this.type=j,this.properties=H||{},this.extent=ue,this.pointsArray=V,this.id=oe}loadGeometry(){return this.pointsArray.map((j=>j.map((V=>new O.P(V.x,V.y)))))}}class At{constructor(j,V,H){this.version=2,this._myFeatures=j,this.name=V,this.length=j.length,this.extent=H}feature(j){return this._myFeatures[j]}}class ei{constructor(){this.layers={}}addLayer(j){this.layers[j.name]=j}}function tt(ye){let j=O.cU(ye);return j.byteOffset===0&&j.byteLength===j.buffer.byteLength||(j=new Uint8Array(j)),{vectorTile:ye,rawData:j.buffer}}function nt(ye,j,V){const{extent:H}=ye,oe=Math.pow(2,V.z-j.z),ue=(V.x-j.x*oe)*H,Me=(V.y-j.y*oe)*H,_e=[];for(let W=0;W<ye.length;W++){const he=ye.feature(W);let we=he.loadGeometry();for(const et of we)for(const pt of et)pt.x=pt.x*oe-ue,pt.y=pt.y*oe-Me;const Ie=128;we=O.cV(we,he.type,-Ie,-Ie,H+Ie,H+Ie),we.length!==0&&_e.push(new ht(he.type,we,he.properties,he.id,H))}return new At(_e,ye.name,H)}class ve{constructor(j,V,H){this.actor=j,this.layerIndex=V,this.availableImages=H,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new O.cW(1e3)}loadVectorTile(j,V){return O._(this,void 0,void 0,(function*(){const H=yield O.n(j.request,V);try{return{vectorTile:j.encoding!=="mlt"?new O.cX(new O.cY(H.data)):new O.cZ(H.data),rawData:H.data,cacheControl:H.cacheControl,expires:H.expires}}catch(oe){const ue=new Uint8Array(H.data);let Me=`Unable to parse the tile at ${j.request.url}, `;throw Me+=ue[0]===31&&ue[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${oe.message}`,new Error(Me)}}))}loadTile(j){return O._(this,void 0,void 0,(function*(){const{uid:V,overzoomParameters:H}=j;H&&(j.request=H.overzoomRequest);const oe=!!(j&&j.request&&j.request.collectResourceTiming)&&new O.c_(j.request),ue=new Be(j);this.loading[V]=ue;const Me=new AbortController;ue.abort=Me;try{const _e=yield this.loadVectorTile(j,Me);if(delete this.loading[V],!_e)return null;if(H){const et=this._getOverzoomTile(j,_e.vectorTile);_e.rawData=et.rawData,_e.vectorTile=et.vectorTile}const W=_e.rawData,he={};_e.expires&&(he.expires=_e.expires),_e.cacheControl&&(he.cacheControl=_e.cacheControl);const we={};if(oe){const et=oe.finish();et&&(we.resourceTiming=JSON.parse(JSON.stringify(et)))}ue.vectorTile=_e.vectorTile;const Ie=ue.parse(_e.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity);this.loaded[V]=ue,this.fetching[V]={rawTileData:W,cacheControl:he,resourceTiming:we};try{const et=yield Ie;return O.e({rawTileData:W.slice(0),encoding:j.encoding},et,he,we)}finally{delete this.fetching[V]}}catch(_e){throw delete this.loading[V],ue.status="done",this.loaded[V]=ue,_e}}))}_getOverzoomTile(j,V){const{tileID:H,source:oe,overzoomParameters:ue}=j,{maxZoomTileID:Me}=ue,_e=`${Me.key}_${H.key}`,W=this.overzoomedTileResultCache.get(_e);if(W)return W;const he=new ei,we=this.layerIndex.familiesBySource[oe];for(const et in we){const pt=V.layers[et];if(!pt)continue;const Et=nt(pt,Me,H.canonical);Et.length>0&&he.addLayer(Et)}const Ie=tt(he);return this.overzoomedTileResultCache.set(_e,Ie),Ie}reloadTile(j){return O._(this,void 0,void 0,(function*(){const V=j.uid;if(!this.loaded||!this.loaded[V])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const H=this.loaded[V];if(H.showCollisionBoxes=j.showCollisionBoxes,H.status==="parsing"){const oe=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity);let ue;if(this.fetching[V]){const{rawTileData:Me,cacheControl:_e,resourceTiming:W}=this.fetching[V];delete this.fetching[V],ue=O.e({rawTileData:Me.slice(0),encoding:j.encoding},oe,_e,W)}else ue=oe;return ue}if(H.status==="done"&&H.vectorTile)return H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity)}))}abortTile(j){return O._(this,void 0,void 0,(function*(){const V=this.loading,H=j.uid;V&&V[H]&&V[H].abort&&(V[H].abort.abort(),delete V[H])}))}removeTile(j){return O._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]}))}}class ti{constructor(){this.loaded={}}loadTile(j){return O._(this,void 0,void 0,(function*(){const{uid:V,encoding:H,rawImageData:oe,redFactor:ue,greenFactor:Me,blueFactor:_e,baseShift:W}=j,he=oe.width+2,we=oe.height+2,Ie=O.b(oe)?new O.R({width:he,height:we},yield O.c$(oe,-1,-1,he,we)):oe,et=new O.d0(V,Ie,H,ue,Me,_e,W);return this.loaded=this.loaded||{},this.loaded[V]=et,et}))}removeTile(j){const V=this.loaded,H=j.uid;V&&V[H]&&delete V[H]}}var mt,Ft,Ot=(function(){if(Ft)return mt;function ye(V,H){if(V.length!==0){j(V[0],H);for(var oe=1;oe<V.length;oe++)j(V[oe],!H)}}function j(V,H){for(var oe=0,ue=0,Me=0,_e=V.length,W=_e-1;Me<_e;W=Me++){var he=(V[Me][0]-V[W][0])*(V[W][1]+V[Me][1]),we=oe+he;ue+=Math.abs(oe)>=Math.abs(he)?oe-we+he:he-we+oe,oe=we}oe+ue>=0!=!!H&&V.reverse()}return Ft=1,mt=function V(H,oe){var ue,Me=H&&H.type;if(Me==="FeatureCollection")for(ue=0;ue<H.features.length;ue++)V(H.features[ue],oe);else if(Me==="GeometryCollection")for(ue=0;ue<H.geometries.length;ue++)V(H.geometries[ue],oe);else if(Me==="Feature")V(H.geometry,oe);else if(Me==="Polygon")ye(H.coordinates,oe);else if(Me==="MultiPolygon")for(ue=0;ue<H.coordinates.length;ue++)ye(H.coordinates[ue],oe);return H}})(),jn=O.d1(Ot);const Ht={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ye=>ye},Ct=Math.fround||(Pi=new Float32Array(1),ye=>(Pi[0]=+ye,Pi[0]));var Pi;class bn{constructor(j){this.options=Object.assign(Object.create(Ht),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:V,minZoom:H,maxZoom:oe}=this.options;V&&console.time("total time");const ue=`prepare ${j.length} points`;V&&console.time(ue),this.points=j;const Me=[];for(let W=0;W<j.length;W++){const he=j[W];if(!he.geometry)continue;const[we,Ie]=he.geometry.coordinates,et=Ct(Gi(we)),pt=Ct(Cn(Ie));Me.push(et,pt,1/0,W,-1,1),this.options.reduce&&Me.push(0)}let _e=this.trees[oe+1]=this._createTree(Me);V&&console.timeEnd(ue);for(let W=oe;W>=H;W--){const he=+Date.now();_e=this.trees[W]=this._createTree(this._cluster(_e,W)),V&&console.log("z%d: %d clusters in %dms",W,_e.numItems,+Date.now()-he)}return V&&console.timeEnd("total time"),this}getClusters(j,V){let H=((j[0]+180)%360+360)%360-180;const oe=Math.max(-90,Math.min(90,j[1]));let ue=j[2]===180?180:((j[2]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)H=-180,ue=180;else if(H>ue){const Ie=this.getClusters([H,oe,180,Me],V),et=this.getClusters([-180,oe,ue,Me],V);return Ie.concat(et)}const _e=this.trees[this._limitZoom(V)],W=_e.range(Gi(H),Cn(Me),Gi(ue),Cn(oe)),he=_e.data,we=[];for(const Ie of W){const et=this.stride*Ie;we.push(he[et+5]>1?Yn(he,et,this.clusterProps):this.points[he[et+3]])}return we}getChildren(j){const V=this._getOriginId(j),H=this._getOriginZoom(j),oe="No cluster with the specified id.",ue=this.trees[H];if(!ue)throw new Error(oe);const Me=ue.data;if(V*this.stride>=Me.length)throw new Error(oe);const _e=this.options.radius/(this.options.extent*Math.pow(2,H-1)),W=ue.within(Me[V*this.stride],Me[V*this.stride+1],_e),he=[];for(const we of W){const Ie=we*this.stride;Me[Ie+4]===j&&he.push(Me[Ie+5]>1?Yn(Me,Ie,this.clusterProps):this.points[Me[Ie+3]])}if(he.length===0)throw new Error(oe);return he}getLeaves(j,V,H){const oe=[];return this._appendLeaves(oe,j,V=V||10,H=H||0,0),oe}getTile(j,V,H){const oe=this.trees[this._limitZoom(j)],ue=Math.pow(2,j),{extent:Me,radius:_e}=this.options,W=_e/Me,he=(H-W)/ue,we=(H+1+W)/ue,Ie={features:[]};return this._addTileFeatures(oe.range((V-W)/ue,he,(V+1+W)/ue,we),oe.data,V,H,ue,Ie),V===0&&this._addTileFeatures(oe.range(1-W/ue,he,1,we),oe.data,ue,H,ue,Ie),V===ue-1&&this._addTileFeatures(oe.range(0,he,W/ue,we),oe.data,-1,H,ue,Ie),Ie.features.length?Ie:null}getClusterExpansionZoom(j){let V=this._getOriginZoom(j)-1;for(;V<=this.options.maxZoom;){const H=this.getChildren(j);if(V++,H.length!==1)break;j=H[0].properties.cluster_id}return V}_appendLeaves(j,V,H,oe,ue){const Me=this.getChildren(V);for(const _e of Me){const W=_e.properties;if(W&&W.cluster?ue+W.point_count<=oe?ue+=W.point_count:ue=this._appendLeaves(j,W.cluster_id,H,oe,ue):ue<oe?ue++:j.push(_e),j.length===H)break}return ue}_createTree(j){const V=new O.aT(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<j.length;H+=this.stride)V.add(j[H],j[H+1]);return V.finish(),V.data=j,V}_addTileFeatures(j,V,H,oe,ue,Me){for(const _e of j){const W=_e*this.stride,he=V[W+5]>1;let we,Ie,et;if(he)we=An(V,W,this.clusterProps),Ie=V[W],et=V[W+1];else{const li=this.points[V[W+3]];we=li.properties;const[$t,be]=li.geometry.coordinates;Ie=Gi($t),et=Cn(be)}const pt={type:1,geometry:[[Math.round(this.options.extent*(Ie*ue-H)),Math.round(this.options.extent*(et*ue-oe))]],tags:we};let Et;Et=he||this.options.generateId?V[W+3]:this.points[V[W+3]].id,Et!==void 0&&(pt.id=Et),Me.features.push(pt)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,V){const{radius:H,extent:oe,reduce:ue,minPoints:Me}=this.options,_e=H/(oe*Math.pow(2,V)),W=j.data,he=[],we=this.stride;for(let Ie=0;Ie<W.length;Ie+=we){if(W[Ie+2]<=V)continue;W[Ie+2]=V;const et=W[Ie],pt=W[Ie+1],Et=j.within(W[Ie],W[Ie+1],_e),li=W[Ie+5];let $t=li;for(const be of Et){const fi=be*we;W[fi+2]>V&&($t+=W[fi+5])}if($t>li&&$t>=Me){let be,fi=et*li,Ki=pt*li,Pt=-1;const ni=(Ie/we<<5)+(V+1)+this.points.length;for(const Vi of Et){const Nt=Vi*we;if(W[Nt+2]<=V)continue;W[Nt+2]=V;const Ji=W[Nt+5];fi+=W[Nt]*Ji,Ki+=W[Nt+1]*Ji,W[Nt+4]=ni,ue&&(be||(be=this._map(W,Ie,!0),Pt=this.clusterProps.length,this.clusterProps.push(be)),ue(be,this._map(W,Nt)))}W[Ie+4]=ni,he.push(fi/$t,Ki/$t,1/0,ni,-1,$t),ue&&he.push(Pt)}else{for(let be=0;be<we;be++)he.push(W[Ie+be]);if($t>1)for(const be of Et){const fi=be*we;if(!(W[fi+2]<=V)){W[fi+2]=V;for(let Ki=0;Ki<we;Ki++)he.push(W[fi+Ki])}}}}return he}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,V,H){if(j[V+5]>1){const Me=this.clusterProps[j[V+6]];return H?Object.assign({},Me):Me}const oe=this.points[j[V+3]].properties,ue=this.options.map(oe);return H&&ue===oe?Object.assign({},ue):ue}}function Yn(ye,j,V){return{type:"Feature",id:ye[j+3],properties:An(ye,j,V),geometry:{type:"Point",coordinates:[(H=ye[j],360*(H-.5)),ma(ye[j+1])]}};var H}function An(ye,j,V){const H=ye[j+5],oe=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,ue=ye[j+6],Me=ue===-1?{}:Object.assign({},V[ue]);return Object.assign(Me,{cluster:!0,cluster_id:ye[j+3],point_count:H,point_count_abbreviated:oe})}function Gi(ye){return ye/360+.5}function Cn(ye){const j=Math.sin(ye*Math.PI/180),V=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return V<0?0:V>1?1:V}function ma(ye){const j=(180-360*ye)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function Hi(ye,j,V,H){let oe=H;const ue=j+(V-j>>1);let Me,_e=V-j;const W=ye[j],he=ye[j+1],we=ye[V],Ie=ye[V+1];for(let et=j+3;et<V;et+=3){const pt=je(ye[et],ye[et+1],W,he,we,Ie);if(pt>oe)Me=et,oe=pt;else if(pt===oe){const Et=Math.abs(et-ue);Et<_e&&(Me=et,_e=Et)}}oe>H&&(Me-j>3&&Hi(ye,j,Me,H),ye[Me+2]=oe,V-Me>3&&Hi(ye,Me,V,H))}function je(ye,j,V,H,oe,ue){let Me=oe-V,_e=ue-H;if(Me!==0||_e!==0){const W=((ye-V)*Me+(j-H)*_e)/(Me*Me+_e*_e);W>1?(V=oe,H=ue):W>0&&(V+=Me*W,H+=_e*W)}return Me=ye-V,_e=j-H,Me*Me+_e*_e}function it(ye,j,V,H){const oe={id:ye??null,type:j,geometry:V,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")Mt(oe,V);else if(j==="Polygon")Mt(oe,V[0]);else if(j==="MultiLineString")for(const ue of V)Mt(oe,ue);else if(j==="MultiPolygon")for(const ue of V)Mt(oe,ue[0]);return oe}function Mt(ye,j){for(let V=0;V<j.length;V+=3)ye.minX=Math.min(ye.minX,j[V]),ye.minY=Math.min(ye.minY,j[V+1]),ye.maxX=Math.max(ye.maxX,j[V]),ye.maxY=Math.max(ye.maxY,j[V+1])}function St(ye,j,V,H){if(!j.geometry)return;const oe=j.geometry.coordinates;if(oe&&oe.length===0)return;const ue=j.geometry.type,Me=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2);let _e=[],W=j.id;if(V.promoteId?W=j.properties[V.promoteId]:V.generateId&&(W=H||0),ue==="Point")Wt(oe,_e);else if(ue==="MultiPoint")for(const he of oe)Wt(he,_e);else if(ue==="LineString")de(oe,_e,Me,!1);else if(ue==="MultiLineString"){if(V.lineMetrics){for(const he of oe)_e=[],de(he,_e,Me,!1),ye.push(it(W,"LineString",_e,j.properties));return}Ze(oe,_e,Me,!1)}else if(ue==="Polygon")Ze(oe,_e,Me,!0);else{if(ue!=="MultiPolygon"){if(ue==="GeometryCollection"){for(const he of j.geometry.geometries)St(ye,{id:W,geometry:he,properties:j.properties},V,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const he of oe){const we=[];Ze(he,we,Me,!0),_e.push(we)}}ye.push(it(W,ue,_e,j.properties))}function Wt(ye,j){j.push(ot(ye[0]),yt(ye[1]),0)}function de(ye,j,V,H){let oe,ue,Me=0;for(let W=0;W<ye.length;W++){const he=ot(ye[W][0]),we=yt(ye[W][1]);j.push(he,we,0),W>0&&(Me+=H?(oe*we-he*ue)/2:Math.sqrt(Math.pow(he-oe,2)+Math.pow(we-ue,2))),oe=he,ue=we}const _e=j.length-3;j[2]=1,Hi(j,0,_e,V),j[_e+2]=1,j.size=Math.abs(Me),j.start=0,j.end=j.size}function Ze(ye,j,V,H){for(let oe=0;oe<ye.length;oe++){const ue=[];de(ye[oe],ue,V,H),j.push(ue)}}function ot(ye){return ye/360+.5}function yt(ye){const j=Math.sin(ye*Math.PI/180),V=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return V<0?0:V>1?1:V}function xt(ye,j,V,H,oe,ue,Me,_e){if(H/=j,ue>=(V/=j)&&Me<H)return ye;if(Me<V||ue>=H)return null;const W=[];for(const he of ye){const we=he.geometry;let Ie=he.type;const et=oe===0?he.minX:he.minY,pt=oe===0?he.maxX:he.maxY;if(et>=V&&pt<H){W.push(he);continue}if(pt<V||et>=H)continue;let Et=[];if(Ie==="Point"||Ie==="MultiPoint")zt(we,Et,V,H,oe);else if(Ie==="LineString")Xt(we,Et,V,H,oe,!1,_e.lineMetrics);else if(Ie==="MultiLineString")wi(we,Et,V,H,oe,!1);else if(Ie==="Polygon")wi(we,Et,V,H,oe,!0);else if(Ie==="MultiPolygon")for(const li of we){const $t=[];wi(li,$t,V,H,oe,!0),$t.length&&Et.push($t)}if(Et.length){if(_e.lineMetrics&&Ie==="LineString"){for(const li of Et)W.push(it(he.id,Ie,li,he.tags));continue}Ie!=="LineString"&&Ie!=="MultiLineString"||(Et.length===1?(Ie="LineString",Et=Et[0]):Ie="MultiLineString"),Ie!=="Point"&&Ie!=="MultiPoint"||(Ie=Et.length===3?"Point":"MultiPoint"),W.push(it(he.id,Ie,Et,he.tags))}}return W.length?W:null}function zt(ye,j,V,H,oe){for(let ue=0;ue<ye.length;ue+=3){const Me=ye[ue+oe];Me>=V&&Me<=H&&Xi(j,ye[ue],ye[ue+1],ye[ue+2])}}function Xt(ye,j,V,H,oe,ue,Me){let _e=ri(ye);const W=oe===0?Un:ga;let he,we,Ie=ye.start;for(let $t=0;$t<ye.length-3;$t+=3){const be=ye[$t],fi=ye[$t+1],Ki=ye[$t+2],Pt=ye[$t+3],ni=ye[$t+4],Vi=oe===0?be:fi,Nt=oe===0?Pt:ni;let Ji=!1;Me&&(he=Math.sqrt(Math.pow(be-Pt,2)+Math.pow(fi-ni,2))),Vi<V?Nt>V&&(we=W(_e,be,fi,Pt,ni,V),Me&&(_e.start=Ie+he*we)):Vi>H?Nt<H&&(we=W(_e,be,fi,Pt,ni,H),Me&&(_e.start=Ie+he*we)):Xi(_e,be,fi,Ki),Nt<V&&Vi>=V&&(we=W(_e,be,fi,Pt,ni,V),Ji=!0),Nt>H&&Vi<=H&&(we=W(_e,be,fi,Pt,ni,H),Ji=!0),!ue&&Ji&&(Me&&(_e.end=Ie+he*we),j.push(_e),_e=ri(ye)),Me&&(Ie+=he)}let et=ye.length-3;const pt=ye[et],Et=ye[et+1],li=oe===0?pt:Et;li>=V&&li<=H&&Xi(_e,pt,Et,ye[et+2]),et=_e.length-3,ue&&et>=3&&(_e[et]!==_e[0]||_e[et+1]!==_e[1])&&Xi(_e,_e[0],_e[1],_e[2]),_e.length&&j.push(_e)}function ri(ye){const j=[];return j.size=ye.size,j.start=ye.start,j.end=ye.end,j}function wi(ye,j,V,H,oe,ue){for(const Me of ye)Xt(Me,j,V,H,oe,ue,!1)}function Xi(ye,j,V,H){ye.push(j,V,H)}function Un(ye,j,V,H,oe,ue){const Me=(ue-j)/(H-j);return Xi(ye,ue,V+(oe-V)*Me,1),Me}function ga(ye,j,V,H,oe,ue){const Me=(ue-V)/(oe-V);return Xi(ye,j+(H-j)*Me,ue,1),Me}function Ya(ye,j){const V=[];for(let H=0;H<ye.length;H++){const oe=ye[H],ue=oe.type;let Me;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")Me=Ii(oe.geometry,j);else if(ue==="MultiLineString"||ue==="Polygon"){Me=[];for(const _e of oe.geometry)Me.push(Ii(_e,j))}else if(ue==="MultiPolygon"){Me=[];for(const _e of oe.geometry){const W=[];for(const he of _e)W.push(Ii(he,j));Me.push(W)}}V.push(it(oe.id,ue,Me,oe.tags))}return V}function Ii(ye,j){const V=[];V.size=ye.size,ye.start!==void 0&&(V.start=ye.start,V.end=ye.end);for(let H=0;H<ye.length;H+=3)V.push(ye[H]+j,ye[H+1],ye[H+2]);return V}function Qn(ye,j){if(ye.transformed)return ye;const V=1<<ye.z,H=ye.x,oe=ye.y;for(const ue of ye.features){const Me=ue.geometry,_e=ue.type;if(ue.geometry=[],_e===1)for(let W=0;W<Me.length;W+=2)ue.geometry.push(La(Me[W],Me[W+1],j,V,H,oe));else for(let W=0;W<Me.length;W++){const he=[];for(let we=0;we<Me[W].length;we+=2)he.push(La(Me[W][we],Me[W][we+1],j,V,H,oe));ue.geometry.push(he)}}return ye.transformed=!0,ye}function La(ye,j,V,H,oe,ue){return[Math.round(V*(ye*H-oe)),Math.round(V*(j*H-ue))]}function $i(ye,j,V,H,oe){const ue=j===oe.maxZoom?0:oe.tolerance/((1<<j)*oe.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:ye.length,source:null,x:V,y:H,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const _e of ye)Qa(Me,_e,ue,oe);return Me}function Qa(ye,j,V,H){const oe=j.geometry,ue=j.type,Me=[];if(ye.minX=Math.min(ye.minX,j.minX),ye.minY=Math.min(ye.minY,j.minY),ye.maxX=Math.max(ye.maxX,j.maxX),ye.maxY=Math.max(ye.maxY,j.maxY),ue==="Point"||ue==="MultiPoint")for(let _e=0;_e<oe.length;_e+=3)Me.push(oe[_e],oe[_e+1]),ye.numPoints++,ye.numSimplified++;else if(ue==="LineString")Br(Me,oe,ye,V,!1,!1);else if(ue==="MultiLineString"||ue==="Polygon")for(let _e=0;_e<oe.length;_e++)Br(Me,oe[_e],ye,V,ue==="Polygon",_e===0);else if(ue==="MultiPolygon")for(let _e=0;_e<oe.length;_e++){const W=oe[_e];for(let he=0;he<W.length;he++)Br(Me,W[he],ye,V,!0,he===0)}if(Me.length){let _e=j.tags||null;if(ue==="LineString"&&H.lineMetrics){_e={};for(const he in j.tags)_e[he]=j.tags[he];_e.mapbox_clip_start=oe.start/oe.size,_e.mapbox_clip_end=oe.end/oe.size}const W={geometry:Me,type:ue==="Polygon"||ue==="MultiPolygon"?3:ue==="LineString"||ue==="MultiLineString"?2:1,tags:_e};j.id!==null&&(W.id=j.id),ye.features.push(W)}}function Br(ye,j,V,H,oe,ue){const Me=H*H;if(H>0&&j.size<(oe?Me:H))return void(V.numPoints+=j.length/3);const _e=[];for(let W=0;W<j.length;W+=3)(H===0||j[W+2]>Me)&&(V.numSimplified++,_e.push(j[W],j[W+1])),V.numPoints++;oe&&(function(W,he){let we=0;for(let Ie=0,et=W.length,pt=et-2;Ie<et;pt=Ie,Ie+=2)we+=(W[Ie]-W[pt])*(W[Ie+1]+W[pt+1]);if(we>0===he)for(let Ie=0,et=W.length;Ie<et/2;Ie+=2){const pt=W[Ie],Et=W[Ie+1];W[Ie]=W[et-2-Ie],W[Ie+1]=W[et-1-Ie],W[et-2-Ie]=pt,W[et-1-Ie]=Et}})(_e,ue),ye.push(_e)}const es={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Gn{constructor(j,V){const H=(V=this.options=(function(ue,Me){for(const _e in Me)ue[_e]=Me[_e];return ue})(Object.create(es),V)).debug;if(H&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");let oe=(function(ue,Me){const _e=[];if(ue.type==="FeatureCollection")for(let W=0;W<ue.features.length;W++)St(_e,ue.features[W],Me,W);else St(_e,ue.type==="Feature"?ue:{geometry:ue},Me);return _e})(j,V);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),oe=(function(ue,Me){const _e=Me.buffer/Me.extent;let W=ue;const he=xt(ue,1,-1-_e,_e,0,-1,2,Me),we=xt(ue,1,1-_e,2+_e,0,-1,2,Me);return(he||we)&&(W=xt(ue,1,-_e,1+_e,0,-1,2,Me)||[],he&&(W=Ya(he,1).concat(W)),we&&(W=W.concat(Ya(we,-1)))),W})(oe,V),oe.length&&this.splitTile(oe,0,0,0),H&&(oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,V,H,oe,ue,Me,_e){const W=[j,V,H,oe],he=this.options,we=he.debug;for(;W.length;){oe=W.pop(),H=W.pop(),V=W.pop(),j=W.pop();const Ie=1<<V,et=Ba(V,H,oe);let pt=this.tiles[et];if(!pt&&(we>1&&console.time("creation"),pt=this.tiles[et]=$i(j,V,H,oe,he),this.tileCoords.push({z:V,x:H,y:oe}),we)){we>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,H,oe,pt.numFeatures,pt.numPoints,pt.numSimplified),console.timeEnd("creation"));const Ji=`z${V}`;this.stats[Ji]=(this.stats[Ji]||0)+1,this.total++}if(pt.source=j,ue==null){if(V===he.indexMaxZoom||pt.numPoints<=he.indexMaxPoints)continue}else{if(V===he.maxZoom||V===ue)continue;if(ue!=null){const Ji=ue-V;if(H!==Me>>Ji||oe!==_e>>Ji)continue}}if(pt.source=null,j.length===0)continue;we>1&&console.time("clipping");const Et=.5*he.buffer/he.extent,li=.5-Et,$t=.5+Et,be=1+Et;let fi=null,Ki=null,Pt=null,ni=null,Vi=xt(j,Ie,H-Et,H+$t,0,pt.minX,pt.maxX,he),Nt=xt(j,Ie,H+li,H+be,0,pt.minX,pt.maxX,he);j=null,Vi&&(fi=xt(Vi,Ie,oe-Et,oe+$t,1,pt.minY,pt.maxY,he),Ki=xt(Vi,Ie,oe+li,oe+be,1,pt.minY,pt.maxY,he),Vi=null),Nt&&(Pt=xt(Nt,Ie,oe-Et,oe+$t,1,pt.minY,pt.maxY,he),ni=xt(Nt,Ie,oe+li,oe+be,1,pt.minY,pt.maxY,he),Nt=null),we>1&&console.timeEnd("clipping"),W.push(fi||[],V+1,2*H,2*oe),W.push(Ki||[],V+1,2*H,2*oe+1),W.push(Pt||[],V+1,2*H+1,2*oe),W.push(ni||[],V+1,2*H+1,2*oe+1)}}getTile(j,V,H){j=+j,V=+V,H=+H;const oe=this.options,{extent:ue,debug:Me}=oe;if(j<0||j>24)return null;const _e=1<<j,W=Ba(j,V=V+_e&_e-1,H);if(this.tiles[W])return Qn(this.tiles[W],ue);Me>1&&console.log("drilling down to z%d-%d-%d",j,V,H);let he,we=j,Ie=V,et=H;for(;!he&&we>0;)we--,Ie>>=1,et>>=1,he=this.tiles[Ba(we,Ie,et)];return he&&he.source?(Me>1&&(console.log("found parent tile z%d-%d-%d",we,Ie,et),console.time("drilling down")),this.splitTile(he.source,we,Ie,et,j,V,H),Me>1&&console.timeEnd("drilling down"),this.tiles[W]?Qn(this.tiles[W],ue):null):null}}function Ba(ye,j,V){return 32*((1<<ye)*V+j)+ye}class Wa extends ve{constructor(j,V,H,oe=On){super(j,V,H),this._dataUpdateable=new Map,this._createGeoJSONIndex=oe}loadVectorTile(j,V){return O._(this,void 0,void 0,(function*(){const H=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const oe=this._geoJSONIndex.getTile(H.z,H.x,H.y);return oe?tt(new O.d2(oe.features,{version:2,extent:O.a5})):null}))}loadData(j){return O._(this,void 0,void 0,(function*(){var V;(V=this._pendingRequest)===null||V===void 0||V.abort();const H=this._startPerformance(j);this._pendingRequest=new AbortController;try{(!this._pendingData||j.request||j.data||j.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(j,this._pendingRequest));const oe=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(oe,j),this.loaded={};const ue={};return j.request&&(ue.data=oe),this._finishPerformance(H,j,ue),ue}catch(oe){if(delete this._pendingRequest,O.Z(oe))return{abandoned:!0};throw oe}}))}_startPerformance(j){var V;if(!((V=j?.request)===null||V===void 0)&&V.collectResourceTiming)return new O.c_(j.request)}_finishPerformance(j,V,H){if(!j)return;const oe=j.finish();oe&&(H.resourceTiming={},H.resourceTiming[V.source]=JSON.parse(JSON.stringify(oe)))}getData(){return O._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(j){const V=this.loaded;return V&&V[j.uid]?super.reloadTile(j):this.loadTile(j)}loadAndProcessGeoJSON(j,V){return O._(this,void 0,void 0,(function*(){let H;if(j.request?H=yield this.loadGeoJSONFromUrl(j.request,j.promoteId,V):j.data?H=this._loadGeoJSONFromObject(j.data,j.promoteId):j.dataDiff&&(H=this._loadGeoJSONFromDiff(j.dataDiff,j.promoteId,j.source)),delete this._pendingRequest,typeof H!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);return jn(H,!0),j.filter&&(H=this._filterGeoJSON(H,j.filter)),H}))}loadGeoJSONFromUrl(j,V,H){return O._(this,void 0,void 0,(function*(){const oe=yield O.j(j,H);return this._dataUpdateable=O.a7(oe.data,V),oe.data}))}_loadGeoJSONFromObject(j,V){return this._dataUpdateable=O.a7(j,V),j}_loadGeoJSONFromDiff(j,V,H){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${H}`);O.a8(this._dataUpdateable,j,V);const oe=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(oe)}_filterGeoJSON(j,V){const H=O.d3(V,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(H.result==="error")throw new Error(H.value.map((ue=>`${ue.key}: ${ue.message}`)).join(", "));const oe=j.features.filter((ue=>H.value.evaluate({zoom:0},ue)));return this._toFeatureCollection(oe)}_toFeatureCollection(j){return{type:"FeatureCollection",features:j}}removeSource(j){return O._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}function On(ye,j){return j.cluster?new bn((function({superclusterOptions:V,clusterProperties:H}){if(!H||!V)return V;const oe={},ue={},Me={accumulated:null,zoom:0},_e={properties:null},W=Object.keys(H);for(const he of W){const[we,Ie]=H[he],et=O.d3(Ie),pt=O.d3(typeof we=="string"?[we,["accumulated"],["get",he]]:we);oe[he]=et.value,ue[he]=pt.value}return V.map=he=>{_e.properties=he;const we={};for(const Ie of W)we[Ie]=oe[Ie].evaluate(Me,_e);return we},V.reduce=(he,we)=>{_e.properties=we;for(const Ie of W)Me.accumulated=he[Ie],he[Ie]=ue[Ie].evaluate(Me,_e)},V})(j)).load(ye.features):(function(V,H){return new Gn(V,H)})(ye,j.geojsonVtOptions)}class ua{constructor(j){this.self=j,this.actor=new O.L(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(V,H)=>{if(this.externalWorkerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.externalWorkerSourceTypes[V]=H},this.self.addProtocol=O.cJ,this.self.removeProtocol=O.cK,this.self.registerRTLTextPlugin=V=>{O.d4.setMethods(V)},this.actor.registerMessageHandler("LDT",((V,H)=>this._getDEMWorkerSource(V,H.source).loadTile(H))),this.actor.registerMessageHandler("RDT",((V,H)=>O._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(V,H.source).removeTile(H)})))),this.actor.registerMessageHandler("GCEZ",((V,H)=>O._(this,void 0,void 0,(function*(){return this._getWorkerSource(V,H.type,H.source).getClusterExpansionZoom(H)})))),this.actor.registerMessageHandler("GCC",((V,H)=>O._(this,void 0,void 0,(function*(){return this._getWorkerSource(V,H.type,H.source).getClusterChildren(H)})))),this.actor.registerMessageHandler("GCL",((V,H)=>O._(this,void 0,void 0,(function*(){return this._getWorkerSource(V,H.type,H.source).getClusterLeaves(H)})))),this.actor.registerMessageHandler("LD",((V,H)=>this._getWorkerSource(V,H.type,H.source).loadData(H))),this.actor.registerMessageHandler("GD",((V,H)=>this._getWorkerSource(V,H.type,H.source).getData())),this.actor.registerMessageHandler("LT",((V,H)=>this._getWorkerSource(V,H.type,H.source).loadTile(H))),this.actor.registerMessageHandler("RT",((V,H)=>this._getWorkerSource(V,H.type,H.source).reloadTile(H))),this.actor.registerMessageHandler("AT",((V,H)=>this._getWorkerSource(V,H.type,H.source).abortTile(H))),this.actor.registerMessageHandler("RMT",((V,H)=>this._getWorkerSource(V,H.type,H.source).removeTile(H))),this.actor.registerMessageHandler("RS",((V,H)=>O._(this,void 0,void 0,(function*(){if(!this.workerSources[V]||!this.workerSources[V][H.type]||!this.workerSources[V][H.type][H.source])return;const oe=this.workerSources[V][H.type][H.source];delete this.workerSources[V][H.type][H.source],oe.removeSource!==void 0&&oe.removeSource(H)})))),this.actor.registerMessageHandler("RM",(V=>O._(this,void 0,void 0,(function*(){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],this.globalStates.delete(V)})))),this.actor.registerMessageHandler("SR",((V,H)=>O._(this,void 0,void 0,(function*(){this.referrer=H})))),this.actor.registerMessageHandler("SRPS",((V,H)=>this._syncRTLPluginState(V,H))),this.actor.registerMessageHandler("IS",((V,H)=>O._(this,void 0,void 0,(function*(){this.self.importScripts(H)})))),this.actor.registerMessageHandler("SI",((V,H)=>this._setImages(V,H))),this.actor.registerMessageHandler("UL",((V,H)=>O._(this,void 0,void 0,(function*(){this._getLayerIndex(V).update(H.layers,H.removedIds,this._getGlobalState(V))})))),this.actor.registerMessageHandler("UGS",((V,H)=>O._(this,void 0,void 0,(function*(){const oe=this._getGlobalState(V);for(const ue in H)oe[ue]=H[ue]})))),this.actor.registerMessageHandler("SL",((V,H)=>O._(this,void 0,void 0,(function*(){this._getLayerIndex(V).replace(H,this._getGlobalState(V))}))))}_getGlobalState(j){let V=this.globalStates.get(j);return V||(V={},this.globalStates.set(j,V)),V}_setImages(j,V){return O._(this,void 0,void 0,(function*(){this.availableImages[j]=V;for(const H in this.workerSources[j]){const oe=this.workerSources[j][H];for(const ue in oe)oe[ue].availableImages=V}}))}_syncRTLPluginState(j,V){return O._(this,void 0,void 0,(function*(){return yield O.d4.syncState(V,this.self.importScripts)}))}_getAvailableImages(j){let V=this.availableImages[j];return V||(V=[]),V}_getLayerIndex(j){let V=this.layerIndexes[j];return V||(V=this.layerIndexes[j]=new d),V}_getWorkerSource(j,V,H){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][V]||(this.workerSources[j][V]={}),!this.workerSources[j][V][H]){const oe={sendAsync:(ue,Me)=>(ue.targetMapId=j,this.actor.sendAsync(ue,Me))};switch(V){case"vector":this.workerSources[j][V][H]=new ve(oe,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][V][H]=new Wa(oe,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][V][H]=new this.externalWorkerSourceTypes[V](oe,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][V][H]}_getDEMWorkerSource(j,V){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][V]||(this.demWorkerSources[j][V]=new ti),this.demWorkerSources[j][V]}}return O.i(self)&&(self.worker=new ua(self)),ua})),Ye("index",["exports","./shared"],(function(O,d){var ge="5.15.0";function Be(){var m=new d.A(4);return d.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let ft,ht,At;const ei={frame(m,t,r){const l=requestAnimationFrame((_=>{h(),t(_)})),{unsubscribe:h}=d.s(m.signal,"abort",(()=>{h(),cancelAnimationFrame(l),r(new d.a(m.signal.reason))}),!1)},frameAsync(m){return new Promise(((t,r)=>{this.frame(m,t,r)}))},getImageData(m,t=0){return this.getImageCanvasContext(m).getImageData(-t,-t,m.width+2*t,m.height+2*t)},getImageCanvasContext(m){const t=window.document.createElement("canvas"),r=t.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return t.width=m.width,t.height=m.height,r.drawImage(m,0,0,m.width,m.height),r},resolveURL:m=>(ft||(ft=document.createElement("a")),ft.href=m,ft.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return At!==void 0?At:!!matchMedia&&(ht==null&&(ht=matchMedia("(prefers-reduced-motion: reduce)")),ht.matches)},set prefersReducedMotion(m){At=m}},tt=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(m){this._frozenAt=m}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function nt(){return tt.getCurrentTime()}class ve{static testProp(t){if(!ve.docStyle)return t[0];for(let r=0;r<t.length;r++)if(t[r]in ve.docStyle)return t[r];return t[0]}static create(t,r,l){const h=window.document.createElement(t);return r!==void 0&&(h.className=r),l&&l.appendChild(h),h}static createNS(t,r){return window.document.createElementNS(t,r)}static disableDrag(){ve.docStyle&&ve.selectProp&&(ve.userSelect=ve.docStyle[ve.selectProp],ve.docStyle[ve.selectProp]="none")}static enableDrag(){ve.docStyle&&ve.selectProp&&(ve.docStyle[ve.selectProp]=ve.userSelect)}static setTransform(t,r){t.style[ve.transformProp]=r}static addEventListener(t,r,l,h={}){t.addEventListener(r,l,"passive"in h?h:h.capture)}static removeEventListener(t,r,l,h={}){t.removeEventListener(r,l,"passive"in h?h:h.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",ve.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ve.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",ve.suppressClickInternal,!0)}),0)}static getScale(t){const r=t.getBoundingClientRect();return{x:r.width/t.offsetWidth||1,y:r.height/t.offsetHeight||1,boundingClientRect:r}}static getPoint(t,r,l){const h=r.boundingClientRect;return new d.P((l.clientX-h.left)/r.x-t.clientLeft,(l.clientY-h.top)/r.y-t.clientTop)}static mousePos(t,r){const l=ve.getScale(t);return ve.getPoint(t,l,r)}static touchPos(t,r){const l=[],h=ve.getScale(t);for(let _=0;_<r.length;_++)l.push(ve.getPoint(t,h,r[_]));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const r=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),l=r.querySelectorAll("script");for(const h of l)h.remove();return ve.clean(r),r.innerHTML}static isPossiblyDangerous(t,r){const l=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!l.includes("javascript:")&&!l.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const r=t.children;for(const l of r)ve.removeAttributes(l),ve.clean(l)}static removeAttributes(t){for(const{name:r,value:l}of t.attributes)ve.isPossiblyDangerous(r,l)&&t.removeAttribute(r)}}ve.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ve.selectProp=ve.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ve.transformProp=ve.testProp(["transform","WebkitTransform"]);const ti={supported:!1,testSupport:function(m){!Ot&&Ft&&(jn?Ht(m):mt=m)}};let mt,Ft,Ot=!1,jn=!1;function Ht(m){const t=m.createTexture();m.bindTexture(m.TEXTURE_2D,t);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,Ft),m.isContextLost())return;ti.supported=!0}catch{}m.deleteTexture(t),Ot=!0}var Ct;typeof document<"u"&&(Ft=document.createElement("img"),Ft.onload=()=>{mt&&Ht(mt),mt=null,jn=!0},Ft.onerror=()=>{Ot=!0,mt=null},Ft.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(m){let t,r,l,h;m.resetRequestQueue=()=>{t=[],r=0,l=0,h={}},m.addThrottleControl=S=>{const A=l++;return h[A]=S,A},m.removeThrottleControl=S=>{delete h[S],v()},m.getImage=(S,A,z=!0)=>new Promise(((R,I)=>{ti.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),d.e(S,{type:"image"}),t.push({abortController:A,requestParameters:S,supportImageRefresh:z,state:"queued",onError:F=>{I(F)},onSuccess:F=>{R(F)}}),v()}));const _=S=>d._(this,void 0,void 0,(function*(){S.state="running";const{requestParameters:A,supportImageRefresh:z,onError:R,onSuccess:I,abortController:F}=S,U=z===!1&&!d.i(self)&&!d.g(A.url)&&(!A.headers||Object.keys(A.headers).reduce(((Y,J)=>Y&&J==="accept"),!0));r++;const $=U?b(A,F):d.m(A,F);try{const Y=yield $;delete S.abortController,S.state="completed",Y.data instanceof HTMLImageElement||d.b(Y.data)?I(Y):Y.data&&I({data:yield(Q=Y.data,typeof createImageBitmap=="function"?d.f(Q):d.h(Q)),cacheControl:Y.cacheControl,expires:Y.expires})}catch(Y){delete S.abortController,R(Y)}finally{r--,v()}var Q})),v=()=>{const S=(()=>{for(const A of Object.keys(h))if(h[A]())return!0;return!1})()?d.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=r;A<S&&t.length>0;A++){const z=t.shift();z.abortController.signal.aborted?A--:_(z)}},b=(S,A)=>new Promise(((z,R)=>{const I=new Image,F=S.url,U=S.credentials;U&&U==="include"?I.crossOrigin="use-credentials":(U&&U==="same-origin"||!d.d(F))&&(I.crossOrigin="anonymous"),A.signal.addEventListener("abort",(()=>{I.src="",R(new d.a(A.signal.reason))})),I.fetchPriority="high",I.onload=()=>{I.onerror=I.onload=null,z({data:I})},I.onerror=()=>{I.onerror=I.onload=null,A.signal.aborted||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},I.src=F}))})(Ct||(Ct={})),Ct.resetRequestQueue();class Pi{constructor(t){this._transformRequestFn=t??null}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function bn(m){const t=[];if(typeof m=="string")t.push({id:"default",url:m});else if(m&&m.length>0){const r=[];for(const{id:l,url:h}of m){const _=`${l}${h}`;r.indexOf(_)===-1&&(r.push(_),t.push({id:l,url:h}))}}return t}function Yn(m,t,r){try{const l=new URL(m);return l.pathname+=`${t}${r}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function An(m){const{userImage:t}=m;return!!(t&&t.render&&t.render())&&(m.data.replace(new Uint8Array(t.data.buffer)),!0)}class Gi extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:r,promiseResolve:l}of this.requestors)l(this._getImagesForIds(r));this.requestors=[]}}getImage(t){const r=this.images[t];if(r&&!r.data&&r.spriteData){const l=r.spriteData;r.data=new d.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),r.spriteData=null}return r}addImage(t,r){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,r)&&(this.images[t]=r)}_validate(t,r){let l=!0;const h=r.data||r.spriteData;return this._validateStretch(r.stretchX,h&&h.width)||(this.fire(new d.k(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(r.stretchY,h&&h.height)||(this.fire(new d.k(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(r.content,r)||(this.fire(new d.k(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,r){if(!t)return!0;let l=0;for(const h of t){if(h[0]<l||h[1]<h[0]||r<h[1])return!1;l=h[1]}return!0}_validateContent(t,r){if(!t)return!0;if(t.length!==4)return!1;const l=r.spriteData,h=l&&l.width||r.data.width,_=l&&l.height||r.data.height;return!(t[0]<0||h<t[0]||t[1]<0||_<t[1]||t[2]<0||h<t[2]||t[3]<0||_<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,r,l=!0){const h=this.getImage(t);if(l&&(h.data.width!==r.data.width||h.data.height!==r.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=h.version+1,this.images[t]=r,this.updatedImages[t]=!0}removeImage(t){const r=this.images[t];delete this.images[t],delete this.patterns[t],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((r,l)=>{let h=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(h=!1);this.isLoaded()||h?r(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:r})}))}_getImagesForIds(t){const r={};for(const l of t){let h=this.getImage(l);h||(this.fire(new d.l("styleimagemissing",{id:l})),h=this.getImage(l)),h?r[l]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:d.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:t,height:r}=this.atlasImage;return{width:t,height:r}}getPattern(t){const r=this.patterns[t],l=this.getImage(t);if(!l)return null;if(r&&r.position.version===l.version)return r.position;if(r)r.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},_=new d.I(h,l);this.patterns[t]={bin:h,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const r=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.T(t,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:r,h:l}=d.p(t),h=this.atlasImage;h.resize({width:r||1,height:l||1});for(const _ in this.patterns){const{bin:v}=this.patterns[_],b=v.x+1,S=v.y+1,A=this.getImage(_).data,z=A.width,R=A.height;d.R.copy(A,h,{x:0,y:0},{x:b,y:S},{width:z,height:R}),d.R.copy(A,h,{x:0,y:R-1},{x:b,y:S-1},{width:z,height:1}),d.R.copy(A,h,{x:0,y:0},{x:b,y:S+R},{width:z,height:1}),d.R.copy(A,h,{x:z-1,y:0},{x:b-1,y:S},{width:1,height:R}),d.R.copy(A,h,{x:0,y:0},{x:b+z,y:S},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const r of t){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const l=this.getImage(r);l||d.w(`Image with ID: "${r}" was not found`),An(l)&&this.updateImage(r,l)}}cloneImages(){const t={};for(const r in this.images){const l=this.images[r];t[r]=Object.assign(Object.assign({},l),{data:l.data?l.data.clone():null})}return t}}const Cn=1e20;function ma(m,t,r,l,h,_,v,b,S){for(let A=t;A<t+l;A++)Hi(m,r*_+A,_,h,v,b,S);for(let A=r;A<r+h;A++)Hi(m,A*_+t,1,l,v,b,S)}function Hi(m,t,r,l,h,_,v){_[0]=0,v[0]=-Cn,v[1]=Cn,h[0]=m[t];for(let b=1,S=0,A=0;b<l;b++){h[b]=m[t+b*r];const z=b*b;do{const R=_[S];A=(h[b]-h[R]+z-R*R)/(b-R)/2}while(A<=v[S]&&--S>-1);S++,_[S]=b,v[S]=A,v[S+1]=Cn}for(let b=0,S=0;b<l;b++){for(;v[S+1]<b;)S++;const A=_[S],z=b-A;m[t+b*r]=h[A]+z*z}}const je=d.v.layout_symbol["text-font"].default.join(",");class it{constructor(t,r,l){this.requestManager=t,this.localIdeographFontFamily=r,this.entries={},this.lang=l}setURL(t){this.url=t}getGlyphs(t){return d._(this,void 0,void 0,(function*(){const r=[];for(const _ in t)for(const v of t[_])r.push(this._getAndCacheGlyphsPromise(_,v));const l=yield Promise.all(r),h={};for(const{stack:_,id:v,glyph:b}of l)h[_]||(h[_]={}),h[_][v]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return h}))}_getAndCacheGlyphsPromise(t,r){return d._(this,void 0,void 0,(function*(){let l=this.entries[t];l||(l=this.entries[t]={glyphs:{},requests:{},ranges:{}});let h=l.glyphs[r];return h!==void 0?{stack:t,id:r,glyph:h}:!this.url||this._charUsesLocalIdeographFontFamily(r)?(h=l.glyphs[r]=this._drawGlyph(l,t,r),{stack:t,id:r,glyph:h}):yield this._downloadAndCacheRangePromise(t,r)}))}_downloadAndCacheRangePromise(t,r){return d._(this,void 0,void 0,(function*(){const l=this.entries[t],h=Math.floor(r/256);if(l.ranges[h])return{stack:t,id:r,glyph:null};if(!l.requests[h]){const _=it.loadGlyphRange(t,h,this.url,this.requestManager);l.requests[h]=_}try{const _=yield l.requests[h];for(const v in _)l.glyphs[+v]=_[+v];return l.ranges[h]=!0,{stack:t,id:r,glyph:_[r]||null}}catch(_){const v=l.glyphs[r]=this._drawGlyph(l,t,r);return this._warnOnMissingGlyphRange(v,h,r,_),{stack:t,id:r,glyph:v}}}))}_warnOnMissingGlyphRange(t,r,l,h){const _=256*r,v=_+255,b=l.toString(16).padStart(4,"0").toUpperCase();d.w(`Unable to load glyph range ${r}, ${_}-${v}. Rendering codepoint U+${b} locally instead. ${h}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&d.q(t)}_drawGlyph(t,r,l){const h=r===je&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(l),_=h?"ideographTinySDF":"tinySDF";t[_]||(t[_]=this._createTinySDF(h?this.localIdeographFontFamily:r));const v=t[_].draw(String.fromCodePoint(l));return{id:l,bitmap:new d.r({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const r=t?t.split(","):[];r.push("sans-serif");const l=r.map((h=>/[-\w]+/.test(h)?h:`'${CSS.escape(h)}'`)).join(",");return new it.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:this._fontWeight(r[0]),fontStyle:this._fontStyle(r[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const r={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let l;for(const[h,_]of Object.entries(r))new RegExp(`\\b${h}\\b`,"i").test(t)&&(l=`${_}`);return l}destroy(){for(const t in this.entries){const r=this.entries[t];r.tinySDF&&(r.tinySDF=null),r.ideographTinySDF&&(r.ideographTinySDF=null),r.glyphs={},r.requests={},r.ranges={}}this.entries={}}}it.loadGlyphRange=function(m,t,r,l){return d._(this,void 0,void 0,(function*(){const h=256*t,_=h+255,v=l.transformRequest(r.replace("{fontstack}",m).replace("{range}",`${h}-${_}`),"Glyphs"),b=yield d.n(v,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${t}, ${h}-${_}`);const S={};for(const A of d.o(b.data))S[A.id]=A;return S}))},it.TinySDF=class{constructor({fontSize:m=24,buffer:t=3,radius:r=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:_="normal",fontStyle:v="normal",lang:b=null}={}){this.buffer=t,this.cutoff=l,this.radius=r,this.lang=b;const S=this.size=m+4*t,A=this._createCanvas(S),z=this.ctx=A.getContext("2d",{willReadFrequently:!0});z.font=`${v} ${_} ${m}px ${h}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){const t=document.createElement("canvas");return t.width=t.height=m,t}draw(m){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:_}=this.ctx.measureText(m),v=Math.ceil(r),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-h))),S=Math.min(this.size-this.buffer,v+Math.ceil(l)),A=b+2*this.buffer,z=S+2*this.buffer,R=Math.max(A*z,0),I=new Uint8ClampedArray(R),F={data:I,width:A,height:z,glyphWidth:b,glyphHeight:S,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(b===0||S===0)return F;const{ctx:U,buffer:$,gridInner:Q,gridOuter:Y}=this;this.lang&&(U.lang=this.lang),U.clearRect($,$,b,S),U.fillText(m,$,$+v);const J=U.getImageData($,$,b,S);Y.fill(Cn,0,R),Q.fill(0,0,R);for(let re=0;re<S;re++)for(let K=0;K<b;K++){const ae=J.data[4*(re*b+K)+3]/255;if(ae===0)continue;const le=(re+$)*A+K+$;if(ae===1)Y[le]=0,Q[le]=Cn;else{const ie=.5-ae;Y[le]=ie>0?ie*ie:0,Q[le]=ie<0?ie*ie:0}}ma(Y,0,0,A,z,A,this.f,this.v,this.z),ma(Q,$,$,b,S,A,this.f,this.v,this.z);for(let re=0;re<R;re++){const K=Math.sqrt(Y[re])-Math.sqrt(Q[re]);I[re]=Math.round(255-255*(K/this.radius+this.cutoff))}return F}};class Mt{constructor(){this.specification=d.u.light.position}possiblyEvaluate(t,r){return d.F(t.expression.evaluate(r))}interpolate(t,r,l){return{x:d.G.number(t.x,r.x,l),y:d.G.number(t.y,r.y,l),z:d.G.number(t.z,r.z,l)}}}let St;class Wt extends d.E{constructor(t){super(),St=St||new d.t({anchor:new d.D(d.u.light.anchor),position:new Mt,color:new d.D(d.u.light.color),intensity:new d.D(d.u.light.intensity)}),this._transitionable=new d.x(St,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r={}){if(!this._validate(d.y,t,r))for(const l in t){const h=t[l];l.endsWith(d.z)?this._transitionable.setTransition(l.slice(0,-d.z.length),h):this._transitionable.setValue(l,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,l){return(!l||l.validate!==!1)&&d.B(this,t.call(d.C,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:d.u}))}}const de=new d.t({"sky-color":new d.D(d.u.sky["sky-color"]),"horizon-color":new d.D(d.u.sky["horizon-color"]),"fog-color":new d.D(d.u.sky["fog-color"]),"fog-ground-blend":new d.D(d.u.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.u.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.u.sky["atmosphere-blend"])});class Ze extends d.E{constructor(t){super(),this._transitionable=new d.x(de,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.H(0))}setSky(t,r={}){if(!this._validate(d.J,t,r)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in t){const h=t[l];l.endsWith(d.z)?this._transitionable.setTransition(l.slice(0,-d.z.length),h):this._transitionable.setValue(l,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,l={}){return l?.validate!==!1&&d.B(this,t.call(d.C,d.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:d.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class ot{constructor(t,r){this.width=t,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,r){const l=t.join(",")+String(r);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,r)),this.dashEntry[l]}getDashRanges(t,r,l){const h=[];let _=t.length%2==1?-t[t.length-1]*l:0,v=t[0]*l,b=!0;h.push({left:_,right:v,isDash:b,zeroLength:t[0]===0});let S=t[0];for(let A=1;A<t.length;A++){b=!b;const z=t[A];_=S*l,S+=z,v=S*l,h.push({left:_,right:v,isDash:b,zeroLength:z===0})}return h}addRoundDash(t,r,l){const h=r/2;for(let _=-l;_<=l;_++){const v=this.width*(this.nextRow+l+_);let b=0,S=t[b];for(let A=0;A<this.width;A++){A/S.right>1&&(S=t[++b]);const z=Math.abs(A-S.left),R=Math.abs(A-S.right),I=Math.min(z,R);let F;const U=_/l*(h+1);if(S.isDash){const $=h-Math.abs(U);F=Math.sqrt(I*I+$*$)}else F=h-Math.sqrt(I*I+U*U);this.data[v+A]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(t){for(let b=t.length-1;b>=0;--b){const S=t[b],A=t[b+1];S.zeroLength?t.splice(b,1):A&&A.isDash===S.isDash&&(A.left=S.left,t.splice(b,1))}const r=t[0],l=t[t.length-1];r.isDash===l.isDash&&(r.left=l.left-this.width,l.right=r.right+this.width);const h=this.width*this.nextRow;let _=0,v=t[_];for(let b=0;b<this.width;b++){b/v.right>1&&(v=t[++_]);const S=Math.abs(b-v.left),A=Math.abs(b-v.right),z=Math.min(S,A);this.data[h+b]=Math.max(0,Math.min(255,(v.isDash?z:-z)+128))}}addDash(t,r){const l=r?7:0,h=2*l+1;if(this.nextRow+h>this.height)return d.w("LineAtlas out of space"),null;let _=0;for(let b=0;b<t.length;b++)_+=t[b];if(_!==0){const b=this.width/_,S=this.getDashRanges(t,this.width,b);r?this.addRoundDash(S,b,l):this.addRegularDash(S)}const v={y:this.nextRow+l,height:2*l,width:_};return this.nextRow+=h,this.dirty=!0,v}bind(t){const r=t.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const yt="maplibre_preloaded_worker_pool";class xt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<xt.workerCount;)this.workers.push(new Worker(d.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((r=>{r.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[yt]}numActive(){return Object.keys(this.active).length}}const zt=Math.floor(ei.hardwareConcurrency/2);let Xt,ri;function wi(){return Xt||(Xt=new xt),Xt}xt.workerCount=d.K(globalThis)?Math.max(Math.min(zt,3),1):1;class Xi{constructor(t,r){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=r;const l=this.workerPool.acquire(r);for(let h=0;h<l.length;h++){const _=new d.L(l[h],r);_.name=`Worker ${h}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,r){const l=[];for(const h of this.actors)l.push(h.sendAsync({type:t,data:r}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((r=>{r.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,r){for(const l of this.actors)l.registerMessageHandler(t,r)}unregisterMessageHandler(t){for(const r of this.actors)r.unregisterMessageHandler(t)}}function Un(){return ri||(ri=new Xi(wi(),d.M),ri.registerMessageHandler("GR",((m,t,r)=>d.m(t,r)))),ri}function ga(m,t){const r=d.N();return d.O(r,r,[1,1,0]),d.Q(r,r,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?d.S(r,r,m.calculatePosMatrix(t.toUnwrapped())):r}function Ya(m,t,r,l,h,_,v){var b;const S=(function(I,F,U){if(I)for(const $ of I){const Q=F[$];if(Q&&Q.source===U&&Q.type==="fill-extrusion")return!0}else for(const $ in F){const Q=F[$];if(Q.source===U&&Q.type==="fill-extrusion")return!0}return!1})((b=h?.layers)!==null&&b!==void 0?b:null,t,m.id),A=_.maxPitchScaleFactor(),z=m.tilesIn(l,A,S);z.sort(Ii);const R=[];for(const I of z)R.push({wrappedTileID:I.tileID.wrapped().key,queryResults:I.tile.queryRenderedFeatures(t,r,m.getState(),I.queryGeometry,I.cameraQueryGeometry,I.scale,h,_,A,ga(_,I.tileID),v?(F,U)=>v(I.tileID,F,U):void 0)});return(function(I,F){for(const U in I)for(const $ of I[U])Qn($,F);return I})((function(I){const F={},U={};for(const $ of I){const Q=$.queryResults,Y=$.wrappedTileID,J=U[Y]=U[Y]||{};for(const re in Q){const K=Q[re],ae=J[re]=J[re]||{},le=F[re]=F[re]||[];for(const ie of K)ae[ie.featureIndex]||(ae[ie.featureIndex]=!0,le.push(ie))}}return F})(R),m)}function Ii(m,t){const r=m.tileID,l=t.tileID;return r.overscaledZ-l.overscaledZ||r.canonical.y-l.canonical.y||r.wrap-l.wrap||r.canonical.x-l.canonical.x}function Qn(m,t){const r=m.feature,l=t.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=l}function La(m,t,r){return d._(this,void 0,void 0,(function*(){let l=m;if(m.url?l=(yield d.j(t.transformRequest(m.url,"Source"),r)).data:yield ei.frameAsync(r),!l)return null;const h=d.U(d.e(l,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(h.vectorLayerIds=l.vector_layers.map((_=>_.id))),h}))}class $i{constructor(t,r){t&&(r?this.setSouthWest(t).setNorthEast(r):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof d.V?new d.V(t.lng,t.lat):d.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof d.V?new d.V(t.lng,t.lat):d.V.convert(t),this}extend(t){const r=this._sw,l=this._ne;let h,_;if(t instanceof d.V)h=t,_=t;else{if(!(t instanceof $i))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend($i.convert(t)):this.extend(d.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(d.V.convert(t)):this;if(h=t._sw,_=t._ne,!h||!_)return this}return r||l?(r.lng=Math.min(h.lng,r.lng),r.lat=Math.min(h.lat,r.lat),l.lng=Math.max(_.lng,l.lng),l.lat=Math.max(_.lat,l.lat)):(this._sw=new d.V(h.lng,h.lat),this._ne=new d.V(_.lng,_.lat)),this}getCenter(){return new d.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.V(this.getWest(),this.getNorth())}getSouthEast(){return new d.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:l}=d.V.convert(t);let h=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}intersects(t){if(!((t=$i.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const r=Math.abs(this.getEast()-this.getWest()),l=Math.abs(t.getEast()-t.getWest());if(r>=360||l>=360)return!0;const h=d.W(this.getWest(),-180,180),_=d.W(this.getEast(),-180,180),v=d.W(t.getWest(),-180,180),b=d.W(t.getEast(),-180,180),S=h>=_,A=v>=b;return!(!S||!A)||(S?b>=h||v<=_:A?_>=v||h<=b:v<=_&&b>=h)}static convert(t){return t instanceof $i?t:t&&new $i(t)}static fromLngLat(t,r=0){const l=360*r/40075017,h=l/Math.cos(Math.PI/180*t.lat);return new $i(new d.V(t.lng-h,t.lat-l),new d.V(t.lng+h,t.lat+l))}adjustAntiMeridian(){const t=new d.V(this._sw.lng,this._sw.lat),r=new d.V(this._ne.lng,this._ne.lat);return new $i(t,t.lng>r.lng?new d.V(r.lng+360,r.lat):r)}}class Qa{constructor(t,r,l){this.bounds=$i.convert(this.validateBounds(t)),this.minzoom=r||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const r=Math.pow(2,t.z),l=Math.floor(d.Y(this.bounds.getWest())*r),h=Math.floor(d.X(this.bounds.getNorth())*r),_=Math.ceil(d.Y(this.bounds.getEast())*r),v=Math.ceil(d.X(this.bounds.getSouth())*r);return t.x>=l&&t.x<_&&t.y>=h&&t.y<v}}class Br extends d.E{constructor(t,r,l,h){if(super(),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.U(r,["url","scheme","tileSize","promoteId","encoding"])),this._options=d.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield La(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(d.e(this,t),t.bounds&&(this.tileBounds=new Qa(t.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,d.Z(t)||this.fire(new d.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(t){return d._(this,void 0,void 0,(function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(r,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};l.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((_,v)=>{t.reloadPromise={resolve:_,reject:v}}))}else t.actor=this.dispatcher.getActor(),h="LT";t.abortController=new AbortController;try{const _=yield t.actor.sendAsync({type:h,data:l},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,_)}catch(_){if(delete t.abortController,t.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const r=t.tileID.scaledTo(this.maxzoom).canonical,l=r.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:r,overzoomRequest:this.map._requestManager.transformRequest(l,"Tile")}}_afterTileLoadWorkerResponse(t,r){if(r&&r.resourceTiming&&(t.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&t.setExpiryData(r),t.loadVectorData(r,this.map.painter),t.reloadPromise){const l=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(l.resolve).catch(l.reject)}}abortTile(t){return d._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return d._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class es extends d.E{constructor(t,r,l,h){super(),this.id=t,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},r),d.e(this,d.U(r,["url","scheme","tileSize"]))}load(){return d._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield La(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(d.e(this,r),r.bounds&&(this.tileBounds=new Qa(r.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(r){this._tileJSONRequest=null,this._loaded=!0,d.Z(r)||this.fire(new d.k(r))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return d.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return d._(this,void 0,void 0,(function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const l=yield Ct.getImage(this.map._requestManager.transformRequest(r,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const h=this.map.painter.context,_=h.gl,v=l.data;t.texture=this.map.painter.getTileTexture(v.width),t.texture?t.texture.update(v,{useMipmap:!0}):(t.texture=new d.T(h,v,_.RGBA,{useMipmap:!0}),t.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}}))}abortTile(t){return d._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return d._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class Gn extends es{constructor(t,r,l,h){super(t,r,l,h),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(t){return d._(this,void 0,void 0,(function*(){const r=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(r,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const h=yield Ct.getImage(l,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(h&&h.data){const _=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&t.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const v=d.b(_)&&d.$()?_:yield this.readImageNow(_),b={type:this.type,uid:t.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const S=yield t.actor.sendAsync({type:"LDT",data:b});t.dem=S,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(h){if(delete t.abortController,t.aborted)t.state="unloaded";else if(h)throw t.state="errored",h}}))}readImageNow(t){return d._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&d.a0()){const r=t.width+2,l=t.height+2;try{return new d.R({width:r,height:l},yield d.a1(t,-1,-1,r,l))}catch{}}return ei.getImageData(t,1)}))}_getNeighboringTiles(t){const r=t.canonical,l=Math.pow(2,r.z),h=(r.x-1+l)%l,_=r.x===0?t.wrap-1:t.wrap,v=(r.x+1+l)%l,b=r.x+1===l?t.wrap+1:t.wrap,S={};return S[new d.a2(t.overscaledZ,_,r.z,h,r.y).key]={backfilled:!1},S[new d.a2(t.overscaledZ,b,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(S[new d.a2(t.overscaledZ,_,r.z,h,r.y-1).key]={backfilled:!1},S[new d.a2(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},S[new d.a2(t.overscaledZ,b,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<l&&(S[new d.a2(t.overscaledZ,_,r.z,h,r.y+1).key]={backfilled:!1},S[new d.a2(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},S[new d.a2(t.overscaledZ,b,r.z,v,r.y+1).key]={backfilled:!1}),S}unloadTile(t){return d._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Ba(m){return m.type==="GeometryCollection"?m.geometries.map((t=>t.coordinates)).flat(1/0):m.coordinates.flat(1/0)}function Wa(m){const t=new $i;let r;switch(m.type){case"FeatureCollection":r=m.features.map((l=>Ba(l.geometry))).flat(1/0);break;case"Feature":r=Ba(m.geometry);break;default:r=Ba(m)}if(r.length==0)return t;for(let l=0;l<r.length-1;l+=2)t.extend([r[l],r[l+1]]);return t}class On extends d.E{constructor(t,r,l,h){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:r.data},this.actor=l.getActor(),this.setEventedParent(h),this._data=typeof r.data=="string"?{url:r.data}:{geojson:r.data},this._options=d.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:d.a5,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(r.clusterMaxZoom),minPoints:Math.max(2,r.clusterMinPoints||2),extent:d.a5,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(d.a5/this.tileSize)}_getClusterMaxZoom(t){const r=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||d.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${r}"`),r}load(){return d._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,r){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const l=this._updateWorkerData();return r?l:this}updateData(t,r){this._pendingWorkerUpdate.diff=d.a6(this._pendingWorkerUpdate.diff,t);const l=this._updateWorkerData();return r?l:this}getData(){return d._(this,void 0,void 0,(function*(){const t=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return d._(this,void 0,void 0,(function*(){return Wa(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,r,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:r,offset:l}})}_updateWorkerData(){return d._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void d.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:r}=this._pendingWorkerUpdate,l=d.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(l.request=this.map._requestManager.transformRequest(ei.resolveURL(t),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=t,this._pendingWorkerUpdate.data=void 0):r&&(l.dataDiff=r,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new d.l("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:l});if(this._isUpdatingWorker=!1,this._removed||h.abandoned)return void this.fire(new d.l("dataabort",{dataType:"source"}));h.data&&(this._data={geojson:h.data});const _=this._applyDiffToSource(r),v=this._getShouldReloadTileOptions(_);let b=null;h.resourceTiming&&h.resourceTiming[this.id]&&(b=h.resourceTiming[this.id].slice(0));const S={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&d.e(S,{resourceTiming:b}),this.fire(new d.l("data",Object.assign(Object.assign({},S),{sourceDataType:"metadata"}))),this.fire(new d.l("data",Object.assign(Object.assign({},S),{sourceDataType:"content",shouldReloadTileOptions:v})))}catch(h){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new d.l("dataabort",{dataType:"source"}));this.fire(new d.k(h))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiffToSource(t){if(!t)return;const r=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){const h=d.a7(this._data.geojson,r);if(!h)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:h}}if(!this._data.updateable)return;const l=d.a8(this._data.updateable,t,r);return t.removeAll||this._options.cluster?void 0:l}_getShouldReloadTileOptions(t){if(t)return{affectedBounds:t.filter(Boolean).map((r=>Wa(r)))}}shouldReloadTile(t,{affectedBounds:r}){if(t.state==="loading")return!0;if(t.state==="unloaded")return!1;const{buffer:l,extent:h}=this.workerOptions.geojsonVtOptions,_=(function({x:v,y:b,z:S},A=0){const z=d.a3((v-A)/Math.pow(2,S)),R=d.a4((b+1+A)/Math.pow(2,S)),I=d.a3((v+1+A)/Math.pow(2,S)),F=d.a4((b-A)/Math.pow(2,S));return new $i([z,R],[I,F])})(t.tileID.canonical,l/h);for(const v of r)if(_.intersects(v))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return d._(this,void 0,void 0,(function*(){const r=t.actor?"RT":"LT";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const h=yield this.actor.sendAsync({type:r,data:l},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(h,this.map.painter,r==="RT")}))}abortTile(t){return d._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return d._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class ua extends d.E{constructor(t,r,l,h){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=r}load(t){return d._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield Ct.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,t&&(this.coordinates=t),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,d.Z(r)||this.fire(new d.k(r))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const r=t.map(d.a9.fromLngLat);var l;return this.tileID=(function(h){const _=d.aa.fromPoints(h),v=_.width(),b=_.height(),S=Math.max(v,b),A=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),z=Math.pow(2,A);return new d.ac(A,Math.floor((_.minX+_.maxX)/2*z),Math.floor((_.minY+_.maxY)/2*z))})(r),this.terrainTileRanges=this._getOverlappingTileRanges(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map((h=>this.tileID.getTilePoint(h)._round())),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,r=t.gl;this.texture||(this.texture=new d.T(t,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const _=this.tiles[h];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,l=!0)}l&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return d._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:r,minY:l,maxX:h,maxY:_}=d.aa.fromPoints(t),v={};for(let b=0;b<=d.ab;b++){const S=Math.pow(2,b),A=Math.floor(r*S),z=Math.floor(l*S),R=Math.floor(h*S),I=Math.floor(_*S);v[b]={minTileX:A,minTileY:z,maxTileX:R,maxTileY:I}}return v}}class ye extends ua{constructor(t,r,l,h){super(t,r,l,h),this.roundZoom=!0,this.type="video",this.options=r}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const r of t.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield d.ad(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new d.k(r))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new d.k(new d.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,r=t.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new d.T(t,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const _=this.tiles[h];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,l=!0)}l&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class j extends ua{constructor(t,r,l,h){super(t,r,l,h),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some((_=>!Array.isArray(_)||_.length!==2||_.some((v=>typeof v!="number"))))||this.fire(new d.k(new d.ae(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.k(new d.ae(`sources.${t}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new d.k(new d.ae(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new d.k(new d.ae(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.k(new d.ae(`sources.${t}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,l=r.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new d.T(r,this.canvas,l.RGBA,{premultiply:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let h=!1;for(const _ in this.tiles){const v=this.tiles[_];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,h=!0)}h&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const V={},H=m=>{switch(m){case"geojson":return On;case"image":return ua;case"raster":return es;case"raster-dem":return Gn;case"vector":return Br;case"video":return ye;case"canvas":return j}return V[m]},oe="RTLPluginLoaded";class ue extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Un()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((r=>{throw this.status="error",r}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return d._(this,arguments,void 0,(function*(r,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ei.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return d._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.l(oe))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Me=null;function _e(){return Me||(Me=new ue),Me}var W,he;(function(m){m[m.Base=0]="Base",m[m.Parent=1]="Parent"})(W||(W={})),(function(m){m[m.Departing=0]="Departing",m[m.Incoming=1]="Incoming"})(he||(he={}));class we{constructor(t,r){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=d.af(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:r,fadingParentID:l,fadeEndTime:h}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=r,this.fadingParentID=l,this.fadeEndTime=h}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=nt(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,r,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(h,_){const v={};if(!_)return v;for(const b of h){const S=b.layerIds.map((A=>_.getLayer(A))).filter(Boolean);if(S.length!==0){b.layers=S,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map((A=>S.filter((z=>z.id===A))[0])));for(const A of S)v[A.id]=b}}return v})(t.buckets,r?.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const _=this.buckets[h];if(_ instanceof d.ah){if(this.hasSymbolBuckets=!0,!l)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const _=this.buckets[h];if(_ instanceof d.ah&&_.hasRTLText){this.hasRTLText=!0,_e().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const _=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(h).queryRadius(_))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new d.ag}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(t)}const r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new d.T(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new d.T(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,r,l,h,_,v,b,S,A,z,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:_,scale:v,tileSize:this.tileSize,pixelPosMatrix:z,transform:S,params:b,queryPadding:this.queryPadding*A,getElevation:R},t,r,l):{}}querySourceFeatures(t,r){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),_=r&&r.sourceLayer?r.sourceLayer:"",v=h[d.ai]||h[_];if(!v)return;const b=d.aj(r?.filter,r?.globalState),{z:S,x:A,y:z}=this.tileID.canonical,R={z:S,x:A,y:z};for(let I=0;I<v.length;I++){const F=v.feature(I);if(b.needGeometry){const Q=d.ak(F,!0);if(!b.filter(new d.H(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!b.filter(new d.H(this.tileID.overscaledZ),F))continue;const U=l.getId(F,_),$=new d.al(F,S,A,z,U);$.tile=R,t.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const l=d.am(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(r)if(this.expirationTime<r)h=!0;else{const _=this.expirationTime-r;_?this.expirationTime=l+Math.max(_,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!r.style.hasLayer(h))continue;const _=this.buckets[h],v=_.layers[0].sourceLayer||d.ai,b=l[v],S=t[v];if(!b||!S||Object.keys(S).length===0)continue;_.update(S,b,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const A=r&&r.style&&r.style.getLayer(h);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(_)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<nt()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=nt()+t}setDependencies(t,r){const l={};for(const h of r)l[h]=!0;this.dependencies[t]=l}hasDependency(t,r){for(const l of t){const h=this.dependencies[l];if(h){for(const _ of r)if(h[_])return!0}}return!1}}class Ie{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,l){const h=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},d.e(this.stateChanges[t][h],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==h&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const _ in this.state[t][h])l[_]||(this.deletedStates[t][h][_]=null)}else for(const _ in l)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][_]===null&&delete this.deletedStates[t][h][_]}removeFeatureState(t,r,l){if(this.deletedStates[t]===null)return;const h=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&r!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][l]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(l in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][l]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,r){const l=String(r),h=d.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const _=this.deletedStates[t][r];if(_===null)return{};for(const v in _)delete h[v]}return h}initializeTileState(t,r){t.setFeatureState(this.state,r)}coalesceChanges(t,r){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const _={};for(const v in this.stateChanges[h])this.state[h][v]||(this.state[h][v]={}),d.e(this.state[h][v],this.stateChanges[h][v]),_[v]=this.state[h][v];l[h]=_}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const _={};if(this.deletedStates[h]===null)for(const v in this.state[h])_[v]={},this.state[h][v]={};else for(const v in this.deletedStates[h]){if(this.deletedStates[h][v]===null)this.state[h][v]={};else for(const b of Object.keys(this.deletedStates[h][v]))delete this.state[h][v][b];_[v]=this.state[h][v]}l[h]=l[h]||{},d.e(l[h],_)}this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0&&t.setFeatureState(l,r)}}const et=89.25;function pt(m,t){const r=d.an(t.lat,-d.ao,d.ao);return new d.P(d.Y(t.lng)*m,d.X(r)*m)}function Et(m,t){return new d.a9(t.x/m,t.y/m).toLngLat()}function li(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(d.ap(90-m.pitch)),Math.tan(d.ap(et-m.pitch)))}function $t(m,t){const r=m.canonical,l=t/d.aq(r.z),h=r.x+Math.pow(2,r.z)*m.wrap,_=d.ar(new Float64Array(16));return d.O(_,_,[h*l,r.y*l,0]),d.Q(_,_,[l/d.a5,l/d.a5,1]),_}function be(m,t,r,l,h){const _=d.a9.fromLngLat(m,t),v=h*d.as(1,m.lat),{x:b,y:S,z:A}=fi(r,l);return new d.a9(_.x+v*-b,_.y+v*-S,_.z+v*-A)}function fi(m,t){const r=d.ap(m),l=d.ap(t),h=Math.cos(-r),_=Math.sin(r);return{x:_*Math.sin(l),y:-_*Math.cos(l),z:h}}function Ki(m,t,r){const l=t.intersectsFrustum(m);if(!r||l===0)return l;const h=t.intersectsPlane(r);return h===0?0:l===2&&h===2?2:1}function Pt(m,t,r){let l=0;const h=(r-t)/10;for(let _=0;_<10;_++)l+=h*Math.pow(Math.cos(t+(_+.5)/10*(r-t)),m);return l}function ni(m,t){return function(r,l,h,_,v){const b=2*((m-1)/d.at(Math.cos(d.ap(et-v))/Math.cos(d.ap(et)))-1),S=Math.acos(h/_),A=2*Pt(b-1,0,d.ap(v/2)),z=Math.min(d.ap(et),S+d.ap(v/2)),R=Pt(b-1,Math.min(z,S-d.ap(v/2)),z),I=Math.atan(l/h),F=Math.hypot(l,h);let U=r;return U+=d.at(_/F/Math.max(.5,Math.cos(d.ap(v/2)))),U+=b*d.at(Math.cos(I))/2,U-=d.at(Math.max(1,R/A/t))/2,U}}const Vi=ni(9.314,3);function Nt(m,t){const r=(t.roundZoom?Math.round:Math.floor)(m.zoom+d.at(m.tileSize/t.tileSize));return Math.max(0,r)}function Ji(m,t){const r=m.getCameraFrustum(),l=m.getClippingPlane(),h=m.screenPointToMercatorCoordinate(m.getCameraPoint()),_=d.a9.fromLngLat(m.center,m.elevation);h.z=_.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const v=m.getCoveringTilesDetailsProvider(),b=v.allowVariableZoom(m,t),S=Nt(m,t),A=t.minzoom||0,z=t.maxzoom!==void 0?t.maxzoom:m.maxZoom,R=Math.min(Math.max(0,S),z),I=Math.pow(2,R),F=[I*h.x,I*h.y,0],U=[I*_.x,I*_.y,0],$=Math.hypot(_.x-h.x,_.y-h.y),Q=Math.abs(_.z-h.z),Y=Math.hypot($,Q),J=ae=>({zoom:0,x:0,y:0,wrap:ae,fullyVisible:!1}),re=[],K=[];if(m.renderWorldCopies&&v.allowWorldCopies())for(let ae=1;ae<=3;ae++)re.push(J(-ae)),re.push(J(ae));for(re.push(J(0));re.length>0;){const ae=re.pop(),le=ae.x,ie=ae.y;let pe=ae.fullyVisible;const ze={x:le,y:ie,z:ae.zoom},Te=v.getTileBoundingVolume(ze,ae.wrap,m.elevation,t);if(!pe){const Ke=Ki(r,Te,l);if(Ke===0)continue;pe=Ke===2}const Ae=v.distanceToTile2d(h.x,h.y,ze,Te);let Ce=S;b&&(Ce=(t.calculateTileZoom||Vi)(m.zoom+d.at(m.tileSize/t.tileSize),Ae,Q,Y,m.fov)),Ce=(t.roundZoom?Math.round:Math.floor)(Ce),Ce=Math.max(0,Ce);const We=Math.min(Ce,z);if(ae.wrap=v.getWrap(_,ze,ae.wrap),ae.zoom>=We){if(ae.zoom<A)continue;const Ke=R-ae.zoom,Ge=F[0]-.5-(le<<Ke),at=F[1]-.5-(ie<<Ke),kt=t.reparseOverscaled?Math.max(ae.zoom,Ce):ae.zoom;K.push({tileID:new d.a2(ae.zoom===z?kt:ae.zoom,ae.wrap,ae.zoom,le,ie),distanceSq:d.au([U[0]-.5-le,U[1]-.5-ie]),tileDistanceToCamera:Math.sqrt(Ge*Ge+at*at)})}else for(let Ke=0;Ke<4;Ke++)re.push({zoom:ae.zoom+1,x:(le<<1)+Ke%2,y:(ie<<1)+(Ke>>1),wrap:ae.wrap,fullyVisible:pe})}return K.sort(((ae,le)=>ae.distanceSq-le.distanceSq)).map((ae=>ae.tileID))}const Ri=d.aa.fromPoints([new d.P(0,0),new d.P(d.a5,d.a5)]);function zn(m){return m==="raster"||m==="image"||m==="video"}function bl(m,t,r,l,h,_,v){if(!t.hasData())return!1;const{tileID:b,fadingRole:S,fadingDirection:A,fadingParentID:z}=t;if(S===W.Base&&A===he.Incoming&&z)return r[z.key]=z,!0;const R=Math.max(b.overscaledZ-h,_);for(let I=b.overscaledZ-1;I>=R;I--){const F=b.scaledTo(I),U=m.getLoadedTile(F);if(U)return t.setCrossFadeLogic({fadingRole:W.Base,fadingDirection:he.Incoming,fadingParentID:U.tileID,fadeEndTime:l+v}),U.setCrossFadeLogic({fadingRole:W.Parent,fadingDirection:he.Departing,fadeEndTime:l+v}),r[F.key]=F,!0}return!1}function Do(m,t,r,l,h,_){if(!t.hasData())return!1;const v=t.tileID.children(h);let b=Qe(m,t,v,r,l,h,_);if(b)return!0;for(const S of v)Qe(m,t,S.children(h),r,l,h,_)&&(b=!0);return b}function Qe(m,t,r,l,h,_,v){if(r[0].overscaledZ>=_)return!1;let b=!1;for(const S of r){const A=m.getLoadedTile(S);if(!A)continue;const{fadingRole:z,fadingDirection:R,fadingParentID:I}=A;z===W.Base&&R===he.Departing&&I||(A.setCrossFadeLogic({fadingRole:W.Base,fadingDirection:he.Departing,fadingParentID:t.tileID,fadeEndTime:h+v}),t.setCrossFadeLogic({fadingRole:W.Parent,fadingDirection:he.Incoming,fadeEndTime:h+v})),l[S.key]=S,b=!0}return b}function _a(m,t,r,l){const h=m.tileID;return!!m.selfFading||!m.hasData()&&!!t.has(h)&&(m.setSelfFadeLogic(r+l),!0)}function ya(m,t){var r;m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let l=t.tileID.canonical.x-m.tileID.canonical.x;const h=t.tileID.canonical.y-m.tileID.canonical.y,_=Math.pow(2,m.tileID.canonical.z),v=t.tileID.key;l===0&&h===0||Math.abs(h)>1||(Math.abs(l)>1&&(Math.abs(l+_)===1?l+=_:Math.abs(l-_)===1&&(l-=_)),t.dem&&m.dem&&(m.dem.backfillBorder(t.dem,l,h),!((r=m.neighboringTiles)===null||r===void 0)&&r[v]&&(m.neighboringTiles[v].backfilled=!0)))}class Or{constructor(){this._tiles={}}handleWrapJump(t){const r={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+t),r[h.tileID.key]=h}this._tiles=r}setFeatureState(t,r){for(const l in this._tiles)this._tiles[l].setFeatureState(t,r)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((r=>r.tileID)).sort(d.aw).map((r=>r.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,r){this._tiles[t]=r}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const r=this.getTileById(t.key);return r?.hasData()?r:null}isIdRenderable(t,r=!1){var l;return(l=this.getTileById(t))===null||l===void 0?void 0:l.isRenderable(r)}getRenderableIds(t=0,r){const l=[];for(const h of this.getAllIds())this.isIdRenderable(h,r)&&l.push(this.getTileById(h));return r?l.sort(((h,_)=>{const v=h.tileID,b=_.tileID,S=new d.P(v.canonical.x,v.canonical.y)._rotate(-t),A=new d.P(b.canonical.x,b.canonical.y)._rotate(-t);return v.overscaledZ-b.overscaledZ||A.y-S.y||A.x-S.x})).map((h=>h.tileID.key)):l.map((h=>h.tileID)).sort(d.aw).map((h=>h.key))}}class ji extends d.E{constructor(t,r,l){super(),this.id=t,this.dispatcher=l,this.on("data",(h=>this._dataHandler(h))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((h,_,v,b)=>{const S=new(H(_.type))(h,_,v,b);if(S.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${S.id}`);return S})(t,r,l,this),this._inViewTiles=new Or,this._outOfViewCache=new d.ax(0,(h=>this._unloadTile(h))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Ie,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const r of this._inViewTiles.getAllTiles())r.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Or}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,r,l){return d._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,r,l)}catch(h){t.state="errored",h.status!==404?this._source.fire(new d.k(h,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new d.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const r of this._inViewTiles.getAllTiles())r.upload(t),r.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var r;return this._inViewTiles.getRenderableIds((r=this.transform)===null||r===void 0?void 0:r.bearingInRadians,t)}hasRenderableParent(t){const r=t.overscaledZ-1;if(r>=this._source.minzoom){const l=this.getLoadedTile(t.scaledTo(r));if(l)return this._inViewTiles.isIdRenderable(l.tileID.key)}return!1}reload(t,r=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const l of this._inViewTiles.getAllIds()){const h=this._inViewTiles.getTileById(l);r&&!this._source.shouldReloadTile(h,r)||(t?this._reloadTile(l,"expired"):h.state!=="errored"&&this._reloadTile(l,"reloading"))}}}_reloadTile(t,r){return d._(this,void 0,void 0,(function*(){const l=this._inViewTiles.getTileById(t);l&&(l.state!=="loading"&&(l.state=r),yield this._loadTile(l,t,r))}))}_tileLoaded(t,r,l){t.timeAdded=nt(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this.getSource().type==="raster-dem"&&t.dem&&(function(h,_){var v,b;const S=_.getRenderableIds();for(const A of S){if(!h.neighboringTiles||!h.neighboringTiles[A])continue;const z=_.getTileById(A);h.neighboringTiles[A].backfilled||ya(h,z),!((b=(v=z.neighboringTiles)===null||v===void 0?void 0:v[h.tileID.key])===null||b===void 0)&&b.backfilled||ya(z,h)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new d.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,r){const l=this._getLoadedDescendents(r),h=new Set;for(const _ of r){const v=l[_.key];if(!v?.length){h.add(_);continue}const b=_.overscaledZ+ji.maxOverzooming,S=v.filter((R=>R.tileID.overscaledZ<=b));if(!S.length){h.add(_);continue}const A=Math.min(...S.map((R=>R.tileID.overscaledZ))),z=S.filter((R=>R.tileID.overscaledZ===A)).map((R=>R.tileID));for(const R of z)t[R.key]=R;this._areDescendentsComplete(z,A,_.overscaledZ)||h.add(_)}return h}_getLoadedDescendents(t){var r;const l={};for(const h of this._inViewTiles.getAllTiles().filter((_=>_.hasData())))for(const _ of t)h.tileID.isChildOf(_)&&(l[r=_.key]||(l[r]=[])).push(h);return l}_areDescendentsComplete(t,r,l){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===r:Math.pow(4,r-l)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const r=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,h=Math.floor(r*l*(this._maxTileCacheZoomLevels===null?d.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._outOfViewCache.setMaxSize(_)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,r&&(this._inViewTiles.handleWrapJump(r),this._resetTileReloadTimers())}update(t,r){if(!this._sourceLoaded||this._paused)return;let l;this.transform=t,this.terrain=r,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((S=>new d.a2(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y))):(l=Ji(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter((S=>this._source.hasTile(S))))):l=[],this.usedForTerrain&&(l=this._addTerrainIdealTiles(l));const h=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,h&&this.fire(new d.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const _=Nt(t,this._source),v=this._updateRetainedTiles(l,_),b=zn(this._source.type);b&&this._rasterFadeDuration>0&&!r&&(function(S,A,z,R,I,F,U){const $=nt(),Q=d.av(A);for(const Y of A){const J=S.getTileById(Y.key);J.fadingDirection!==he.Departing&&J.fadeOpacity!==0||J.resetFadeLogic(),bl(S,J,z,$,R,I,U)||Do(S,J,z,$,F,U)||_a(J,Q,$,U)||J.resetFadeLogic()}})(this._inViewTiles,l,v,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),b?this._cleanUpRasterTiles(v):this._cleanUpVectorTiles(v)}_cleanUpRasterTiles(t){for(const r of this._inViewTiles.getAllIds())t[r]||this._removeTile(r)}_cleanUpVectorTiles(t){for(const r of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(r);t[r]?l.clearSymbolFadeHold():l.hasSymbolBuckets?l.holdingForSymbolFade()?l.symbolFadeFinished()&&this._removeTile(r):l.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(r)}}_addTerrainIdealTiles(t){const r=[];for(const l of t)if(l.canonical.z>this._source.minzoom){const h=l.scaledTo(l.canonical.z-1);r.push(h);const _=l.scaledTo(Math.max(this._source.minzoom,Math.min(l.canonical.z,5)));r.push(_)}return t.concat(r)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,r){var l;const h=new Set;for(const A of t)this._addTile(A).hasData()||h.add(A);const _=t.reduce(((A,z)=>(A[z.key]=z,A)),{}),v=this._retainLoadedChildren(_,h),b={},S=Math.max(r-ji.maxUnderzooming,this._source.minzoom);for(const A of v){let z=this._inViewTiles.getTileById(A.key),R=z?.wasRequested();for(let I=A.overscaledZ-1;I>=S;--I){const F=A.scaledTo(I);if(b[F.key])break;if(b[F.key]=!0,z=this.getTile(F),!z&&R&&(z=this._addTile(F)),z){const U=z.hasData();if((U||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||R)&&(_[F.key]=F),R=z.wasRequested(),U)break}}}return _}_addTile(t){let r=this._inViewTiles.getTileById(t.key);if(r)return r;r=this._outOfViewCache.getAndRemove(t),r&&(r.resetFadeLogic(),this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null));const l=r;return r||(r=new we(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(r,t.key,r.state)),r.uses++,this._inViewTiles.setTile(t.key,r),l||this._source.fire(new d.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){this._clearTileReloadTimer(t);const l=r.getExpiryTimeout();l&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),l))}_clearTileReloadTimer(t){const r=this._timers[t];r&&(clearTimeout(r),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const r=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,r)}}refreshTiles(t){for(const r of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(r);(this._inViewTiles.isIdRenderable(r)||l.state=="errored")&&t.some((h=>h.equals(l.tileID.canonical)))&&this._reloadTile(r,"expired")}}_removeTile(t){const r=this._inViewTiles.getTileById(t);r&&(r.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._outOfViewCache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,r,l){const h=[],_=this.transform;if(!_)return h;const v=_.getCoveringTilesDetailsProvider().allowWorldCopies(),b=l?_.getCameraQueryGeometry(t):t,S=F=>_.screenPointToMercatorCoordinate(F,this.terrain),A=this.transformBbox(t,S,!v),z=this.transformBbox(b,S,!v),R=this.getIds(),I=d.aa.fromPoints(z);for(let F=0;F<R.length;F++){const U=this._inViewTiles.getTileById(R[F]);if(U.holdingForSymbolFade())continue;const $=v?[U.tileID]:[U.tileID.unwrapTo(-1),U.tileID.unwrapTo(0)],Q=Math.pow(2,_.zoom-U.tileID.overscaledZ),Y=r*U.queryPadding*d.a5/U.tileSize/Q;for(const J of $){const re=I.map((K=>J.getTilePoint(new d.a9(K.x,K.y))));if(re.expandBy(Y),re.intersects(Ri)){const K=A.map((le=>J.getTilePoint(le))),ae=z.map((le=>J.getTilePoint(le)));h.push({tile:U,tileID:v?J:J.unwrapTo(0),queryGeometry:K,cameraQueryGeometry:ae,scale:Q})}}}return h}transformBbox(t,r,l){let h=t.map(r);if(l){const _=d.aa.fromPoints(t);_.shrinkBy(.001*Math.min(_.width(),_.height()));const v=_.map(r);d.aa.fromPoints(h).covers(v)||(h=h.map((b=>b.x>.5?new d.a9(b.x-1,b.y,b.z):b)))}return h}getVisibleCoordinates(t){const r=this.getRenderableIds(t).map((l=>this._inViewTiles.getTileById(l).tileID));return this.transform&&this.transform.populateCache(r),r}hasTransition(){return!!this._source.hasTransition()||!(!zn(this._source.type)||!(function(t,r){if(r<=0)return!1;const l=nt();for(const h of t.getAllTiles())if(h.fadeEndTime>=l)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,r,l){this._state.updateState(t=t||d.ai,r,l)}removeFeatureState(t,r,l){this._state.removeFeatureState(t=t||d.ai,r,l)}getFeatureState(t,r){return this._state.getState(t=t||d.ai,r)}setDependencies(t,r,l){const h=this._inViewTiles.getTileById(t);h&&h.setDependencies(r,l)}reloadTilesForDependencies(t,r){for(const l of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(l).hasDependency(t,r)&&this._reloadTile(l,"reloading");this._outOfViewCache.filter((l=>!l.hasDependency(t,r)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}ji.maxUnderzooming=10,ji.maxOverzooming=3;class Je{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=d.an(t,0,1);let r=1,l=this._distances[r];const h=t*this.paddedLength+this.padding;for(;l<h&&r<this._distances.length;)l=this._distances[++r];const _=r-1,v=this._distances[_],b=l-v,S=b>0?(h-v)/b:0;return this.points[_].mult(1-S).add(this.points[r].mult(S))}}function jt(m,t){let r=!0;return m==="always"||m!=="never"&&t!=="never"||(r=!1),r}class Zt{constructor(t,r,l){const h=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(r/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)h.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,l,h,_){this._forEachCell(r,l,h,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(_)}insertCircle(t,r,l,h){this._forEachCell(r-h,l-h,r+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(l),this.circles.push(h)}_insertBoxCell(t,r,l,h,_,v){this.boxCells[_].push(v)}_insertCircleCell(t,r,l,h,_,v){this.circleCells[_].push(v)}_query(t,r,l,h,_,v,b){if(l<0||t>this.width||h<0||r>this.height)return[];const S=[];if(t<=0&&r<=0&&this.width<=l&&this.height<=h){if(_)return[{key:null,x1:t,y1:r,x2:l,y2:h}];for(let A=0;A<this.boxKeys.length;A++)S.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const z=this.circles[3*A],R=this.circles[3*A+1],I=this.circles[3*A+2];S.push({key:this.circleKeys[A],x1:z-I,y1:R-I,x2:z+I,y2:R+I})}}else this._forEachCell(t,r,l,h,this._queryCell,S,{hitTest:_,overlapMode:v,seenUids:{box:{},circle:{}}},b);return S}query(t,r,l,h){return this._query(t,r,l,h,!1,null)}hitTest(t,r,l,h,_,v){return this._query(t,r,l,h,!0,_,v).length>0}hitTestCircle(t,r,l,h,_){const v=t-l,b=t+l,S=r-l,A=r+l;if(b<0||v>this.width||A<0||S>this.height)return!1;const z=[];return this._forEachCell(v,S,b,A,this._queryCellCircle,z,{hitTest:!0,overlapMode:h,circle:{x:t,y:r,radius:l},seenUids:{box:{},circle:{}}},_),z.length>0}_queryCell(t,r,l,h,_,v,b,S){const{seenUids:A,hitTest:z,overlapMode:R}=b,I=this.boxCells[_];if(I!==null){const U=this.bboxes;for(const $ of I)if(!A.box[$]){A.box[$]=!0;const Q=4*$,Y=this.boxKeys[$];if(t<=U[Q+2]&&r<=U[Q+3]&&l>=U[Q+0]&&h>=U[Q+1]&&(!S||S(Y))&&(!z||!jt(R,Y.overlapMode))&&(v.push({key:Y,x1:U[Q],y1:U[Q+1],x2:U[Q+2],y2:U[Q+3]}),z))return!0}}const F=this.circleCells[_];if(F!==null){const U=this.circles;for(const $ of F)if(!A.circle[$]){A.circle[$]=!0;const Q=3*$,Y=this.circleKeys[$];if(this._circleAndRectCollide(U[Q],U[Q+1],U[Q+2],t,r,l,h)&&(!S||S(Y))&&(!z||!jt(R,Y.overlapMode))){const J=U[Q],re=U[Q+1],K=U[Q+2];if(v.push({key:Y,x1:J-K,y1:re-K,x2:J+K,y2:re+K}),z)return!0}}}return!1}_queryCellCircle(t,r,l,h,_,v,b,S){const{circle:A,seenUids:z,overlapMode:R}=b,I=this.boxCells[_];if(I!==null){const U=this.bboxes;for(const $ of I)if(!z.box[$]){z.box[$]=!0;const Q=4*$,Y=this.boxKeys[$];if(this._circleAndRectCollide(A.x,A.y,A.radius,U[Q+0],U[Q+1],U[Q+2],U[Q+3])&&(!S||S(Y))&&!jt(R,Y.overlapMode))return v.push(!0),!0}}const F=this.circleCells[_];if(F!==null){const U=this.circles;for(const $ of F)if(!z.circle[$]){z.circle[$]=!0;const Q=3*$,Y=this.circleKeys[$];if(this._circlesCollide(U[Q],U[Q+1],U[Q+2],A.x,A.y,A.radius)&&(!S||S(Y))&&!jt(R,Y.overlapMode))return v.push(!0),!0}}}_forEachCell(t,r,l,h,_,v,b,S){const A=this._convertToXCellCoord(t),z=this._convertToYCellCoord(r),R=this._convertToXCellCoord(l),I=this._convertToYCellCoord(h);for(let F=A;F<=R;F++)for(let U=z;U<=I;U++)if(_.call(this,t,r,l,h,this.xCellCount*U+F,v,b,S))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,l,h,_,v){const b=h-t,S=_-r,A=l+v;return A*A>b*b+S*S}_circleAndRectCollide(t,r,l,h,_,v,b){const S=(v-h)/2,A=Math.abs(t-(h+S));if(A>S+l)return!1;const z=(b-_)/2,R=Math.abs(r-(_+z));if(R>z+l)return!1;if(A<=S||R<=z)return!0;const I=A-S,F=R-z;return I*I+F*F<=l*l}}function Ka(m,t,r){const l=d.N();if(!m){const{vecSouth:R,vecEast:I}=ts(t),F=Be();F[0]=I[0],F[1]=I[1],F[2]=R[0],F[3]=R[1],h=F,(z=(v=(_=F)[0])*(A=_[3])-(S=_[2])*(b=_[1]))&&(h[0]=A*(z=1/z),h[1]=-b*z,h[2]=-S*z,h[3]=v*z),l[0]=F[0],l[1]=F[1],l[4]=F[2],l[5]=F[3]}var h,_,v,b,S,A,z;return d.Q(l,l,[1/r,1/r,1]),l}function cc(m,t,r,l){if(m){const h=d.N();if(!t){const{vecSouth:_,vecEast:v}=ts(r);h[0]=v[0],h[1]=v[1],h[4]=_[0],h[5]=_[1]}return d.Q(h,h,[l,l,1]),h}return r.pixelsToClipSpaceMatrix}function ts(m){const t=Math.cos(m.rollInRadians),r=Math.sin(m.rollInRadians),l=Math.cos(m.pitchInRadians),h=Math.cos(m.bearingInRadians),_=Math.sin(m.bearingInRadians),v=d.aC();v[0]=-h*l*r-_*t,v[1]=-_*l*r+h*t;const b=d.aD(v);b<1e-9?d.aE(v):d.aF(v,v,1/b);const S=d.aC();S[0]=h*l*t-_*r,S[1]=_*l*t+h*r;const A=d.aD(S);return A<1e-9?d.aE(S):d.aF(S,S,1/A),{vecEast:S,vecSouth:v}}function Vt(m,t,r,l){let h;l?(h=[m,t,l(m,t),1],d.aH(h,h,r)):(h=[m,t,0,1],mr(h,h,r));const _=h[3];return{point:new d.P(h[0]/_,h[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}function Po(m,t){return .5+m/t*.5}function is(m,t){return m.x>=-t[0]&&m.x<=t[0]&&m.y>=-t[1]&&m.y<=t[1]}function zs(m,t,r,l,h,_,v,b,S,A,z,R,I){const F=r?m.textSizeData:m.iconSizeData,U=d.ay(F,t.transform.zoom),$=[256/t.width*2+1,256/t.height*2+1],Q=r?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;Q.clear();const Y=m.lineVertexArray,J=r?m.text.placedSymbolArray:m.icon.placedSymbolArray,re=t.transform.width/t.transform.height;let K=!1;for(let ae=0;ae<J.length;ae++){const le=J.get(ae);if(le.hidden||le.writingMode===d.az.vertical&&!K){rs(le.numGlyphs,Q);continue}K=!1;const ie=new d.P(le.anchorX,le.anchorY),pe={getElevation:I,pitchedLabelPlaneMatrix:l,lineVertexArray:Y,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:ie,unwrappedTileID:S,width:A,height:z,translation:R},ze=Tl(le.anchorX,le.anchorY,pe);if(!is(ze.point,$)){rs(le.numGlyphs,Q);continue}const Te=Po(t.transform.cameraToCenterDistance,ze.signedDistanceFromCamera),Ae=d.aA(F,U,le),Ce=_?Ae*t.transform.getPitchedTextCorrection(le.anchorX,le.anchorY,S)/Te:Ae*Te,We=fn({projectionContext:pe,pitchedLabelPlaneMatrixInverse:h,symbol:le,fontSize:Ce,flip:!1,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:Q,aspectRatio:re,rotateToLine:b});K=We.useVertical,(We.notEnoughRoom||K||We.needsFlipping&&fn({projectionContext:pe,pitchedLabelPlaneMatrixInverse:h,symbol:le,fontSize:Ce,flip:!0,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:Q,aspectRatio:re,rotateToLine:b}).notEnoughRoom)&&rs(le.numGlyphs,Q)}r?m.text.dynamicLayoutVertexBuffer.updateData(Q):m.icon.dynamicLayoutVertexBuffer.updateData(Q)}function ns(m,t,r,l,h,_,v,b){const S=_.glyphStartIndex+_.numGlyphs,A=_.lineStartIndex,z=_.lineStartIndex+_.lineLength,R=t.getoffsetX(_.glyphStartIndex),I=t.getoffsetX(S-1),F=kr(m*R,r,l,h,_.segment,A,z,b,v);if(!F)return null;const U=kr(m*I,r,l,h,_.segment,A,z,b,v);return U?b.projectionCache.anyProjectionOccluded?null:{first:F,last:U}:null}function as(m,t,r,l){return m===d.az.horizontal&&Math.abs(r.y-t.y)>Math.abs(r.x-t.x)*l?{useVertical:!0}:(m===d.az.vertical?t.y<r.y:t.x>r.x)?{needsFlipping:!0}:null}function fn(m){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:r,symbol:l,fontSize:h,flip:_,keepUpright:v,glyphOffsetArray:b,dynamicLayoutVertexArray:S,aspectRatio:A,rotateToLine:z}=m,R=h/24,I=l.lineOffsetX*R,F=l.lineOffsetY*R;let U;if(l.numGlyphs>1){const $=l.glyphStartIndex+l.numGlyphs,Q=l.lineStartIndex,Y=l.lineStartIndex+l.lineLength,J=ns(R,b,I,F,_,l,z,t);if(!J)return{notEnoughRoom:!0};const re=Ds(J.first.point.x,J.first.point.y,t,r),K=Ds(J.last.point.x,J.last.point.y,t,r);if(v&&!_){const ae=as(l.writingMode,re,K,A);if(ae)return ae}U=[J.first];for(let ae=l.glyphStartIndex+1;ae<$-1;ae++){const le=kr(R*b.getoffsetX(ae),I,F,_,l.segment,Q,Y,t,z);if(!le)return{notEnoughRoom:!0};U.push(le)}U.push(J.last)}else{if(v&&!_){const Q=ui(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,Y=l.lineStartIndex+l.segment+1,J=new d.P(t.lineVertexArray.getx(Y),t.lineVertexArray.gety(Y)),re=ui(J.x,J.y,t),K=re.signedDistanceFromCamera>0?re.point:wl(t.tileAnchorPoint,J,Q,1,t),ae=Ds(Q.x,Q.y,t,r),le=Ds(K.x,K.y,t,r),ie=as(l.writingMode,ae,le,A);if(ie)return ie}const $=kr(R*b.getoffsetX(l.glyphStartIndex),I,F,_,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,t,z);if(!$||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};U=[$]}for(const $ of U)d.aG(S,$.point,$.angle);return{}}function wl(m,t,r,l,h){const _=m.add(m.sub(t)._unit()),v=ui(_.x,_.y,h).point,b=r.sub(v);return r.add(b._mult(l/b.mag()))}function va(m,t,r){const l=t.projectionCache;if(l.projections[m])return l.projections[m];const h=new d.P(t.lineVertexArray.getx(m),t.lineVertexArray.gety(m)),_=ui(h.x,h.y,t);if(_.signedDistanceFromCamera>0)return l.projections[m]=_.point,l.anyProjectionOccluded=l.anyProjectionOccluded||_.isOccluded,_.point;const v=m-r.direction;return wl(r.distanceFromAnchor===0?t.tileAnchorPoint:new d.P(t.lineVertexArray.getx(v),t.lineVertexArray.gety(v)),h,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,t)}function ui(m,t,r){const l=m+r.translation[0],h=t+r.translation[1];let _;return r.pitchWithMap?(_=Vt(l,h,r.pitchedLabelPlaneMatrix,r.getElevation),_.isOccluded=!1):(_=r.transform.projectTileCoordinates(l,h,r.unwrappedTileID,r.getElevation),_.point.x=(.5*_.point.x+.5)*r.width,_.point.y=(.5*-_.point.y+.5)*r.height),_}function Ds(m,t,r,l){if(r.pitchWithMap){const h=[m,t,0,1];return d.aH(h,h,l),r.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],r.unwrappedTileID,r.getElevation).point}return{x:m/r.width*2-1,y:1-t/r.height*2}}function Tl(m,t,r){return r.transform.projectTileCoordinates(m,t,r.unwrappedTileID,r.getElevation)}function Sl(m,t,r){return m._unit()._perp()._mult(t*r)}function Js(m,t,r,l,h,_,v,b,S){if(b.projectionCache.offsets[m])return b.projectionCache.offsets[m];const A=r.add(t);if(m+S.direction<l||m+S.direction>=h)return b.projectionCache.offsets[m]=A,A;const z=va(m+S.direction,b,S),R=Sl(z.sub(r),v,S.direction),I=r.add(R),F=z.add(R);return b.projectionCache.offsets[m]=d.aI(_,A,I,F)||A,b.projectionCache.offsets[m]}function kr(m,t,r,l,h,_,v,b,S){const A=l?m-t:m+t;let z=A>0?1:-1,R=0;l&&(z*=-1,R=Math.PI),z<0&&(R+=Math.PI);let I,F=z>0?_+h:_+h+1;b.projectionCache.cachedAnchorPoint?I=b.projectionCache.cachedAnchorPoint:(I=ui(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=I);let U,$,Q=I,Y=I,J=0,re=0;const K=Math.abs(A),ae=[];let le;for(;J+re<=K;){if(F+=z,F<_||F>=v)return null;J+=re,Y=Q,$=U;const ze={absOffsetX:K,direction:z,distanceFromAnchor:J,previousVertex:Y};if(Q=va(F,b,ze),r===0)ae.push(Y),le=Q.sub(Y);else{let Te;const Ae=Q.sub(Y);Te=Ae.mag()===0?Sl(va(F+z,b,ze).sub(Q),r,z):Sl(Ae,r,z),$||($=Y.add(Te)),U=Js(F,Te,Q,_,v,$,r,b,ze),ae.push($),le=U.sub($)}re=le.mag()}const ie=le._mult((K-J)/re)._add($||Y),pe=R+Math.atan2(Q.y-Y.y,Q.x-Y.x);return ae.push(ie),{point:ie,angle:S?pe:0,path:ae}}const cu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function rs(m,t){for(let r=0;r<m;r++){const l=t.length;t.resize(l+4),t.float32.set(cu,3*l)}}function mr(m,t,r){const l=t[0],h=t[1];return m[0]=r[0]*l+r[4]*h+r[12],m[1]=r[1]*l+r[5]*h+r[13],m[3]=r[3]*l+r[7]*h+r[15],m}const gi=100;class uh{constructor(t,r=new Zt(t.width+200,t.height+200,25),l=new Zt(t.width+200,t.height+200,25)){this.transform=t,this.grid=r,this.ignoredGrid=l,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+gi,this.screenBottomBoundary=t.height+gi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,r,l,h,_,v,b,S,A,z,R,I){const F=this.projectAndGetPerspectiveRatio(t.anchorPointX+S[0],t.anchorPointY+S[1],_,z,I),U=l*F.perspectiveRatio;let $;if(v||b)$=this._projectCollisionBox(t,U,h,_,v,b,S,F,z,R,I);else{const le=F.x+(R?R.x*U:0),ie=F.y+(R?R.y*U:0);$={allPointsOccluded:!1,box:[le+t.x1*U,ie+t.y1*U,le+t.x2*U,ie+t.y2*U]}}const[Q,Y,J,re]=$.box,K=v?$.allPointsOccluded:F.isOccluded;let ae=K;return ae||(ae=F.perspectiveRatio<this.perspectiveRatioCutoff),ae||(ae=!this.isInsideGrid(Q,Y,J,re)),ae||r!=="always"&&this.grid.hitTest(Q,Y,J,re,r,A)?{box:[Q,Y,J,re],placeable:!1,offscreen:!1,occluded:K}:{box:[Q,Y,J,re],placeable:!0,offscreen:this.isOffscreen(Q,Y,J,re),occluded:K}}placeCollisionCircles(t,r,l,h,_,v,b,S,A,z,R,I,F,U){const $=[],Q=new d.P(r.anchorX,r.anchorY),Y=this.getPerspectiveRatio(Q.x,Q.y,v,U),J=(A?_*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,v)/Y:_*Y)/d.aM,re={getElevation:U,pitchedLabelPlaneMatrix:b,lineVertexArray:l,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Q,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:F},K=ns(J,h,r.lineOffsetX*J,r.lineOffsetY*J,!1,r,!1,re);let ae=!1,le=!1,ie=!0;if(K){const pe=.5*R*Y+I,ze=new d.P(-100,-100),Te=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Ae=new Je,Ce=K.first,We=K.last;let Ke=[];for(let kt=Ce.path.length-1;kt>=1;kt--)Ke.push(Ce.path[kt]);for(let kt=1;kt<We.path.length;kt++)Ke.push(We.path[kt]);const Ge=2.5*pe;if(A){const kt=this.projectPathToScreenSpace(Ke,re);Ke=kt.some((bi=>bi.signedDistanceFromCamera<=0))?[]:kt.map((bi=>bi.point))}let at=[];if(Ke.length>0){const kt=Ke[0].clone(),bi=Ke[0].clone();for(let Ui=1;Ui<Ke.length;Ui++)kt.x=Math.min(kt.x,Ke[Ui].x),kt.y=Math.min(kt.y,Ke[Ui].y),bi.x=Math.max(bi.x,Ke[Ui].x),bi.y=Math.max(bi.y,Ke[Ui].y);at=kt.x>=ze.x&&bi.x<=Te.x&&kt.y>=ze.y&&bi.y<=Te.y?[Ke]:bi.x<ze.x||kt.x>Te.x||bi.y<ze.y||kt.y>Te.y?[]:d.aJ([Ke],ze.x,ze.y,Te.x,Te.y)}for(const kt of at){Ae.reset(kt,.25*pe);let bi=0;bi=Ae.length<=.5*pe?1:Math.ceil(Ae.paddedLength/Ge)+1;for(let Ui=0;Ui<bi;Ui++){const Oi=Ui/Math.max(bi-1,1),Qi=Ae.lerp(Oi),Ai=Qi.x+gi,cn=Qi.y+gi;$.push(Ai,cn,pe,0);const Wi=Ai-pe,Jn=cn-pe,gn=Ai+pe,_n=cn+pe;if(ie=ie&&this.isOffscreen(Wi,Jn,gn,_n),le=le||this.isInsideGrid(Wi,Jn,gn,_n),t!=="always"&&this.grid.hitTestCircle(Ai,cn,pe,t,z)&&(ae=!0,!S))return{circles:[],offscreen:!1,collisionDetected:ae}}}}return{circles:!S&&ae||!le||Y<this.perspectiveRatioCutoff?[]:$,offscreen:ie,collisionDetected:ae}}projectPathToScreenSpace(t,r){const l=(function(h,_){const v=d.N();return d.aB(v,_.pitchedLabelPlaneMatrix),h.map((b=>{const S=Vt(b.x,b.y,v,_.getElevation),A=_.transform.projectTileCoordinates(S.point.x,S.point.y,_.unwrappedTileID,_.getElevation);return A.point.x=(.5*A.point.x+.5)*_.width,A.point.y=(.5*-A.point.y+.5)*_.height,A}))})(t,r);return(function(h){let _=0,v=0,b=0,S=0;for(let A=0;A<h.length;A++)h[A].isOccluded?(b=A+1,S=0):(S++,S>v&&(v=S,_=b));return h.slice(_,_+v)})(l)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[],l=new d.aa;for(const R of t){const I=new d.P(R.x+gi,R.y+gi);l.extend(I),r.push(I)}const{minX:h,minY:_,maxX:v,maxY:b}=l,S=this.grid.query(h,_,v,b).concat(this.ignoredGrid.query(h,_,v,b)),A={},z={};for(const R of S){const I=R.key;if(A[I.bucketInstanceId]===void 0&&(A[I.bucketInstanceId]={}),A[I.bucketInstanceId][I.featureIndex])continue;const F=[new d.P(R.x1,R.y1),new d.P(R.x2,R.y1),new d.P(R.x2,R.y2),new d.P(R.x1,R.y2)];d.aK(r,F)&&(A[I.bucketInstanceId][I.featureIndex]=!0,z[I.bucketInstanceId]===void 0&&(z[I.bucketInstanceId]=[]),z[I.bucketInstanceId].push(I.featureIndex))}return z}insertCollisionBox(t,r,l,h,_,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:_,collisionGroupID:v,overlapMode:r},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,l,h,_,v){const b=l?this.ignoredGrid:this.grid,S={bucketInstanceId:h,featureIndex:_,collisionGroupID:v,overlapMode:r};for(let A=0;A<t.length;A+=4)b.insertCircle(S,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,r,l,h,_){if(_){let v;h?(v=[t,r,h(t,r),1],d.aH(v,v,_)):(v=[t,r,0,1],mr(v,v,_));const b=v[3];return{x:(v[0]/b+1)/2*this.transform.width+gi,y:(-v[1]/b+1)/2*this.transform.height+gi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b*.5,isOccluded:!1,signedDistanceFromCamera:b}}{const v=this.transform.projectTileCoordinates(t,r,l,h);return{x:(v.point.x+1)/2*this.transform.width+gi,y:(1-v.point.y)/2*this.transform.height+gi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}}getPerspectiveRatio(t,r,l,h){const _=this.transform.projectTileCoordinates(t,r,l,h);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(t,r,l,h){return l<gi||t>=this.screenRightBoundary||h<gi||r>this.screenBottomBoundary}isInsideGrid(t,r,l,h){return l>=0&&t<this.gridRightBoundary&&h>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=d.ar([]);return d.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,r,l,h,_,v,b,S,A,z,R){let I=1,F=0,U=0,$=1;const Q=t.anchorPointX+b[0],Y=t.anchorPointY+b[1];if(v&&!_){const Ke=this.projectAndGetPerspectiveRatio(Q+1,Y,h,A,R),Ge=Ke.x-S.x,at=Math.atan((Ke.y-S.y)/Ge)+(Ge<0?Math.PI:0),kt=Math.sin(at),bi=Math.cos(at);I=bi,F=kt,U=-kt,$=bi}else if(!v&&_){const Ke=ts(this.transform);I=Ke.vecEast[0],F=Ke.vecEast[1],U=Ke.vecSouth[0],$=Ke.vecSouth[1]}let J=S.x,re=S.y,K=r;_&&(J=Q,re=Y,K=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),K*=this.transform.getPitchedTextCorrection(Q,Y,h),z||(K*=d.an(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),z&&(J+=I*z.x*K+U*z.y*K,re+=F*z.x*K+$*z.y*K);const ae=t.x1*K,le=t.x2*K,ie=(ae+le)/2,pe=t.y1*K,ze=t.y2*K,Te=(pe+ze)/2,Ae=[{offsetX:ae,offsetY:pe},{offsetX:ie,offsetY:pe},{offsetX:le,offsetY:pe},{offsetX:le,offsetY:Te},{offsetX:le,offsetY:ze},{offsetX:ie,offsetY:ze},{offsetX:ae,offsetY:ze},{offsetX:ae,offsetY:Te}];let Ce=[];for(const{offsetX:Ke,offsetY:Ge}of Ae)Ce.push(new d.P(J+I*Ke+U*Ge,re+F*Ke+$*Ge));let We=!1;if(_){const Ke=Ce.map((Ge=>this.projectAndGetPerspectiveRatio(Ge.x,Ge.y,h,A,R)));We=Ke.some((Ge=>!Ge.isOccluded)),Ce=Ke.map((Ge=>new d.P(Ge.x,Ge.y)))}else We=!0;return{box:d.aL(Ce),allPointsOccluded:!We}}}class wf{constructor(t,r,l,h){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class Io{constructor(t,r,l,h,_){this.text=new wf(t?t.text:null,r,l,_),this.icon=new wf(t?t.icon:null,r,h,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ch{constructor(t,r,l){this.text=t,this.icon=r,this.skipFade=l}}class hu{constructor(t,r,l,h,_){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=_}}class Tf{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:l=>l.collisionGroupID===r}}return this.collisionGroups[t]}}function Ea(m,t,r,l,h){const{horizontalAlign:_,verticalAlign:v}=d.aS(m);return new d.P(-(_-.5)*t+l[0]*h,-(v-.5)*r+l[1]*h)}class fu{constructor(t,r,l,h,_){this.transform=t.clone(),this.terrain=r,this.collisionIndex=new uh(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Tf(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const r=this.terrain;return r?(l,h)=>r.getElevation(t,l,h):null}getBucketParts(t,r,l,h){const _=l.getBucket(r),v=l.latestFeatureIndex;if(!_||!v||r.id!==_.layerIds[0])return;const b=l.collisionBoxArray,S=_.layers[0].layout,A=_.layers[0].paint,z=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),R=l.tileSize/d.a5,I=l.tileID.toUnwrapped(),F=S.get("text-rotation-alignment")==="map",U=d.aN(l,1,this.transform.zoom),$=d.aO(this.collisionIndex.transform,l,A.get("text-translate"),A.get("text-translate-anchor")),Q=d.aO(this.collisionIndex.transform,l,A.get("icon-translate"),A.get("icon-translate-anchor")),Y=Ka(F,this.transform,U);this.retainedQueryData[_.bucketInstanceId]=new hu(_.bucketInstanceId,v,_.sourceLayerIndex,_.index,l.tileID);const J={bucket:_,layout:S,translationText:$,translationIcon:Q,unwrappedTileID:I,pitchedLabelPlaneMatrix:Y,scale:z,textPixelRatio:R,holdingForFade:l.holdingForSymbolFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:d.ay(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(h)for(const re of _.sortKeyRanges){const{sortKey:K,symbolInstanceStart:ae,symbolInstanceEnd:le}=re;t.push({sortKey:K,symbolInstanceStart:ae,symbolInstanceEnd:le,parameters:J})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:J})}attemptAnchorPlacement(t,r,l,h,_,v,b,S,A,z,R,I,F,U,$,Q,Y,J,re,K){const ae=d.aP[t.textAnchor],le=[t.textOffset0,t.textOffset1],ie=Ea(ae,l,h,le,_),pe=this.collisionIndex.placeCollisionBox(r,I,S,A,z,b,v,Q,R.predicate,re,ie,K);if((!J||this.collisionIndex.placeCollisionBox(J,I,S,A,z,b,v,Y,R.predicate,re,ie,K).placeable)&&pe.placeable){let ze;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(ze=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:le,width:l,height:h,anchor:ae,textBoxScale:_,prevAnchor:ze},this.markUsedJustification(U,ae,F,$),U.allowVerticalPlacement&&(this.markUsedOrientation(U,$,F),this.placedOrientations[F.crossTileID]=$),{shift:ie,placedGlyphBoxes:pe}}}placeLayerBucketPart(t,r,l){const{bucket:h,layout:_,translationText:v,translationIcon:b,unwrappedTileID:S,pitchedLabelPlaneMatrix:A,textPixelRatio:z,holdingForFade:R,collisionBoxArray:I,partiallyEvaluatedTextSize:F,collisionGroup:U}=t.parameters,$=_.get("text-optional"),Q=_.get("icon-optional"),Y=d.aQ(_,"text-overlap","text-allow-overlap"),J=Y==="always",re=d.aQ(_,"icon-overlap","icon-allow-overlap"),K=re==="always",ae=_.get("text-rotation-alignment")==="map",le=_.get("text-pitch-alignment")==="map",ie=_.get("icon-text-fit")!=="none",pe=_.get("symbol-z-order")==="viewport-y",ze=J&&(K||!h.hasIconData()||Q),Te=K&&(J||!h.hasTextData()||$);!h.collisionArrays&&I&&h.deserializeCollisionBoxes(I);const Ae=this.retainedQueryData[h.bucketInstanceId].tileID,Ce=this._getTerrainElevationFunc(Ae),We=this.transform.getFastPathSimpleProjectionMatrix(Ae),Ke=(Ge,at,kt)=>{var bi,Ui;if(r[Ge.crossTileID])return;if(R)return void(this.placements[Ge.crossTileID]=new ch(!1,!1,!1));let Oi=!1,Qi=!1,Ai=!0,cn=null,Wi={box:null,placeable:!1,offscreen:null,occluded:!1},Jn={placeable:!1},gn=null,_n=null,ea=null,Ss=0,Ms=0,Hr=0;at.textFeatureIndex?Ss=at.textFeatureIndex:Ge.useRuntimeCollisionCircles&&(Ss=Ge.featureIndex),at.verticalTextFeatureIndex&&(Ms=at.verticalTextFeatureIndex);const ja=at.textBox;if(ja){const Ua=Si=>{let ki=d.az.horizontal;if(h.allowVerticalPlacement&&!Si&&this.prevPlacement){const In=this.prevPlacement.placedOrientations[Ge.crossTileID];In&&(this.placedOrientations[Ge.crossTileID]=In,ki=In,this.markUsedOrientation(h,ki,Ge))}return ki},ur=(Si,ki)=>{if(h.allowVerticalPlacement&&Ge.numVerticalGlyphVertices>0&&at.verticalTextBox){for(const In of h.writingModes)if(In===d.az.vertical?(Wi=ki(),Jn=Wi):Wi=Si(),Wi&&Wi.placeable)break}else Wi=Si()},Er=Ge.textAnchorOffsetStartIndex,Ar=Ge.textAnchorOffsetEndIndex;if(Ar===Er){const Si=(ki,In)=>{const Fn=this.collisionIndex.placeCollisionBox(ki,Y,z,Ae,S,le,ae,v,U.predicate,Ce,void 0,We);return Fn&&Fn.placeable&&(this.markUsedOrientation(h,In,Ge),this.placedOrientations[Ge.crossTileID]=In),Fn};ur((()=>Si(ja,d.az.horizontal)),(()=>{const ki=at.verticalTextBox;return h.allowVerticalPlacement&&Ge.numVerticalGlyphVertices>0&&ki?Si(ki,d.az.vertical):{box:null,offscreen:null}})),Ua(Wi&&Wi.placeable)}else{let Si=d.aP[(Ui=(bi=this.prevPlacement)===null||bi===void 0?void 0:bi.variableOffsets[Ge.crossTileID])===null||Ui===void 0?void 0:Ui.anchor];const ki=(Fn,Fc,Nc)=>{const xo=Fn.x2-Fn.x1,jf=Fn.y2-Fn.y1,bo=Ge.textBoxScale,Vc=ie&&re==="never"?Fc:null;let qs=null,Zs=Y==="never"?1:2,$r="never";Si&&Zs++;for(let jc=0;jc<Zs;jc++){for(let $u=Er;$u<Ar;$u++){const Yu=h.textAnchorOffsets.get($u);if(Si&&Yu.textAnchor!==Si)continue;const Qu=this.attemptAnchorPlacement(Yu,Fn,xo,jf,bo,ae,le,z,Ae,S,U,$r,Ge,h,Nc,v,b,Vc,Ce);if(Qu&&(qs=Qu.placedGlyphBoxes,qs&&qs.placeable))return Oi=!0,cn=Qu.shift,qs}Si?Si=null:$r=Y}return l&&!qs&&(qs={box:this.collisionIndex.placeCollisionBox(ja,"always",z,Ae,S,le,ae,v,U.predicate,Ce,void 0,We).box,offscreen:!1,placeable:!1,occluded:!1}),qs};ur((()=>ki(ja,at.iconBox,d.az.horizontal)),(()=>{const Fn=at.verticalTextBox;return h.allowVerticalPlacement&&(!Wi||!Wi.placeable)&&Ge.numVerticalGlyphVertices>0&&Fn?ki(Fn,at.verticalIconBox,d.az.vertical):{box:null,occluded:!0,offscreen:null}})),Wi&&(Oi=Wi.placeable,Ai=Wi.offscreen);const In=Ua(Wi&&Wi.placeable);if(!Oi&&this.prevPlacement){const Fn=this.prevPlacement.variableOffsets[Ge.crossTileID];Fn&&(this.variableOffsets[Ge.crossTileID]=Fn,this.markUsedJustification(h,Fn.anchor,Ge,In))}}}if(gn=Wi,Oi=gn&&gn.placeable,Ai=gn&&gn.offscreen,Ge.useRuntimeCollisionCircles&&Ge.centerJustifiedTextSymbolIndex>=0){const Ua=h.text.placedSymbolArray.get(Ge.centerJustifiedTextSymbolIndex),ur=d.aA(h.textSizeData,F,Ua),Er=_.get("text-padding");_n=this.collisionIndex.placeCollisionCircles(Y,Ua,h.lineVertexArray,h.glyphOffsetArray,ur,S,A,l,le,U.predicate,Ge.collisionCircleDiameter,Er,v,Ce),_n.circles.length&&_n.collisionDetected&&!l&&d.w("Collisions detected, but collision boxes are not shown"),Oi=J||_n.circles.length>0&&!_n.collisionDetected,Ai=Ai&&_n.offscreen}if(at.iconFeatureIndex&&(Hr=at.iconFeatureIndex),at.iconBox){const Ua=ur=>this.collisionIndex.placeCollisionBox(ur,re,z,Ae,S,le,ae,b,U.predicate,Ce,ie&&cn?cn:void 0,We);Jn&&Jn.placeable&&at.verticalIconBox?(ea=Ua(at.verticalIconBox),Qi=ea.placeable):(ea=Ua(at.iconBox),Qi=ea.placeable),Ai=Ai&&ea.offscreen}const il=$||Ge.numHorizontalGlyphVertices===0&&Ge.numVerticalGlyphVertices===0,Xl=Q||Ge.numIconVertices===0;il||Xl?Xl?il||(Qi=Qi&&Oi):Oi=Qi&&Oi:Qi=Oi=Qi&&Oi;const Xr=Qi&&ea.placeable;if(Oi&&gn.placeable&&this.collisionIndex.insertCollisionBox(gn.box,Y,_.get("text-ignore-placement"),h.bucketInstanceId,Jn&&Jn.placeable&&Ms?Ms:Ss,U.ID),Xr&&this.collisionIndex.insertCollisionBox(ea.box,re,_.get("icon-ignore-placement"),h.bucketInstanceId,Hr,U.ID),_n&&Oi&&this.collisionIndex.insertCollisionCircles(_n.circles,Y,_.get("text-ignore-placement"),h.bucketInstanceId,Ss,U.ID),l&&this.storeCollisionData(h.bucketInstanceId,kt,at,gn,ea,_n),Ge.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ge.crossTileID]=new ch((Oi||ze)&&!gn?.occluded,(Qi||Te)&&!ea?.occluded,Ai||h.justReloaded),r[Ge.crossTileID]=!0};if(pe){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ge=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let at=Ge.length-1;at>=0;--at){const kt=Ge[at];Ke(h.symbolInstances.get(kt),h.collisionArrays[kt],kt)}}else for(let Ge=t.symbolInstanceStart;Ge<t.symbolInstanceEnd;Ge++)Ke(h.symbolInstances.get(Ge),h.collisionArrays[Ge],Ge);h.justReloaded=!1}storeCollisionData(t,r,l,h,_,v){if(l.textBox||l.iconBox){let b,S;this.collisionBoxArrays.has(t)?b=this.collisionBoxArrays.get(t):(b=new Map,this.collisionBoxArrays.set(t,b)),b.has(r)?S=b.get(r):(S={text:null,icon:null},b.set(r,S)),l.textBox&&(S.text=h.box),l.iconBox&&(S.icon=_.box)}if(v){let b=this.collisionCircleArrays[t];b===void 0&&(b=this.collisionCircleArrays[t]=[]);for(let S=0;S<v.circles.length;S+=4)b.push(v.circles[S+0]-gi),b.push(v.circles[S+1]-gi),b.push(v.circles[S+2]),b.push(v.collisionDetected?1:0)}}markUsedJustification(t,r,l,h){let _;_=h===d.az.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[d.aR(r)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const b of v)b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=_>=0&&b!==_?0:l.crossTileID)}markUsedOrientation(t,r,l){const h=r===d.az.horizontal||r===d.az.horizontalOnly?r:0,_=r===d.az.vertical?r:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const b of v)t.text.placedSymbolArray.get(b).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let l=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const h=r?r.symbolFadeChange(t):1,_=r?r.opacities:{},v=r?r.variableOffsets:{},b=r?r.placedOrientations:{};for(const S in this.placements){const A=this.placements[S],z=_[S];z?(this.opacities[S]=new Io(z,h,A.text,A.icon),l=l||A.text!==z.text.placed||A.icon!==z.icon.placed):(this.opacities[S]=new Io(null,h,A.text,A.icon,A.skipFade),l=l||A.text||A.icon)}for(const S in _){const A=_[S];if(!this.opacities[S]){const z=new Io(A,h,!1,!1);z.isHidden()||(this.opacities[S]=z,l=l||A.text.placed||A.icon.placed)}}for(const S in v)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=v[S]);for(const S in b)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=b[S]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r){const l={};for(const h of r){const _=h.getBucket(t);_&&h.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,h.tileID,l,h.collisionBoxArray)}}updateBucketOpacities(t,r,l,h){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0],v=_.layout,b=new Io(null,0,!1,!1,!0),S=v.get("text-allow-overlap"),A=v.get("icon-allow-overlap"),z=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=v.get("text-rotation-alignment")==="map",I=v.get("text-pitch-alignment")==="map",F=v.get("icon-text-fit")!=="none",U=new Io(null,0,S&&(A||!t.hasIconData()||v.get("icon-optional")),A&&(S||!t.hasTextData()||v.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const $=(Y,J,re)=>{for(let K=0;K<J/4;K++)Y.opacityVertexArray.emplaceBack(re);Y.hasVisibleVertices=Y.hasVisibleVertices||re!==Lo},Q=this.collisionBoxArrays.get(t.bucketInstanceId);for(let Y=0;Y<t.symbolInstances.length;Y++){const J=t.symbolInstances.get(Y),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:K,crossTileID:ae}=J;let le=this.opacities[ae];l[ae]?le=b:le||(le=U,this.opacities[ae]=le),l[ae]=!0;const ie=J.numIconVertices>0,pe=this.placedOrientations[J.crossTileID],ze=pe===d.az.vertical,Te=pe===d.az.horizontal||pe===d.az.horizontalOnly;if(re>0||K>0){const Ce=fc(le.text);$(t.text,re,ze?Lo:Ce),$(t.text,K,Te?Lo:Ce);const We=le.text.isHidden();[J.rightJustifiedTextSymbolIndex,J.centerJustifiedTextSymbolIndex,J.leftJustifiedTextSymbolIndex].forEach((at=>{at>=0&&(t.text.placedSymbolArray.get(at).hidden=We||ze?1:0)})),J.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(J.verticalPlacedTextSymbolIndex).hidden=We||Te?1:0);const Ke=this.variableOffsets[J.crossTileID];Ke&&this.markUsedJustification(t,Ke.anchor,J,pe);const Ge=this.placedOrientations[J.crossTileID];Ge&&(this.markUsedJustification(t,"left",J,Ge),this.markUsedOrientation(t,Ge,J))}if(ie){const Ce=fc(le.icon),We=!(F&&J.verticalPlacedIconSymbolIndex&&ze);J.placedIconSymbolIndex>=0&&($(t.icon,J.numIconVertices,We?Ce:Lo),t.icon.placedSymbolArray.get(J.placedIconSymbolIndex).hidden=le.icon.isHidden()),J.verticalPlacedIconSymbolIndex>=0&&($(t.icon,J.numVerticalIconVertices,We?Lo:Ce),t.icon.placedSymbolArray.get(J.verticalPlacedIconSymbolIndex).hidden=le.icon.isHidden())}const Ae=Q&&Q.has(Y)?Q.get(Y):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ce=t.collisionArrays[Y];if(Ce){let We=new d.P(0,0);if(Ce.textBox||Ce.verticalTextBox){let Ke=!0;if(z){const Ge=this.variableOffsets[ae];Ge?(We=Ea(Ge.anchor,Ge.width,Ge.height,Ge.textOffset,Ge.textBoxScale),R&&We._rotate(I?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Ke=!1}if(Ce.textBox||Ce.verticalTextBox){let Ge;Ce.textBox&&(Ge=ze),Ce.verticalTextBox&&(Ge=Te),hc(t.textCollisionBox.collisionVertexArray,le.text.placed,!Ke||Ge,Ae.text,We.x,We.y)}}if(Ce.iconBox||Ce.verticalIconBox){const Ke=!!(!Te&&Ce.verticalIconBox);let Ge;Ce.iconBox&&(Ge=Ke),Ce.verticalIconBox&&(Ge=!Ke),hc(t.iconCollisionBox.collisionVertexArray,le.icon.placed,Ge,Ae.icon,F?We.x:0,F?We.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const l=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function hc(m,t,r,l,h,_){l&&l.length!==0||(l=[0,0,0,0]);const v=l[0]-gi,b=l[1]-gi,S=l[2]-gi,A=l[3]-gi;m.emplaceBack(t?1:0,r?1:0,h||0,_||0,v,b),m.emplaceBack(t?1:0,r?1:0,h||0,_||0,S,b),m.emplaceBack(t?1:0,r?1:0,h||0,_||0,S,A),m.emplaceBack(t?1:0,r?1:0,h||0,_||0,v,A)}const du=Math.pow(2,25),eo=Math.pow(2,24),Sf=Math.pow(2,17),Ml=Math.pow(2,16),Ps=Math.pow(2,9),Mf=Math.pow(2,8),Ro=Math.pow(2,1);function fc(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const t=m.placed?1:0,r=Math.floor(127*m.opacity);return r*du+t*eo+r*Sf+t*Ml+r*Ps+t*Mf+r*Ro+t}const Lo=0;class to{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,r,l,h,_){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(v,h,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort(((b,S)=>b.sortKey-S.sortKey)));this._currentPartIndex<v.length;)if(r.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,_())return!0;return!1}}class El{constructor(t,r,l,h,_,v,b,S){this.placement=new fu(t,r,v,b,S),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,r,l){const h=nt(),_=()=>!this._forceFullPlacement&&nt()-h>2;for(;this._currentPlacementIndex>=0;){const v=r[t[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=b)&&(!v.maxzoom||v.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new to(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const qt=512/d.a5/2;class Fr{constructor(t,r,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let _=0;_<r.length;_++){const v=r.get(_),b=v.key,S=h.get(b);S?S.push(v):h.set(b,[v])}for(const[_,v]of h){const b={positions:v.map((S=>({x:Math.floor(S.anchorX*qt),y:Math.floor(S.anchorY*qt)}))),crossTileIDs:v.map((S=>S.crossTileID))};if(b.positions.length>128){const S=new d.aT(b.positions.length,16,Uint16Array);for(const{x:A,y:z}of b.positions)S.add(A,z);S.finish(),delete b.positions,b.index=S}this._symbolsByKey[_]=b}}getScaledCoordinates(t,r){const{x:l,y:h,z:_}=this.tileID.canonical,{x:v,y:b,z:S}=r.canonical,A=qt/Math.pow(2,S-_),z=(b*d.a5+t.anchorY)*A,R=h*d.a5*qt;return{x:Math.floor((v*d.a5+t.anchorX)*A-l*d.a5*qt),y:Math.floor(z-R)}}findMatches(t,r,l){const h=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let _=0;_<t.length;_++){const v=t.get(_);if(v.crossTileID)continue;const b=this._symbolsByKey[v.key];if(!b)continue;const S=this.getScaledCoordinates(v,r);if(b.index){const A=b.index.range(S.x-h,S.y-h,S.x+h,S.y+h).sort();for(const z of A){const R=b.crossTileIDs[z];if(!l[R]){l[R]=!0,v.crossTileID=R;break}}}else if(b.positions)for(let A=0;A<b.positions.length;A++){const z=b.positions[A],R=b.crossTileIDs[A];if(Math.abs(z.x-S.x)<=h&&Math.abs(z.y-S.y)<=h&&!l[R]){l[R]=!0,v.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class hh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class pu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const l in this.indexes){const h=this.indexes[l],_={};for(const v in h){const b=h[v];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+r),_[b.tileID.key]=b}this.indexes[l]=_}this.lng=t}addBucket(t,r,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<r.symbolInstances.length;_++)r.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const h=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const v=this.indexes[_];if(Number(_)>t.overscaledZ)for(const b in v){const S=v[b];S.tileID.isChildOf(t)&&S.findMatches(r.symbolInstances,t,h)}else{const b=v[t.scaledTo(Number(_)).key];b&&b.findMatches(r.symbolInstances,t,h)}}for(let _=0;_<r.symbolInstances.length;_++){const v=r.symbolInstances.get(_);v.crossTileID||(v.crossTileID=l.generate(),h[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Fr(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const l of r.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[t][h]}removeStaleBuckets(t){let r=!1;for(const l in this.indexes){const h=this.indexes[l];for(const _ in h)t[h[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[_]),delete h[_],r=!0)}return r}}class qn{constructor(){this.layerIndexes={},this.crossTileIDs=new hh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,l){let h=this.layerIndexes[t.id];h===void 0&&(h=this.layerIndexes[t.id]=new pu);let _=!1;const v={};h.handleWrapJump(l);for(const b of r){const S=b.getBucket(t);S&&t.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(b.tileID,S,this.crossTileIDs)&&(_=!0),v[S.bucketInstanceId]=!0)}return h.removeStaleBuckets(v)&&(_=!0),_}pruneUnusedLayers(t){const r={};t.forEach((l=>{r[l]=!0}));for(const l in this.layerIndexes)r[l]||delete this.layerIndexes[l]}}var Dn="void main() {fragColor=vec4(1.0);}";const en={prelude:It(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:It("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:It("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:It(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:It(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:It(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:It(Dn,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:It(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:It(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:It("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:It("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:It(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:It("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:It(Dn,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:It(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:It(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:It(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:It(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:It(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:It(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:It(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:It(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:It(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:It(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:It(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:It(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:It(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:It(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:It(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:It(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:It(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:It("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:It("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:It("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:It("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:It(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:It("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function It(m,t){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/in ([\w]+) ([\w]+)/g),h=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=_?_.concat(h):h,b={};return{fragmentSource:m=m.replace(r,((S,A,z,R,I)=>(b[I]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${I}
in ${z} ${R} ${I};
#else
uniform ${z} ${R} u_${I};
#endif
`:`
#ifdef HAS_UNIFORM_u_${I}
    ${z} ${R} ${I} = u_${I};
#endif
`))),vertexSource:t=t.replace(r,((S,A,z,R,I)=>{const F=R==="float"?"vec2":"vec4",U=I.match(/color/)?"color":F;return b[I]?A==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
in ${z} ${F} a_${I};
out ${z} ${R} ${I};
#else
uniform ${z} ${R} u_${I};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = a_${I};
#else
    ${z} ${R} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = unpack_mix_${U}(a_${I}, u_${I}_t);
#else
    ${z} ${R} ${I} = u_${I};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
in ${z} ${F} a_${I};
#else
uniform ${z} ${R} u_${I};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${z} ${R} ${I} = a_${I};
#else
    ${z} ${R} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${z} ${R} ${I} = unpack_mix_${U}(a_${I}, u_${I}_t);
#else
    ${z} ${R} ${I} = u_${I};
#endif
`})),staticAttributes:l,staticUniforms:v}}class Li{constructor(t,r,l){this.vertexBuffer=t,this.indexBuffer=r,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var gr=d.aU([{name:"a_pos",type:"Int16",components:2}]);const dn="#define PROJECTION_MERCATOR",Aa="mercator";class Zn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Aa}get shaderDefine(){return dn}get shaderPreludeCode(){return en.projectionMercator}get vertexShaderPreludeCode(){return en.projectionMercator.vertexSource}get subdivisionGranularity(){return d.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,r,l,h,_){if(this._cachedMesh)return this._cachedMesh;const v=new d.aW;v.emplaceBack(0,0),v.emplaceBack(d.a5,0),v.emplaceBack(0,d.a5),v.emplaceBack(d.a5,d.a5);const b=t.createVertexBuffer(v,gr.members),S=d.aX.simpleSegment(0,0,4,2),A=new d.aY;A.emplaceBack(1,0,2),A.emplaceBack(1,2,3);const z=t.createIndexBuffer(A);return this._cachedMesh=new Li(b,z,S),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class Ja{constructor(t=0,r=0,l=0,h=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=l,this.right=h}interpolate(t,r,l){return r.top!=null&&t.top!=null&&(this.top=d.G.number(t.top,r.top,l)),r.bottom!=null&&t.bottom!=null&&(this.bottom=d.G.number(t.bottom,r.bottom,l)),r.left!=null&&t.left!=null&&(this.left=d.G.number(t.left,r.left,l)),r.right!=null&&t.right!=null&&(this.right=d.G.number(t.right,r.right,l)),this}getCenter(t,r){const l=d.an((this.left+t-this.right)/2,0,t),h=d.an((this.top+r-this.bottom)/2,0,r);return new d.P(l,h)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ja(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ss(m,t){if(!m.renderWorldCopies||m.lngRange)return;const r=t.lng-m.center.lng;t.lng+=r>180?-360:r<-180?360:0}function tn(m){return Math.max(0,Math.floor(m))}class io{constructor(t,r){var l;this.applyConstrain=(h,_)=>this._constrainOverride!==null?this._constrainOverride(h,_):this._callbacks.defaultConstrain(h,_),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=r?.renderWorldCopies===void 0||!!r?.renderWorldCopies,this._minZoom=r?.minZoom||0,this._maxZoom=r?.maxZoom||22,this._minPitch=r?.minPitch==null?0:r?.minPitch,this._maxPitch=r?.maxPitch==null?60:r?.maxPitch,this._constrainOverride=(l=r?.constrainOverride)!==null&&l!==void 0?l:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new d.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=tn(this._zoom),this._scale=d.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ja,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,r,l){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=tn(this._zoom),this._scale=d.aq(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Ja(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!l&&t.autoCalculateNearFarZ,r&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const r=d.W(t,-180,180)*Math.PI/180;var l,h,_,v,b,S,A,z,R;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=Be(),l=this._rotationMatrix,_=-this._bearingInRadians,v=(h=this._rotationMatrix)[0],b=h[1],S=h[2],A=h[3],z=Math.sin(_),R=Math.cos(_),l[0]=v*R+S*z,l[1]=b*R+A*z,l[2]=v*-z+S*R,l[3]=b*-z+A*R)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const r=d.an(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const r=t/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return d.aZ(this._fovInRadians)}setFov(t){t=d.an(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=d.ap(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const r=this.applyConstrain(this._center,t).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=d.aq(r),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,r){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,l){this._unmodified=!1,this._edgeInsets.interpolate(t,r,l),this.constrainInternal(),this._calcMatrices()}resize(t,r,l=!0){this._width=t,this._height=r,l&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new $i([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-d.ao,d.ao])}getCameraQueryGeometry(t,r){if(r.length===1)return[r[0],t];{const{minX:l,minY:h,maxX:_,maxY:v}=d.aa.fromPoints(r).extend(t);return[new d.P(l,h),new d.P(_,h),new d.P(_,v),new d.P(l,v),new d.P(l,h)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:r,zoom:l}=this.applyConstrain(this.center,this.zoom);this.setCenter(r),this.setZoom(l),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=d.ar(new Float64Array(16));d.Q(t,t,[this._width/2,-this._height/2,1]),d.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=d.ar(new Float64Array(16)),d.Q(t,t,[1,-1,1]),d.O(t,t,[-1,-1,0]),d.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,r,l,h){const _=l!==void 0?l:this.bearing,v=h=h!==void 0?h:this.pitch,{distanceToCenter:b,clampedElevation:S}=this._distanceToCenterFromAltElevationPitch(r,this.elevation,v),{x:A,y:z}=fi(v,_),R=d.a9.fromLngLat(t,r);let I,F,U=d.a_(1,R.y),$=0;do{if($+=1,$>10)break;F=b/U,I=new d.a9(R.x+A*F,R.y+z*F),U=1/I.meterInMercatorCoordinateUnits()}while(Math.abs(b-F*U)>1e-12);return{center:I.toLngLat(),elevation:S,zoom:d.at(this.height/2/Math.tan(this.fovInRadians/2)/F/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const r=1/this.worldSize,l=d.as(1,this.center.lat)*this.worldSize,h=d.a9.fromLngLat(this.center,this.elevation),_=h.x/r,v=h.y/r,b=h.z/r,S=this.pitch,A=this.bearing,{x:z,y:R,z:I}=fi(S,A),F=this.cameraToCenterDistance,U=_+F*-z,$=v+F*-R,Q=b+F*I,{distanceToCenter:Y,clampedElevation:J}=this._distanceToCenterFromAltElevationPitch(Q/l,t,S),re=Y*l,K=new d.a9((U+z*re)*r,($+R*re)*r,0).toLngLat(),ae=d.as(1,K.lat),le=d.at(this.height/2/Math.tan(this.fovInRadians/2)/Y/ae/this.tileSize);this._elevation=J,this._center=K,this.setZoom(le)}_distanceToCenterFromAltElevationPitch(t,r,l){const h=-Math.cos(d.ap(l)),_=t-r;let v,b=r;return h*_>=0||Math.abs(h)<.1?(v=1e4,b=t+v*h):v=-_/h,{distanceToCenter:v,clampedElevation:b}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=d.as(1,this.center.lat)*this.worldSize;return be(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const r=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/r,t.canonical.y/r,1/r/d.a5,1/r/d.a5]}}class er{constructor(t,r){this.min=t,this.max=r,this.center=d.a$([],d.b0([],this.min,this.max),.5)}quadrant(t){const r=[t%2==0,t<2],l=d.b1(this.min),h=d.b1(this.max);for(let _=0;_<r.length;_++)l[_]=r[_]?this.min[_]:this.center[_],h[_]=r[_]?this.center[_]:this.max[_];return h[2]=this.max[2],new er(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let r=!0;for(let l=0;l<t.planes.length;l++){const h=this.intersectsPlane(t.planes[l]);if(h===0)return 0;h===1&&(r=!1)}return r?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let r=t[3],l=t[3];for(let h=0;h<3;h++)t[h]>0?(r+=t[h]*this.min[h],l+=t[h]*this.max[h]):(l+=t[h]*this.min[h],r+=t[h]*this.max[h]);return r>=0?2:l<0?0:1}}class Bo{distanceToTile2d(t,r,l,h){const _=h.distanceX([t,r]),v=h.distanceY([t,r]);return Math.hypot(_,v)}getWrap(t,r,l){return l}getTileBoundingVolume(t,r,l,h){var _,v;let b=0,S=0;if(h?.terrain){const z=new d.a2(t.z,r,t.z,t.x,t.y),R=h.terrain.getMinMaxElevation(z);b=(_=R.minElevation)!==null&&_!==void 0?_:Math.min(0,l),S=(v=R.maxElevation)!==null&&v!==void 0?v:Math.max(0,l)}const A=1<<t.z;return new er([r+t.x/A,t.y/A,b],[r+(t.x+1)/A,(t.y+1)/A,S])}allowVariableZoom(t,r){const l=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,h=d.an(78.5-l/2,0,60);return!!r.terrain||t.pitch>h}allowWorldCopies(){return!0}prepareNextFrame(){}}class Ca{constructor(t,r,l){this.points=t,this.planes=r,this.aabb=l}static fromInvProjectionMatrix(t,r=1,l=0,h,_){const v=_?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],b=Math.pow(2,l),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((I=>(function(F,U,$,Q){const Y=d.aH([],F,U),J=1/Y[3]/$*Q;return d.b6(Y,Y,[J,J,1/Y[3],J])})(I,t,r,b)));h&&(function(I,F,U,$){const Q=$?4:0,Y=$?0:4;let J=0;const re=[],K=[];for(let ie=0;ie<4;ie++){const pe=d.b2([],I[ie+Y],I[ie+Q]),ze=d.b7(pe);d.a$(pe,pe,1/ze),re.push(ze),K.push(pe)}for(let ie=0;ie<4;ie++){const pe=d.b8(I[ie+Q],K[ie],U);J=pe!==null&&pe>=0?Math.max(J,pe):Math.max(J,re[ie])}const ae=(function(ie,pe){const ze=d.b2([],ie[pe[0]],ie[pe[1]]),Te=d.b2([],ie[pe[2]],ie[pe[1]]),Ae=[0,0,0,0];return d.b3(Ae,d.b4([],ze,Te)),Ae[3]=-d.b5(Ae,ie[pe[0]]),Ae})(I,F),le=(function(ie,pe){const ze=d.b9(ie),Te=d.ba([],ie,1/ze),Ae=d.b2([],pe,d.a$([],Te,d.b5(pe,Te))),Ce=d.b9(Ae);if(Ce>0){const We=Math.sqrt(1-Te[3]*Te[3]),Ke=d.a$([],Te,-Te[3]),Ge=d.b0([],Ke,d.a$([],Ae,We/Ce));return d.bb(pe,Ge)}return null})(U,ae);if(le!==null){const ie=le/d.b5(K[0],ae);J=Math.min(J,ie)}for(let ie=0;ie<4;ie++){const pe=Math.min(J,re[ie]);I[ie+Y]=[I[ie+Q][0]+K[ie][0]*pe,I[ie+Q][1]+K[ie][1]*pe,I[ie+Q][2]+K[ie][2]*pe,1]}})(S,v[0],h,_);const A=v.map((I=>{const F=d.b2([],S[I[0]],S[I[1]]),U=d.b2([],S[I[2]],S[I[1]]),$=d.b3([],d.b4([],F,U)),Q=-d.b5($,S[I[1]]);return $.concat(Q)})),z=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],R=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const I of S)for(let F=0;F<3;F++)z[F]=Math.min(z[F],I[F]),R[F]=Math.max(R[F],I[F]);return new Ca(S,A,new er(z,R))}}class kn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,l){return this._helper.interpolatePadding(t,r,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r,l=!0){this._helper.resize(t,r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,r){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(r,l)=>{l=d.an(+l,this.minZoom,this.maxZoom);const h={center:new d.V(r.lng,r.lat),zoom:l};let _=this._helper._lngRange;if(!this._helper._renderWorldCopies&&_===null){const K=179.9999999999;_=[-K,K]}const v=this.tileSize*d.aq(h.zoom);let b=0,S=v,A=0,z=v,R=0,I=0;const{x:F,y:U}=this.size;if(this._helper._latRange){const K=this._helper._latRange;b=d.X(K[1])*v,S=d.X(K[0])*v,S-b<U&&(R=U/(S-b))}_&&(A=d.W(d.Y(_[0])*v,0,v),z=d.W(d.Y(_[1])*v,0,v),z<A&&(z+=v),z-A<F&&(I=F/(z-A)));const{x:$,y:Q}=pt(v,r);let Y,J;const re=Math.max(I||0,R||0);if(re){const K=new d.P(I?(z+A)/2:$,R?(S+b)/2:Q);return h.center=Et(v,K).wrap(),h.zoom+=d.at(re),h}if(this._helper._latRange){const K=U/2;Q-K<b&&(J=b+K),Q+K>S&&(J=S-K)}if(_){const K=(A+z)/2;let ae=$;this._helper._renderWorldCopies&&(ae=d.W($,K-v/2,K+v/2));const le=F/2;ae-le<A&&(Y=A+le),ae+le>z&&(Y=z-le)}if(Y!==void 0||J!==void 0){const K=new d.P(Y??$,J??Q);h.center=Et(v,K).wrap()}return h},this.applyConstrain=(r,l)=>this._helper.applyConstrain(r,l),this._helper=new io({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(r,l)=>this.defaultConstrain(r,l)},t),this._coveringTilesDetailsProvider=new Bo}clone(){const t=new kn;return t.apply(this),t}apply(t,r,l){this._helper.apply(t,r,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const r=[new d.bc(0,t)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new d.P(0,0)),h=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,0)),_=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,this._helper._height)),v=this.screenPointToMercatorCoordinate(new d.P(0,this._helper._height)),b=Math.floor(Math.min(l.x,h.x,_.x,v.x)),S=Math.floor(Math.max(l.x,h.x,_.x,v.x)),A=1;for(let z=b-A;z<=S+A;z++)z!==0&&r.push(new d.bc(z,t))}return r}getCameraFrustum(){return Ca.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const r=this.screenPointToLocation(this.centerPoint,t),l=t?t.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(t,r){const l=d.as(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(r,l),_=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),v=d.a9.fromLngLat(t),b=new d.a9(v.x-(h.x-_.x),v.y-(h.y-_.y));this.setCenter(b?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,r){return r?this.coordinatePoint(d.a9.fromLngLat(t),r.getElevationForLngLat(t,this),this._pixelMatrix3D):this.coordinatePoint(d.a9.fromLngLat(t))}screenPointToLocation(t,r){var l;return(l=this.screenPointToMercatorCoordinate(t,r))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(t,r){if(r){const l=r.pointCoordinate(t);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,r){const l=r||0,h=[t.x,t.y,0,1],_=[t.x,t.y,1,1];d.aH(h,h,this._pixelMatrixInverse),d.aH(_,_,this._pixelMatrixInverse);const v=h[3],b=_[3],S=h[1]/v,A=_[1]/b,z=h[2]/v,R=_[2]/b,I=z===R?0:(l-z)/(R-z);return new d.a9(d.G.number(h[0]/v,_[0]/b,I)/this.worldSize,d.G.number(S,A,I)/this.worldSize,l)}coordinatePoint(t,r=0,l=this._pixelMatrix){const h=[t.x*this.worldSize,t.y*this.worldSize,r,1];return d.aH(h,h,l),new d.P(h[0]/h[3],h[1]/h[3])}getBounds(){const t=Math.max(0,this._helper._height/2-li(this));return new $i().extend(this.screenPointToLocation(new d.P(0,t))).extend(this.screenPointToLocation(new d.P(this._helper._width,t))).extend(this.screenPointToLocation(new d.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new d.P(0,this._helper._height)))}isPointOnMapSurface(t,r){return r?r.pointCoordinate(t)!=null:t.y>this.height/2-li(this)}calculatePosMatrix(t,r=!1,l){var h;const _=(h=t.key)!==null&&h!==void 0?h:d.bd(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),v=r?this._alignedPosMatrixCache:this._posMatrixCache;if(v.has(_)){const A=v.get(_);return l?A.f32:A.f64}const b=$t(t,this.worldSize);d.S(b,r?this._alignedProjMatrix:this._viewProjMatrix,b);const S={f64:b,f32:new Float32Array(b)};return v.set(_,S),l?S.f32:S.f64}calculateFogMatrix(t){const r=t.key,l=this._fogMatrixCacheF32;if(l.has(r))return l.get(r);const h=$t(t,this.worldSize);return d.S(h,this._fogMatrix,h),l.set(r,new Float32Array(h)),l.get(r)}calculateCenterFromCameraLngLatAlt(t,r,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,l,h)}_calculateNearFarZIfNeeded(t,r,l){if(!this._helper.autoCalculateNearFarZ)return;const h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),_=t-h*this._helper._pixelPerMeter/Math.cos(r),v=h<0?_:t,b=Math.PI/2+this.pitchInRadians,S=d.ap(this.fov)*(Math.abs(Math.cos(d.ap(this.roll)))*this.height+Math.abs(Math.sin(d.ap(this.roll)))*this.width)/this.height*(.5+l.y/this.height),A=Math.sin(S)*v/Math.sin(d.an(Math.PI-b-S,.01,Math.PI-.01)),z=li(this),R=Math.atan(z/this._helper.cameraToCenterDistance),I=d.ap(.75),F=R>I?2*R*(.5+l.y/(2*z)):I,U=Math.sin(F)*v/Math.sin(d.an(Math.PI-b-F,.01,Math.PI-.01)),$=Math.min(A,U);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*$+v),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,r=pt(this.worldSize,this.center),l=r.x,h=r.y;this._helper._pixelPerMeter=d.as(1,this.center.lat)*this.worldSize;const _=d.ap(Math.min(this.pitch,et)),v=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(_));let b;this._calculateNearFarZIfNeeded(v,_,t),b=new Float64Array(16),d.be(b,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),d.aB(this._invProjMatrix,b),b[8]=2*-t.x/this._helper._width,b[9]=2*t.y/this._helper._height,this._projectionMatrix=d.bf(b),d.Q(b,b,[1,-1,1]),d.O(b,b,[0,0,-this._helper.cameraToCenterDistance]),d.bg(b,b,-this.rollInRadians),d.bh(b,b,this.pitchInRadians),d.bg(b,b,-this.bearingInRadians),d.O(b,b,[-l,-h,0]),this._mercatorMatrix=d.Q([],b,[this.worldSize,this.worldSize,this.worldSize]),d.Q(b,b,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=d.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,b),d.O(b,b,[0,0,-this.elevation]),this._viewProjMatrix=b,this._invViewProjMatrix=d.aB([],b);const S=[0,0,-1,1];d.aH(S,S,this._invViewProjMatrix),this._cameraPosition=[S[0]/S[3],S[1]/S[3],S[2]/S[3]],this._fogMatrix=new Float64Array(16),d.be(this._fogMatrix,this.fovInRadians,this.width/this.height,v,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,d.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),d.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),d.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),d.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),d.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),d.O(this._fogMatrix,this._fogMatrix,[-l,-h,0]),d.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),d.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=d.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,b);const A=this._helper._width%2/2,z=this._helper._height%2/2,R=Math.cos(this.bearingInRadians),I=Math.sin(-this.bearingInRadians),F=l-Math.round(l)+R*A+I*z,U=h-Math.round(h)+R*z+I*A,$=new Float64Array(b);if(d.O($,$,[F>.5?F-1:F,U>.5?U-1:U,0]),this._alignedProjMatrix=$,b=d.aB(new Float64Array(16),this._pixelMatrix),!b)throw new Error("failed to invert matrix");this._pixelMatrixInverse=b,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new d.P(0,0)),r=[t.x*this.worldSize,t.y*this.worldSize,0,1];return d.aH(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=d.as(1,this.center.lat)*this.worldSize;return be(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,r){const l=d.a9.fromLngLat(t),h=[l.x*this.worldSize,l.y*this.worldSize,r,1];return d.aH(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(t){const{overscaledTileID:r,aligned:l,applyTerrainMatrix:h}=t,_=this._helper.getMercatorTileCoordinates(r),v=r?this.calculatePosMatrix(r,l,!0):null;let b;return b=r&&r.terrainRttPosMatrix32f&&h?r.terrainRttPosMatrix32f:v||d.bi(),{mainMatrix:b,tileMercatorCoords:_,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:b}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,r,l){return 1}transformLightDirection(t){return d.b1(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,r,l,h){const _=this.calculatePosMatrix(l);let v;h?(v=[t,r,h(t,r),1],d.aH(v,v,_)):(v=[t,r,0,1],mr(v,v,_));const b=v[3];return{point:new d.P(v[0]/b,v[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}populateCache(t){for(const r of t)this.calculatePosMatrix(r)}getMatrixForModel(t,r){const l=d.a9.fromLngLat(t,r),h=l.meterInMercatorCoordinateUnits(),_=d.bj();return d.O(_,_,[l.x,l.y,l.z]),d.bg(_,_,Math.PI),d.bh(_,_,Math.PI/2),d.Q(_,_,[-h,h,h]),_}getProjectionDataForCustomLayer(t=!0){const r=new d.a2(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:t}),h=$t(r,this.worldSize);d.S(h,this._viewProjMatrix,h),l.tileMercatorCoords=[0,0,1,1];const _=[d.a5,d.a5,this.worldSize/this._helper.pixelsPerMeter],v=d.bk();return d.Q(v,h,_),l.fallbackMatrix=v,l.mainMatrix=v,l}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function za(){d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function mu(m){if(m.useSlerp)if(m.k<1){const t=d.bl(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),r=d.bl(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),l=new Float64Array(4);d.bm(l,t,r,m.k);const h=d.bn(l);m.tr.setRoll(h.roll),m.tr.setPitch(h.pitch),m.tr.setBearing(h.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(d.G.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(d.G.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(d.G.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function Oo(m,t,r,l,h){const _=h.padding,v=pt(h.worldSize,r.getNorthWest()),b=pt(h.worldSize,r.getNorthEast()),S=pt(h.worldSize,r.getSouthEast()),A=pt(h.worldSize,r.getSouthWest()),z=d.ap(-l),R=v.rotate(z),I=b.rotate(z),F=S.rotate(z),U=A.rotate(z),$=new d.P(Math.max(R.x,I.x,U.x,F.x),Math.max(R.y,I.y,U.y,F.y)),Q=new d.P(Math.min(R.x,I.x,U.x,F.x),Math.min(R.y,I.y,U.y,F.y)),Y=$.sub(Q),J=(h.width-(_.left+_.right+t.left+t.right))/Y.x,re=(h.height-(_.top+_.bottom+t.top+t.bottom))/Y.y;if(re<0||J<0)return void za();const K=Math.min(d.at(h.scale*Math.min(J,re)),m.maxZoom),ae=d.P.convert(m.offset),le=new d.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(d.ap(l)),ie=ae.add(le).mult(h.scale/d.aq(K));return{center:Et(h.worldSize,v.add(S).div(2).sub(ie)),zoom:K,bearing:l}}class ko{get useGlobeControls(){return!1}handlePanInertia(t,r){const l=t.mag(),h=Math.abs(li(r));return{easingOffset:t.mult(Math.min(.75*h/l,1)),easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(t,r){t.bearingDelta&&r.setBearing(r.bearing+t.bearingDelta),t.pitchDelta&&r.setPitch(r.pitch+t.pitchDelta),t.rollDelta&&r.setRoll(r.roll+t.rollDelta),t.zoomDelta&&r.setZoom(r.zoom+t.zoomDelta)}handleMapControlsPan(t,r,l){t.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(l,t.around)}cameraForBoxAndBearing(t,r,l,h,_){return Oo(t,r,l,h,_)}handleJumpToCenterZoom(t,r){t.zoom!==(r.zoom!==void 0?+r.zoom:t.zoom)&&t.setZoom(+r.zoom),r.center!==void 0&&t.setCenter(d.V.convert(r.center))}handleEaseTo(t,r){const l=t.zoom,h=t.padding,_={roll:t.roll,pitch:t.pitch,bearing:t.bearing},v={roll:r.roll===void 0?t.roll:r.roll,pitch:r.pitch===void 0?t.pitch:r.pitch,bearing:r.bearing===void 0?t.bearing:r.bearing},b=r.zoom!==void 0,S=!t.isPaddingEqual(r.padding);let A=!1;const z=b?+r.zoom:t.zoom;let R=t.centerPoint.add(r.offsetAsPoint);const I=t.screenPointToLocation(R),{center:F,zoom:U}=t.applyConstrain(d.V.convert(r.center||I),z??l);ss(t,F);const $=pt(t.worldSize,I),Q=pt(t.worldSize,F).sub($),Y=d.aq(U-l);return A=U!==l,{easeFunc:J=>{if(A&&t.setZoom(d.G.number(l,U,J)),d.bo(_,v)||mu({startEulerAngles:_,endEulerAngles:v,tr:t,k:J,useSlerp:_.roll!=v.roll}),S&&(t.interpolatePadding(h,r.padding,J),R=t.centerPoint.add(r.offsetAsPoint)),r.around)t.setLocationAtPoint(r.around,r.aroundPoint);else{const re=d.aq(t.zoom-l),K=U>l?Math.min(2,Y):Math.max(.5,Y),ae=Math.pow(K,1-J),le=Et(t.worldSize,$.add(Q.mult(J*ae)).mult(re));t.setLocationAtPoint(t.renderWorldCopies?le.wrap():le,R)}},isZooming:A,elevationCenter:F}}handleFlyTo(t,r){const l=r.zoom!==void 0,h=t.zoom,_=t.applyConstrain(d.V.convert(r.center||r.locationAtOffset),l?+r.zoom:h),v=_.center,b=_.zoom;ss(t,v);const S=pt(t.worldSize,r.locationAtOffset),A=pt(t.worldSize,v).sub(S),z=A.mag(),R=d.aq(b-h);let I;if(r.minZoom!==void 0){const F=Math.min(+r.minZoom,h,b),U=t.applyConstrain(v,F).zoom;I=d.aq(U-h)}return{easeFunc:(F,U,$,Q)=>{t.setZoom(F===1?b:h+d.at(U));const Y=F===1?v:Et(t.worldSize,S.add(A.mult($)).mult(U));t.setLocationAtPoint(t.renderWorldCopies?Y.wrap():Y,Q)},scaleOfZoom:R,targetCenter:v,scaleOfMinZoom:I,pixelPathLength:z}}}class Ei{constructor(t,r,l){this.blendFunction=t,this.blendColor=r,this.mask=l}}Ei.Replace=[1,0],Ei.disabled=new Ei(Ei.Replace,d.bp.transparent,[!1,!1,!1,!1]),Ei.unblended=new Ei(Ei.Replace,d.bp.transparent,[!0,!0,!0,!0]),Ei.alphaBlended=new Ei([1,771],d.bp.transparent,[!0,!0,!0,!0]);const no=2305;class Kt{constructor(t,r,l){this.enable=t,this.mode=r,this.frontFace=l}}Kt.disabled=new Kt(!1,1029,no),Kt.backCCW=new Kt(!0,1029,no),Kt.frontCCW=new Kt(!0,1028,no);class Ut{constructor(t,r,l){this.func=t,this.mask=r,this.range=l}}Ut.ReadOnly=!1,Ut.ReadWrite=!0,Ut.disabled=new Ut(519,Ut.ReadOnly,[0,1]);const Fo=7680;class ci{constructor(t,r,l,h,_,v){this.test=t,this.ref=r,this.mask=l,this.fail=h,this.depthFail=_,this.pass=v}}ci.disabled=new ci({func:519,mask:0},0,0,Fo,Fo,Fo);const gu=new WeakMap;function _r(m){var t;if(gu.has(m))return gu.get(m);{const r=(t=m.getParameter(m.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return gu.set(m,r),r}}class ao{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const r=t.context,l=r.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const h=new d.aW;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);const _=new d.aY;_.emplaceBack(0,1,2),this._fullscreenTriangle=new Li(r.createVertexBuffer(h,gr.members),r.createIndexBuffer(_),d.aX.simpleSegment(0,0,h.length,_.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(l.TEXTURE1);const v=l.createTexture();l.bindTexture(l.TEXTURE_2D,v),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(v),_r(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,r){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,r=t.gl;t.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,r){const l=this._cachedRenderContext.context,h=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:d.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,h.TRIANGLES,Ut.disabled,ci.disabled,Ei.unblended,Kt.disabled,((_,v)=>({u_input:_,u_output_expected:v}))(t,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&_r(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);const _=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:_}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&_r(t)){const r=t.clientWaitSync(this._readbackQueue.sync,0,0);if(r===t.WAIT_FAILED)return d.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ao._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let r=0;return r+=t[0]/256,r+=t[1]/65536,r+=t[2]/16777216,t[3]<127&&(r=-r),r/128}}const ro=d.a5/128;function Ef(m,t){const r=m.granularity!==void 0?Math.max(m.granularity,1):1,l=r+(m.generateBorders?2:0),h=r+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),_=l+1,v=h+1,b=m.generateBorders?-1:0,S=m.generateBorders||m.extendToNorthPole?-1:0,A=r+(m.generateBorders?1:0),z=r+(m.generateBorders||m.extendToSouthPole?1:0),R=_*v,I=l*h*6,F=_*v>65536;if(F&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const U=F||t==="32bit",$=new Int16Array(2*R);let Q=0;for(let re=S;re<=z;re++)for(let K=b;K<=A;K++){let ae=K/r*d.a5;K===-1&&(ae=-ro),K===r+1&&(ae=d.a5+ro);let le=re/r*d.a5;re===-1&&(le=m.extendToNorthPole?d.br:-ro),re===r+1&&(le=m.extendToSouthPole?d.bs:d.a5+ro),$[Q++]=ae,$[Q++]=le}const Y=U?new Uint32Array(I):new Uint16Array(I);let J=0;for(let re=0;re<h;re++)for(let K=0;K<l;K++){const ae=K+1+re*_,le=K+(re+1)*_,ie=K+1+(re+1)*_;Y[J++]=K+re*_,Y[J++]=le,Y[J++]=ae,Y[J++]=ae,Y[J++]=le,Y[J++]=ie}return{vertices:$.buffer.slice(0),indices:Y.buffer.slice(0),uses32bitIndices:U}}const _u=new d.aV({fill:new d.bt(128,2),line:new d.bt(512,0),tile:new d.bt(128,32),stencil:new d.bt(128,1),circle:3});class fh{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return en.projectionGlobe}get vertexShaderPreludeCode(){return en.projectionMercator.vertexSource}get subdivisionGranularity(){return _u}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new ao(t));const r=d.X(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(r,l),_=nt();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=_);const v=Math.min(Math.max((_-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=d.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,d.bv(v))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,r,l,h,_){const v=(_==="stencil"?_u.stencil:_u.tile).getGranularityForZoomLevel(r.z);return this._getMesh(t,{granularity:v,generateBorders:l,extendToNorthPole:r.y===0&&h,extendToSouthPole:r.y===(1<<r.z)-1&&h})}_getMesh(t,r){const l=this._getMeshKey(r);if(l in this._tileMeshCache)return this._tileMeshCache[l];const h=(function(_,v){const b=Ef(v,"16bit"),S=d.aW.deserialize({arrayBuffer:b.vertices,length:b.vertices.byteLength/2/2}),A=d.aY.deserialize({arrayBuffer:b.indices,length:b.indices.byteLength/2/3});return new Li(_.createVertexBuffer(S,gr.members),_.createIndexBuffer(A),d.aX.simpleSegment(0,0,S.length,A.length))})(t,r);return this._tileMeshCache[l]=h,h}recalculate(t){}hasTransition(){const t=nt();let r=!1;return r=r||(t-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Zd=new d.t({type:new d.D(d.u.projection.type)});class dh extends d.E{constructor(t){super(),this._transitionable=new d.x(Zd,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.H(0)),this._mercatorProjection=new Zn,this._verticalPerspectiveProjection=new fh}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof d.bw){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,r,l,h,_){return this.currentProjection.getMeshFromTileID(t,r,l,h,_)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Da(m){const t=No(m.worldSize,m.center.lat);return 2*Math.PI*t}function os(m,t,r,l,h){const _=1/(1<<h),v=t/d.a5*_+l*_,b=d.by((m/d.a5*_+r*_)*Math.PI*2+Math.PI,2*Math.PI),S=2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI,A=Math.cos(S),z=new Float64Array(3);return z[0]=Math.sin(b)*A,z[1]=Math.sin(S),z[2]=Math.cos(b)*A,z}function nn(m){return(function(t,r){const l=Math.cos(r),h=new Float64Array(3);return h[0]=Math.sin(t)*l,h[1]=Math.sin(r),h[2]=Math.cos(t)*l,h})(m.lng*Math.PI/180,m.lat*Math.PI/180)}function No(m,t){return m/(2*Math.PI)/Math.cos(t*Math.PI/180)}function yu(m){const t=Math.asin(m[1])/Math.PI*180,r=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(r>1e-6){const l=m[0]/r,h=Math.acos(m[2]/r),_=(l>0?h:-h)/Math.PI*180;return new d.V(d.W(_,-180,180),t)}return new d.V(0,t)}function vu(m){return Math.cos(m*Math.PI/180)}function pn(m,t){const r=vu(m),l=vu(t);return d.at(l/r)}function Af(m,t){const r=m.rotate(t.bearingInRadians),l=t.zoom+pn(t.center.lat,0),h=d.bu(1/vu(t.center.lat),1/vu(Math.min(Math.abs(t.center.lat),60)),d.bx(l,7,3,0,1)),_=360/Da({worldSize:t.worldSize,center:{lat:t.center.lat}});return new d.V(t.center.lng-r.x*_*h,d.an(t.center.lat+r.y*_,-d.ao,d.ao))}function dc(m){const t=.5*m,r=Math.sin(t),l=Math.cos(t);return Math.log(r+l)-Math.log(l-r)}function Cf(m,t,r,l){const h=m.lat+r*l;if(Math.abs(r)>1){const _=(Math.sign(m.lat+r)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,v=Math.abs(m.lat+r)*Math.PI/180,b=dc(_+l*(v-_)),S=dc(_),A=dc(v);return new d.V(m.lng+t*((b-S)/(A-S)),h)}return new d.V(m.lng+t*l,h)}class Hd{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,r,l,h){const _=`${t.z}_${t.x}_${t.y}_${h?.terrain?"t":""}`,v=this._cache.get(_);if(v)return v;const b=this._cachePrevious.get(_);if(b)return this._cache.set(_,b),b;const S=this._boundingVolumeFactory(t,r,l,h);return this._cache.set(_,S),this._hadAnyChanges=!0,S}}class Al{constructor(t,r,l,h){this.min=l,this.max=h,this.points=t,this.planes=r}static fromAabb(t,r){const l=[];for(let h=0;h<8;h++)l.push([1&~h?t[0]:r[0],(h>>1&1)==1?r[1]:t[1],(h>>2&1)==1?r[2]:t[2]]);return new Al(l,[[-1,0,0,r[0]],[1,0,0,-t[0]],[0,-1,0,r[1]],[0,1,0,-t[1]],[0,0,-1,r[2]],[0,0,1,-t[2]]],t,r)}static fromCenterSizeAngles(t,r,l){const h=d.bB([],l[0],l[1],l[2]),_=d.bC([],[r[0],0,0],h),v=d.bC([],[0,r[1],0],h),b=d.bC([],[0,0,r[2]],h),S=[...t],A=[...t];for(let R=0;R<8;R++)for(let I=0;I<3;I++){const F=t[I]+_[I]*(1&~R?-1:1)+v[I]*((R>>1&1)==1?1:-1)+b[I]*((R>>2&1)==1?1:-1);S[I]=Math.min(S[I],F),A[I]=Math.max(A[I],F)}const z=[];for(let R=0;R<8;R++){const I=[...t];d.b0(I,I,d.a$([],_,1&~R?-1:1)),d.b0(I,I,d.a$([],v,(R>>1&1)==1?1:-1)),d.b0(I,I,d.a$([],b,(R>>2&1)==1?1:-1)),z.push(I)}return new Al(z,[[..._,-d.b5(_,z[0])],[...v,-d.b5(v,z[0])],[...b,-d.b5(b,z[0])],[-_[0],-_[1],-_[2],-d.b5(_,z[7])],[-v[0],-v[1],-v[2],-d.b5(v,z[7])],[-b[0],-b[1],-b[2],-d.b5(b,z[7])]],S,A)}intersectsFrustum(t){let r=!0;const l=this.points.length,h=this.planes.length,_=t.planes.length,v=t.points.length;for(let b=0;b<_;b++){const S=t.planes[b];let A=0;for(let z=0;z<l;z++){const R=this.points[z];S[0]*R[0]+S[1]*R[1]+S[2]*R[2]+S[3]>=0&&A++}if(A===0)return 0;A<l&&(r=!1)}if(r)return 2;for(let b=0;b<h;b++){const S=this.planes[b];let A=0;for(let z=0;z<v;z++){const R=t.points[z];S[0]*R[0]+S[1]*R[1]+S[2]*R[2]+S[3]>=0&&A++}if(A===0)return 0}return 1}intersectsPlane(t){const r=this.points.length;let l=0;for(let h=0;h<r;h++){const _=this.points[h];t[0]*_[0]+t[1]*_[1]+t[2]*_[2]+t[3]>=0&&l++}return l===r?2:l===0?0:1}}function pc(m,t,r){const l=m-t;return l<0?-l:Math.max(0,l-r)}function Cl(m,t,r,l,h){const _=m-r;let v;return v=_<0?Math.min(-_,1+_-h):_>1?Math.min(Math.max(_-h,0),1-_):0,Math.max(v,pc(t,l,h))}class ph{constructor(){this._boundingVolumeCache=new Hd(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,r,l,h){const _=1<<l.z,v=1/_,b=l.x/_,S=l.y/_;let A=2;return A=Math.min(A,Cl(t,r,b,S,v)),A=Math.min(A,Cl(t,r,b+.5,-S-v,v)),A=Math.min(A,Cl(t,r,b+.5,2-S-v,v)),A}getWrap(t,r,l){const h=1<<r.z,_=1/h,v=r.x/h,b=pc(t.x,v,_),S=pc(t.x,v-1,_),A=pc(t.x,v+1,_),z=Math.min(b,S,A);return z===A?1:z===S?-1:0}allowVariableZoom(t,r){return Nt(t,r)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,r,l,h){return this._boundingVolumeCache.getTileBoundingVolume(t,r,l,h)}_computeTileBoundingVolume(t,r,l,h){var _,v;let b=0,S=0;if(h?.terrain){const A=new d.a2(t.z,r,t.z,t.x,t.y),z=h.terrain.getMinMaxElevation(A);b=(_=z.minElevation)!==null&&_!==void 0?_:Math.min(0,l),S=(v=z.maxElevation)!==null&&v!==void 0?v:Math.max(0,l)}if(b/=d.bE,S/=d.bE,b+=1,S+=1,t.z<=0)return Al.fromAabb([-S,-S,-S],[S,S,S]);if(t.z===1)return Al.fromAabb([t.x===0?-S:0,t.y===0?0:-S,-S],[t.x===0?0:S,t.y===0?S:0,S]);{const A=[os(0,0,t.x,t.y,t.z),os(d.a5,0,t.x,t.y,t.z),os(d.a5,d.a5,t.x,t.y,t.z),os(0,d.a5,t.x,t.y,t.z)],z=[];for(const Ae of A)z.push(d.a$([],Ae,S));if(S!==b)for(const Ae of A)z.push(d.a$([],Ae,b));t.y===0&&z.push([0,1,0]),t.y===(1<<t.z)-1&&z.push([0,-1,0]);const R=[1,1,1],I=[-1,-1,-1];for(const Ae of z)for(let Ce=0;Ce<3;Ce++)R[Ce]=Math.min(R[Ce],Ae[Ce]),I[Ce]=Math.max(I[Ce],Ae[Ce]);const F=os(d.a5/2,d.a5/2,t.x,t.y,t.z),U=d.b4([],[0,1,0],F);d.b3(U,U);const $=d.b4([],F,U);d.b3($,$);const Q=d.b4([],A[2],A[1]);d.b3(Q,Q);const Y=d.b4([],A[0],A[3]);d.b3(Y,Y),z.push(d.a$([],F,S)),t.y>=(1<<t.z)/2&&z.push(d.a$([],os(d.a5/2,0,t.x,t.y,t.z),S)),t.y<(1<<t.z)/2&&z.push(d.a$([],os(d.a5/2,d.a5,t.x,t.y,t.z),S));const J=xu(F,z),re=xu($,z),K=[-F[0],-F[1],-F[2],J.max],ae=[F[0],F[1],F[2],-J.min],le=[-$[0],-$[1],-$[2],re.max],ie=[$[0],$[1],$[2],-re.min],pe=[...Q,0],ze=[...Y,0],Te=[];return t.y===0?Te.push(d.bD(ze,pe,K),d.bD(ze,pe,ae)):Te.push(d.bD(le,pe,K),d.bD(le,pe,ae),d.bD(le,ze,K),d.bD(le,ze,ae)),t.y===(1<<t.z)-1?Te.push(d.bD(ze,pe,K),d.bD(ze,pe,ae)):Te.push(d.bD(ie,pe,K),d.bD(ie,pe,ae),d.bD(ie,ze,K),d.bD(ie,ze,ae)),new Al(Te,[K,ae,le,ie,pe,ze],R,I)}}}function xu(m,t){let r=1/0,l=-1/0;for(const h of t){const _=d.b5(m,h);r=Math.min(r,_),l=Math.max(l,_)}return{min:r,max:l}}class zl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,l){return this._helper.interpolatePadding(t,r,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r){this._helper.resize(t,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=d.bF(),this._projectionMatrix=d.bj(),this._globeViewProjMatrix32f=d.bi(),this._globeViewProjMatrixNoCorrection=d.bj(),this._globeViewProjMatrixNoCorrectionInverted=d.bj(),this._globeProjMatrixInverted=d.bj(),this._cameraPosition=d.bz(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(r,l)=>{const h=d.an(r.lat,-d.ao,d.ao),_=d.an(+l,this.minZoom+pn(0,h),this.maxZoom);return{center:new d.V(r.lng,h),zoom:_}},this.applyConstrain=(r,l)=>this._helper.applyConstrain(r,l),this._helper=new io({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(r,l)=>this.defaultConstrain(r,l)},t),this._coveringTilesDetailsProvider=new ph}clone(){const t=new zl;return t.apply(this),t}apply(t,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=d.bz();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:r,applyGlobeMatrix:l}=t,h=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const r=this.pitchInRadians,l=this.cameraToCenterDistance/t,h=Math.sin(r)*l,_=Math.cos(r)*l+1,v=1/Math.sqrt(h*h+_*_)*1;let b=-h,S=_;const A=Math.sqrt(b*b+S*S);b/=A,S/=A;const z=[0,b,S];d.bG(z,z,[0,0,0],-this.bearingInRadians),d.bH(z,z,[0,0,0],-1*this.center.lat*Math.PI/180),d.bI(z,z,[0,0,0],this.center.lng*Math.PI/180);const R=1/d.b7(z);return d.a$(z,z,R),[...z,-v*R]}isLocationOccluded(t){return!this.isSurfacePointVisible(nn(t))}transformLightDirection(t){const r=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,h=Math.cos(l),_=[Math.sin(r)*h,Math.sin(l),Math.cos(r)*h],v=[_[2],0,-_[0]],b=[0,0,0];d.b4(b,v,_),d.b3(v,v),d.b3(b,b);const S=[0,0,0];return d.b3(S,[v[0]*t[0]+b[0]*t[1]+_[0]*t[2],v[1]*t[0]+b[1]*t[1]+_[1]*t[2],v[2]*t[0]+b[2]*t[1]+_[2]*t[2]]),S}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,r,l){const h=(function(b,S,A){const z=1/(1<<A.z);return new d.a9(b/d.a5*z+A.x*z,S/d.a5*z+A.y*z)})(t,r,l.canonical),_=(v=h.y,[d.by(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI]);var v;return this.getCircleRadiusCorrection()/Math.cos(_[1])}projectTileCoordinates(t,r,l,h){const _=l.canonical,v=os(t,r,_.x,_.y,_.z),b=1+(h?h(t,r):0)/d.bE,S=[v[0]*b,v[1]*b,v[2]*b,1];d.aH(S,S,this._globeViewProjMatrixNoCorrection);const A=this._cachedClippingPlane,z=A[0]*v[0]+A[1]*v[1]+A[2]*v[2]+A[3]<0;return{point:new d.P(S[0]/S[3],S[1]/S[3]),signedDistanceFromCamera:S[3],isOccluded:z}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=No(this.worldSize,this.center.lat),r=d.bk(),l=d.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),d.be(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const h=this.centerOffset;r[8]=2*-h.x/this._helper._width,r[9]=2*h.y/this._helper._height,this._projectionMatrix=d.bf(r),this._globeProjMatrixInverted=d.bk(),d.aB(this._globeProjMatrixInverted,r),d.O(r,r,[0,0,-this.cameraToCenterDistance]),d.bg(r,r,this.rollInRadians),d.bh(r,r,-this.pitchInRadians),d.bg(r,r,this.bearingInRadians),d.O(r,r,[0,0,-t]);const _=d.bz();_[0]=t,_[1]=t,_[2]=t,d.bh(l,r,this.center.lat*Math.PI/180),d.bJ(l,l,-this.center.lng*Math.PI/180),d.Q(l,l,_),this._globeViewProjMatrixNoCorrection=l,d.bh(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),d.bJ(r,r,-this.center.lng*Math.PI/180),d.Q(r,r,_),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=d.bk(),d.aB(this._globeViewProjMatrixNoCorrectionInverted,l);const v=d.bz();this._cameraPosition=d.bz(),this._cameraPosition[2]=this.cameraToCenterDistance/t,d.bG(this._cameraPosition,this._cameraPosition,v,-this.rollInRadians),d.bH(this._cameraPosition,this._cameraPosition,v,this.pitchInRadians),d.bG(this._cameraPosition,this._cameraPosition,v,-this.bearingInRadians),d.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),d.bH(this._cameraPosition,this._cameraPosition,v,-this.center.lat*Math.PI/180),d.bI(this._cameraPosition,this._cameraPosition,v,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const b=d.bf(this._globeViewProjMatrixNoCorrectionInverted);d.Q(b,b,[1,1,-1]),this._cachedFrustum=Ca.fromInvProjectionMatrix(b,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){d.w("calculateFogMatrix is not supported on globe projection.");const r=d.bk();return d.ar(r),r}getVisibleUnwrappedCoordinates(t){return[new d.bc(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&d.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=nn(t);d.a$(l,l,1+r/d.bE);const h=d.bF();return d.aH(h,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(t){}getBounds(){const t=.5*this.width,r=.5*this.height,l=[new d.P(0,0),new d.P(t,0),new d.P(this.width,0),new d.P(this.width,r),new d.P(this.width,this.height),new d.P(t,this.height),new d.P(0,this.height),new d.P(0,r)],h=[];for(const R of l)h.push(this.unprojectScreenPoint(R));let _=0,v=0,b=0,S=0;const A=this.center;for(const R of h){const I=d.bK(A.lng,R.lng),F=d.bK(A.lat,R.lat);I<v&&(v=I),I>_&&(_=I),F<S&&(S=F),F>b&&(b=F)}const z=[A.lng+v,A.lat+S,A.lng+_,A.lat+b];return this.isSurfacePointOnScreen([0,1,0])&&(z[3]=90,z[0]=-180,z[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(z[1]=-90,z[0]=-180,z[2]=180),new $i(z)}calculateCenterFromCameraLngLatAlt(t,r,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,l,h)}setLocationAtPoint(t,r){const l=nn(this.unprojectScreenPoint(r)),h=nn(t),_=d.bz();d.bL(_);const v=d.bz();d.bI(v,l,_,-this.center.lng*Math.PI/180),d.bH(v,v,_,this.center.lat*Math.PI/180);const b=h[0]*h[0]+h[2]*h[2],S=v[0]*v[0];if(b<S)return;const A=Math.sqrt(b-S),z=-A,R=d.bM(h[0],h[2],v[0],A),I=d.bM(h[0],h[2],v[0],z),F=d.bz();d.bI(F,h,_,-R);const U=d.bM(F[1],F[2],v[1],v[2]),$=d.bz();d.bI($,h,_,-I);const Q=d.bM($[1],$[2],v[1],v[2]),Y=.5*Math.PI,J=U>=-Y&&U<=Y,re=Q>=-Y&&Q<=Y;let K,ae;if(J&&re){const ze=this.center.lng*Math.PI/180,Te=this.center.lat*Math.PI/180;d.bN(R,ze)+d.bN(U,Te)<d.bN(I,ze)+d.bN(Q,Te)?(K=R,ae=U):(K=I,ae=Q)}else if(J)K=R,ae=U;else{if(!re)return;K=I,ae=Q}const le=K/Math.PI*180,ie=ae/Math.PI*180,pe=this.center.lat;this.setCenter(new d.V(le,d.an(ie,-90,90))),this.setZoom(this.zoom+pn(pe,this.center.lat))}locationToScreenPoint(t,r){const l=nn(t);if(r){const h=r.getElevationForLngLatZoom(t,this._helper._tileZoom);d.a$(l,l,1+h/d.bE)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(t){const r=d.bF();return d.aH(r,[...t,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new d.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,r){if(r){const l=r.pointCoordinate(t);if(l)return l}return d.a9.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,r){var l;return(l=this.screenPointToMercatorCoordinate(t,r))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(t,r){const l=this._cameraPosition,h=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(l,h)}getRayDirectionFromPixel(t){const r=d.bF();r[0]=t.x/this.width*2-1,r[1]=-1*(t.y/this.height*2-1),r[2]=1,r[3]=1,d.aH(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const l=d.bz();l[0]=r[0]-this._cameraPosition[0],l[1]=r[1]-this._cameraPosition[1],l[2]=r[2]-this._cameraPosition[2];const h=d.bz();return d.b3(h,l),h}isSurfacePointVisible(t){const r=this._cachedClippingPlane;return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const r=d.bF();return d.aH(r,[...t,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(t,r){const l=d.b5(t,r),h=d.bz(),_=d.bz();d.a$(_,r,l),d.b2(h,t,_);const v=1-d.b5(h,h);if(v<0)return null;const b=d.b5(t,t)-1,S=-l+(l<0?1:-1)*Math.sqrt(v),A=b/S,z=S;return{tMin:Math.min(A,z),tMax:Math.max(A,z)}}unprojectScreenPoint(t){const r=this._cameraPosition,l=this.getRayDirectionFromPixel(t),h=this.rayPlanetIntersection(r,l);if(h){const z=d.bz();d.b0(z,r,[l[0]*h.tMin,l[1]*h.tMin,l[2]*h.tMin]);const R=d.bz();return d.b3(R,z),yu(R)}const _=this._cachedClippingPlane,v=_[0]*l[0]+_[1]*l[1]+_[2]*l[2],b=-d.bb(_,r)/v,S=d.bz();if(b>0)d.b0(S,r,[l[0]*b,l[1]*b,l[2]*b]);else{const z=d.bz();d.b0(z,r,[2*l[0],2*l[1],2*l[2]]);const R=d.bb(this._cachedClippingPlane,z);d.b2(S,z,[this._cachedClippingPlane[0]*R,this._cachedClippingPlane[1]*R,this._cachedClippingPlane[2]*R])}const A=(function(z){const R=d.bz();return R[0]=z[0]*-z[3],R[1]=z[1]*-z[3],R[2]=z[2]*-z[3],{center:R,radius:Math.sqrt(1-z[3]*z[3])}})(_);return yu((function(z,R,I){const F=d.bz();d.b2(F,I,z);const U=d.bz();return d.bA(U,z,F,R/d.b9(F)),U})(A.center,A.radius,S))}getMatrixForModel(t,r){const l=d.V.convert(t),h=1/d.bE,_=d.bj();return d.bJ(_,_,l.lng/180*Math.PI),d.bh(_,_,-l.lat/180*Math.PI),d.O(_,_,[0,0,1+r/d.bE]),d.bh(_,_,.5*Math.PI),d.Q(_,_,[h,h,h]),_}getProjectionDataForCustomLayer(t=!0){const r=this.getProjectionData({overscaledTileID:new d.a2(0,0,0,0,0),applyGlobeMatrix:t});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(t){}}class Dl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,r,l){return this._helper.interpolatePadding(t,r,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,r,l=!0){this._helper.resize(t,r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,r){this._helper.overrideNearFarZ(t,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,r){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(r,l)=>this.currentTransform.defaultConstrain(r,l),this.applyConstrain=(r,l)=>this._helper.applyConstrain(r,l),this._helper=new io({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(r,l)=>this.defaultConstrain(r,l)},t),this._globeness=1,this._mercatorTransform=new kn,this._verticalPerspectiveTransform=new zl}clone(){const t=new Dl;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const r=this._mercatorTransform.getProjectionData(t),l=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:r.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return d.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return d.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,r,l){const h=this._mercatorTransform.getPitchedTextCorrection(t,r,l),_=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,r,l);return d.bu(h,_,this._globeness)}projectTileCoordinates(t,r,l,h){return this.currentTransform.projectTileCoordinates(t,r,l,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,r){return this.currentTransform.lngLatToCameraDepth(t,r)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,r,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,r,l,h)}setLocationAtPoint(t,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,r){return this.currentTransform.locationToScreenPoint(t,r)}screenPointToMercatorCoordinate(t,r){return this.currentTransform.screenPointToMercatorCoordinate(t,r)}screenPointToLocation(t,r){return this.currentTransform.screenPointToLocation(t,r)}isPointOnMapSurface(t,r){return this.currentTransform.isPointOnMapSurface(t,r)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,r){return this.currentTransform.getMatrixForModel(t,r)}getProjectionDataForCustomLayer(t=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return r;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return l.fallbackMatrix=r.mainMatrix,l}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class wn{get useGlobeControls(){return!0}handlePanInertia(t,r){const l=Af(t,r);return Math.abs(l.lng-r.center.lng)>180&&(l.lng=r.center.lng+179.5*Math.sign(l.lng-r.center.lng)),{easingCenter:l,easingOffset:new d.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,r){const l=t.around,h=r.screenPointToLocation(l);t.bearingDelta&&r.setBearing(r.bearing+t.bearingDelta),t.pitchDelta&&r.setPitch(r.pitch+t.pitchDelta),t.rollDelta&&r.setRoll(r.roll+t.rollDelta);const _=r.zoom;t.zoomDelta&&r.setZoom(r.zoom+t.zoomDelta);const v=r.zoom-_;if(v===0)return;const b=d.bK(r.center.lng,h.lng),S=b/(Math.abs(b/180)+1),A=d.bK(r.center.lat,h.lat),z=r.getRayDirectionFromPixel(l),R=r.cameraPosition,I=-1*d.b5(R,z),F=d.bz();d.b0(F,R,[z[0]*I,z[1]*I,z[2]*I]);const U=d.b7(F)-1,$=Math.exp(.5*-Math.max(U-.3,0)),Q=No(r.worldSize,r.center.lat)/Math.min(r.width,r.height),Y=d.bx(Q,.9,.5,1,.25),J=(1-d.aq(-v))*Math.min($,Y),re=r.center.lat,K=r.zoom,ae=new d.V(r.center.lng+S*J,d.an(r.center.lat+A*J,-d.ao,d.ao));r.setLocationAtPoint(h,l);const le=r.center,ie=d.bx(Math.abs(b),45,85,0,1),pe=d.bx(Q,.75,.35,0,1),ze=Math.pow(Math.max(ie,pe),.25),Te=d.bK(le.lng,ae.lng),Ae=d.bK(le.lat,ae.lat);r.setCenter(new d.V(le.lng+Te*ze,le.lat+Ae*ze).wrap()),r.setZoom(K+pn(re,r.center.lat))}handleMapControlsPan(t,r,l){if(!t.panDelta)return;const h=r.center.lat,_=r.zoom;r.setCenter(Af(t.panDelta,r).wrap()),r.setZoom(_+pn(h,r.center.lat))}cameraForBoxAndBearing(t,r,l,h,_){const v=Oo(t,r,l,h,_),b=r.left/_.width*2-1,S=(_.width-r.right)/_.width*2-1,A=r.top/_.height*-2+1,z=(_.height-r.bottom)/_.height*-2+1,R=d.bK(l.getWest(),l.getEast())<0,I=R?l.getEast():l.getWest(),F=R?l.getWest():l.getEast(),U=Math.max(l.getNorth(),l.getSouth()),$=Math.min(l.getNorth(),l.getSouth()),Q=I+.5*d.bK(I,F),Y=U+.5*d.bK(U,$),J=_.clone();J.setCenter(v.center),J.setBearing(v.bearing),J.setPitch(0),J.setRoll(0),J.setZoom(v.zoom);const re=J.modelViewProjectionMatrix,K=[nn(l.getNorthWest()),nn(l.getNorthEast()),nn(l.getSouthWest()),nn(l.getSouthEast()),nn(new d.V(F,Y)),nn(new d.V(I,Y)),nn(new d.V(Q,U)),nn(new d.V(Q,$))],ae=nn(v.center);let le=Number.POSITIVE_INFINITY;for(const ie of K)b<0&&(le=wn.getLesserNonNegativeNonNull(le,wn.solveVectorScale(ie,ae,re,"x",b))),S>0&&(le=wn.getLesserNonNegativeNonNull(le,wn.solveVectorScale(ie,ae,re,"x",S))),A>0&&(le=wn.getLesserNonNegativeNonNull(le,wn.solveVectorScale(ie,ae,re,"y",A))),z<0&&(le=wn.getLesserNonNegativeNonNull(le,wn.solveVectorScale(ie,ae,re,"y",z)));if(Number.isFinite(le)&&le!==0)return v.zoom=J.zoom+d.at(le),v;za()}handleJumpToCenterZoom(t,r){const l=t.center.lat,h=t.applyConstrain(r.center?d.V.convert(r.center):t.center,t.zoom).center;t.setCenter(h.wrap());const _=r.zoom!==void 0?+r.zoom:t.zoom+pn(l,h.lat);t.zoom!==_&&t.setZoom(_)}handleEaseTo(t,r){const l=t.zoom,h=t.center,_=t.padding,v={roll:t.roll,pitch:t.pitch,bearing:t.bearing},b={roll:r.roll===void 0?t.roll:r.roll,pitch:r.pitch===void 0?t.pitch:r.pitch,bearing:r.bearing===void 0?t.bearing:r.bearing},S=r.zoom!==void 0,A=!t.isPaddingEqual(r.padding);let z=!1;const R=r.center?d.V.convert(r.center):h,I=t.applyConstrain(R,l).center;ss(t,I);const F=t.clone();F.setCenter(I),F.setZoom(S?+r.zoom:l+pn(h.lat,R.lat)),F.setBearing(r.bearing);const U=new d.P(d.an(t.centerPoint.x+r.offsetAsPoint.x,0,t.width),d.an(t.centerPoint.y+r.offsetAsPoint.y,0,t.height));F.setLocationAtPoint(I,U);const $=(r.offset&&r.offsetAsPoint.mag())>0?F.center:I,Q=S?+r.zoom:l+pn(h.lat,$.lat),Y=l+pn(h.lat,0),J=Q+pn($.lat,0),re=d.bK(h.lng,$.lng),K=d.bK(h.lat,$.lat),ae=d.aq(J-Y);return z=Q!==l,{easeFunc:le=>{if(d.bo(v,b)||mu({startEulerAngles:v,endEulerAngles:b,tr:t,k:le,useSlerp:v.roll!=b.roll}),A&&t.interpolatePadding(_,r.padding,le),r.around)d.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(r.around,r.aroundPoint);else{const ie=J>Y?Math.min(2,ae):Math.max(.5,ae),pe=Math.pow(ie,1-le),ze=Cf(h,re,K,le*pe);t.setCenter(ze.wrap())}if(z){const ie=d.G.number(Y,J,le)+pn(0,t.center.lat);t.setZoom(ie)}},isZooming:z,elevationCenter:$}}handleFlyTo(t,r){const l=r.zoom!==void 0,h=t.center,_=t.zoom,v=t.padding,b=!t.isPaddingEqual(r.padding),S=t.applyConstrain(d.V.convert(r.center||r.locationAtOffset),_).center,A=l?+r.zoom:t.zoom+pn(t.center.lat,S.lat),z=t.clone();z.setCenter(S),z.setZoom(A),z.setBearing(r.bearing);const R=new d.P(d.an(t.centerPoint.x+r.offsetAsPoint.x,0,t.width),d.an(t.centerPoint.y+r.offsetAsPoint.y,0,t.height));z.setLocationAtPoint(S,R);const I=z.center;ss(t,I);const F=(function(K,ae,le){const ie=nn(ae),pe=nn(le),ze=d.b5(ie,pe),Te=Math.acos(ze),Ae=Da(K);return Te/(2*Math.PI)*Ae})(t,h,I),U=_+pn(h.lat,0),$=A+pn(I.lat,0),Q=d.aq($-U);let Y;if(typeof r.minZoom=="number"){const K=+r.minZoom+pn(I.lat,0),ae=Math.min(K,U,$)+pn(0,I.lat),le=t.applyConstrain(I,ae).zoom+pn(I.lat,0);Y=d.aq(le-U)}const J=d.bK(h.lng,I.lng),re=d.bK(h.lat,I.lat);return{easeFunc:(K,ae,le,ie)=>{const pe=Cf(h,J,re,le);b&&t.interpolatePadding(v,r.padding,K);const ze=K===1?I:pe;t.setCenter(ze.wrap());const Te=U+d.at(ae);t.setZoom(K===1?A:Te+pn(0,ze.lat))},scaleOfZoom:Q,targetCenter:I,scaleOfMinZoom:Y,pixelPathLength:F}}static solveVectorScale(t,r,l,h,_){const v=h==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],b=[l[3],l[7],l[11],l[15]],S=t[0]*v[0]+t[1]*v[1]+t[2]*v[2],A=t[0]*b[0]+t[1]*b[1]+t[2]*b[2],z=r[0]*v[0]+r[1]*v[1]+r[2]*v[2],R=r[0]*b[0]+r[1]*b[1]+r[2]*b[2];return z+_*A===S+_*R||b[3]*(S-z)+v[3]*(R-A)+S*R==z*A?null:(z+v[3]-_*R-_*b[3])/(z-S-_*R+_*A)}static getLesserNonNegativeNonNull(t,r){return r!==null&&r>=0&&r<t?r:t}}class Pl{constructor(t){this._globe=t,this._mercatorCameraHelper=new ko,this._verticalPerspectiveCameraHelper=new wn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,r){return this.currentHelper.handlePanInertia(t,r)}handleMapControlsRollPitchBearingZoom(t,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,r)}handleMapControlsPan(t,r,l){this.currentHelper.handleMapControlsPan(t,r,l)}cameraForBoxAndBearing(t,r,l,h,_){return this.currentHelper.cameraForBoxAndBearing(t,r,l,h,_)}handleJumpToCenterZoom(t,r){this.currentHelper.handleJumpToCenterZoom(t,r)}handleEaseTo(t,r){return this.currentHelper.handleEaseTo(t,r)}handleFlyTo(t,r){return this.currentHelper.handleFlyTo(t,r)}}const Il=(m,t)=>d.B(m,t&&t.filter((r=>r.identifier!=="source.canvas"))),Rl=d.bO();class so extends d.E{constructor(t,r={}){var l,h;super(),this._rtlPluginLoaded=()=>{for(const v in this.tileManagers){const b=this.tileManagers[v].getSource().type;b!=="vector"&&b!=="geojson"||this.tileManagers[v].reload()}},this.map=t,this.dispatcher=new Xi(wi(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((v,b)=>this.getGlyphs(v,b))),this.dispatcher.registerMessageHandler("GI",((v,b)=>this.getImages(v,b))),this.dispatcher.registerMessageHandler("GDA",((v,b)=>this.getDashes(v,b))),this.imageManager=new Gi,this.imageManager.setEventedParent(this);const _=((l=t._container)===null||l===void 0?void 0:l.lang)||typeof document<"u"&&((h=document.documentElement)===null||h===void 0?void 0:h.lang)||void 0;this.glyphManager=new it(t._requestManager,r.localIdeographFontFamily,_),this.lineAtlas=new ot(256,512),this.crossTileSymbolIndex=new qn,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",d.bP()),_e().on(oe,this._rtlPluginLoaded),this.on("data",(v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const b=this.tileManagers[v.sourceId];if(!b)return;const S=b.getSource();if(S&&S.vectorLayerIds)for(const A in this._layers){const z=this._layers[A];z.source===S.id&&this._validateLayer(z)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new d.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,r){var l,h,_;this._checkLoaded();const v=r===null?(_=(h=(l=this.stylesheet.state)===null||l===void 0?void 0:l[t])===null||h===void 0?void 0:h.default)!==null&&_!==void 0?_:null:r;if(d.bR(v,this._globalState[t]))return this;this._globalState[t]=v,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const r=[];for(const l in t)!d.bR(this._globalState[l],t[l].default)&&(r.push(l),this._globalState[l]=t[l].default);this._applyGlobalStateChanges(r)}_applyGlobalStateChanges(t){if(t.length===0)return;const r=new Set,l={};for(const h of t){l[h]=this._globalState[h];for(const _ in this._layers){const v=this._layers[_],b=v.getLayoutAffectingGlobalStateRefs(),S=v.getPaintAffectingGlobalStateRefs(),A=v.getVisibilityAffectingGlobalStateRefs();if(b.has(h)&&r.add(v.source),S.has(h))for(const{name:z,value:R}of S.get(h))this._updatePaintProperty(v,z,R);A?.has(h)&&(v.recalculateVisibility(),this._updateLayer(v))}}this.dispatcher.broadcast("UGS",l);for(const h in this.tileManagers)r.has(h)&&(this._reloadSource(h),this._changed=!0)}loadURL(t,r={},l){this.fire(new d.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const h=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const _=this._loadStyleRequest;d.j(h,this._loadStyleRequest).then((v=>{this._loadStyleRequest=null,this._load(v.data,r,l)})).catch((v=>{this._loadStyleRequest=null,v&&!_.signal.aborted&&this.fire(new d.k(v))}))}loadJSON(t,r={},l){this.fire(new d.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ei.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(t,r,l)})).catch((()=>{}))}loadEmpty(){this.fire(new d.l("dataloading",{dataType:"style"})),this._load(Rl,{validate:!1})}_load(t,r,l){var h,_;let v=r.transformStyle?r.transformStyle(l,t):t;if(!r.validate||!Il(this,d.C(v))){v=Object.assign({},v),this._loaded=!0,this.stylesheet=v;for(const b in v.sources)this.addSource(b,v.sources[b],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new Wt(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new Ze(this.stylesheet.sky),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.fire(new d.l("data",{dataType:"style"})),this.fire(new d.l("style.load"))}}_createLayers(){var t,r,l;const h=d.bS(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",h),this._order=h.map((_=>_.id)),this._layers={},this._serializedLayers=null;for(const _ of h){const v=d.bT(_,this._globalState);if(v.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=v,d.bU(v)&&this.tileManagers[v.source]){const b=(l=(r=_.paint)===null||r===void 0?void 0:r["raster-fade-duration"])!==null&&l!==void 0?l:v.paint.get("raster-fade-duration");this.tileManagers[v.source].setRasterFadeDuration(b)}}}_loadSprite(t,r=!1,l=void 0){this.imageManager.setLoaded(!1);const h=new AbortController;let _;this._spriteRequest=h,(function(v,b,S,A){return d._(this,void 0,void 0,(function*(){const z=bn(v),R=S>1?"@2x":"",I={},F={};for(const{id:U,url:$}of z){const Q=b.transformRequest(Yn($,R,".json"),"SpriteJSON");I[U]=d.j(Q,A);const Y=b.transformRequest(Yn($,R,".png"),"SpriteImage");F[U]=Ct.getImage(Y,A)}return yield Promise.all([...Object.values(I),...Object.values(F)]),(function(U,$){return d._(this,void 0,void 0,(function*(){const Q={};for(const Y in U){Q[Y]={};const J=ei.getImageCanvasContext((yield $[Y]).data),re=(yield U[Y]).data;for(const K in re){const{width:ae,height:le,x:ie,y:pe,sdf:ze,pixelRatio:Te,stretchX:Ae,stretchY:Ce,content:We,textFitWidth:Ke,textFitHeight:Ge}=re[K];Q[Y][K]={data:null,pixelRatio:Te,sdf:ze,stretchX:Ae,stretchY:Ce,content:We,textFitWidth:Ke,textFitHeight:Ge,spriteData:{width:ae,height:le,x:ie,y:pe,context:J}}}}return Q}))})(I,F)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((v=>{if(this._spriteRequest=null,v)for(const b in v){this._spritesImagesIds[b]=[];const S=this._spritesImagesIds[b]?this._spritesImagesIds[b].filter((A=>!(A in v))):[];for(const A of S)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in v[b]){const z=b==="default"?A:`${b}:${A}`;this._spritesImagesIds[b].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,v[b][A],!1):this.imageManager.addImage(z,v[b][A]),r&&(this._changedImages[z]=!0)}}})).catch((v=>{this._spriteRequest=null,_=v,h.signal.aborted||this.fire(new d.k(_))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"})),l&&l(_)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}_validateLayer(t){const r=this.tileManagers[t.source];if(!r)return;const l=t.sourceLayer;if(!l)return;const h=r.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new d.k(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,r=!1){const l=this._serializedAllLayers();if(!t||t.length===0)return Object.values(r?d.bV(l):l);const h=[];for(const _ of t)if(l[_]){const v=r?d.bV(l[_]):l[_];h.push(v)}return h}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const r=Object.keys(this._layers);for(const l of r){const h=this._layers[l];h.type!=="custom"&&(t[l]=h.serialize())}return t}hasTransitions(){var t,r,l;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const h in this.tileManagers)if(this.tileManagers[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const r=this._changed;if(r){const h=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(h.length||_.length)&&this._updateWorkerLayers(h,_);for(const v in this._updatedSources){const b=this._updatedSources[v];if(b==="reload")this._reloadSource(v);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const l={};for(const h in this.tileManagers){const _=this.tileManagers[h];l[h]=_.used,_.used=!1}for(const h of this._order){const _=this._layers[h];_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)&&_.source&&(this.tileManagers[_.source].used=!0)}for(const h in l){const _=this.tileManagers[h];!!l[h]!=!!_.used&&_.fire(new d.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,r&&this.fire(new d.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const r in this.tileManagers)this.tileManagers[r].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,r={}){var l;this._checkLoaded();const h=this.serialize();if(t=r.transformStyle?r.transformStyle(h,t):t,((l=r.validate)===null||l===void 0||l)&&Il(this,d.C(t)))return!1;(t=d.bV(t)).layers=d.bS(t.layers);const _=d.bW(h,t),v=this._getOperationsToPerform(_);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const b of v.operations)b();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const r=[],l=[];for(const h of t)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push((()=>this.addLayer.apply(this,h.args)));break;case"removeLayer":r.push((()=>this.removeLayer.apply(this,h.args)));break;case"setPaintProperty":r.push((()=>this.setPaintProperty.apply(this,h.args)));break;case"setLayoutProperty":r.push((()=>this.setLayoutProperty.apply(this,h.args)));break;case"setFilter":r.push((()=>this.setFilter.apply(this,h.args)));break;case"addSource":r.push((()=>this.addSource.apply(this,h.args)));break;case"removeSource":r.push((()=>this.removeSource.apply(this,h.args)));break;case"setLayerZoomRange":r.push((()=>this.setLayerZoomRange.apply(this,h.args)));break;case"setLight":r.push((()=>this.setLight.apply(this,h.args)));break;case"setGeoJSONSourceData":r.push((()=>this.setGeoJSONSourceData.apply(this,h.args)));break;case"setGlyphs":r.push((()=>this.setGlyphs.apply(this,h.args)));break;case"setSprite":r.push((()=>this.setSprite.apply(this,h.args)));break;case"setTerrain":r.push((()=>this.map.setTerrain.apply(this,h.args)));break;case"setSky":r.push((()=>this.setSky.apply(this,h.args)));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setGlobalState":r.push((()=>this.setGlobalState.apply(this,h.args)));break;case"setTransition":r.push((()=>{}));break;default:l.push(h.command)}return{operations:r,unimplemented:l}}addImage(t,r){if(this.getImage(t))return this.fire(new d.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,r),this._afterImageUpdated(t)}updateImage(t,r){this.imageManager.updateImage(t,r)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new d.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,r,l={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(d.C.source,`sources.${t}`,r,null,l))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const h=this.tileManagers[t]=new ji(t,r,this.dispatcher);h.style=this,h.setEventedParent(this,(()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:t}))),h.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new d.k(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const r=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],r.fire(new d.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,r){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.tileManagers[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(r),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,r,l={}){this._checkLoaded();const h=t.id;if(this.getLayer(h))return void this.fire(new d.k(new Error(`Layer "${h}" already exists on this map.`)));let _;if(t.type==="custom"){if(Il(this,d.bX(t)))return;_=d.bT(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(h,t.source),t=d.bV(t),t=d.e(t,{source:h})),this._validate(d.C.layer,`layers.${h}`,t,{arrayIndex:-1},l))return;_=d.bT(t,this._globalState),this._validateLayer(_),_.setEventedParent(this,{layer:{id:h}})}const v=r?this._order.indexOf(r):this._order.length;if(r&&v===-1)this.fire(new d.k(new Error(`Cannot add layer "${h}" before non-existing layer "${r}".`)));else{if(this._order.splice(v,0,h),this._layerOrderChanged=!0,this._layers[h]=_,this._removedLayers[h]&&_.source&&_.type!=="custom"){const b=this._removedLayers[h];delete this._removedLayers[h],b.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.tileManagers[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(t,r){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new d.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===r)return;const l=this._order.indexOf(t);this._order.splice(l,1);const h=r?this._order.indexOf(r):this._order.length;r&&h===-1?this.fire(new d.k(new Error(`Cannot move layer "${t}" before non-existing layer "${r}".`))):(this._order.splice(h,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const r=this._layers[t];if(!r)return void this.fire(new d.k(new Error(`Cannot remove non-existing layer "${t}".`)));r.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=r,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],r.onRemove&&r.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,r,l){this._checkLoaded();const h=this.getLayer(t);h?h.minzoom===r&&h.maxzoom===l||(r!=null&&(h.minzoom=r),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new d.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,r,l={}){this._checkLoaded();const h=this.getLayer(t);if(h){if(!d.bR(h.filter,r))return r==null?(h.setFilter(void 0),void this._updateLayer(h)):void(this._validate(d.C.filter,`layers.${h.id}.filter`,r,null,l)||(h.setFilter(d.bV(r)),this._updateLayer(h)))}else this.fire(new d.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return d.bV(this.getLayer(t).filter)}setLayoutProperty(t,r,l,h={}){this._checkLoaded();const _=this.getLayer(t);_?d.bR(_.getLayoutProperty(r),l)||(_.setLayoutProperty(r,l,h),this._updateLayer(_)):this.fire(new d.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,r){const l=this.getLayer(t);if(l)return l.getLayoutProperty(r);this.fire(new d.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,r,l,h={}){this._checkLoaded();const _=this.getLayer(t);_?d.bR(_.getPaintProperty(r),l)||this._updatePaintProperty(_,r,l,h):this.fire(new d.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,r,l,h={}){t.setPaintProperty(r,l,h)&&this._updateLayer(t),d.bU(t)&&r==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(l),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,r){return this.getLayer(t).getPaintProperty(r)}setFeatureState(t,r){this._checkLoaded();const l=t.source,h=t.sourceLayer,_=this.tileManagers[l];if(_===void 0)return void this.fire(new d.k(new Error(`The source '${l}' does not exist in the map's style.`)));const v=_.getSource().type;v==="geojson"&&h?this.fire(new d.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||h?(t.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),_.setFeatureState(h,t.id,r)):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,r){this._checkLoaded();const l=t.source,h=this.tileManagers[l];if(h===void 0)return void this.fire(new d.k(new Error(`The source '${l}' does not exist in the map's style.`)));const _=h.getSource().type,v=_==="vector"?t.sourceLayer:void 0;_!=="vector"||v?r&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new d.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(v,t.id,r):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const r=t.source,l=t.sourceLayer,h=this.tileManagers[r];if(h!==void 0)return h.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,t.id)):void this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=d.bY(this.tileManagers,(_=>_.serialize())),r=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,h=this.stylesheet;return d.bZ({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:t,layers:r,terrain:l},(_=>_!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const r=v=>this._layers[v].type==="fill-extrusion",l={},h=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(r(b)){l[b]=v;for(const S of t){const A=S[b];if(A)for(const z of A)h.push(z)}}}h.sort(((v,b)=>b.intersectionZ-v.intersectionZ));const _=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(r(b))for(let S=h.length-1;S>=0;S--){const A=h[S].feature;if(l[A.layer.id]<v)break;_.push(A),h.pop()}else for(const S of t){const A=S[b];if(A)for(const z of A)_.push(z.feature)}}return _}queryRenderedFeatures(t,r,l){r&&r.filter&&this._validate(d.C.filter,"queryRenderedFeatures.filter",r.filter,null,r);const h={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new d.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const A of r.layers){const z=this._layers[A];if(!z)return this.fire(new d.k(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];h[z.source]=!0}}const _=[];r.availableImages=this._availableImages;const v=this._serializedAllLayers(),b=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,S=Object.assign(Object.assign({},r),{layers:b,globalState:this._globalState});for(const A in this.tileManagers)r.layers&&!h[A]||_.push(Ya(this.tileManagers[A],this._layers,v,t,S,l,this.map.terrain?(z,R,I)=>this.map.terrain.getElevation(z,R,I):void 0));return this.placement&&_.push((function(A,z,R,I,F,U,$){const Q={},Y=U.queryRenderedSymbols(I),J=[];for(const re of Object.keys(Y).map(Number))J.push($[re]);J.sort(Ii);for(const re of J){const K=re.featureIndex.lookupSymbolFeatures(Y[re.bucketInstanceId],z,re.bucketIndex,re.sourceLayerIndex,{filterSpec:F.filter,globalState:F.globalState},F.layers,F.availableImages,A);for(const ae in K){const le=Q[ae]=Q[ae]||[],ie=K[ae];ie.sort(((pe,ze)=>{const Te=re.featureSortOrder;if(Te){const Ae=Te.indexOf(pe.featureIndex);return Te.indexOf(ze.featureIndex)-Ae}return ze.featureIndex-pe.featureIndex}));for(const pe of ie)le.push(pe)}}return(function(re,K,ae){for(const le in re)for(const ie of re[le])Qn(ie,ae[K[le].source]);return re})(Q,A,R)})(this._layers,v,this.tileManagers,t,S,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,r){r?.filter&&this._validate(d.C.filter,"querySourceFeatures.filter",r.filter,null,r);const l=this.tileManagers[t];return l?(function(h,_){const v=h.getRenderableIds().map((A=>h.getTileByID(A))),b=[],S={};for(let A=0;A<v.length;A++){const z=v[A],R=z.tileID.canonical.key;S[R]||(S[R]=!0,z.querySourceFeatures(b,_))}return b})(l,r?Object.assign(Object.assign({},r),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,r={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const v in t)if(!d.bR(t[v],l[v])){h=!0;break}if(!h)return;const _={now:nt(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,r),this.light.updateTransitions(_)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,r={}){this._checkLoaded();const l=this.getSky();let h=!1;if(!t&&!l)return;if(t&&!l)h=!0;else if(!t&&l)h=!0;else for(const v in t)if(!d.bR(t[v],l[v])){h=!0;break}if(!h)return;const _={now:nt(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,r),this.sky.updateTransitions(_)}_setProjectionInternal(t){const r=(function(l,h){const _={constrainOverride:h};if(Array.isArray(l)){const v=new dh({type:l});return{projection:v,transform:new Dl(_),cameraHelper:new Pl(v)}}switch(l){case"mercator":return{projection:new Zn,transform:new kn(_),cameraHelper:new ko};case"globe":{const v=new dh({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:v,transform:new Dl(_),cameraHelper:new Pl(v)}}case"vertical-perspective":return{projection:new fh,transform:new zl(_),cameraHelper:new wn};default:return d.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new Zn,transform:new kn(_),cameraHelper:new ko}}})(t,this.map.transformConstrain);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const l in this.tileManagers)this.tileManagers[l].reload()}_validate(t,r,l,h,_={}){return(!_||_.validate!==!1)&&Il(this,t.call(d.C,d.e({key:r,style:this.serialize(),value:l,styleSpec:d.u},h)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),_e().off(oe,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.tileManagers){const l=this.tileManagers[r];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const r in this.tileManagers)this.tileManagers[r].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,r,l,h,_=!1){let v=!1,b=!1;const S={};for(const A of this._order){const z=this._layers[A];if(z.type!=="symbol")continue;if(!S[z.source]){const I=this.tileManagers[z.source];S[z.source]=I.getRenderableIds(!0).map((F=>I.getTileByID(F))).sort(((F,U)=>U.tileID.overscaledZ-F.tileID.overscaledZ||(F.tileID.isLessThan(U.tileID)?-1:1)))}const R=this.crossTileSymbolIndex.addLayer(z,S[z.source],t.center.lng);v=v||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(nt(),t.zoom))&&(this.pauseablePlacement=new El(t,this.map.terrain,this._order,_,r,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(nt()),b=!0),v&&this.pauseablePlacement.placement.setStale()),b||v)for(const A of this._order){const z=this._layers[A];z.type==="symbol"&&this.placement.updateLayerOpacities(z,S[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(nt())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,r){return d._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const h=this.tileManagers[r.source];return h&&h.setDependencies(r.tileID.key,r.type,r.icons),l}))}getGlyphs(t,r){return d._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(r.stacks),h=this.tileManagers[r.source];return h&&h.setDependencies(r.tileID.key,r.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,r={}){this._checkLoaded(),t&&this._validate(d.C.glyphs,"glyphs",t,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,r){return d._(this,void 0,void 0,(function*(){const l={};for(const[h,_]of Object.entries(r.dashes))l[h]=this.lineAtlas.getDash(_.dasharray,_.round);return l}))}addSprite(t,r,l={},h){this._checkLoaded();const _=[{id:t,url:r}],v=[...bn(this.stylesheet.sprite),..._];this._validate(d.C.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(_,!0,h))}removeSprite(t){this._checkLoaded();const r=bn(this.stylesheet.sprite);if(r.find((l=>l.id===t))){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;r.splice(r.findIndex((l=>l.id===t)),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}else this.fire(new d.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return bn(this.stylesheet.sprite)}setSprite(t,r={},l){this._checkLoaded(),t&&this._validate(d.C.sprite,"sprite",t,null,r)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const r=this.tileManagers[t];r.setEventedParent(null),r.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const r=this._layers[t];r.setEventedParent(null),r.onRemove&&r.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var zf=d.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class bu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,r,l,h,_,v,b,S,A){this.context=t;let z=this.boundPaintVertexBuffers.length!==h.length;for(let R=0;!z&&R<h.length;R++)this.boundPaintVertexBuffers[R]!==h[R]&&(z=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==l||z||this.boundIndexBuffer!==_||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==A?this.freshBind(r,l,h,_,v,b,S,A):(t.bindVertexArray.set(this.vao),b&&b.bind(),_&&_.dynamicDraw&&_.bind(),S&&S.bind(),A&&A.bind())}freshBind(t,r,l,h,_,v,b,S){const A=t.numAttributes,z=this.context,R=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=S,r.enableAttributes(R,t);for(const I of l)I.enableAttributes(R,t);v&&v.enableAttributes(R,t),b&&b.enableAttributes(R,t),S&&S.enableAttributes(R,t),r.bind(),r.setVertexAttribPointers(R,t,_);for(const I of l)I.bind(),I.setVertexAttribPointers(R,t,_);v&&(v.bind(),v.setVertexAttribPointers(R,t,_)),h&&h.bind(),b&&(b.bind(),b.setVertexAttribPointers(R,t,_)),S&&(S.bind(),S.setVertexAttribPointers(R,t,_)),z.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Df=(m,t,r,l,h)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:t,u_fog_color:r?r.properties.get("fog-color"):d.bp.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:r?r.calculateFogBlendOpacity(l):0,u_horizon_color:r?r.properties.get("horizon-color"):d.bp.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),Nr={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function mc(m){const t=[];for(let r=0;r<m.length;r++){if(m[r]===null)continue;const l=m[r].split(" ");t.push(l.pop())}return t}class Pf{constructor(t,r,l,h,_,v,b,S,A=[]){const z=t.gl;this.program=z.createProgram();const R=mc(r.staticAttributes),I=l?l.getBinderAttributes():[],F=R.concat(I),U=en.prelude.staticUniforms?mc(en.prelude.staticUniforms):[],$=b.staticUniforms?mc(b.staticUniforms):[],Q=r.staticUniforms?mc(r.staticUniforms):[],Y=l?l.getBinderUniforms():[],J=U.concat($).concat(Q).concat(Y),re=[];for(const Te of J)re.indexOf(Te)<0&&re.push(Te);const K=l?l.defines():[];_r(z)&&K.unshift("#version 300 es"),_&&K.push("#define OVERDRAW_INSPECTOR;"),v&&K.push("#define TERRAIN3D;"),S&&K.push(S),A&&K.push(...A);let ae=K.concat(en.prelude.fragmentSource,b.fragmentSource,r.fragmentSource).join(`
`),le=K.concat(en.prelude.vertexSource,b.vertexSource,r.vertexSource).join(`
`);_r(z)||(ae=(function(Te){return Te.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ae),le=(function(Te){return Te.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(le));const ie=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(ie,ae),z.compileShader(ie),!z.getShaderParameter(ie,z.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${z.getShaderInfoLog(ie)}`);z.attachShader(this.program,ie);const pe=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(pe,le),z.compileShader(pe),!z.getShaderParameter(pe,z.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${z.getShaderInfoLog(pe)}`);z.attachShader(this.program,pe),this.attributes={};const ze={};this.numAttributes=F.length;for(let Te=0;Te<this.numAttributes;Te++)F[Te]&&(z.bindAttribLocation(this.program,Te,F[Te]),this.attributes[F[Te]]=Te);if(z.linkProgram(this.program),!z.getProgramParameter(this.program,z.LINK_STATUS))throw new Error(`Program failed to link: ${z.getProgramInfoLog(this.program)}`);z.deleteShader(pe),z.deleteShader(ie);for(let Te=0;Te<re.length;Te++){const Ae=re[Te];if(Ae&&!ze[Ae]){const Ce=z.getUniformLocation(this.program,Ae);Ce&&(ze[Ae]=Ce)}}this.fixedUniforms=h(t,ze),this.terrainUniforms=((Te,Ae)=>({u_depth:new d.b_(Te,Ae.u_depth),u_terrain:new d.b_(Te,Ae.u_terrain),u_terrain_dim:new d.bq(Te,Ae.u_terrain_dim),u_terrain_matrix:new d.c0(Te,Ae.u_terrain_matrix),u_terrain_unpack:new d.c1(Te,Ae.u_terrain_unpack),u_terrain_exaggeration:new d.bq(Te,Ae.u_terrain_exaggeration)}))(t,ze),this.projectionUniforms=((Te,Ae)=>({u_projection_matrix:new d.c0(Te,Ae.u_projection_matrix),u_projection_tile_mercator_coords:new d.c1(Te,Ae.u_projection_tile_mercator_coords),u_projection_clipping_plane:new d.c1(Te,Ae.u_projection_clipping_plane),u_projection_transition:new d.bq(Te,Ae.u_projection_transition),u_projection_fallback_matrix:new d.c0(Te,Ae.u_projection_fallback_matrix)}))(t,ze),this.binderUniforms=l?l.getUniforms(t,ze):[]}draw(t,r,l,h,_,v,b,S,A,z,R,I,F,U,$,Q,Y,J,re){const K=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(h),t.setColorMode(_),t.setCullFace(v),S){t.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,S.depthTexture),t.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,S.texture);for(const le in this.terrainUniforms)this.terrainUniforms[le].set(S[le])}if(A)for(const le in A)this.projectionUniforms[Nr[le]].set(A[le]);if(b)for(const le in this.fixedUniforms)this.fixedUniforms[le].set(b[le]);Q&&Q.setUniforms(t,this.binderUniforms,U,{zoom:$});let ae=0;switch(r){case K.LINES:ae=2;break;case K.TRIANGLES:ae=3;break;case K.LINE_STRIP:ae=1}for(const le of F.get()){const ie=le.vaos||(le.vaos={});(ie[z]||(ie[z]=new bu)).bind(t,this,R,Q?Q.getPaintVertexBuffers():[],I,le.vertexOffset,Y,J,re),K.drawElements(r,le.primitiveLength*ae,K.UNSIGNED_SHORT,le.primitiveOffset*ae*2)}}}function If(m,t,r){const l=1/d.aN(r,1,t.transform.tileZoom),h=Math.pow(2,r.tileID.overscaledZ),_=r.tileSize*Math.pow(2,t.transform.tileZoom)/h,v=_*(r.tileID.canonical.x+r.tileID.wrap*h),b=_*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[l,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b]}}const gc=(m,t,r,l)=>{const h=m.style.light,_=h.properties.get("position"),v=[_.x,_.y,_.z],b=d.c4();h.properties.get("anchor")==="viewport"&&d.c5(b,m.transform.bearingInRadians),d.c6(v,v,b);const S=m.transform.transformLightDirection(v),A=h.properties.get("color");return{u_lightpos:v,u_lightpos_globe:S,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+t,u_opacity:r,u_fill_translate:l}},_c=(m,t,r,l,h,_,v)=>d.e(gc(m,t,r,l),If(_,m,v),{u_height_factor:-Math.pow(2,h.overscaledZ)/v.tileSize/8}),Vo=(m,t,r,l)=>d.e(If(t,m,r),{u_fill_translate:l}),Ll=(m,t)=>({u_world:m,u_fill_translate:t}),Rf=(m,t,r,l,h)=>d.e(Vo(m,t,r,h),{u_world:l}),wu=(m,t,r,l,h)=>{const _=m.transform;let v,b,S=0;if(r.paint.get("circle-pitch-alignment")==="map"){const A=d.aN(t,1,_.zoom);v=!0,b=[A,A],S=A/(d.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*h}else v=!1,b=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+v,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:b,u_globe_extrude_scale:S,u_translate:l}},oo=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),mh=m=>({u_viewport_size:[m.width,m.height]}),Tu=(m,t=1)=>({u_color:m,u_overlay:0,u_overlay_scale:t}),lo=(m,t,r,l)=>{const h=d.aN(m,1,t)/(d.a5*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:d.aN(m,1,t),u_intensity:r,u_globe_extrude_scale:h}},gh=(m,t,r,l)=>{const h=d.N();d.c7(h,0,m.width,m.height,0,0,1);const _=m.context.gl;return{u_matrix:h,u_world:[_.drawingBufferWidth,_.drawingBufferHeight],u_image:r,u_color_ramp:l,u_opacity:t.paint.get("heatmap-opacity")}},Su=(m,t,r)=>{const l=r.paint.get("hillshade-accent-color");let h;switch(r.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}const _=r.getIlluminationProperties();for(let v=0;v<_.directionRadians.length;v++)r.paint.get("hillshade-illumination-anchor")==="viewport"&&(_.directionRadians[v]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:Xd(0,t.tileID),u_exaggeration:r.paint.get("hillshade-exaggeration"),u_altitudes:_.altitudeRadians,u_azimuths:_.directionRadians,u_accent:l,u_method:h,u_highlights:_.highlightColor,u_shadows:_.shadowColor}},Lf=(m,t)=>{const r=t.stride,l=d.N();return d.c7(l,0,d.a5,-d.a5,0,0,1),d.O(l,l,[0,-d.a5,0]),{u_matrix:l,u_image:1,u_dimension:[r,r],u_zoom:m.overscaledZ,u_unpack:t.getUnpackVector()}};function Xd(m,t){const r=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new d.a9(0,l/r).toLngLat().lat,new d.a9(0,(l+1)/r).toLngLat().lat]}const Bf=(m,t,r=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:r,u_opacity:m.paint.get("color-relief-opacity")}),Mu=(m,t,r,l)=>{const h=m.transform;return{u_translation:Eu(m,t,r),u_ratio:l/d.aN(t,1,h.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Of=(m,t,r,l,h)=>d.e(Mu(m,t,r,l),{u_image:0,u_image_height:h}),_h=(m,t,r,l,h)=>{const _=m.transform,v=yr(t,_);return{u_translation:Eu(m,t,r),u_texsize:t.imageAtlasTexture.size,u_ratio:l/d.aN(t,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[v,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Oa=(m,t,r,l,h)=>{const _=yr(t,m.transform);return d.e(Mu(m,t,r,l),{u_tileratio:_,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image:0,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})},uo=(m,t,r,l,h,_)=>{const v=yr(t,m.transform);return d.e(Mu(m,t,r,l),{u_image:0,u_image_height:_,u_tileratio:v,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image_dash:1,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})};function yr(m,t){return 1/d.aN(m,1,t.tileZoom)}function Eu(m,t,r){return d.aO(m.transform,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const yc=(m,t,r,l,h)=>{return{u_tl_parent:m,u_scale_parent:t,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(v=l.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(_=l.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:vc(l.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var _,v};function vc(m){m*=Math.PI/180;const t=Math.sin(m),r=Math.cos(m);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const Au=(m,t,r,l,h,_,v,b,S,A,z,R,I)=>{const F=v.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:F.width/F.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_label_plane_matrix:b,u_coord_matrix:S,u_is_text:+z,u_pitch_with_map:+l,u_is_along_line:h,u_is_variable_anchor:_,u_texsize:R,u_texture:0,u_translation:A,u_pitched_scale:I}},xc=(m,t,r,l,h,_,v,b,S,A,z,R,I,F)=>{const U=v.transform;return d.e(Au(m,t,r,l,h,_,v,b,S,A,z,R,F),{u_gamma_scale:l?Math.cos(U.pitch*Math.PI/180)*U.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},vr=(m,t,r,l,h,_,v,b,S,A,z,R,I)=>d.e(xc(m,t,r,l,h,_,v,b,S,A,!0,z,0,I),{u_texsize_icon:R,u_texture_icon:1}),Cu=(m,t)=>({u_opacity:m,u_color:t}),zu=(m,t,r,l,h)=>d.e((function(_,v,b,S){const A=b.imageManager.getPattern(_.from.toString()),z=b.imageManager.getPattern(_.to.toString()),{width:R,height:I}=b.imageManager.getPixelSize(),F=Math.pow(2,S.tileID.overscaledZ),U=S.tileSize*Math.pow(2,b.transform.tileZoom)/F,$=U*(S.tileID.canonical.x+S.tileID.wrap*F),Q=U*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[R,I],u_mix:v.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/d.aN(S,1,b.transform.tileZoom),u_pixel_coord_upper:[$>>16,Q>>16],u_pixel_coord_lower:[65535&$,65535&Q]}})(r,h,t,l),{u_opacity:m}),bc=(m,t)=>{},kf={fillExtrusion:(m,t)=>({u_lightpos:new d.c2(m,t.u_lightpos),u_lightpos_globe:new d.c2(m,t.u_lightpos_globe),u_lightintensity:new d.bq(m,t.u_lightintensity),u_lightcolor:new d.c2(m,t.u_lightcolor),u_vertical_gradient:new d.bq(m,t.u_vertical_gradient),u_opacity:new d.bq(m,t.u_opacity),u_fill_translate:new d.c3(m,t.u_fill_translate)}),fillExtrusionPattern:(m,t)=>({u_lightpos:new d.c2(m,t.u_lightpos),u_lightpos_globe:new d.c2(m,t.u_lightpos_globe),u_lightintensity:new d.bq(m,t.u_lightintensity),u_lightcolor:new d.c2(m,t.u_lightcolor),u_vertical_gradient:new d.bq(m,t.u_vertical_gradient),u_height_factor:new d.bq(m,t.u_height_factor),u_opacity:new d.bq(m,t.u_opacity),u_fill_translate:new d.c3(m,t.u_fill_translate),u_image:new d.b_(m,t.u_image),u_texsize:new d.c3(m,t.u_texsize),u_pixel_coord_upper:new d.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.c3(m,t.u_pixel_coord_lower),u_scale:new d.c2(m,t.u_scale),u_fade:new d.bq(m,t.u_fade)}),fill:(m,t)=>({u_fill_translate:new d.c3(m,t.u_fill_translate)}),fillPattern:(m,t)=>({u_image:new d.b_(m,t.u_image),u_texsize:new d.c3(m,t.u_texsize),u_pixel_coord_upper:new d.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.c3(m,t.u_pixel_coord_lower),u_scale:new d.c2(m,t.u_scale),u_fade:new d.bq(m,t.u_fade),u_fill_translate:new d.c3(m,t.u_fill_translate)}),fillOutline:(m,t)=>({u_world:new d.c3(m,t.u_world),u_fill_translate:new d.c3(m,t.u_fill_translate)}),fillOutlinePattern:(m,t)=>({u_world:new d.c3(m,t.u_world),u_image:new d.b_(m,t.u_image),u_texsize:new d.c3(m,t.u_texsize),u_pixel_coord_upper:new d.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.c3(m,t.u_pixel_coord_lower),u_scale:new d.c2(m,t.u_scale),u_fade:new d.bq(m,t.u_fade),u_fill_translate:new d.c3(m,t.u_fill_translate)}),circle:(m,t)=>({u_camera_to_center_distance:new d.bq(m,t.u_camera_to_center_distance),u_scale_with_map:new d.b_(m,t.u_scale_with_map),u_pitch_with_map:new d.b_(m,t.u_pitch_with_map),u_extrude_scale:new d.c3(m,t.u_extrude_scale),u_device_pixel_ratio:new d.bq(m,t.u_device_pixel_ratio),u_globe_extrude_scale:new d.bq(m,t.u_globe_extrude_scale),u_translate:new d.c3(m,t.u_translate)}),collisionBox:(m,t)=>({u_pixel_extrude_scale:new d.c3(m,t.u_pixel_extrude_scale)}),collisionCircle:(m,t)=>({u_viewport_size:new d.c3(m,t.u_viewport_size)}),debug:(m,t)=>({u_color:new d.b$(m,t.u_color),u_overlay:new d.b_(m,t.u_overlay),u_overlay_scale:new d.bq(m,t.u_overlay_scale)}),depth:bc,clippingMask:bc,heatmap:(m,t)=>({u_extrude_scale:new d.bq(m,t.u_extrude_scale),u_intensity:new d.bq(m,t.u_intensity),u_globe_extrude_scale:new d.bq(m,t.u_globe_extrude_scale)}),heatmapTexture:(m,t)=>({u_matrix:new d.c0(m,t.u_matrix),u_world:new d.c3(m,t.u_world),u_image:new d.b_(m,t.u_image),u_color_ramp:new d.b_(m,t.u_color_ramp),u_opacity:new d.bq(m,t.u_opacity)}),hillshade:(m,t)=>({u_image:new d.b_(m,t.u_image),u_latrange:new d.c3(m,t.u_latrange),u_exaggeration:new d.bq(m,t.u_exaggeration),u_altitudes:new d.c9(m,t.u_altitudes),u_azimuths:new d.c9(m,t.u_azimuths),u_accent:new d.b$(m,t.u_accent),u_method:new d.b_(m,t.u_method),u_shadows:new d.c8(m,t.u_shadows),u_highlights:new d.c8(m,t.u_highlights)}),hillshadePrepare:(m,t)=>({u_matrix:new d.c0(m,t.u_matrix),u_image:new d.b_(m,t.u_image),u_dimension:new d.c3(m,t.u_dimension),u_zoom:new d.bq(m,t.u_zoom),u_unpack:new d.c1(m,t.u_unpack)}),colorRelief:(m,t)=>({u_image:new d.b_(m,t.u_image),u_unpack:new d.c1(m,t.u_unpack),u_dimension:new d.c3(m,t.u_dimension),u_elevation_stops:new d.b_(m,t.u_elevation_stops),u_color_stops:new d.b_(m,t.u_color_stops),u_color_ramp_size:new d.b_(m,t.u_color_ramp_size),u_opacity:new d.bq(m,t.u_opacity)}),line:(m,t)=>({u_translation:new d.c3(m,t.u_translation),u_ratio:new d.bq(m,t.u_ratio),u_device_pixel_ratio:new d.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new d.c3(m,t.u_units_to_pixels)}),lineGradient:(m,t)=>({u_translation:new d.c3(m,t.u_translation),u_ratio:new d.bq(m,t.u_ratio),u_device_pixel_ratio:new d.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new d.c3(m,t.u_units_to_pixels),u_image:new d.b_(m,t.u_image),u_image_height:new d.bq(m,t.u_image_height)}),linePattern:(m,t)=>({u_translation:new d.c3(m,t.u_translation),u_texsize:new d.c3(m,t.u_texsize),u_ratio:new d.bq(m,t.u_ratio),u_device_pixel_ratio:new d.bq(m,t.u_device_pixel_ratio),u_image:new d.b_(m,t.u_image),u_units_to_pixels:new d.c3(m,t.u_units_to_pixels),u_scale:new d.c2(m,t.u_scale),u_fade:new d.bq(m,t.u_fade)}),lineSDF:(m,t)=>({u_translation:new d.c3(m,t.u_translation),u_ratio:new d.bq(m,t.u_ratio),u_device_pixel_ratio:new d.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new d.c3(m,t.u_units_to_pixels),u_image:new d.b_(m,t.u_image),u_mix:new d.bq(m,t.u_mix),u_tileratio:new d.bq(m,t.u_tileratio),u_crossfade_from:new d.bq(m,t.u_crossfade_from),u_crossfade_to:new d.bq(m,t.u_crossfade_to),u_lineatlas_width:new d.bq(m,t.u_lineatlas_width),u_lineatlas_height:new d.bq(m,t.u_lineatlas_height)}),lineGradientSDF:(m,t)=>({u_translation:new d.c3(m,t.u_translation),u_ratio:new d.bq(m,t.u_ratio),u_device_pixel_ratio:new d.bq(m,t.u_device_pixel_ratio),u_units_to_pixels:new d.c3(m,t.u_units_to_pixels),u_image:new d.b_(m,t.u_image),u_image_height:new d.bq(m,t.u_image_height),u_tileratio:new d.bq(m,t.u_tileratio),u_crossfade_from:new d.bq(m,t.u_crossfade_from),u_crossfade_to:new d.bq(m,t.u_crossfade_to),u_image_dash:new d.b_(m,t.u_image_dash),u_mix:new d.bq(m,t.u_mix),u_lineatlas_width:new d.bq(m,t.u_lineatlas_width),u_lineatlas_height:new d.bq(m,t.u_lineatlas_height)}),raster:(m,t)=>({u_tl_parent:new d.c3(m,t.u_tl_parent),u_scale_parent:new d.bq(m,t.u_scale_parent),u_buffer_scale:new d.bq(m,t.u_buffer_scale),u_fade_t:new d.bq(m,t.u_fade_t),u_opacity:new d.bq(m,t.u_opacity),u_image0:new d.b_(m,t.u_image0),u_image1:new d.b_(m,t.u_image1),u_brightness_low:new d.bq(m,t.u_brightness_low),u_brightness_high:new d.bq(m,t.u_brightness_high),u_saturation_factor:new d.bq(m,t.u_saturation_factor),u_contrast_factor:new d.bq(m,t.u_contrast_factor),u_spin_weights:new d.c2(m,t.u_spin_weights),u_coords_top:new d.c1(m,t.u_coords_top),u_coords_bottom:new d.c1(m,t.u_coords_bottom)}),symbolIcon:(m,t)=>({u_is_size_zoom_constant:new d.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.b_(m,t.u_is_size_feature_constant),u_size_t:new d.bq(m,t.u_size_t),u_size:new d.bq(m,t.u_size),u_camera_to_center_distance:new d.bq(m,t.u_camera_to_center_distance),u_pitch:new d.bq(m,t.u_pitch),u_rotate_symbol:new d.b_(m,t.u_rotate_symbol),u_aspect_ratio:new d.bq(m,t.u_aspect_ratio),u_fade_change:new d.bq(m,t.u_fade_change),u_label_plane_matrix:new d.c0(m,t.u_label_plane_matrix),u_coord_matrix:new d.c0(m,t.u_coord_matrix),u_is_text:new d.b_(m,t.u_is_text),u_pitch_with_map:new d.b_(m,t.u_pitch_with_map),u_is_along_line:new d.b_(m,t.u_is_along_line),u_is_variable_anchor:new d.b_(m,t.u_is_variable_anchor),u_texsize:new d.c3(m,t.u_texsize),u_texture:new d.b_(m,t.u_texture),u_translation:new d.c3(m,t.u_translation),u_pitched_scale:new d.bq(m,t.u_pitched_scale)}),symbolSDF:(m,t)=>({u_is_size_zoom_constant:new d.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.b_(m,t.u_is_size_feature_constant),u_size_t:new d.bq(m,t.u_size_t),u_size:new d.bq(m,t.u_size),u_camera_to_center_distance:new d.bq(m,t.u_camera_to_center_distance),u_pitch:new d.bq(m,t.u_pitch),u_rotate_symbol:new d.b_(m,t.u_rotate_symbol),u_aspect_ratio:new d.bq(m,t.u_aspect_ratio),u_fade_change:new d.bq(m,t.u_fade_change),u_label_plane_matrix:new d.c0(m,t.u_label_plane_matrix),u_coord_matrix:new d.c0(m,t.u_coord_matrix),u_is_text:new d.b_(m,t.u_is_text),u_pitch_with_map:new d.b_(m,t.u_pitch_with_map),u_is_along_line:new d.b_(m,t.u_is_along_line),u_is_variable_anchor:new d.b_(m,t.u_is_variable_anchor),u_texsize:new d.c3(m,t.u_texsize),u_texture:new d.b_(m,t.u_texture),u_gamma_scale:new d.bq(m,t.u_gamma_scale),u_device_pixel_ratio:new d.bq(m,t.u_device_pixel_ratio),u_is_halo:new d.b_(m,t.u_is_halo),u_translation:new d.c3(m,t.u_translation),u_pitched_scale:new d.bq(m,t.u_pitched_scale)}),symbolTextAndIcon:(m,t)=>({u_is_size_zoom_constant:new d.b_(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.b_(m,t.u_is_size_feature_constant),u_size_t:new d.bq(m,t.u_size_t),u_size:new d.bq(m,t.u_size),u_camera_to_center_distance:new d.bq(m,t.u_camera_to_center_distance),u_pitch:new d.bq(m,t.u_pitch),u_rotate_symbol:new d.b_(m,t.u_rotate_symbol),u_aspect_ratio:new d.bq(m,t.u_aspect_ratio),u_fade_change:new d.bq(m,t.u_fade_change),u_label_plane_matrix:new d.c0(m,t.u_label_plane_matrix),u_coord_matrix:new d.c0(m,t.u_coord_matrix),u_is_text:new d.b_(m,t.u_is_text),u_pitch_with_map:new d.b_(m,t.u_pitch_with_map),u_is_along_line:new d.b_(m,t.u_is_along_line),u_is_variable_anchor:new d.b_(m,t.u_is_variable_anchor),u_texsize:new d.c3(m,t.u_texsize),u_texsize_icon:new d.c3(m,t.u_texsize_icon),u_texture:new d.b_(m,t.u_texture),u_texture_icon:new d.b_(m,t.u_texture_icon),u_gamma_scale:new d.bq(m,t.u_gamma_scale),u_device_pixel_ratio:new d.bq(m,t.u_device_pixel_ratio),u_is_halo:new d.b_(m,t.u_is_halo),u_translation:new d.c3(m,t.u_translation),u_pitched_scale:new d.bq(m,t.u_pitched_scale)}),background:(m,t)=>({u_opacity:new d.bq(m,t.u_opacity),u_color:new d.b$(m,t.u_color)}),backgroundPattern:(m,t)=>({u_opacity:new d.bq(m,t.u_opacity),u_image:new d.b_(m,t.u_image),u_pattern_tl_a:new d.c3(m,t.u_pattern_tl_a),u_pattern_br_a:new d.c3(m,t.u_pattern_br_a),u_pattern_tl_b:new d.c3(m,t.u_pattern_tl_b),u_pattern_br_b:new d.c3(m,t.u_pattern_br_b),u_texsize:new d.c3(m,t.u_texsize),u_mix:new d.bq(m,t.u_mix),u_pattern_size_a:new d.c3(m,t.u_pattern_size_a),u_pattern_size_b:new d.c3(m,t.u_pattern_size_b),u_scale_a:new d.bq(m,t.u_scale_a),u_scale_b:new d.bq(m,t.u_scale_b),u_pixel_coord_upper:new d.c3(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.c3(m,t.u_pixel_coord_lower),u_tile_units_to_pixels:new d.bq(m,t.u_tile_units_to_pixels)}),terrain:(m,t)=>({u_texture:new d.b_(m,t.u_texture),u_ele_delta:new d.bq(m,t.u_ele_delta),u_fog_matrix:new d.c0(m,t.u_fog_matrix),u_fog_color:new d.b$(m,t.u_fog_color),u_fog_ground_blend:new d.bq(m,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.bq(m,t.u_fog_ground_blend_opacity),u_horizon_color:new d.b$(m,t.u_horizon_color),u_horizon_fog_blend:new d.bq(m,t.u_horizon_fog_blend),u_is_globe_mode:new d.bq(m,t.u_is_globe_mode)}),terrainDepth:(m,t)=>({u_ele_delta:new d.bq(m,t.u_ele_delta)}),terrainCoords:(m,t)=>({u_texture:new d.b_(m,t.u_texture),u_terrain_coords_id:new d.bq(m,t.u_terrain_coords_id),u_ele_delta:new d.bq(m,t.u_ele_delta)}),projectionErrorMeasurement:(m,t)=>({u_input:new d.bq(m,t.u_input),u_output_expected:new d.bq(m,t.u_output_expected)}),atmosphere:(m,t)=>({u_sun_pos:new d.c2(m,t.u_sun_pos),u_atmosphere_blend:new d.bq(m,t.u_atmosphere_blend),u_globe_position:new d.c2(m,t.u_globe_position),u_globe_radius:new d.bq(m,t.u_globe_radius),u_inv_proj_matrix:new d.c0(m,t.u_inv_proj_matrix)}),sky:(m,t)=>({u_sky_color:new d.b$(m,t.u_sky_color),u_horizon_color:new d.b$(m,t.u_horizon_color),u_horizon:new d.c3(m,t.u_horizon),u_horizon_normal:new d.c3(m,t.u_horizon_normal),u_sky_horizon_blend:new d.bq(m,t.u_sky_horizon_blend),u_sky_blend:new d.bq(m,t.u_sky_blend)})};class jo{constructor(t,r,l){this.context=t;const h=t.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Uo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class yh{constructor(t,r,l,h){this.length=r.length,this.attributes=l,this.itemSize=r.bytesPerElement,this.dynamicDraw=h,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let l=0;l<this.attributes.length;l++){const h=r.attributes[this.attributes[l].name];h!==void 0&&t.enableVertexAttribArray(h)}}setVertexAttribPointers(t,r,l){for(let h=0;h<this.attributes.length;h++){const _=this.attributes[h],v=r.attributes[_.name];v!==void 0&&t.vertexAttribPointer(v,_.components,t[Uo[_.type]],!1,this.itemSize,_.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class _i{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ls extends _i{getDefault(){return d.bp.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Du extends _i{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Pu extends _i{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class wc extends _i{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Go extends _i{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Iu extends _i{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Bl extends _i{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class tr extends _i{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class vh extends _i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class Tc extends _i{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ir extends _i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class us extends _i{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Pa extends _i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class Is extends _i{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class qo extends _i{getDefault(){return d.bp.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Zo extends _i{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Ru extends _i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class co extends _i{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class xr extends _i{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class xh extends _i{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Ol extends _i{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Gt extends _i{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Sc extends _i{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class nr extends _i{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Mc extends _i{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ar extends _i{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ff extends _i{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ec extends _i{getDefault(){return null}set(t){var r;if(t===this.current&&!this.dirty)return;const l=this.gl;_r(l)?l.bindVertexArray(t):(r=l.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class ho extends _i{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class bh extends _i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ac extends _i{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class fo extends _i{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class kl extends fo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ia extends fo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class po extends fo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const mo="Framebuffer is not complete";class Ho{constructor(t,r,l,h,_){this.context=t,this.width=r,this.height=l;const v=t.gl,b=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new kl(t,b),h)this.depthAttachment=_?new po(t,b):new Ia(t,b);else if(_)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error(mo)}destroy(){const t=this.context.gl,r=this.colorAttachment.get();if(r&&t.deleteTexture(r),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class go{constructor(t){var r,l;if(this.gl=t,this.clearColor=new ls(this),this.clearDepth=new Du(this),this.clearStencil=new Pu(this),this.colorMask=new wc(this),this.depthMask=new Go(this),this.stencilMask=new Iu(this),this.stencilFunc=new Bl(this),this.stencilOp=new tr(this),this.stencilTest=new vh(this),this.depthRange=new Tc(this),this.depthTest=new ir(this),this.depthFunc=new us(this),this.blend=new Pa(this),this.blendFunc=new Is(this),this.blendColor=new qo(this),this.blendEquation=new Zo(this),this.cullFace=new Ru(this),this.cullFaceSide=new co(this),this.frontFace=new xr(this),this.program=new xh(this),this.activeTexture=new Ol(this),this.viewport=new Gt(this),this.bindFramebuffer=new Sc(this),this.bindRenderbuffer=new nr(this),this.bindTexture=new Mc(this),this.bindVertexBuffer=new ar(this),this.bindElementBuffer=new Ff(this),this.bindVertexArray=new Ec(this),this.pixelStoreUnpack=new ho(this),this.pixelStoreUnpackPremultiplyAlpha=new bh(this),this.pixelStoreUnpackFlipY=new Ac(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),_r(t)){this.HALF_FLOAT=t.HALF_FLOAT;const h=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=t.RGBA16F)!==null&&r!==void 0?r:h?.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:h?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const h=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=h?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r){return new jo(this,t,r)}createVertexBuffer(t,r,l){return new yh(this,t,r,l)}createRenderbuffer(t,r,l){const h=this.gl,_=h.createRenderbuffer();return this.bindRenderbuffer.set(_),h.renderbufferStorage(h.RENDERBUFFER,t,r,l),this.bindRenderbuffer.set(null),_}createFramebuffer(t,r,l,h){return new Ho(this,t,r,l,h)}clear({color:t,depth:r,stencil:l}){const h=this.gl;let _=0;t&&(_|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(_|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),l!==void 0&&(_|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){d.bR(t.blendFunction,Ei.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return _r(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var r;return _r(this.gl)?this.gl.deleteVertexArray(t):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Hn;function Wn(m,t,r,l,h){const _=m.context,v=m.transform,b=_.gl,S=m.useProgram("collisionBox"),A=[];let z=0,R=0;for(let Y=0;Y<l.length;Y++){const J=l[Y],re=t.getTile(J).getBucket(r);if(!re)continue;const K=h?re.textCollisionBox:re.iconCollisionBox,ae=re.collisionCircleArray;ae.length>0&&(A.push({circleArray:ae,circleOffset:R,coord:J}),z+=ae.length/4,R=z),K&&S.draw(_,b.LINES,Ut.disabled,ci.disabled,m.colorModeForRenderPass(),Kt.disabled,oo(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(J),v.getProjectionData({overscaledTileID:J,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,null,m.transform.zoom,null,null,K.collisionVertexBuffer)}if(!h||!A.length)return;const I=m.useProgram("collisionCircle"),F=new d.ca;F.resize(4*z),F._trim();let U=0;for(const Y of A)for(let J=0;J<Y.circleArray.length/4;J++){const re=4*J,K=Y.circleArray[re+0],ae=Y.circleArray[re+1],le=Y.circleArray[re+2],ie=Y.circleArray[re+3];F.emplace(U++,K,ae,le,ie,0),F.emplace(U++,K,ae,le,ie,1),F.emplace(U++,K,ae,le,ie,2),F.emplace(U++,K,ae,le,ie,3)}(!Hn||Hn.length<2*z)&&(Hn=(function(Y){const J=2*Y,re=new d.cc;re.resize(J),re._trim();for(let K=0;K<J;K++){const ae=6*K;re.uint16[ae+0]=4*K+0,re.uint16[ae+1]=4*K+1,re.uint16[ae+2]=4*K+2,re.uint16[ae+3]=4*K+2,re.uint16[ae+4]=4*K+3,re.uint16[ae+5]=4*K+0}return re})(z));const $=_.createIndexBuffer(Hn,!0),Q=_.createVertexBuffer(F,d.cb.members,!0);for(const Y of A){const J=mh(m.transform);I.draw(_,b.TRIANGLES,Ut.disabled,ci.disabled,m.colorModeForRenderPass(),Kt.disabled,J,m.style.map.terrain&&m.style.map.terrain.getTerrainData(Y.coord),null,r.id,Q,$,d.aX.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,m.transform.zoom,null,null,null)}Q.destroy(),$.destroy()}const cs=d.ar(new Float32Array(16));function hs(m,t,r,l,h,_){const{horizontalAlign:v,verticalAlign:b}=d.aS(m);return new d.P((-(v-.5)*t/h+l[0])*_,(-(b-.5)*r/h+l[1])*_)}function ka(m,t,r,l,h,_){const v=t.tileAnchorPoint.add(new d.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let b=l.mult(_);r||(b=b.rotate(-h));const S=v.add(b);return Vt(S.x,S.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(r){const b=ui(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(m),S=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return m.add(l.rotate(S))}return m.add(l)}function Rs(m,t,r,l,h,_,v,b,S,A,z,R){const I=m.text.placedSymbolArray,F=m.text.dynamicLayoutVertexArray,U=m.icon.dynamicLayoutVertexArray,$={};F.clear();for(let Q=0;Q<I.length;Q++){const Y=I.get(Q),J=Y.hidden||!Y.crossTileID||m.allowVerticalPlacement&&!Y.placedOrientation?null:l[Y.crossTileID];if(J){const re=new d.P(Y.anchorX,Y.anchorY),K={getElevation:R,width:h.width,height:h.height,pitchedLabelPlaneMatrix:_,pitchWithMap:r,transform:h,tileAnchorPoint:re,translation:A,unwrappedTileID:z},ae=r?Tl(re.x,re.y,K):ui(re.x,re.y,K),le=Po(h.cameraToCenterDistance,ae.signedDistanceFromCamera);let ie=d.aA(m.textSizeData,b,Y)*le/d.aM;r&&(ie*=m.tilePixelRatio/v);const{width:pe,height:ze,anchor:Te,textOffset:Ae,textBoxScale:Ce}=J,We=hs(Te,pe,ze,Ae,Ce,ie),Ke=h.getPitchedTextCorrection(re.x+A[0],re.y+A[1],z),Ge=ka(ae.point,K,t,We,-h.bearingInRadians,Ke),at=m.allowVerticalPlacement&&Y.placedOrientation===d.az.vertical?Math.PI/2:0;for(let kt=0;kt<Y.numGlyphs;kt++)d.aG(F,Ge,at);S&&Y.associatedIconIndex>=0&&($[Y.associatedIconIndex]={shiftedAnchor:Ge,angle:at})}else rs(Y.numGlyphs,F)}if(S){U.clear();const Q=m.icon.placedSymbolArray;for(let Y=0;Y<Q.length;Y++){const J=Q.get(Y);if(J.hidden)rs(J.numGlyphs,U);else{const re=$[Y];if(re)for(let K=0;K<J.numGlyphs;K++)d.aG(U,re.shiftedAnchor,re.angle);else rs(J.numGlyphs,U)}}m.icon.dynamicLayoutVertexBuffer.updateData(U)}m.text.dynamicLayoutVertexBuffer.updateData(F)}function wh(m,t,r){return r.iconsInText&&t?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Xo(m,t,r,l,h,_,v,b,S,A,z,R,I){const F=m.context,U=F.gl,$=m.transform,Q=b==="map",Y=S==="map",J=b!=="viewport"&&r.layout.get("symbol-placement")!=="point",re=Q&&!Y&&!J,K=!r.layout.get("symbol-sort-key").isConstant();let ae=!1;const le=m.getDepthModeForSublayer(0,Ut.ReadOnly),ie=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),pe=[],ze=$.getCircleRadiusCorrection();for(const Te of l){const Ae=t.getTile(Te),Ce=Ae.getBucket(r);if(!Ce)continue;const We=h?Ce.text:Ce.icon;if(!We||!We.segments.get().length||!We.hasVisibleVertices)continue;const Ke=We.programConfigurations.get(r.id),Ge=h||Ce.sdfIcons,at=h?Ce.textSizeData:Ce.iconSizeData,kt=Y||$.pitch!==0,bi=m.useProgram(wh(Ge,h,Ce),Ke),Ui=d.ay(at,$.zoom),Oi=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Te);let Qi,Ai,cn,Wi,Jn=[0,0],gn=null;if(h)Ai=Ae.glyphAtlasTexture,cn=U.LINEAR,Qi=Ae.glyphAtlasTexture.size,Ce.iconsInText&&(Jn=Ae.imageAtlasTexture.size,gn=Ae.imageAtlasTexture,Wi=kt||m.options.rotating||m.options.zooming||at.kind==="composite"||at.kind==="camera"?U.LINEAR:U.NEAREST);else{const Si=r.layout.get("icon-size").constantOr(0)!==1||Ce.iconsNeedLinear;Ai=Ae.imageAtlasTexture,cn=Ge||m.options.rotating||m.options.zooming||Si||kt?U.LINEAR:U.NEAREST,Qi=Ae.imageAtlasTexture.size}const _n=d.aN(Ae,1,m.transform.zoom),ea=Ka(Q,m.transform,_n),Ss=d.N();d.aB(Ss,ea);const Ms=cc(Y,Q,m.transform,_n),Hr=d.aO($,Ae,_,v),ja=$.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),il=ie&&Ce.hasTextData(),Xl=r.layout.get("icon-text-fit")!=="none"&&il&&Ce.hasIconData();if(J){const Si=m.style.map.terrain?(In,Fn)=>m.style.map.terrain.getElevation(Te,In,Fn):null,ki=r.layout.get("text-rotation-alignment")==="map";zs(Ce,m,h,ea,Ss,Y,A,ki,Te.toUnwrapped(),$.width,$.height,Hr,Si)}const Xr=h&&ie||Xl,Ua=J||Xr?cs:Y?ea:m.transform.clipSpaceToPixelsMatrix,ur=Ge&&r.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Er;Er=Ge?Ce.iconsInText?vr(at.kind,Ui,re,Y,J,Xr,m,Ua,Ms,Hr,Qi,Jn,ze):xc(at.kind,Ui,re,Y,J,Xr,m,Ua,Ms,Hr,h,Qi,0,ze):Au(at.kind,Ui,re,Y,J,Xr,m,Ua,Ms,Hr,h,Qi,ze);const Ar={program:bi,buffers:We,uniformValues:Er,projectionData:ja,atlasTexture:Ai,atlasTextureIcon:gn,atlasInterpolation:cn,atlasInterpolationIcon:Wi,isSDF:Ge,hasHalo:ur};if(K&&Ce.canOverlap){ae=!0;const Si=We.segments.get();for(const ki of Si)pe.push({segments:new d.aX([ki]),sortKey:ki.sortKey,state:Ar,terrainData:Oi})}else pe.push({segments:We.segments,sortKey:0,state:Ar,terrainData:Oi})}ae&&pe.sort(((Te,Ae)=>Te.sortKey-Ae.sortKey));for(const Te of pe){const Ae=Te.state;if(F.activeTexture.set(U.TEXTURE0),Ae.atlasTexture.bind(Ae.atlasInterpolation,U.CLAMP_TO_EDGE),Ae.atlasTextureIcon&&(F.activeTexture.set(U.TEXTURE1),Ae.atlasTextureIcon&&Ae.atlasTextureIcon.bind(Ae.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),Ae.isSDF){const Ce=Ae.uniformValues;Ae.hasHalo&&(Ce.u_is_halo=1,Fl(Ae.buffers,Te.segments,r,m,Ae.program,le,z,R,Ce,Ae.projectionData,Te.terrainData)),Ce.u_is_halo=0}Fl(Ae.buffers,Te.segments,r,m,Ae.program,le,z,R,Ae.uniformValues,Ae.projectionData,Te.terrainData)}}function Fl(m,t,r,l,h,_,v,b,S,A,z){const R=l.context;h.draw(R,R.gl.TRIANGLES,_,v,b,Kt.backCCW,S,z,A,r.id,m.layoutVertexBuffer,m.indexBuffer,t,r.paint,l.transform.zoom,m.programConfigurations.get(r.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Th(m,t,r,l,h){const _=m.context,v=_.gl,b=ci.disabled,S=new Ei([v.ONE,v.ONE],d.bp.transparent,[!0,!0,!0,!0]),A=t.getBucket(r);if(!A)return;const z=l.key;let R=r.heatmapFbos.get(z);R||(R=Bi(_,t.tileSize,t.tileSize),r.heatmapFbos.set(z,R)),_.bindFramebuffer.set(R.framebuffer),_.viewport.set([0,0,t.tileSize,t.tileSize]),_.clear({color:d.bp.transparent});const I=A.programConfigurations.get(r.id),F=m.useProgram("heatmap",I,!h),U=m.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),$=m.style.map.terrain.getTerrainData(l);F.draw(_,v.TRIANGLES,Ut.disabled,b,S,Kt.disabled,lo(t,m.transform.zoom,r.paint.get("heatmap-intensity"),1),$,U,r.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,r.paint,m.transform.zoom,I)}function Kn(m,t,r,l,h){const _=m.context,v=_.gl,b=m.transform;_.setColorMode(m.colorModeForRenderPass());const S=si(_,t),A=r.key,z=t.heatmapFbos.get(A);if(!z)return;_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,z.colorAttachment.get()),_.activeTexture.set(v.TEXTURE1),S.bind(v.LINEAR,v.CLAMP_TO_EDGE);const R=b.getProjectionData({overscaledTileID:r,applyTerrainMatrix:h,applyGlobeMatrix:!l});m.useProgram("heatmapTexture").draw(_,v.TRIANGLES,Ut.disabled,ci.disabled,m.colorModeForRenderPass(),Kt.disabled,gh(m,t,0,1),null,R,t.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,t.paint,b.zoom),z.destroy(),t.heatmapFbos.delete(A)}function Bi(m,t,r){var l,h;const _=m.gl,v=_.createTexture();_.bindTexture(_.TEXTURE_2D,v),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR);const b=(l=m.HALF_FLOAT)!==null&&l!==void 0?l:_.UNSIGNED_BYTE,S=(h=m.RGBA16F)!==null&&h!==void 0?h:_.RGBA;_.texImage2D(_.TEXTURE_2D,0,S,t,r,0,_.RGBA,b,null);const A=m.createFramebuffer(t,r,!1,!1);return A.colorAttachment.set(v),A}function si(m,t){return t.colorRampTexture||(t.colorRampTexture=new d.T(m,t.colorRamp,m.gl.RGBA)),t.colorRampTexture}function Ls(m,t,r,l,h,_,v,b){let S=256;if(h.stepInterpolant){const A=t.getSource().maxzoom,z=v.canonical.z===A?Math.ceil(1<<m.transform.maxZoom-v.canonical.z):1;S=d.an(d.ce(_.maxLineLength/d.a5*1024*z),256,r.maxTextureSize)}return b.gradient=d.cf({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:S,image:b.gradient||void 0,clips:_.lineClipsArray}),b.texture?b.texture.update(b.gradient):b.texture=new d.T(r,b.gradient,l.RGBA),b.version=h.gradientVersion,b.texture}function rr(m,t,r,l,h){m.activeTexture.set(t.TEXTURE0),r.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),l.updatePaintBuffers(h)}function ln(m,t,r,l,h,_){(h||m.lineAtlas.dirty)&&(t.activeTexture.set(r.TEXTURE0),m.lineAtlas.bind(t)),l.updatePaintBuffers(_)}function Fa(m,t,r,l,h,_,v){const b=_.gradients[h.id];let S=b.texture;h.gradientVersion!==b.version&&(S=Ls(m,t,r,l,h,_,v,b)),r.activeTexture.set(l.TEXTURE0),S.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE)}function Na(m,t,r,l,h,_,v,b,S){const A=_.gradients[h.id];let z=A.texture;h.gradientVersion!==A.version&&(z=Ls(m,t,r,l,h,_,v,A)),r.activeTexture.set(l.TEXTURE0),z.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE),r.activeTexture.set(l.TEXTURE1),m.lineAtlas.bind(r),b.updatePaintBuffers(S)}function Lu(m,t,r,l,h){if(!r||!l||!l.imageAtlas)return;const _=l.imageAtlas.patternPositions;let v=_[r.to.toString()],b=_[r.from.toString()];if(!v&&b&&(v=b),!b&&v&&(b=v),!v||!b){const S=h.getPaintProperty(t);v=_[S],b=_[S]}v&&b&&m.setConstantPatternPositions(v,b)}function fs(m,t,r,l,h,_,v,b){const S=m.context.gl,A="fill-pattern",z=r.paint.get(A),R=z&&z.constantOr(1),I=r.getCrossfadeParameters();let F,U,$,Q,Y;const J=m.transform,re=r.paint.get("fill-translate"),K=r.paint.get("fill-translate-anchor");v?(U=R&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=S.LINES):(U=R?"fillPattern":"fill",F=S.TRIANGLES);const ae=z.constantOr(null);for(const le of l){const ie=t.getTile(le);if(R&&!ie.patternsLoaded())continue;const pe=ie.getBucket(r);if(!pe)continue;const ze=pe.programConfigurations.get(r.id),Te=m.useProgram(U,ze),Ae=m.style.map.terrain&&m.style.map.terrain.getTerrainData(le);R&&(m.context.activeTexture.set(S.TEXTURE0),ie.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ze.updatePaintBuffers(I)),Lu(ze,A,ae,ie,r);const Ce=J.getProjectionData({overscaledTileID:le,applyGlobeMatrix:!b,applyTerrainMatrix:!0}),We=d.aO(J,ie,re,K);if(v){Q=pe.indexBuffer2,Y=pe.segments2;const Ge=[S.drawingBufferWidth,S.drawingBufferHeight];$=U==="fillOutlinePattern"&&R?Rf(m,I,ie,Ge,We):Ll(Ge,We)}else Q=pe.indexBuffer,Y=pe.segments,$=R?Vo(m,I,ie,We):{u_fill_translate:We};const Ke=m.stencilModeForClipping(le);Te.draw(m.context,F,h,Ke,_,Kt.backCCW,$,Ae,Ce,r.id,pe.layoutVertexBuffer,Q,Y,r.paint,m.transform.zoom,ze)}}function ds(m,t,r,l,h,_,v,b){const S=m.context,A=S.gl,z="fill-extrusion-pattern",R=r.paint.get(z),I=R.constantOr(1),F=r.getCrossfadeParameters(),U=r.paint.get("fill-extrusion-opacity"),$=R.constantOr(null),Q=m.transform;for(const Y of l){const J=t.getTile(Y),re=J.getBucket(r);if(!re)continue;const K=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Y),ae=re.programConfigurations.get(r.id),le=m.useProgram(I?"fillExtrusionPattern":"fillExtrusion",ae);I&&(m.context.activeTexture.set(A.TEXTURE0),J.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ae.updatePaintBuffers(F));const ie=Q.getProjectionData({overscaledTileID:Y,applyGlobeMatrix:!b,applyTerrainMatrix:!0});Lu(ae,z,$,J,r);const pe=d.aO(Q,J,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),ze=r.paint.get("fill-extrusion-vertical-gradient"),Te=I?_c(m,ze,U,pe,Y,F,J):gc(m,ze,U,pe);le.draw(S,S.gl.TRIANGLES,h,_,v,Kt.backCCW,Te,K,ie,r.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,r.paint,m.transform.zoom,ae,m.style.map.terrain&&re.centroidVertexBuffer)}}function ps(m,t,r,l,h,_,v,b,S){var A;const z=m.style.projection,R=m.context,I=m.transform,F=R.gl,U=[`#define NUM_ILLUMINATION_SOURCES ${r.paint.get("hillshade-highlight-color").values.length}`],$=m.useProgram("hillshade",null,!1,U),Q=!m.options.moving;for(const Y of l){const J=t.getTile(Y),re=J.fbo;if(!re)continue;const K=z.getMeshFromTileID(R,Y.canonical,b,!0,"raster"),ae=(A=m.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(Y);R.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,re.colorAttachment.get());const le=I.getProjectionData({overscaledTileID:Y,aligned:Q,applyGlobeMatrix:!S,applyTerrainMatrix:!0});$.draw(R,F.TRIANGLES,_,h[Y.overscaledZ],v,Kt.backCCW,Su(m,J,r),ae,le,r.id,K.vertexBuffer,K.indexBuffer,K.segments)}}function Bs(m,t,r,l,h,_,v,b,S){var A;const z=m.style.projection,R=m.context,I=m.transform,F=R.gl,U=m.useProgram("colorRelief"),$=!m.options.moving;let Q=!0,Y=0;for(const J of l){const re=t.getTile(J),K=re.dem;if(Q){const Te=F.getParameter(F.MAX_TEXTURE_SIZE),{elevationTexture:Ae,colorTexture:Ce}=r.getColorRampTextures(R,Te,K.getUnpackVector());R.activeTexture.set(F.TEXTURE1),Ae.bind(F.NEAREST,F.CLAMP_TO_EDGE),R.activeTexture.set(F.TEXTURE4),Ce.bind(F.LINEAR,F.CLAMP_TO_EDGE),Q=!1,Y=Ae.size[0]}if(!K||!K.data)continue;const ae=K.stride,le=K.getPixels();if(R.activeTexture.set(F.TEXTURE0),R.pixelStoreUnpackPremultiplyAlpha.set(!1),re.demTexture=re.demTexture||m.getTileTexture(ae),re.demTexture){const Te=re.demTexture;Te.update(le,{premultiply:!1}),Te.bind(F.LINEAR,F.CLAMP_TO_EDGE)}else re.demTexture=new d.T(R,le,F.RGBA,{premultiply:!1}),re.demTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const ie=z.getMeshFromTileID(R,J.canonical,b,!0,"raster"),pe=(A=m.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(J),ze=I.getProjectionData({overscaledTileID:J,aligned:$,applyGlobeMatrix:!S,applyTerrainMatrix:!0});U.draw(R,F.TRIANGLES,_,h[J.overscaledZ],v,Kt.backCCW,Bf(r,re.dem,Y),pe,ze,r.id,ie.vertexBuffer,ie.indexBuffer,ie.segments)}}const Os=[new d.P(0,0),new d.P(d.a5,0),new d.P(d.a5,d.a5),new d.P(0,d.a5)];function br(m,t,r,l,h,_,v,b,S=!1,A=!1){const z=l[l.length-1].overscaledZ,R=m.context,I=R.gl,F=m.useProgram("raster"),U=m.transform,$=m.style.projection,Q=m.colorModeForRenderPass(),Y=!m.options.moving,J=r.paint.get("raster-opacity"),re=r.paint.get("raster-resampling"),K=r.paint.get("raster-fade-duration"),ae=!!m.style.map.terrain;for(const le of l){const ie=m.getDepthModeForSublayer(le.overscaledZ-z,J===1?Ut.ReadWrite:Ut.ReadOnly,I.LESS),pe=t.getTile(le),ze=re==="nearest"?I.NEAREST:I.LINEAR;R.activeTexture.set(I.TEXTURE0),pe.texture.bind(ze,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),R.activeTexture.set(I.TEXTURE1);const{parentTile:Te,parentScaleBy:Ae,parentTopLeft:Ce,fadeValues:We}=ms(pe,t,K,ae);pe.fadeOpacity=We.tileOpacity,Te?(Te.fadeOpacity=We.parentTileOpacity,Te.texture.bind(ze,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST)):pe.texture.bind(ze,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),pe.texture.useMipmap&&R.extTextureFilterAnisotropic&&m.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const Ke=m.style.map.terrain&&m.style.map.terrain.getTerrainData(le),Ge=U.getProjectionData({overscaledTileID:le,aligned:Y,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),at=yc(Ce,Ae,We.fadeMix,r,b),kt=$.getMeshFromTileID(R,le.canonical,_,v,"raster");F.draw(R,I.TRIANGLES,ie,h?h[le.overscaledZ]:ci.disabled,Q,S?Kt.frontCCW:Kt.backCCW,at,Ke,Ge,r.id,kt.vertexBuffer,kt.indexBuffer,kt.segments)}}function ms(m,t,r,l){const h={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(r===0||l)return h;if(m.fadingParentID){const _=t.getLoadedTile(m.fadingParentID);if(!_)return h;const v=Math.pow(2,_.tileID.overscaledZ-m.tileID.overscaledZ),b=[m.tileID.canonical.x*v%1,m.tileID.canonical.y*v%1],S=(function(A,z,R){const I=nt(),F=(I-z.timeAdded)/R,U=A.fadingDirection===he.Incoming,$=d.an((I-A.timeAdded)/R,0,1),Q=d.an(1-F,0,1),Y=U?$:Q;return{tileOpacity:Y,parentTileOpacity:U?Q:$,fadeMix:{opacity:1,mix:1-Y}}})(m,_,r);return{parentTile:_,parentScaleBy:v,parentTopLeft:b,fadeValues:S}}if(m.selfFading){const _=(function(v,b){const S=(nt()-v.timeAdded)/b,A=d.an(S,0,1);return{tileOpacity:A,fadeMix:{opacity:A,mix:0}}})(m,r);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:_}}return h}const ks=new d.bp(1,0,0,1),gs=new d.bp(0,1,0,1),Cc=new d.bp(0,0,1,1),zc=new d.bp(1,0,1,1),sr=new d.bp(0,1,1,1);function Nl(m,t,r,l){Pn(m,0,t+r/2,m.transform.width,r,l)}function Fs(m,t,r,l){Pn(m,t-r/2,0,r,m.transform.height,l)}function Pn(m,t,r,l,h,_){const v=m.context,b=v.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*m.pixelRatio,r*m.pixelRatio,l*m.pixelRatio,h*m.pixelRatio),v.clear({color:_}),b.disable(b.SCISSOR_TEST)}function Bu(m,t,r){const l=m.context,h=l.gl,_=m.useProgram("debug"),v=Ut.disabled,b=ci.disabled,S=m.colorModeForRenderPass(),A="$debug",z=m.style.map.terrain&&m.style.map.terrain.getTerrainData(r);l.activeTexture.set(h.TEXTURE0);const R=t.getTileByID(r.key).latestRawTileData,I=Math.floor((R&&R.byteLength||0)/1024),F=t.getTile(r).tileSize,U=512/Math.min(F,512)*(r.overscaledZ/m.transform.zoom)*.5;let $=r.canonical.toString();r.overscaledZ!==r.canonical.z&&($+=` => ${r.overscaledZ}`),(function(Y,J){Y.initDebugOverlayCanvas();const re=Y.debugOverlayCanvas,K=Y.context.gl,ae=Y.debugOverlayCanvas.getContext("2d");ae.clearRect(0,0,re.width,re.height),ae.shadowColor="white",ae.shadowBlur=2,ae.lineWidth=1.5,ae.strokeStyle="white",ae.textBaseline="top",ae.font="bold 36px Open Sans, sans-serif",ae.fillText(J,5,5),ae.strokeText(J,5,5),Y.debugOverlayTexture.update(re),Y.debugOverlayTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE)})(m,`${$} ${I}kB`);const Q=m.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(l,h.TRIANGLES,v,b,Ei.alphaBlended,Kt.disabled,Tu(d.bp.transparent,U),null,Q,A,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),_.draw(l,h.LINE_STRIP,v,b,S,Kt.disabled,Tu(d.bp.red),z,Q,A,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Dc(m,t,r,l){const{isRenderingGlobe:h}=l,_=m.context,v=_.gl,b=m.transform,S=m.colorModeForRenderPass(),A=m.getDepthModeFor3D(),z=m.useProgram("terrain");_.bindFramebuffer.set(null),_.viewport.set([0,0,m.width,m.height]);for(const R of r){const I=t.getTerrainMesh(R.tileID),F=m.renderToTexture.getTexture(R),U=t.getTerrainData(R.tileID);_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,F.texture);const $=t.getMeshFrameDelta(b.zoom),Q=b.calculateFogMatrix(R.tileID.toUnwrapped()),Y=Df($,Q,m.style.sky,b.pitch,h),J=b.getProjectionData({overscaledTileID:R.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});z.draw(_,v.TRIANGLES,A,ci.disabled,S,Kt.backCCW,Y,U,J,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}}function Sh(m,t){if(!t.mesh){const r=new d.aW;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const l=new d.aY;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),t.mesh=new Li(m.createVertexBuffer(r,gr.members),m.createIndexBuffer(l),d.aX.simpleSegment(0,0,r.length,l.length))}return t.mesh}class Nf{constructor(t,r){this.context=new go(t),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ji.maxOverzooming+ji.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new qn}resize(t,r,l){if(this.width=Math.floor(t*l),this.height=Math.floor(r*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const t=this.context,r=new d.aW;r.emplaceBack(0,0),r.emplaceBack(d.a5,0),r.emplaceBack(0,d.a5),r.emplaceBack(d.a5,d.a5),this.tileExtentBuffer=t.createVertexBuffer(r,gr.members),this.tileExtentSegments=d.aX.simpleSegment(0,0,4,2);const l=new d.aW;l.emplaceBack(0,0),l.emplaceBack(d.a5,0),l.emplaceBack(0,d.a5),l.emplaceBack(d.a5,d.a5),this.debugBuffer=t.createVertexBuffer(l,gr.members),this.debugSegments=d.aX.simpleSegment(0,0,4,5);const h=new d.ch;h.emplaceBack(0,0,0,0),h.emplaceBack(d.a5,0,d.a5,0),h.emplaceBack(0,d.a5,0,d.a5),h.emplaceBack(d.a5,d.a5,d.a5,d.a5),this.rasterBoundsBuffer=t.createVertexBuffer(h,zf.members),this.rasterBoundsSegments=d.aX.simpleSegment(0,0,4,2);const _=new d.aW;_.emplaceBack(0,0),_.emplaceBack(d.a5,0),_.emplaceBack(0,d.a5),_.emplaceBack(d.a5,d.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(_,gr.members),this.rasterBoundsSegmentsPosOnly=d.aX.simpleSegment(0,0,4,5);const v=new d.aW;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(v,gr.members),this.viewportSegments=d.aX.simpleSegment(0,0,4,2);const b=new d.ci;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(b);const S=new d.aY;S.emplaceBack(1,0,2),S.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S);const A=this.context.gl;this.stencilClearMode=new ci({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.tileExtentMesh=new Li(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,r=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=d.N();d.c7(l,0,this.width,this.height,0,0,1),d.Q(l,l,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const h={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(t,r.TRIANGLES,Ut.disabled,this.stencilClearMode,Ei.disabled,Kt.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,r,l){if(this.currentStencilSource===t.source||!t.isTileClipped()||!r||!r.length)return;this.currentStencilSource=t.source,this.nextStencilID+r.length>256&&this.clearStencil();const h=this.context;h.setColorMode(Ei.disabled),h.setDepthMode(Ut.disabled);const _={};for(const v of r)_[v.key]=this.nextStencilID++;this._renderTileMasks(_,r,l,!0),this._renderTileMasks(_,r,l,!1),this._tileClippingMaskIDs=_}_renderTileMasks(t,r,l,h){const _=this.context,v=_.gl,b=this.style.projection,S=this.transform,A=this.useProgram("clippingMask");for(const z of r){const R=t[z.key],I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),F=b.getMeshFromTileID(this.context,z.canonical,h,!0,"stencil"),U=S.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!l,applyTerrainMatrix:!0});A.draw(_,v.TRIANGLES,Ut.disabled,new ci({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),Ei.disabled,l?Kt.disabled:Kt.backCCW,null,I,U,"$clipping",F.vertexBuffer,F.indexBuffer,F.segments)}}_renderTilesDepthBuffer(){const t=this.context,r=t.gl,l=this.style.projection,h=this.transform,_=this.useProgram("depth"),v=this.getDepthModeFor3D(),b=Ji(h,{tileSize:h.tileSize});for(const S of b){const A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S),z=l.getMeshFromTileID(this.context,S.canonical,!0,!0,"raster"),R=h.getProjectionData({overscaledTileID:S,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(t,r.TRIANGLES,v,ci.disabled,Ei.disabled,Kt.backCCW,null,A,R,"$clipping",z.vertexBuffer,z.indexBuffer,z.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new ci({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){const r=this.context.gl;return new ci({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const r=this.context.gl,l=t.sort(((v,b)=>b.overscaledZ-v.overscaledZ)),h=l[l.length-1].overscaledZ,_=l[0].overscaledZ-h+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const v={};for(let b=0;b<_;b++)v[b+h]=new ci({func:r.GEQUAL,mask:255},b+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=_,[v,l]}return[{[h]:ci.disabled},l]}stencilConfigForOverlapTwoPass(t){const r=this.context.gl,l=t.sort(((v,b)=>b.overscaledZ-v.overscaledZ)),h=l[l.length-1].overscaledZ,_=l[0].overscaledZ-h+1;if(this.clearStencil(),_>1){const v={},b={};for(let S=0;S<_;S++)v[S+h]=new ci({func:r.GREATER,mask:255},_+1+S,255,r.KEEP,r.KEEP,r.REPLACE),b[S+h]=new ci({func:r.GREATER,mask:255},1+S,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*_+1,[v,b,l]}return this.nextStencilID=3,[{[h]:new ci({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[h]:new ci({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ei([t.CONSTANT_COLOR,t.ONE],new d.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ei.unblended:Ei.alphaBlended}getDepthModeForSublayer(t,r,l){if(!this.opaquePassEnabledForLayer())return Ut.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Ut(l||this.context.gl.LEQUAL,r,[h,h])}getDepthModeFor3D(){return new Ut(this.context.gl.LEQUAL,Ut.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,r){var l,h;this.style=t,this.options=r,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(nt()),this.imageManager.beginFrame();const _=this.style._order,v=this.style.tileManagers,b={},S={},A={},z={isRenderingToTexture:!1,isRenderingGlobe:((l=t.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const I in v){const F=v[I];F.used&&F.prepare(this.context),b[I]=F.getVisibleCoordinates(!1),S[I]=b[I].slice().reverse(),A[I]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<_.length;I++)if(this.style._layers[_[I]].is3D()){this.opaquePassCutoff=I;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const I of _){const F=this.style._layers[I];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const U=S[F.source];(F.type==="custom"||U.length)&&this.renderLayer(this,v[F.source],F,U,z)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:I=>this.useProgram(I)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?d.bp.black:d.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(I,F){const U=I.context,$=U.gl,Q=((le,ie,pe)=>{const ze=Math.cos(ie.rollInRadians),Te=Math.sin(ie.rollInRadians),Ae=li(ie),Ce=ie.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:le.properties.get("sky-color"),u_horizon_color:le.properties.get("horizon-color"),u_horizon:[(ie.width/2-Ae*Te)*pe,(ie.height/2+Ae*ze)*pe],u_horizon_normal:[-Te,ze],u_sky_horizon_blend:le.properties.get("sky-horizon-blend")*ie.height/2*pe,u_sky_blend:Ce}})(F,I.style.map.transform,I.pixelRatio),Y=new Ut($.LEQUAL,Ut.ReadWrite,[0,1]),J=ci.disabled,re=I.colorModeForRenderPass(),K=I.useProgram("sky"),ae=Sh(U,F);K.draw(U,$.TRIANGLES,Y,J,re,Kt.disabled,Q,null,void 0,"sky",ae.vertexBuffer,ae.indexBuffer,ae.segments)})(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[_[this.currentLayer]],F=v[I.source],U=b[I.source];this._renderTileClippingMasks(I,U,!1),this.renderLayer(this,F,I,U,z)}this.renderPass="translucent";let R=!1;for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const I=this.style._layers[_[this.currentLayer]],F=v[I.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(I,z))continue;this.opaquePassEnabledForLayer()||R||(R=!0,z.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const U=(I.type==="symbol"?A:S)[I.source];this._renderTileClippingMasks(I,b[I.source],!!this.renderToTexture),this.renderLayer(this,F,I,U,z)}if(z.isRenderingGlobe&&(function(I,F,U){const $=I.context,Q=$.gl,Y=I.useProgram("atmosphere"),J=new Ut(Q.LEQUAL,Ut.ReadOnly,[0,1]),re=I.transform,K=(function(Ce,We){const Ke=Ce.properties.get("position"),Ge=[-Ke.x,-Ke.y,-Ke.z],at=d.ar(new Float64Array(16));return Ce.properties.get("anchor")==="map"&&(d.bg(at,at,We.rollInRadians),d.bh(at,at,-We.pitchInRadians),d.bg(at,at,We.bearingInRadians),d.bh(at,at,We.center.lat*Math.PI/180),d.bJ(at,at,-We.center.lng*Math.PI/180)),d.cg(Ge,Ge,at),Ge})(U,I.transform),ae=re.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),le=F.properties.get("atmosphere-blend")*ae.projectionTransition;if(le===0)return;const ie=No(re.worldSize,re.center.lat),pe=re.inverseProjectionMatrix,ze=new Float64Array(4);ze[3]=1,d.aH(ze,ze,re.modelViewProjectionMatrix),ze[0]/=ze[3],ze[1]/=ze[3],ze[2]/=ze[3],ze[3]=1,d.aH(ze,ze,pe),ze[0]/=ze[3],ze[1]/=ze[3],ze[2]/=ze[3],ze[3]=1;const Te=((Ce,We,Ke,Ge,at)=>({u_sun_pos:Ce,u_atmosphere_blend:We,u_globe_position:Ke,u_globe_radius:Ge,u_inv_proj_matrix:at}))(K,le,[ze[0],ze[1],ze[2]],ie,pe),Ae=Sh($,F);Y.draw($,Q.TRIANGLES,J,ci.disabled,Ei.alphaBlended,Kt.disabled,Te,null,null,"atmosphere",Ae.vertexBuffer,Ae.indexBuffer,Ae.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const I=(function(F,U){let $=null;const Q=Object.values(F._layers).flatMap((K=>K.source&&!K.isHidden(U)?[F.tileManagers[K.source]]:[])),Y=Q.filter((K=>K.getSource().type==="vector")),J=Q.filter((K=>K.getSource().type!=="vector")),re=K=>{(!$||$.getSource().maxzoom<K.getSource().maxzoom)&&($=K)};return Y.forEach((K=>re(K))),$||J.forEach((K=>re(K))),$})(this.style,this.transform.zoom);I&&(function(F,U,$){for(let Q=0;Q<$.length;Q++)Bu(F,U,$[Q])})(this,I,I.getVisibleCoordinates())}this.options.showPadding&&(function(I){const F=I.transform.padding;Nl(I,I.transform.height-(F.top||0),3,ks),Nl(I,F.bottom||0,3,gs),Fs(I,F.left||0,3,Cc),Fs(I,I.transform.width-(F.right||0),3,zc);const U=I.transform.centerPoint;(function($,Q,Y,J){Pn($,Q-1,Y-10,2,20,J),Pn($,Q-10,Y-1,20,2,J)})(I,U.x,I.transform.height-U.y,sr)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=t?!d.cj(r,l):!d.ck(r,l)),h||(h=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(d.cl(r,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(_,v){const b=_.context,S=b.gl,A=_.transform,z=Ei.unblended,R=new Ut(S.LEQUAL,Ut.ReadWrite,[0,1]),I=v.tileManager.getRenderableTiles(),F=_.useProgram("terrainDepth");b.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),b.clear({color:d.bp.transparent,depth:1});for(const U of I){const $=v.getTerrainMesh(U.tileID),Q=v.getTerrainData(U.tileID),Y=A.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),J={u_ele_delta:v.getMeshFrameDelta(A.zoom)};F.draw(b,S.TRIANGLES,R,ci.disabled,z,Kt.backCCW,J,Q,Y,"terrain",$.vertexBuffer,$.indexBuffer,$.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain),(function(_,v){const b=_.context,S=b.gl,A=_.transform,z=Ei.unblended,R=new Ut(S.LEQUAL,Ut.ReadWrite,[0,1]),I=v.getCoordsTexture(),F=v.tileManager.getRenderableTiles(),U=_.useProgram("terrainCoords");b.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),b.clear({color:d.bp.transparent,depth:1}),v.coordsIndex=[];for(const $ of F){const Q=v.getTerrainMesh($.tileID),Y=v.getTerrainData($.tileID);b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,I.texture);const J={u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(A.zoom)},re=A.getProjectionData({overscaledTileID:$.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(b,S.TRIANGLES,R,ci.disabled,z,Kt.backCCW,J,Y,re,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments),v.coordsIndex.push($.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain))}renderLayer(t,r,l,h,_){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(h||[]).length)&&(this.id=l.id,d.cm(l)?(function(v,b,S,A,z,R){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:I}=R,F=ci.disabled,U=v.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function($,Q,Y,J,re,K,ae,le,ie){const pe=Q.transform,ze=Q.style.map.terrain,Te=re==="map",Ae=K==="map";for(const Ce of $){const We=J.getTile(Ce),Ke=We.getBucket(Y);if(!Ke||!Ke.text||!Ke.text.segments.get().length)continue;const Ge=d.ay(Ke.textSizeData,pe.zoom),at=d.aN(We,1,Q.transform.zoom),kt=Ka(Te,Q.transform,at),bi=Y.layout.get("icon-text-fit")!=="none"&&Ke.hasIconData();if(Ge){const Ui=Math.pow(2,pe.zoom-We.tileID.overscaledZ),Oi=ze?(Qi,Ai)=>ze.getElevation(Ce,Qi,Ai):null;Rs(Ke,Te,Ae,ie,pe,kt,Ui,Ge,bi,d.aO(pe,We,ae,le),Ce.toUnwrapped(),Oi)}}})(A,v,S,b,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),z),S.paint.get("icon-opacity").constantOr(1)!==0&&Xo(v,b,S,A,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),F,U,I),S.paint.get("text-opacity").constantOr(1)!==0&&Xo(v,b,S,A,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),F,U,I),b.map.showCollisionBoxes&&(Wn(v,b,S,A,!0),Wn(v,b,S,A,!1))})(t,r,l,h,this.style.placement.variableOffsets,_):d.cn(l)?(function(v,b,S,A,z){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,I=S.paint.get("circle-opacity"),F=S.paint.get("circle-stroke-width"),U=S.paint.get("circle-stroke-opacity"),$=!S.layout.get("circle-sort-key").isConstant();if(I.constantOr(1)===0&&(F.constantOr(1)===0||U.constantOr(1)===0))return;const Q=v.context,Y=Q.gl,J=v.transform,re=v.getDepthModeForSublayer(0,Ut.ReadOnly),K=ci.disabled,ae=v.colorModeForRenderPass(),le=[],ie=J.getCircleRadiusCorrection();for(let pe=0;pe<A.length;pe++){const ze=A[pe],Te=b.getTile(ze),Ae=Te.getBucket(S);if(!Ae)continue;const Ce=S.paint.get("circle-translate"),We=S.paint.get("circle-translate-anchor"),Ke=d.aO(J,Te,Ce,We),Ge=Ae.programConfigurations.get(S.id),at=v.useProgram("circle",Ge),kt=Ae.layoutVertexBuffer,bi=Ae.indexBuffer,Ui=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ze),Oi={programConfiguration:Ge,program:at,layoutVertexBuffer:kt,indexBuffer:bi,uniformValues:wu(v,Te,S,Ke,ie),terrainData:Ui,projectionData:J.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!R,applyTerrainMatrix:!0})};if($){const Qi=Ae.segments.get();for(const Ai of Qi)le.push({segments:new d.aX([Ai]),sortKey:Ai.sortKey,state:Oi})}else le.push({segments:Ae.segments,sortKey:0,state:Oi})}$&&le.sort(((pe,ze)=>pe.sortKey-ze.sortKey));for(const pe of le){const{programConfiguration:ze,program:Te,layoutVertexBuffer:Ae,indexBuffer:Ce,uniformValues:We,terrainData:Ke,projectionData:Ge}=pe.state;Te.draw(Q,Y.TRIANGLES,re,K,ae,Kt.backCCW,We,Ke,Ge,S.id,Ae,Ce,pe.segments,S.paint,v.transform.zoom,ze)}})(t,r,l,h,_):d.co(l)?(function(v,b,S,A,z){if(S.paint.get("heatmap-opacity")===0)return;const R=v.context,{isRenderingToTexture:I,isRenderingGlobe:F}=z;if(v.style.map.terrain){for(const U of A){const $=b.getTile(U);b.hasRenderableParent(U)||(v.renderPass==="offscreen"?Th(v,$,S,U,F):v.renderPass==="translucent"&&Kn(v,S,U,I,F))}R.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?(function(U,$,Q,Y){const J=U.context,re=J.gl,K=U.transform,ae=ci.disabled,le=new Ei([re.ONE,re.ONE],d.bp.transparent,[!0,!0,!0,!0]);(function(ie,pe,ze){const Te=ie.gl;ie.activeTexture.set(Te.TEXTURE1),ie.viewport.set([0,0,pe.width/4,pe.height/4]);let Ae=ze.heatmapFbos.get(d.cd);Ae?(Te.bindTexture(Te.TEXTURE_2D,Ae.colorAttachment.get()),ie.bindFramebuffer.set(Ae.framebuffer)):(Ae=Bi(ie,pe.width/4,pe.height/4),ze.heatmapFbos.set(d.cd,Ae))})(J,U,Q),J.clear({color:d.bp.transparent});for(let ie=0;ie<Y.length;ie++){const pe=Y[ie];if($.hasRenderableParent(pe))continue;const ze=$.getTile(pe),Te=ze.getBucket(Q);if(!Te)continue;const Ae=Te.programConfigurations.get(Q.id),Ce=U.useProgram("heatmap",Ae),We=K.getProjectionData({overscaledTileID:pe,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Ke=K.getCircleRadiusCorrection();Ce.draw(J,re.TRIANGLES,Ut.disabled,ae,le,Kt.backCCW,lo(ze,K.zoom,Q.paint.get("heatmap-intensity"),Ke),null,We,Q.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,Q.paint,K.zoom,Ae)}J.viewport.set([0,0,U.width,U.height])})(v,b,S,A):v.renderPass==="translucent"&&(function(U,$){const Q=U.context,Y=Q.gl;Q.setColorMode(U.colorModeForRenderPass());const J=$.heatmapFbos.get(d.cd);J&&(Q.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,J.colorAttachment.get()),Q.activeTexture.set(Y.TEXTURE1),si(Q,$).bind(Y.LINEAR,Y.CLAMP_TO_EDGE),U.useProgram("heatmapTexture").draw(Q,Y.TRIANGLES,Ut.disabled,ci.disabled,U.colorModeForRenderPass(),Kt.disabled,gh(U,$,0,1),null,null,$.id,U.viewportBuffer,U.quadTriangleIndexBuffer,U.viewportSegments,$.paint,U.transform.zoom))})(v,S)})(t,r,l,h,_):d.cp(l)?(function(v,b,S,A,z){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,I=S.paint.get("line-opacity"),F=S.paint.get("line-width");if(I.constantOr(1)===0||F.constantOr(1)===0)return;const U=v.getDepthModeForSublayer(0,Ut.ReadOnly),$=v.colorModeForRenderPass(),Q=S.paint.get("line-dasharray"),Y=Q.constantOr(1),J=S.paint.get("line-pattern"),re=J.constantOr(1),K=S.paint.get("line-gradient"),ae=S.getCrossfadeParameters();let le;le=re?"linePattern":Y&&K?"lineGradientSDF":Y?"lineSDF":K?"lineGradient":"line";const ie=v.context,pe=ie.gl,ze=v.transform;let Te=!0;for(const Ae of A){const Ce=b.getTile(Ae);if(re&&!Ce.patternsLoaded())continue;const We=Ce.getBucket(S);if(!We)continue;const Ke=We.programConfigurations.get(S.id),Ge=v.context.program.get(),at=v.useProgram(le,Ke),kt=Te||at.program!==Ge,bi=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ae),Ui=J.constantOr(null),Oi=Q&&Q.constantOr(null);if(Ui&&Ce.imageAtlas){const Jn=Ce.imageAtlas,gn=Jn.patternPositions[Ui.to.toString()],_n=Jn.patternPositions[Ui.from.toString()];gn&&_n&&Ke.setConstantPatternPositions(gn,_n)}else if(Oi){const Jn=S.layout.get("line-cap")==="round",gn=v.lineAtlas.getDash(Oi.to,Jn),_n=v.lineAtlas.getDash(Oi.from,Jn);Ke.setConstantDashPositions(gn,_n)}const Qi=ze.getProjectionData({overscaledTileID:Ae,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Ai=ze.getPixelScale();let cn;re?(cn=_h(v,Ce,S,Ai,ae),rr(ie,pe,Ce,Ke,ae)):Y&&K?(cn=uo(v,Ce,S,Ai,ae,We.lineClipsArray.length),Na(v,b,ie,pe,S,We,Ae,Ke,ae)):Y?(cn=Oa(v,Ce,S,Ai,ae),ln(v,ie,pe,Ke,kt,ae)):K?(cn=Of(v,Ce,S,Ai,We.lineClipsArray.length),Fa(v,b,ie,pe,S,We,Ae)):cn=Mu(v,Ce,S,Ai);const Wi=v.stencilModeForClipping(Ae);at.draw(ie,pe.TRIANGLES,U,Wi,$,Kt.disabled,cn,bi,Qi,S.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,S.paint,v.transform.zoom,Ke,We.layoutVertexBuffer2),Te=!1}})(t,r,l,h,_):d.cq(l)?(function(v,b,S,A,z){const R=S.paint.get("fill-color"),I=S.paint.get("fill-opacity");if(I.constantOr(1)===0)return;const{isRenderingToTexture:F}=z,U=v.colorModeForRenderPass(),$=S.paint.get("fill-pattern"),Q=v.opaquePassEnabledForLayer()&&!$.constantOr(1)&&R.constantOr(d.bp.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===Q){const Y=v.getDepthModeForSublayer(1,v.renderPass==="opaque"?Ut.ReadWrite:Ut.ReadOnly);fs(v,b,S,A,Y,U,!1,F)}if(v.renderPass==="translucent"&&S.paint.get("fill-antialias")){const Y=v.getDepthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,Ut.ReadOnly);fs(v,b,S,A,Y,U,!0,F)}})(t,r,l,h,_):d.cr(l)?(function(v,b,S,A,z){const R=S.paint.get("fill-extrusion-opacity");if(R===0)return;const{isRenderingToTexture:I}=z;if(v.renderPass==="translucent"){const F=new Ut(v.context.gl.LEQUAL,Ut.ReadWrite,v.depthRangeFor3D);if(R!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))ds(v,b,S,A,F,ci.disabled,Ei.disabled,I),ds(v,b,S,A,F,v.stencilModeFor3D(),v.colorModeForRenderPass(),I);else{const U=v.colorModeForRenderPass();ds(v,b,S,A,F,ci.disabled,U,I)}}})(t,r,l,h,_):d.cs(l)?(function(v,b,S,A,z){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,I=v.context,F=v.style.projection.useSubdivision,U=v.getDepthModeForSublayer(0,Ut.ReadOnly),$=v.colorModeForRenderPass();if(v.renderPass==="offscreen")(function(Q,Y,J,re,K,ae,le){const ie=Q.context,pe=ie.gl;for(const ze of J){const Te=Y.getTile(ze),Ae=Te.dem;if(!Ae||!Ae.data||!Te.needsHillshadePrepare)continue;const Ce=Ae.dim,We=Ae.stride,Ke=Ae.getPixels();if(ie.activeTexture.set(pe.TEXTURE1),ie.pixelStoreUnpackPremultiplyAlpha.set(!1),Te.demTexture=Te.demTexture||Q.getTileTexture(We),Te.demTexture){const at=Te.demTexture;at.update(Ke,{premultiply:!1}),at.bind(pe.NEAREST,pe.CLAMP_TO_EDGE)}else Te.demTexture=new d.T(ie,Ke,pe.RGBA,{premultiply:!1}),Te.demTexture.bind(pe.NEAREST,pe.CLAMP_TO_EDGE);ie.activeTexture.set(pe.TEXTURE0);let Ge=Te.fbo;if(!Ge){const at=new d.T(ie,{width:Ce,height:Ce,data:null},pe.RGBA);at.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),Ge=Te.fbo=ie.createFramebuffer(Ce,Ce,!0,!1),Ge.colorAttachment.set(at.texture)}ie.bindFramebuffer.set(Ge.framebuffer),ie.viewport.set([0,0,Ce,Ce]),Q.useProgram("hillshadePrepare").draw(ie,pe.TRIANGLES,K,ae,le,Kt.disabled,Lf(Te.tileID,Ae),null,null,re.id,Q.rasterBoundsBuffer,Q.quadTriangleIndexBuffer,Q.rasterBoundsSegments),Te.needsHillshadePrepare=!1}})(v,b,A,S,U,ci.disabled,$),I.viewport.set([0,0,v.width,v.height]);else if(v.renderPass==="translucent")if(F){const[Q,Y,J]=v.stencilConfigForOverlapTwoPass(A);ps(v,b,S,J,Q,U,$,!1,R),ps(v,b,S,J,Y,U,$,!0,R)}else{const[Q,Y]=v.getStencilConfigForOverlapAndUpdateStencilID(A);ps(v,b,S,Y,Q,U,$,!1,R)}})(t,r,l,h,_):d.ct(l)?(function(v,b,S,A,z){if(v.renderPass!=="translucent"||!A.length)return;const{isRenderingToTexture:R}=z,I=v.style.projection.useSubdivision,F=v.getDepthModeForSublayer(0,Ut.ReadOnly),U=v.colorModeForRenderPass();if(I){const[$,Q,Y]=v.stencilConfigForOverlapTwoPass(A);Bs(v,b,S,Y,$,F,U,!1,R),Bs(v,b,S,Y,Q,F,U,!0,R)}else{const[$,Q]=v.getStencilConfigForOverlapAndUpdateStencilID(A);Bs(v,b,S,Q,$,F,U,!1,R)}})(t,r,l,h,_):d.bU(l)?(function(v,b,S,A,z){if(v.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!A.length)return;const{isRenderingToTexture:R}=z,I=b.getSource(),F=v.style.projection.useSubdivision;if(I instanceof ua)br(v,b,S,A,null,!1,!1,I.tileCoords,I.flippedWindingOrder,R);else if(F){const[U,$,Q]=v.stencilConfigForOverlapTwoPass(A);br(v,b,S,Q,U,!1,!0,Os,!1,R),br(v,b,S,Q,$,!0,!0,Os,!1,R)}else{const[U,$]=v.getStencilConfigForOverlapAndUpdateStencilID(A);br(v,b,S,$,U,!1,!0,Os,!1,R)}})(t,r,l,h,_):d.cu(l)?(function(v,b,S,A,z){const R=S.paint.get("background-color"),I=S.paint.get("background-opacity");if(I===0)return;const{isRenderingToTexture:F}=z,U=v.context,$=U.gl,Q=v.style.projection,Y=v.transform,J=Y.tileSize,re=S.paint.get("background-pattern");if(v.isPatternMissing(re))return;const K=!re&&R.a===1&&I===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==K)return;const ae=ci.disabled,le=v.getDepthModeForSublayer(0,K==="opaque"?Ut.ReadWrite:Ut.ReadOnly),ie=v.colorModeForRenderPass(),pe=v.useProgram(re?"backgroundPattern":"background"),ze=A||Ji(Y,{tileSize:J,terrain:v.style.map.terrain});re&&(U.activeTexture.set($.TEXTURE0),v.imageManager.bind(v.context));const Te=S.getCrossfadeParameters();for(const Ae of ze){const Ce=Y.getProjectionData({overscaledTileID:Ae,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),We=re?zu(I,v,re,{tileID:Ae,tileSize:J},Te):Cu(I,R),Ke=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ae),Ge=Q.getMeshFromTileID(U,Ae.canonical,!1,!0,"raster");pe.draw(U,$.TRIANGLES,le,ae,ie,Kt.backCCW,We,Ke,Ce,S.id,Ge.vertexBuffer,Ge.indexBuffer,Ge.segments)}})(t,0,l,h,_):d.cv(l)&&(function(v,b,S,A){const{isRenderingGlobe:z}=A,R=v.context,I=S.implementation,F=v.style.projection,U=v.transform,$=U.getProjectionDataForCustomLayer(z),Q={farZ:U.farZ,nearZ:U.nearZ,fov:U.fov*Math.PI/180,modelViewProjectionMatrix:U.modelViewProjectionMatrix,projectionMatrix:U.projectionMatrix,shaderData:{variantName:F.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${F.shaderPreludeCode.vertexSource}`,define:F.shaderDefine},defaultProjectionData:$},Y=I.renderingMode?I.renderingMode:"2d";if(v.renderPass==="offscreen"){const J=I.prerender;J&&(v.setCustomLayerDefaults(),R.setColorMode(v.colorModeForRenderPass()),J.call(I,R.gl,Q),R.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),R.setColorMode(v.colorModeForRenderPass()),R.setStencilMode(ci.disabled);const J=Y==="3d"?v.getDepthModeFor3D():v.getDepthModeForSublayer(0,Ut.ReadOnly);R.setDepthMode(J),I.render(R.gl,Q),R.setDirty(),v.setBaseState(),R.bindFramebuffer.set(null)}})(t,0,l,_))}saveTileTexture(t){const r=this._tileTextures[t.size[0]];r?r.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const r=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!r||!l}useProgram(t,r,l=!1,h=[]){this.cache=this.cache||{};const _=!!this.style.map.terrain,v=this.style.projection,b=l?en.projectionMercator:v.shaderPreludeCode,S=l?dn:v.shaderDefine,A=t+(r?r.cacheKey:"")+`/${l?Aa:v.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(_?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[A]||(this.cache[A]=new Pf(this.context,en[t],r,kf[t],this._showOverdrawInspector,_,b,S,h)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,r;if(this._tileTextures){for(const l in this._tileTextures){const h=this._tileTextures[l];if(h)for(const _ of h)_.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((r=this.tileExtentMesh.indexBuffer)===null||r===void 0||r.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const l in this.cache){const h=this.cache[l];h&&h.program&&this.context.gl.deleteProgram(h.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:r}=this.context.gl;return this.width!==t||this.height!==r}}function Mh(m,t){let r,l=!1,h=null,_=null;const v=()=>{h=null,l&&(m.apply(_,r),h=setTimeout(v,t),l=!1)};return(...b)=>(l=!0,_=this,r=b,h||v(),h)}class Tn{constructor(t){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map((h=>h.split("="))).forEach((h=>{h[0]===this._hashName&&(l=h)})),(l&&l[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:l,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const l=r.join("/");let h=l;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${l}`);let _=window.location.hash.replace(h,"");_.startsWith("#&")?_=_.slice(0,1)+_.slice(2):_==="#"&&(_="");let v=window.location.href.replace(/(#.+)?$/,_);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=Mh(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const r=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,h),v=Math.round(r.lng*_)/_,b=Math.round(r.lat*_)/_,S=this._map.getBearing(),A=this._map.getPitch();let z="";if(z+=t?`/${v}/${b}/${l}`:`${l}/${b}/${v}`,(S||A)&&(z+="/"+Math.round(10*S)/10),A&&(z+=`/${Math.round(A)}`),this._hashName){const R=this._hashName;let I=!1;const F=window.location.hash.slice(1).split("&").map((U=>{const $=U.split("=")[0];return $===R?(I=!0,`${$}=${z}`):U})).filter((U=>U));return I||F.push(`${R}=${z}`),`#${F.join("&")}`}return`#${z}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new d.V(+t[2],+t[1])}catch{return!1}const r=+t[0],l=+(t[3]||0),h=+(t[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&l>=-180&&l<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}const _s={linearity:.3,easing:d.cw(0,0,.3,1)},Vl=d.e({deceleration:2500,maxSpeed:1400},_s),xa=d.e({deceleration:20,maxSpeed:1400},_s),or=d.e({deceleration:1e3,maxSpeed:360},_s),$o=d.e({deceleration:1e3,maxSpeed:90},_s),ba=d.e({deceleration:1e3,maxSpeed:360},_s);class $d{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:nt(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=nt();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)r.zoom+=_.zoomDelta||0,r.bearing+=_.bearingDelta||0,r.pitch+=_.pitchDelta||0,r.roll+=_.rollDelta||0,_.panDelta&&r.pan._add(_.panDelta),_.around&&(r.around=_.around),_.pinchAround&&(r.pinchAround=_.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(r.pan.mag()){const _=Ou(r.pan.mag(),l,d.e({},Vl,t||{})),v=r.pan.mult(_.amount/r.pan.mag()),b=this._map.cameraHelper.handlePanInertia(v,this._map.transform);h.center=b.easingCenter,h.offset=b.easingOffset,jl(h,_)}if(r.zoom){const _=Ou(r.zoom,l,xa);h.zoom=this._map.transform.zoom+_.amount,jl(h,_)}if(r.bearing){const _=Ou(r.bearing,l,or);h.bearing=this._map.transform.bearing+d.an(_.amount,-179,179),jl(h,_)}if(r.pitch){const _=Ou(r.pitch,l,$o);h.pitch=this._map.transform.pitch+_.amount,jl(h,_)}if(r.roll){const _=Ou(r.roll,l,ba);h.roll=this._map.transform.roll+d.an(_.amount,-179,179),jl(h,_)}if(h.zoom||h.bearing){const _=r.pinchAround===void 0?r.around:r.pinchAround;h.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),d.e(h,{noMoveStart:!0})}}function jl(m,t){(!m.duration||m.duration<t.duration)&&(m.duration=t.duration,m.easing=t.easing)}function Ou(m,t,r){const{maxSpeed:l,linearity:h,deceleration:_}=r,v=d.an(m*h/(t/1e3),-l,l),b=Math.abs(v)/(_*h);return{easing:r.easing,duration:1e3*b,amount:v*(b/2)}}class Xn extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l,h={}){l=l instanceof MouseEvent?l:new MouseEvent(t,l);const _=ve.mousePos(r.getCanvas(),l),v=r.unproject(_);super(t,d.e({point:_,lngLat:v,originalEvent:l},h)),this._defaultPrevented=!1,this.target=r}}class Vr extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l){const h=t==="touchend"?l.changedTouches:l.touches,_=ve.touchPos(r.getCanvasContainer(),h),v=_.map((S=>r.unproject(S))),b=_.reduce(((S,A,z,R)=>S.add(A.div(R.length))),new d.P(0,0));super(t,{points:_,point:b,lngLats:v,lngLat:r.unproject(b),originalEvent:l}),this._defaultPrevented=!1}}class Pc extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class Ic{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Pc(t.type,this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new Xn(t.type,this._map,t))}mouseup(t){this._map.fire(new Xn(t.type,this._map,t))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new Xn(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Xn(t.type,this._map,t))}mouseover(t){this._map.fire(new Xn(t.type,this._map,t))}mouseout(t){this._map.fire(new Xn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Vr(t.type,this._map,t))}touchmove(t){this._map.fire(new Vr(t.type,this._map,t))}touchend(t){this._map.fire(new Vr(t.type,this._map,t))}touchcancel(t){this._map.fire(new Vr(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vf{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Xn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Xn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jr{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(d.P.convert(t),this._map.terrain)}}class _o{constructor(t,r){this._map=t,this._tr=new jr(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(ve.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const l=r;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=ve.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(h.x,l.x),v=Math.max(h.x,l.x),b=Math.min(h.y,l.y),S=Math.max(h.y,l.y);ve.setTransform(this._box,`translate(${_}px,${b}px)`),this._box.style.width=v-_+"px",this._box.style.height=S-b+"px"}mouseupWindow(t,r){if(!this._active||t.button!==0)return;const l=this._startPos,h=r;if(this.reset(),ve.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new d.l("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ve.remove(this._box),this._box=null),ve.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new d.l(t,{originalEvent:r}))}}function Va(m,t){if(m.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${t.length}`);const r={};for(let l=0;l<m.length;l++)r[m[l].identifier]=t[l];return r}class lt{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,r,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=(function(h){const _=new d.P(0,0);for(const v of h)_._add(v);return _.div(h.length)})(r),this.touches=Va(l,r)))}touchmove(t,r,l){if(this.aborted||!this.centroid)return;const h=Va(l,r);for(const _ in this.touches){const v=h[_];(!v||v.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,r,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class ku{constructor(t){this.singleTap=new lt(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,r,l){this.singleTap.touchstart(t,r,l)}touchmove(t,r,l){this.singleTap.touchmove(t,r,l)}touchend(t,r,l){const h=this.singleTap.touchend(t,r,l);if(h){const _=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(h)<30;if(_&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class Rc{constructor(t){this._tr=new jr(t),this._zoomIn=new ku({numTouches:1,numTaps:2}),this._zoomOut=new ku({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,l){this._zoomIn.touchstart(t,r,l),this._zoomOut.touchstart(t,r,l)}touchmove(t,r,l){this._zoomIn.touchmove(t,r,l),this._zoomOut.touchmove(t,r,l)}touchend(t,r,l){const h=this._zoomIn.touchend(t,r,l),_=this._zoomOut.touchend(t,r,l),v=this._tr;return h?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(h)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wr{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const r=this._moveFunction(...t);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(t,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,r){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const h=Array.isArray(r)?r[0]:r;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&ve.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ur=0,Ul=2,Lc={[Ur]:1,[Ul]:2};class ys{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const r=ve.mouseButton(t);this._eventButton=r}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(r,l){const h=Lc[l];return r.buttons===void 0||(r.buttons&h)!==h})(t,this._eventButton)}isValidEndEvent(t){return ve.mouseButton(t)===this._eventButton}}class Yo{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Fu{constructor(t=new ys({checkCorrectEvent:()=>!0}),r=new Yo){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(t,r,l){return t instanceof MouseEvent?r(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?l(t):void 0}startMove(t){this._executeRelevantHandler(t,(r=>this.mouseMoveStateManager.startMove(r)),(r=>this.oneFingerTouchMoveStateManager.startMove(r)))}endMove(t){this._executeRelevantHandler(t,(r=>this.mouseMoveStateManager.endMove(r)),(r=>this.oneFingerTouchMoveStateManager.endMove(r)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(r=>this.mouseMoveStateManager.isValidStartEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(r=>this.mouseMoveStateManager.isValidMoveEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(r=>this.mouseMoveStateManager.isValidEndEvent(r)),(r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r)))}}const vs=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=t=>{t.preventDefault()}};class Bc{constructor(t,r){this._clickTolerance=t.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,r,l){return this._calculateTransform(t,r,l)}touchmove(t,r,l){if(this._active){if(!this._shouldBePrevented(l.length))return t.preventDefault(),this._calculateTransform(t,r,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,r,l){this._calculateTransform(t,r,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,l){l.length>0&&(this._active=!0);const h=Va(l,r),_=new d.P(0,0),v=new d.P(0,0);let b=0;for(const A in h){const z=h[A],R=this._touches[A];R&&(_._add(z),v._add(z.sub(R)),b++,h[A]=z)}if(this._touches=h,this._shouldBePrevented(b)||!v.mag())return;const S=v.div(b);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(b),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,r,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,l){if(!this._firstTwoTouches)return;t.preventDefault();const[h,_]=this._firstTwoTouches,v=xs(l,r,h),b=xs(l,r,_);if(!v||!b)return;const S=this._aroundCenter?null:v.add(b).div(2);return this._move([v,b],S,t)}touchend(t,r,l){if(!this._firstTwoTouches)return;const[h,_]=this._firstTwoTouches,v=xs(l,r,h),b=xs(l,r,_);v&&b||(this._active&&ve.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function xs(m,t,r){for(let l=0;l<m.length;l++)if(m[l].identifier===r)return t[l]}function Eh(m,t){return Math.log(m/t)/Math.LN2}class bs extends Nu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Eh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Eh(this._distance,l),pinchAround:r}}}function Oc(m,t){return 180*m.angleWith(t)/Math.PI}class Vu extends Nu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r,l){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Oc(this._vector,h),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,l=Oc(t,this._startVector);return Math.abs(l)<r}}function ws(m){return Math.abs(m.y)>Math.abs(m.x)}class Ns extends Nu{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,r,l){super.touchstart(t,r,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,ws(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=t[0].sub(this._lastPoints[0]),_=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,_,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(h.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(t,r,l){if(this._valid!==void 0)return this._valid;const h=t.mag()>=2,_=r.mag()>=2;if(!h&&!_)return;if(!h||!_)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=t.y>0==r.y>0;return ws(t)&&ws(r)&&v}}const Tr={panStep:100,bearingStep:15,pitchStep:10};class Ti{constructor(t){this._tr=new jr(t);const r=Tr;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,l=0,h=0,_=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?h=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?h=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:b=>{const S=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:Ah,zoom:r?Math.round(S.zoom)+r*(t.shiftKey?2:1):S.zoom,bearing:S.bearing+l*this._bearingStep,pitch:S.pitch+h*this._pitchStep,offset:[-_*this._panStep,-v*this._panStep],center:S.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ah(m){return m*(2-m)}const Vs=4.000244140625,yo=1/450;class ju{constructor(t,r){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new jr(t),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=yo}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=nt(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,r!==0&&r%Vs==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(h*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=ve.mousePos(this._map.getCanvas(),t),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(d.V.convert(l.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const b=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=b),typeof this._targetZoom=="number"&&(this._targetZoom+=b)}if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>Vs?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&S!==0&&(S=1/S);const A=typeof this._targetZoom!="number"?t.scale:d.aq(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),d.at(A*S)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,l=this._startZoom,h=this._easing;let _,v=!1;if(this._type==="wheel"&&l&&h){const b=nt()-this._lastWheelEventTime,S=Math.min((b+5)/200,1),A=h(S);_=d.G.number(l,r,A),S<1?this._frameId||(this._frameId=!0):v=!0}else _=r,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=_,{noInertia:!0,needsRenderFrame:!v,zoomDelta:_-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=d.cy;if(this._prevEase){const l=this._prevEase,h=(nt()-l.start)/l.duration,_=l.easing(h+.01)-l.easing(h),v=.27/Math.sqrt(_*_+1e-4)*.01,b=Math.sqrt(.0729-v*v);r=d.cw(v,b,.25,1)}return this._prevEase={start:nt(),duration:t,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class kc{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Qo{constructor(t){this._tr=new jr(t),this.reset()}reset(){this._active=!1}dblclick(t,r){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uu{constructor(){this._tap=new ku({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,r,l){if(!this._swipePoint)if(this._tapTime){const h=r[0],_=t.timeStamp-this._tapTime<500,v=this._tapPoint.dist(h)<30;_&&v?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,r,l)}touchmove(t,r,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=r[0],_=h.y-this._swipePoint.y;return this._swipePoint=h,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,r,l)}touchend(t,r,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(t,r,l);h&&(this._tapTime=t.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ch{constructor(t,r,l){this._el=t,this._mousePan=r,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class lr{constructor(t,r,l,h){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=r,this._mousePitch=l,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Wo{constructor(t,r,l,h){this._el=t,this._touchZoom=r,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ct{constructor(t,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=ve.create("div","maplibregl-cooperative-gesture-screen",t);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=r,this._container.appendChild(h);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=l,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(ve.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,r){this._enabled&&(this._map.fire(new d.l("cooperativegestureprevented",{gestureType:t,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const vt=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class Sr extends d.l{}function Gl(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class Gu{constructor(t,r){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,_)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=h.type==="renderFrame"?void 0:h,b={needsRenderFrame:!1},S={},A={};for(const{handlerName:I,handler:F,allowed:U}of this._handlers){if(!F.isEnabled())continue;let $;if(this._blockedByActive(A,U,I))F.reset();else if(F[_||h.type]){if(d.cz(h,_||h.type)){const Q=ve.mousePos(this._map.getCanvas(),h);$=F[_||h.type](h,Q)}else if(d.cA(h,_||h.type)){const Q=this._getMapTouches(h.touches),Y=ve.touchPos(this._map.getCanvas(),Q);$=F[_||h.type](h,Y,Q)}else d.cB(_||h.type)||($=F[_||h.type](h));this.mergeHandlerResult(b,S,$,I,v),$&&$.needsRenderFrame&&this._triggerRenderFrame()}($||F.isActive())&&(A[I]=F)}const z={};for(const I in this._previousActiveHandlers)A[I]||(z[I]=v);this._previousActiveHandlers=A,(Object.keys(z).length||Gl(b))&&(this._changes.push([b,S,z]),this._triggerRenderFrame()),(Object.keys(A).length||Gl(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=b;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new $d(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,_,v]of this._listeners)ve.addEventListener(h,_,h===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,r,l]of this._listeners)ve.removeEventListener(t,r,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const r=this._map,l=r.getCanvasContainer();this._add("mapEvent",new Ic(r,t));const h=r.boxZoom=new _o(r,t);this._add("boxZoom",h),t.interactive&&t.boxZoom&&h.enable();const _=r.cooperativeGestures=new ct(r,t.cooperativeGestures);this._add("cooperativeGestures",_),t.cooperativeGestures&&_.enable();const v=new Rc(r),b=new Qo(r);r.doubleClickZoom=new kc(b,v),this._add("tapZoom",v),this._add("clickZoom",b),t.interactive&&t.doubleClickZoom&&r.doubleClickZoom.enable();const S=new Uu;this._add("tapDragZoom",S);const A=r.touchPitch=new Ns(r);this._add("touchPitch",A),t.interactive&&t.touchPitch&&r.touchPitch.enable(t.touchPitch);const z=()=>r.project(r.getCenter()),R=(function({enable:K,clickTolerance:ae,aroundCenter:le=!0,minPixelCenterThreshold:ie=100,rotateDegreesPerPixelMoved:pe=.8},ze){const Te=new ys({checkCorrectEvent:Ae=>ve.mouseButton(Ae)===0&&Ae.ctrlKey||ve.mouseButton(Ae)===2&&!Ae.ctrlKey});return new wr({clickTolerance:ae,move:(Ae,Ce)=>{const We=ze();if(le&&Math.abs(We.y-Ae.y)>ie)return{bearingDelta:d.cx(new d.P(Ae.x,Ce.y),Ce,We)};let Ke=(Ce.x-Ae.x)*pe;return le&&Ce.y<We.y&&(Ke=-Ke),{bearingDelta:Ke}},moveStateManager:Te,enable:K,assignEvents:vs})})(t,z),I=(function({enable:K,clickTolerance:ae,pitchDegreesPerPixelMoved:le=-.5}){const ie=new ys({checkCorrectEvent:pe=>ve.mouseButton(pe)===0&&pe.ctrlKey||ve.mouseButton(pe)===2});return new wr({clickTolerance:ae,move:(pe,ze)=>({pitchDelta:(ze.y-pe.y)*le}),moveStateManager:ie,enable:K,assignEvents:vs})})(t),F=(function({enable:K,clickTolerance:ae,rollDegreesPerPixelMoved:le=.3},ie){const pe=new ys({checkCorrectEvent:ze=>ve.mouseButton(ze)===2&&ze.ctrlKey});return new wr({clickTolerance:ae,move:(ze,Te)=>{const Ae=ie();let Ce=(Te.x-ze.x)*le;return Te.y<Ae.y&&(Ce=-Ce),{rollDelta:Ce}},moveStateManager:pe,enable:K,assignEvents:vs})})(t,z);r.dragRotate=new lr(t,R,I,F),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",I,["mouseRotate","mouseRoll"]),this._add("mouseRoll",F,["mousePitch"]),t.interactive&&t.dragRotate&&r.dragRotate.enable();const U=(function({enable:K,clickTolerance:ae}){const le=new ys({checkCorrectEvent:ie=>ve.mouseButton(ie)===0&&!ie.ctrlKey});return new wr({clickTolerance:ae,move:(ie,pe)=>({around:pe,panDelta:pe.sub(ie)}),activateOnStart:!0,moveStateManager:le,enable:K,assignEvents:vs})})(t),$=new Bc(t,r);r.dragPan=new Ch(l,U,$),this._add("mousePan",U),this._add("touchPan",$,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&r.dragPan.enable(t.dragPan);const Q=new Vu,Y=new bs;r.touchZoomRotate=new Wo(l,Y,Q,S),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&r.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new Vf(r));const J=r.scrollZoom=new ju(r,(()=>this._triggerRenderFrame()));this._add("scrollZoom",J,["mousePan"]),t.interactive&&t.scrollZoom&&r.scrollZoom.enable(t.scrollZoom);const re=r.keyboard=new Ti(r);this._add("keyboard",re),t.interactive&&t.keyboard&&r.keyboard.enable()}_add(t,r,l){this._handlers.push({handlerName:t,handler:r,allowed:l}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vt(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,r,l){for(const h in t)if(h!==l&&(!r||r.indexOf(h)<0))return!0;return!1}_getMapTouches(t){const r=[];for(const l of t)this._el.contains(l.target)&&r.push(l);return r}mergeHandlerResult(t,r,l,h,_){if(!l)return;d.e(t,l);const v={handlerName:h,originalEvent:l.originalEvent||_};l.zoomDelta!==void 0&&(r.zoom=v),l.panDelta!==void 0&&(r.drag=v),l.rollDelta!==void 0&&(r.roll=v),l.pitchDelta!==void 0&&(r.pitch=v),l.bearingDelta!==void 0&&(r.rotate=v)}_applyChanges(){const t={},r={},l={};for(const[h,_,v]of this._changes)h.panDelta&&(t.panDelta=(t.panDelta||new d.P(0,0))._add(h.panDelta)),h.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(t.rollDelta=(t.rollDelta||0)+h.rollDelta),h.around!==void 0&&(t.around=h.around),h.pinchAround!==void 0&&(t.pinchAround=h.pinchAround),h.noInertia&&(t.noInertia=h.noInertia),d.e(r,_),d.e(l,v);this._updateMapTransform(t,r,l),this._changes=[]}_updateMapTransform(t,r,l){const h=this._map,_=h._getTransformForUpdate(),v=h.terrain;if(!(Gl(t)||v&&this._terrainMovement))return this._fireEvents(r,l,!0);h._stop(!0);let{panDelta:b,zoomDelta:S,bearingDelta:A,pitchDelta:z,rollDelta:R,around:I,pinchAround:F}=t;F!==void 0&&(I=F),I=I||h.transform.centerPoint,v&&!_.isPointOnMapSurface(I)&&(I=_.centerPoint);const U={panDelta:b,zoomDelta:S,rollDelta:R,pitchDelta:z,bearingDelta:A,around:I};this._map.cameraHelper.useGlobeControls&&!_.isPointOnMapSurface(I)&&(I=_.centerPoint);const $=I.distSqr(_.centerPoint)<.01?_.center:_.screenPointToLocation(b?I.sub(b):I);this._handleMapControls({terrain:v,tr:_,deltasForHelper:U,preZoomAroundLoc:$,combinedEventsInProgress:r,panDelta:b}),h._applyUpdatedTransform(_),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,l,!0)}_handleMapControls({terrain:t,tr:r,deltasForHelper:l,preZoomAroundLoc:h,combinedEventsInProgress:_,panDelta:v}){const b=this._map.cameraHelper;if(b.handleMapControlsRollPitchBearingZoom(l,r),t)return b.useGlobeControls?(this._terrainMovement||!_.drag&&!_.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void b.handleMapControlsPan(l,r,h)):this._terrainMovement||!_.drag&&!_.zoom?void(_.drag&&this._terrainMovement&&v?r.setCenter(r.screenPointToLocation(r.centerPoint.sub(v))):b.handleMapControlsPan(l,r,h)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void b.handleMapControlsPan(l,r,h));b.handleMapControlsPan(l,r,h)}_fireEvents(t,r,l){const h=vt(this._eventsInProgress),_=vt(t),v={};for(const R in t){const{originalEvent:I}=t[R];this._eventsInProgress[R]||(v[`${R}start`]=I),this._eventsInProgress[R]=t[R]}!h&&_&&this._fireEvent("movestart",_.originalEvent);for(const R in v)this._fireEvent(R,v[R]);_&&this._fireEvent("move",_.originalEvent);for(const R in t){const{originalEvent:I}=t[R];this._fireEvent(R,I)}const b={};let S;for(const R in this._eventsInProgress){const{handlerName:I,originalEvent:F}=this._eventsInProgress[R];this._handlersById[I].isActive()||(delete this._eventsInProgress[R],S=r[I]||F,b[`${R}end`]=S)}for(const R in b)this._fireEvent(R,b[R]);const A=vt(this._eventsInProgress),z=(h||_)&&!A;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const R=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&R.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(R)}if(l&&z){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),I=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;!R||!R.essential&&ei.prefersReducedMotion?(this._map.fire(new d.l("moveend",{originalEvent:S})),I(this._map.getBearing())&&this._map.resetNorth()):(I(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new d.l(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new Sr("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Sn extends d.E{constructor(t,r,l){super(),this._renderFrameCallback=()=>{const h=Math.min((nt()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,this.cameraHelper=r,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,r){t.apply(this.transform),this.transform=t,this.cameraHelper=r}getCenter(){return new d.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,r){return this.jumpTo({elevation:t},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,r,l){return t=d.P.convert(t).mult(-1),this.panTo(this.transform.center,d.e({offset:t},r),l)}panTo(t,r,l){return this.easeTo(d.e({center:t},r),l)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,l){return this.easeTo(d.e({zoom:t},r),l)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,r){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new d.l("movestart",r)).fire(new d.l("move",r)).fire(new d.l("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,l){return this.easeTo(d.e({bearing:t},r),l)}resetNorth(t,r){return this.rotateTo(0,d.e({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(d.e({bearing:0,pitch:0,roll:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}getRoll(){return this.transform.roll}setRoll(t,r){return this.jumpTo({roll:t},r),this}cameraForBounds(t,r){t=$i.convert(t).adjustAntiMeridian();const l=r&&r.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,r)}_cameraForBoxAndBearing(t,r,l,h){const _={top:0,bottom:0,right:0,left:0};if(typeof(h=d.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const A=h.padding;h.padding={top:A,bottom:A,right:A,left:A}}const v=d.e(_,h.padding);h.padding=v;const b=this.transform,S=new $i(t,r);return this.cameraHelper.cameraForBoxAndBearing(h,v,S,l,b)}fitBounds(t,r,l){return this._fitInternal(this.cameraForBounds(t,r),r,l)}fitScreenCoordinates(t,r,l,h,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(d.P.convert(t)),this.transform.screenPointToLocation(d.P.convert(r)),l,h),h,_)}_fitInternal(t,r,l){return t?(delete(r=d.e(t,r)).padding,r.linear?this.easeTo(r,l):this.flyTo(r,l)):this}jumpTo(t,r){this.stop();const l=this._getTransformForUpdate();let h=!1,_=!1,v=!1;const b=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,t);const S=l.zoom!==b;return"elevation"in t&&l.elevation!==+t.elevation&&l.setElevation(+t.elevation),"bearing"in t&&l.bearing!==+t.bearing&&(h=!0,l.setBearing(+t.bearing)),"pitch"in t&&l.pitch!==+t.pitch&&(_=!0,l.setPitch(+t.pitch)),"roll"in t&&l.roll!==+t.roll&&(v=!0,l.setRoll(+t.roll)),t.padding==null||l.isPaddingEqual(t.padding)||l.setPadding(t.padding),this._applyUpdatedTransform(l),this.fire(new d.l("movestart",r)).fire(new d.l("move",r)),S&&this.fire(new d.l("zoomstart",r)).fire(new d.l("zoom",r)).fire(new d.l("zoomend",r)),h&&this.fire(new d.l("rotatestart",r)).fire(new d.l("rotate",r)).fire(new d.l("rotateend",r)),_&&this.fire(new d.l("pitchstart",r)).fire(new d.l("pitch",r)).fire(new d.l("pitchend",r)),v&&this.fire(new d.l("rollstart",r)).fire(new d.l("roll",r)).fire(new d.l("rollend",r)),this.fire(new d.l("moveend",r))}calculateCameraOptionsFromTo(t,r,l,h=0){const _=d.a9.fromLngLat(t,r),v=d.a9.fromLngLat(l,h),b=v.x-_.x,S=v.y-_.y,A=v.z-_.z,z=Math.hypot(b,S,A);if(z===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(b,S),I=d.at(this.transform.cameraToCenterDistance/z/this.transform.tileSize),F=180*Math.atan2(b,-S)/Math.PI;let U=180*Math.acos(R/z)/Math.PI;return U=A<0?90-U:90+U,{center:v.toLngLat(),elevation:h,zoom:I,pitch:U,bearing:F}}calculateCameraOptionsFromCameraLngLatAltRotation(t,r,l,h,_){const v=this.transform.calculateCenterFromCameraLngLatAlt(t,r,l,h);return{center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:l,pitch:h,roll:_}}easeTo(t,r){this._stop(!1,t.easeId),((t=d.e({offset:[0,0],duration:500,easing:d.cy},t)).animate===!1||!t.essential&&ei.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),h=this.getBearing(),_=l.pitch,v=l.roll,b="bearing"in t?this._normalizeBearing(t.bearing,h):h,S="pitch"in t?+t.pitch:_,A="roll"in t?this._normalizeBearing(t.roll,v):v,z="padding"in t?t.padding:l.padding,R=d.P.convert(t.offset);let I,F;t.around&&(I=d.V.convert(t.around),F=l.locationToScreenPoint(I));const U={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},$=this.cameraHelper.handleEaseTo(l,{bearing:b,pitch:S,roll:A,padding:z,around:I,aroundPoint:F,offsetAsPoint:R,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||h!==b,this._pitching=this._pitching||S!==_,this._rolling=this._rolling||A!==v,this._padding=!l.isPaddingEqual(z),this._zooming=this._zooming||$.isZooming,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,U),this.terrain&&this._prepareElevation($.elevationCenter),this._ease((Q=>{$.easeFunc(Q),this.terrain&&!t.freezeElevation&&this._updateElevation(Q),this._applyUpdatedTransform(l),this._fireMoveEvents(r)}),(Q=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(r,Q)}),t),this}_prepareEase(t,r,l={}){this._moving=!0,r||l.moving||this.fire(new d.l("movestart",t)),this._zooming&&!l.zooming&&this.fire(new d.l("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new d.l("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new d.l("pitchstart",t)),this._rolling&&!l.rolling&&this.fire(new d.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&r!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(r-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=r}this.transform.setElevation(d.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const r=t.getCameraLngLat(),l=t.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(r,t.zoom):0;if(l<h){const _=this.calculateCameraOptionsFromTo(r,h,t.center,t.elevation);return{pitch:_.pitch,zoom:_.zoom}}return{}}_applyUpdatedTransform(t){const r=[];if(r.push((h=>this._elevateCameraIfInsideTerrain(h))),this.transformCameraUpdate&&r.push((h=>this.transformCameraUpdate(h))),!r.length)return;const l=t.clone();for(const h of r){const _=l.clone(),{center:v,zoom:b,roll:S,pitch:A,bearing:z,elevation:R}=h(_);v&&_.setCenter(v),R!==void 0&&_.setElevation(R),b!==void 0&&_.setZoom(b),S!==void 0&&_.setRoll(S),A!==void 0&&_.setPitch(A),z!==void 0&&_.setBearing(z),l.apply(_)}this.transform.apply(l)}_fireMoveEvents(t){this.fire(new d.l("move",t)),this._zooming&&this.fire(new d.l("zoom",t)),this._rotating&&this.fire(new d.l("rotate",t)),this._pitching&&this.fire(new d.l("pitch",t)),this._rolling&&this.fire(new d.l("roll",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const l=this._zooming,h=this._rotating,_=this._pitching,v=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new d.l("zoomend",t)),h&&this.fire(new d.l("rotateend",t)),_&&this.fire(new d.l("pitchend",t)),v&&this.fire(new d.l("rollend",t)),this.fire(new d.l("moveend",t))}flyTo(t,r){if(!t.essential&&ei.prefersReducedMotion){const Ce=d.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ce,r)}this.stop(),t=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.cy},t);const l=this._getTransformForUpdate(),h=l.bearing,_=l.pitch,v=l.roll,b=l.padding,S="bearing"in t?this._normalizeBearing(t.bearing,h):h,A="pitch"in t?+t.pitch:_,z="roll"in t?this._normalizeBearing(t.roll,v):v,R="padding"in t?t.padding:l.padding,I=d.P.convert(t.offset);let F=l.centerPoint.add(I);const U=l.screenPointToLocation(F),$=this.cameraHelper.handleFlyTo(l,{bearing:S,pitch:A,roll:z,padding:R,locationAtOffset:U,offsetAsPoint:I,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let Q=t.curve;const Y=Math.max(l.width,l.height),J=Y/$.scaleOfZoom,re=$.pixelPathLength;typeof $.scaleOfMinZoom=="number"&&(Q=Math.sqrt(Y/$.scaleOfMinZoom/re*2));const K=Q*Q;function ae(Ce){const We=(J*J-Y*Y+(Ce?-1:1)*K*K*re*re)/(2*(Ce?J:Y)*K*re);return Math.log(Math.sqrt(We*We+1)-We)}function le(Ce){return(Math.exp(Ce)-Math.exp(-Ce))/2}function ie(Ce){return(Math.exp(Ce)+Math.exp(-Ce))/2}const pe=ae(!1);let ze=function(Ce){return ie(pe)/ie(pe+Q*Ce)},Te=function(Ce){return Y*((ie(pe)*(le(We=pe+Q*Ce)/ie(We))-le(pe))/K)/re;var We},Ae=(ae(!0)-pe)/Q;if(Math.abs(re)<2e-6||!isFinite(Ae)){if(Math.abs(Y-J)<1e-6)return this.easeTo(t,r);const Ce=J<Y?-1:1;Ae=Math.abs(Math.log(J/Y))/Q,Te=()=>0,ze=We=>Math.exp(Ce*Q*We)}return t.duration="duration"in t?+t.duration:1e3*Ae/("screenSpeed"in t?+t.screenSpeed/Q:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=h!==S,this._pitching=A!==_,this._rolling=z!==v,this._padding=!l.isPaddingEqual(R),this._prepareEase(r,!1),this.terrain&&this._prepareElevation($.targetCenter),this._ease((Ce=>{const We=Ce*Ae,Ke=1/ze(We),Ge=Te(We);this._rotating&&l.setBearing(d.G.number(h,S,Ce)),this._pitching&&l.setPitch(d.G.number(_,A,Ce)),this._rolling&&l.setRoll(d.G.number(v,z,Ce)),this._padding&&(l.interpolatePadding(b,R,Ce),F=l.centerPoint.add(I)),$.easeFunc(Ce,Ke,Ge,F),this.terrain&&!t.freezeElevation&&this._updateElevation(Ce),this._applyUpdatedTransform(l),this._fireMoveEvents(r)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(r)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,r){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,r)}return t||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(t,r,l){l.animate===!1||l.duration===0?(t(1),r()):(this._easeStart=nt(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,r){t=d.W(t,-180,180);const l=Math.abs(t-r);return Math.abs(t-360-r)<l&&(t-=360),Math.abs(t+360-r)<l&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(d.V.convert(t),this.transform):null}}const un={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class mn{constructor(t=un){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=ve.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ve.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ve.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ve.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,r){const l=this._map._getUIString(`AttributionControl.${r}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((h=>typeof h!="string"?"":h))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const r=this._map.style.tileManagers;for(const h in r){const _=r[h];if(_.used||_.usedForTerrain){const v=_.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t=t.filter((h=>String(h).trim())),t.sort(((h,_)=>h.length-_.length)),t=t.filter(((h,_)=>{for(let v=_+1;v<t.length;v++)if(t[v].indexOf(h)>=0)return!1;return!0}));const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=ve.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class qu{constructor(t={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=ve.create("div","maplibregl-ctrl");const r=ve.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ve.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class js{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,l=r?this._queue.concat(r):this._queue;for(const h of l)if(h.id===t)return void(h.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const l of r)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Qt=d.aU([{name:"a_pos3d",type:"Int16",components:3}]);class xi extends d.E{constructor(t){super(),this._lastTilesetChange=nt(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,r){this.tileManager.update(t,r),this._renderableTilesKeys=[];const l={};for(const h of Ji(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.tileManager._source.calculateTileZoom}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),d.c7(h.terrainRttPosMatrix32f,0,d.a5,d.a5,0,0,1),this._tiles[h.key]=new we(h,this.tileSize),this._lastTilesetChange=nt());for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(t){for(const r in this._tiles){const l=this._tiles[r];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,r){return r?this._getTerrainCoordsForTileRanges(t,r):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const r={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID,_=t.clone(),v=d.bk();if(h.canonical.equals(t.canonical))d.c7(v,0,d.a5,d.a5,0,0,1);else if(h.canonical.isChildOf(t.canonical)){const b=h.canonical.z-t.canonical.z,S=h.canonical.x-(h.canonical.x>>b<<b),A=h.canonical.y-(h.canonical.y>>b<<b),z=d.a5>>b;d.c7(v,0,z,z,0,0,1),d.O(v,v,[-S*z,-A*z,0])}else{if(!t.canonical.isChildOf(h.canonical))continue;{const b=t.canonical.z-h.canonical.z,S=t.canonical.x-(t.canonical.x>>b<<b),A=t.canonical.y-(t.canonical.y>>b<<b),z=d.a5>>b;d.c7(v,0,d.a5,d.a5,0,0,1),d.O(v,v,[S*z,A*z,0]),d.Q(v,v,[1/2**b,1/2**b,0])}}_.terrainRttPosMatrix32f=new Float32Array(v),r[l]=_}return r}_getTerrainCoordsForTileRanges(t,r){const l={};for(const h of this._renderableTilesKeys){const _=this._tiles[h].tileID;if(!this._isWithinTileRanges(_,r))continue;const v=t.clone(),b=d.bk();if(_.canonical.z===t.canonical.z){const S=t.canonical.x-_.canonical.x,A=t.canonical.y-_.canonical.y;d.c7(b,0,d.a5,d.a5,0,0,1),d.O(b,b,[S*d.a5,A*d.a5,0])}else if(_.canonical.z>t.canonical.z){const S=_.canonical.z-t.canonical.z,A=_.canonical.x-(_.canonical.x>>S<<S),z=_.canonical.y-(_.canonical.y>>S<<S),R=t.canonical.x-(_.canonical.x>>S),I=t.canonical.y-(_.canonical.y>>S),F=d.a5>>S;d.c7(b,0,F,F,0,0,1),d.O(b,b,[-A*F+R*d.a5,-z*F+I*d.a5,0])}else{const S=t.canonical.z-_.canonical.z,A=t.canonical.x-(t.canonical.x>>S<<S),z=t.canonical.y-(t.canonical.y>>S<<S),R=(t.canonical.x>>S)-_.canonical.x,I=(t.canonical.y>>S)-_.canonical.y,F=d.a5<<S;d.c7(b,0,F,F,0,0,1),d.O(b,b,[A*d.a5+R*F,z*d.a5+I*F,0])}v.terrainRttPosMatrix32f=new Float32Array(b),l[h]=v}return l}getSourceTile(t,r){const l=this.tileManager._source;let h=t.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(h).key);let _=this.findTileInCaches(this._sourceTileCache[t.key]);if(!_?.dem&&r)for(;h>=l.minzoom&&!_?.dem;)_=this.findTileInCaches(t.scaledTo(h--).key);return _}findTileInCaches(t){let r=this.tileManager.getTileByID(t);return r||(r=this.tileManager._outOfViewCache.getByKey(t),r)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,r){return r[t.canonical.z]&&t.canonical.x>=r[t.canonical.z].minTileX&&t.canonical.x<=r[t.canonical.z].maxTileX&&t.canonical.y>=r[t.canonical.z].minTileY&&t.canonical.y<=r[t.canonical.z].maxTileY}}class Yt{constructor(t,r,l){this._meshCache={},this.painter=t,this.tileManager=new xi(r),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,r,l,h=d.a5){var _;if(!(r>=0&&r<h&&l>=0&&l<h))return 0;const v=this.getTerrainData(t),b=(_=v.tile)===null||_===void 0?void 0:_.dem;if(!b)return 0;const S=d.cC([],[r/h*d.a5,l/h*d.a5],v.u_terrain_matrix),A=[S[0]*b.dim,S[1]*b.dim],z=Math.floor(A[0]),R=Math.floor(A[1]),I=A[0]-z,F=A[1]-R;return b.get(z,R)*(1-I)*(1-F)+b.get(z+1,R)*I*(1-F)+b.get(z,R+1)*(1-I)*F+b.get(z+1,R+1)*I*F}getElevationForLngLatZoom(t,r){if(!d.cD(r,t.wrap()))return 0;const{tileID:l,mercatorX:h,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(t,r);return this.getElevation(l,h%d.a5,_%d.a5,d.a5)}getElevationForLngLat(t,r){const l=Ji(r,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this});let h=0;for(const _ of l)_.canonical.z>h&&(h=Math.min(_.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(t,h)}getElevation(t,r,l,h=d.a5){return this.getDEMElevation(t,r,l,h)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const h=this.painter.context,_=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new d.T(h,_,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new d.T(h,new d.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.ar([])}const r=this.tileManager.getSourceTile(t,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const h=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new d.T(h,r.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),r.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const l=r&&r.toString()+r.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const h=this.tileManager.getSource().maxzoom;let _=t.canonical.z-r.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=h?_=t.canonical.z-h:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=t.canonical.x-(t.canonical.x>>_<<_),b=t.canonical.y-(t.canonical.y>>_<<_),S=d.cE(new Float64Array(16),[1/(d.a5<<_),1/(d.a5<<_),0]);d.O(S,S,[v*d.a5,b*d.a5,0]),this._demMatrixCache[t.key]={matrix:S,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(t){const r=this.painter,l=r.width/devicePixelRatio,h=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new d.T(r.context,{width:l,height:h,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new d.T(r.context,{width:l,height:h,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,v=0;_<this._coordsTextureSize;_++)for(let b=0;b<this._coordsTextureSize;b++,v+=4)r[v+0]=255&b,r[v+1]=255&_,r[v+2]=b>>8<<4|_>>8,r[v+3]=0;const l=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),h=new d.T(t,l,t.gl.RGBA,{premultiply:!1});return h.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),l=this.painter.context,h=l.gl,_=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(_,b-v-1,1,1,h.RGBA,h.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null);const S=r[0]+(r[2]>>4<<8),A=r[1]+((15&r[2])<<8),z=this.coordsIndex[255-r[3]],R=z&&this.tileManager.getTileByID(z);if(!R)return null;const I=this._coordsTextureSize,F=(1<<R.tileID.canonical.z)*I;return new d.a9((R.tileID.canonical.x*I+S)/F+R.tileID.wrap,(R.tileID.canonical.y*I+A)/F,this.getElevation(R.tileID,S,A,I))}depthAtPoint(t){const r=new Uint8Array(4),l=this.painter.context,h=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(t){var r;const l=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,h=l&&t.canonical.y===0,_=l&&t.canonical.y===(1<<t.canonical.z)-1,v=`m_${h?"n":""}_${_?"s":""}`;if(this._meshCache[v])return this._meshCache[v];const b=this.painter.context,S=new d.cF,A=new d.aY,z=this.meshSize,R=d.a5/z,I=z*z;for(let ie=0;ie<=z;ie++)for(let pe=0;pe<=z;pe++)S.emplaceBack(pe*R,ie*R,0);for(let ie=0;ie<I;ie+=z+1)for(let pe=0;pe<z;pe++)A.emplaceBack(pe+ie,z+pe+ie+1,z+pe+ie+2),A.emplaceBack(pe+ie,z+pe+ie+2,pe+ie+1);const F=S.length,U=F+(z+1),$=(z+1)*z,Q=h?d.br:0,Y=h?0:1,J=_?d.bs:d.a5,re=_?0:1;for(let ie=0;ie<=z;ie++)S.emplaceBack(ie*R,Q,Y);for(let ie=0;ie<=z;ie++)S.emplaceBack(ie*R,J,re);for(let ie=0;ie<z;ie++)A.emplaceBack($+ie,U+ie,U+ie+1),A.emplaceBack($+ie,U+ie+1,$+ie+1),A.emplaceBack(0+ie,F+ie+1,F+ie),A.emplaceBack(0+ie,0+ie+1,F+ie+1);const K=S.length,ae=K+2*(z+1);for(const ie of[0,1])for(let pe=0;pe<=z;pe++)for(const ze of[0,1])S.emplaceBack(ie*d.a5,pe*R,ze);for(let ie=0;ie<2*z;ie+=2)A.emplaceBack(K+ie,K+ie+1,K+ie+3),A.emplaceBack(K+ie,K+ie+3,K+ie+2),A.emplaceBack(ae+ie,ae+ie+3,ae+ie+1),A.emplaceBack(ae+ie,ae+ie+2,ae+ie+3);const le=new Li(b.createVertexBuffer(S,Qt.members),b.createIndexBuffer(A),d.aX.simpleSegment(0,0,S.length,A.length));return this._meshCache[v]=le,le}getMeshFrameDelta(t){return 2*Math.PI*d.bE/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,r){var l;if(!d.cD(r,t.wrap()))return 0;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(t,r);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const r=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return r&&r.dem&&(l.minElevation=r.dem.min*this.exaggeration,l.maxElevation=r.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,r){const l=d.a9.fromLngLat(t.wrap()),h=(1<<r)*d.a5,_=l.x*h,v=l.y*h,b=Math.floor(_/d.a5),S=Math.floor(v/d.a5);return{tileID:new d.a2(r,0,r,b,S),mercatorX:_,mercatorY:v}}}class an{constructor(t,r,l){this._context=t,this._size=r,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new d.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(l.texture),{id:t,fbo:r,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((r=>t.id!==r)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const Mr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Gr{constructor(t,r){this.painter=t,this.terrain=r,this.pool=new an(t.context,30,r.tileManager.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((l=>!t._layers[l].isHidden(r))),this._coordsAscending={};for(const l in t.tileManagers){this._coordsAscending[l]={};const h=t.tileManagers[l].getVisibleCoordinates(),_=t.tileManagers[l].getSource(),v=_ instanceof ua?_.terrainTileRanges:null;for(const b of h){const S=this.terrain.tileManager.getTerrainCoords(b,v);for(const A in S)this._coordsAscending[l][A]||(this._coordsAscending[l][A]=[]),this._coordsAscending[l][A].push(S[A])}}this._coordsAscendingStr={};for(const l of t._order){const h=t._layers[l],_=h.source;if(Mr[h.type]&&!this._coordsAscendingStr[_]){this._coordsAscendingStr[_]={};for(const v in this._coordsAscending[_])this._coordsAscendingStr[_][v]=this._coordsAscending[_][v].map((b=>b.key)).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsAscendingStr){const _=this._coordsAscendingStr[h][l.tileID.key];_&&_!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(t,r){if(t.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),h=t.type,_=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Mr[h]&&(this._prevType&&Mr[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(t.id),!v))return!0;if(Mr[this._prevType]||Mr[h]&&v){this._prevType=h;const b=this._stacks.length-1,S=this._stacks[b]||[];for(const A of this._renderableTiles){if(this.pool.isFull()&&(Dc(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(A),A.rtt[b]){const R=this.pool.getObjectForId(A.rtt[b].id);if(R.stamp===A.rtt[b].stamp){this.pool.useObject(R);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),A.rtt[b]={id:z.id,stamp:z.stamp},_.context.bindFramebuffer.set(z.fbo.framebuffer),_.context.clear({color:d.bp.transparent,stencil:0}),_.currentStencilSource=void 0;for(let R=0;R<S.length;R++){const I=_.style._layers[S[R]],F=I.source?this._coordsAscending[I.source][A.tileID.key]:[A.tileID];_.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),_._renderTileClippingMasks(I,F,!0),_.renderLayer(_,_.style.tileManagers[I.source],I,F,l),I.source&&(A.rttCoords[I.source]=this._coordsAscendingStr[I.source][A.tileID.key])}}return Dc(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),Mr[h]}return!1}}const Ko={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Jo=ge,Us={hash:!1,interactive:!0,bearingSnap:7,attributionControl:un,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},zh={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Yi{constructor(t,r,l=!1){this.mousedown=_=>{this.startMove(_,ve.mousePos(this.element,_)),ve.addEventListener(window,"mousemove",this.mousemove),ve.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.move(_,ve.mousePos(this.element,_))},this.mouseup=_=>{this._rotatePitchHandler.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ve.touchPos(this.element,_.targetTouches)[0],this.startMove(_,this._startPos),ve.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ve.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=ve.touchPos(this.element,_.targetTouches)[0],this.move(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const h=new Fu;this._rotatePitchHandler=new wr({clickTolerance:3,move:(_,v)=>{const b=r.getBoundingClientRect(),S=new d.P((b.bottom-b.top)/2,(b.right-b.left)/2);return{bearingDelta:d.cx(new d.P(_.x,v.y),v,S),pitchDelta:l?-.5*(v.y-_.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=t,ve.addEventListener(r,"mousedown",this.mousedown),ve.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),ve.addEventListener(r,"touchcancel",this.reset)}startMove(t,r){this._rotatePitchHandler.dragStart(t,r),ve.disableDrag()}move(t,r){const l=this.map,{bearingDelta:h,pitchDelta:_}=this._rotatePitchHandler.dragMove(t,r)||{};h&&l.setBearing(l.getBearing()+h),_&&l.setPitch(l.getPitch()+_)}off(){const t=this.element;ve.removeEventListener(t,"mousedown",this.mousedown),ve.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),ve.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ve.removeEventListener(window,"touchend",this.touchend),ve.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){ve.enableDrag(),ve.removeEventListener(window,"mousemove",this.mousemove),ve.removeEventListener(window,"mouseup",this.mouseup),ve.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ve.removeEventListener(window,"touchend",this.touchend)}}let qr;function ql(m,t,r,l=!1){if(l||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();const h=new d.V(m.lng,m.lat);if(m=new d.V(m.lng,m.lat),t){const _=new d.V(m.lng-360,m.lat),v=new d.V(m.lng+360,m.lat),b=r.locationToScreenPoint(m).distSqr(t);r.locationToScreenPoint(_).distSqr(t)<b?m=_:r.locationToScreenPoint(v).distSqr(t)<b&&(m=v)}for(;Math.abs(m.lng-r.center.lng)>180;){const _=r.locationToScreenPoint(m);if(_.x>=0&&_.y>=0&&_.x<=r.width&&_.y<=r.height)break;m.lng>r.center.lng?m.lng-=360:m.lng+=360}return m.lng!==h.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(m))?m:h}const Zl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Zu(m,t,r){const l=m.classList;for(const h in Zl)l.remove(`maplibregl-${r}-anchor-${h}`);l.add(`maplibregl-${r}-anchor-${t}`)}class Hu extends d.E{constructor(t){if(super(),this._onKeyPress=r=>{const l=r.code,h=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=r=>{const l=r.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=r=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();(r?.type==="terrain"||r?.type==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=ql(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),ve.setTransform(this._element,`${Zl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${h}`),ei.frameAsync(new AbortController).then((()=>{this._updateOpacity(r&&r.type==="moveend")})).catch((()=>{}))},this._onMove=r=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.l("dragstart"))),this.fire(new d.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=d.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=ve.create("div");const r=ve.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${l}px`),r.setAttributeNS(null,"width",`${h}px`),r.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const _=ve.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const v=ve.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const b=ve.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Y of S){const J=ve.createNS("http://www.w3.org/2000/svg","ellipse");J.setAttributeNS(null,"opacity","0.04"),J.setAttributeNS(null,"cx","10.5"),J.setAttributeNS(null,"cy","5.80029008"),J.setAttributeNS(null,"rx",Y.rx),J.setAttributeNS(null,"ry",Y.ry),b.appendChild(J)}const A=ve.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const z=ve.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(z);const R=ve.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const I=ve.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(I);const F=ve.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(6.0, 7.0)"),F.setAttributeNS(null,"fill","#FFFFFF");const U=ve.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");const $=ve.createNS("http://www.w3.org/2000/svg","circle");$.setAttributeNS(null,"fill","#000000"),$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"cx","5.5"),$.setAttributeNS(null,"cy","5.5"),$.setAttributeNS(null,"r","5.4999962");const Q=ve.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#FFFFFF"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962"),U.appendChild($),U.appendChild(Q),v.appendChild(b),v.appendChild(A),v.appendChild(R),v.appendChild(F),v.appendChild(U),r.appendChild(v),r.setAttributeNS(null,"height",l*this._scale+"px"),r.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(r),this._offset=d.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(r=>{r.preventDefault()})),this._element.addEventListener("mousedown",(r=>{r.preventDefault()})),Zu(this._element,this._anchor,"marker"),t&&t.className)for(const r of t.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ve.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=d.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const h=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var r,l;const h=(r=this._map)===null||r===void 0?void 0:r.terrain,_=this._map.transform.isLocationOccluded(this._lngLat);if(!h||_){const F=_?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==F&&(this._element.style.opacity=F))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const v=this._map,b=v.terrain.depthAtPoint(this._pos),S=v.terrain.getElevationForLngLat(this._lngLat,v.transform);if(v.transform.lngLatToCameraDepth(this._lngLat,S)-b<.006)return void(this._element.style.opacity=this._opacity);const A=-this._offset.y/v.transform.pixelsPerMeter,z=Math.sin(v.getPitch()*Math.PI/180)*A,R=v.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),I=v.transform.lngLatToCameraDepth(this._lngLat,S+z)-R>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&I&&this._popup.remove(),this._element.style.opacity=I?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=d.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,r){return(this._opacity===void 0||t===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const Xu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let vo=0,Gs=!1;const ca={maxWidth:100,unit:"metric"};function rn(m,t,r){const l=r&&r.maxWidth||100,h=m._container.clientHeight/2,_=m._container.clientWidth/2,v=m.unproject([_-l/2,h]),b=m.unproject([_+l/2,h]),S=Math.round(m.project(b).x-m.project(v).x),A=Math.min(l,S,m._container.clientWidth),z=v.distanceTo(b);if(r&&r.unit==="imperial"){const R=3.2808*z;R>5280?Ts(t,A,R/5280,m._getUIString("ScaleControl.Miles")):Ts(t,A,R,m._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?Ts(t,A,z/1852,m._getUIString("ScaleControl.NauticalMiles")):z>=1e3?Ts(t,A,z/1e3,m._getUIString("ScaleControl.Kilometers")):Ts(t,A,z,m._getUIString("ScaleControl.Meters"))}function Ts(m,t,r,l){const h=(function(_){const v=Math.pow(10,`${Math.floor(_)}`.length-1);let b=_/v;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:(function(S){const A=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*A)/A})(b),v*b})(r);m.style.width=t*(h/r)+"px",m.innerHTML=`${h}&nbsp;${l}`}const el={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},tl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Hl(m){if(m){if(typeof m=="number"){const t=Math.round(Math.abs(m)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,m),"top-left":new d.P(t,t),"top-right":new d.P(-t,t),bottom:new d.P(0,-m),"bottom-left":new d.P(t,-t),"bottom-right":new d.P(-t,-t),left:new d.P(m,0),right:new d.P(-m,0)}}if(m instanceof d.P||Array.isArray(m)){const t=d.P.convert(m);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:d.P.convert(m.center||[0,0]),top:d.P.convert(m.top||[0,0]),"top-left":d.P.convert(m["top-left"]||[0,0]),"top-right":d.P.convert(m["top-right"]||[0,0]),bottom:d.P.convert(m.bottom||[0,0]),"bottom-left":d.P.convert(m["bottom-left"]||[0,0]),"bottom-right":d.P.convert(m["bottom-right"]||[0,0]),left:d.P.convert(m.left||[0,0]),right:d.P.convert(m.right||[0,0])}}return Hl(new d.P(0,0))}const Zr=ge;O.AJAXError=d.cI,O.Event=d.l,O.Evented=d.E,O.LngLat=d.V,O.MercatorCoordinate=d.a9,O.Point=d.P,O.addProtocol=d.cJ,O.config=d.c,O.removeProtocol=d.cK,O.AttributionControl=mn,O.BoxZoomHandler=_o,O.CanvasSource=j,O.CooperativeGesturesHandler=ct,O.DoubleClickZoomHandler=kc,O.DragPanHandler=Ch,O.DragRotateHandler=lr,O.EdgeInsets=Ja,O.FullscreenControl=class extends d.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var t;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=r?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=ve.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ve.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=ve.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ve.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},O.GeoJSONSource=On,O.GeolocateControl=class extends d.E{constructor(m){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new d.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const r=new d.V(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,h=this._map.getBearing(),_=d.e({bearing:h},this.options.fitBoundsOptions),v=$i.fromLngLat(r,l);this._map.fitBounds(v,_,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const r=new d.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Gs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=ve.create("button","maplibregl-ctrl-geolocate",this._container),ve.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ve.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Hu({element:this._dotElement}),this._circleElement=ve.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Hu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(r=>{const l=r?.[0]instanceof ResizeObserverEntry;r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.l("trackuserlocationend")),this.fire(new d.l("userlocationlostfocus")))}))}},this.options=d.e({},Xu,m)}onAdd(m){return this._map=m,this._container=ve.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return d._(this,arguments,void 0,(function*(t=!1){if(qr!==void 0&&!t)return qr;if(window.navigator.permissions===void 0)return qr=!!window.navigator.geolocation,qr;try{qr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{qr=!!window.navigator.geolocation}return qr}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ve.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,vo=0,Gs=!1}_isOutOfMapMaxBounds(m){const t=this._map.getMaxBounds(),r=m.coords;return t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const m=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&m))return;const t=this._map.project(m),r=this._map.unproject([t.x+100,t.y]),l=m.distanceTo(r)/100,h=2*this._accuracy/l;this._circleElement.style.width=`${h.toFixed(2)}px`,this._circleElement.style.height=`${h.toFixed(2)}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":vo--,Gs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.l("trackuserlocationstart")),this.fire(new d.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),vo++,vo>1?(m={maximumAge:6e5,timeout:0},Gs=!0):(m=this.options.positionOptions,Gs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},O.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const t=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=ve.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=ve.create("button","maplibregl-ctrl-globe",this._container),ve.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){ve.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},O.Hash=Tn,O.ImageSource=ua,O.KeyboardHandler=Ti,O.LngLatBounds=$i,O.LogoControl=qu,O.Map=class extends Sn{constructor(m){var t,r;d.cG.mark(d.cH.create);const l=Object.assign(Object.assign(Object.assign({},Us),m),{canvasContextAttributes:Object.assign(Object.assign({},Us.canvasContextAttributes),m.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const h=new kn,_=new ko;if(l.minZoom!==void 0&&h.setMinZoom(l.minZoom),l.maxZoom!==void 0&&h.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&h.setMinPitch(l.minPitch),l.maxPitch!==void 0&&h.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&h.setRenderWorldCopies(l.renderWorldCopies),l.transformConstrain!==null&&h.setConstrainOverride(l.transformConstrain),super(h,_,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new js,this._controls=[],this._mapId=d.af(),this._lostContextStyle={style:null,images:null},this._contextLost=b=>{b.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const S of Object.values(this.style._layers))if(S.type==="custom"&&console.warn(`Custom layer with id '${S.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),S._listeners)for(const[A]of Object.entries(S._listeners))console.warn(`Custom layer with id '${S.id}' had event listeners for event '${A}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new d.l("webglcontextlost",{originalEvent:b}))},this._contextRestored=b=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new d.l("webglcontextrestored",{originalEvent:b}))},this._onMapScroll=b=>{if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ko),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this._zoomLevelsToOverscale=l.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=l.transformCameraUpdate,this.transformConstrain=l.transformConstrain,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,l.reduceMotion!==void 0&&(ei.prefersReducedMotion=l.reduceMotion),this._imageQueueHandle=Ct.addThrottleControl((()=>this.isMoving())),this._requestManager=new Pi(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let b=!1;const S=Mh((A=>{this._trackResize&&!this._removed&&(this.resize(A),this.redraw())}),50);this._resizeObserver=new ResizeObserver((A=>{b?S(A):b=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Gu(this,l),this._hash=l.hash&&new Tn(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,d.e({},l.fitBoundsOptions,{duration:0}))));const v=typeof l.style=="string"||((r=(t=l.style)===null||t===void 0?void 0:t.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,v),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new mn(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new qu,l.logoPosition),this.on("style.load",(()=>{if(v||this._resizeTransform(),this.transform.unmodified){const b=d.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(b)}})),this.on("data",(b=>{this._update(b.dataType==="style"),this.fire(new d.l(`${b.dataType}data`,b))})),this.on("dataloading",(b=>{this.fire(new d.l(`${b.dataType}dataloading`,b))})),this.on("dataabort",(b=>{this.fire(new d.l("sourcedataabort",b))}))}_getMapId(){return this._mapId}setGlobalStateProperty(m,t){return this.style.setGlobalStateProperty(m,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,t){if(t===void 0&&(t=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new d.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=m.onAdd(this);this._controls.push(m);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(r,l.firstChild):l.appendChild(r),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new d.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(m);return t>-1&&this._controls.splice(t,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}coveringTiles(m){return Ji(this.transform,m)}calculateCameraOptionsFromTo(m,t,r,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLat(r,this.transform)),super.calculateCameraOptionsFromTo(m,t,r,l)}resize(m,t=!0){const[r,l]=this._containerDimensions(),h=this._getClampedPixelRatio(r,l);if(this._resizeCanvas(r,l,h),this.painter.resize(r,l,h),this.painter.overLimit()){const v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];const b=this._getClampedPixelRatio(r,l);this._resizeCanvas(r,l,b),this.painter.resize(r,l,b)}this._resizeTransform(t);const _=!this._moving;return _&&(this.stop(),this.fire(new d.l("movestart",m)).fire(new d.l("move",m))),this.fire(new d.l("resize",m)),_&&this.fire(new d.l("moveend",m)),this}_resizeTransform(m=!0){var t;const[r,l]=this._containerDimensions();this.transform.resize(r,l,m),(t=this._requestedCameraState)===null||t===void 0||t.resize(r,l,m)}_getClampedPixelRatio(m,t){const{0:r,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),_=m*h,v=t*h;return Math.min(_>r?r/_:1,v>l?l/v:1)*h}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds($i.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom){const t=this._getTransformForUpdate();return t.setMinZoom(m),this._applyUpdatedTransform(t),this._update(),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom){const t=this._getTransformForUpdate();return t.setMaxZoom(m),this._applyUpdatedTransform(t),this._update(),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}setTransformConstrain(m){return this.transform.setConstrainOverride(m),this._update()}project(m){return this.transform.locationToScreenPoint(d.V.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(d.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,t,r){if(m==="mouseenter"||m==="mouseover"){let l=!1;return{layers:t,listener:r,delegates:{mousemove:_=>{const v=t.filter((S=>this.getLayer(S))),b=v.length!==0?this.queryRenderedFeatures(_.point,{layers:v}):[];b.length?l||(l=!0,r.call(this,new Xn(m,this,_.originalEvent,{features:b}))):l=!1},mouseout:()=>{l=!1}}}}if(m==="mouseleave"||m==="mouseout"){let l=!1;return{layers:t,listener:r,delegates:{mousemove:v=>{const b=t.filter((S=>this.getLayer(S)));(b.length!==0?this.queryRenderedFeatures(v.point,{layers:b}):[]).length?l=!0:l&&(l=!1,r.call(this,new Xn(m,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,r.call(this,new Xn(m,this,v.originalEvent)))}}}}{const l=h=>{const _=t.filter((b=>this.getLayer(b))),v=_.length!==0?this.queryRenderedFeatures(h.point,{layers:_}):[];v.length&&(h.features=v,r.call(this,h),delete h.features)};return{layers:t,listener:r,delegates:{[m]:l}}}}_saveDelegatedListener(m,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(t)}_removeDelegatedListener(m,t,r){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const l=this._delegatedListeners[m];for(let h=0;h<l.length;h++){const _=l[h];if(_.listener===r&&_.layers.length===t.length&&_.layers.every((v=>t.includes(v)))){for(const v in _.delegates)this.off(v,_.delegates[v]);return void l.splice(h,1)}}}on(m,t,r){if(r===void 0)return super.on(m,t);const l=typeof t=="string"?[t]:t,h=this._createDelegatedListener(m,l,r);this._saveDelegatedListener(m,h);for(const _ in h.delegates)this.on(_,h.delegates[_]);return{unsubscribe:()=>{this._removeDelegatedListener(m,l,r)}}}once(m,t,r){if(r===void 0)return super.once(m,t);const l=typeof t=="string"?[t]:t,h=this._createDelegatedListener(m,l,r);for(const _ in h.delegates){const v=h.delegates[_];h.delegates[_]=(...b)=>{this._removeDelegatedListener(m,l,r),v(...b)}}this._saveDelegatedListener(m,h);for(const _ in h.delegates)this.once(_,h.delegates[_]);return this}off(m,t,r){return r===void 0?super.off(m,t):(this._removeDelegatedListener(m,typeof t=="string"?[t]:t,r),this)}queryRenderedFeatures(m,t){if(!this.style)return[];let r;const l=m instanceof d.P||Array.isArray(m),h=l?m:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:m)||{},h instanceof d.P||typeof h[0]=="number")r=[d.P.convert(h)];else{const _=d.P.convert(h[0]),v=d.P.convert(h[1]);r=[_,new d.P(v.x,_.y),v,new d.P(_.x,v.y),_]}return this.style.queryRenderedFeatures(r,t,this.transform)}querySourceFeatures(m,t){return this.style.querySourceFeatures(m,t)}setStyle(m,t){return(t=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(m,t))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const t=this._locale[m];if(t==null)throw new Error(`Missing UI string '${m}'`);return t}_updateStyle(m,t){var r,l;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(m,t)));const h=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new so(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,t,h):this.style.loadJSON(m,t,h),this):((l=(r=this.style)===null||r===void 0?void 0:r.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new so(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,t){if(typeof m=="string"){const r=this._requestManager.transformRequest(m,"Style");d.j(r,new AbortController).then((l=>{this._updateDiff(l.data,t)})).catch((l=>{l&&this.fire(new d.k(l))}))}else typeof m=="object"&&this._updateDiff(m,t)}_updateDiff(m,t){try{this.style.setState(m,t)&&this._update(!0)}catch(r){d.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(m,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(m,t){return this._lazyInitEmptyStyle(),this.style.addSource(m,t),this._update(!0)}isSourceLoaded(m){const t=this.style&&this.style.tileManagers[m];if(t!==void 0)return t.loaded();this.fire(new d.k(new Error(`There is no tile manager with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const t=this.style.tileManagers[m.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&t.reload();for(const r in this.style._layers){const l=this.style._layers[r];l.type==="hillshade"&&l.source===m.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===m.source&&d.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Yt(this.painter,t,m),this.painter.renderToTexture=new Gr(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{var l;r.dataType==="style"?this.terrain.tileManager.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=r.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new d.l("terrain",{terrain:m})),this}getTerrain(){var m,t;return(t=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const m=this.style&&this.style.tileManagers;for(const t of Object.values(m))if(!t.areTilesLoaded())return!1;return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,t,r){if(r){const l=this.getSource(r);if(!l)throw new Error(`There is no source with ID "${r}", cannot set LOD parameters`);l.calculateTileZoom=ni(Math.max(1,m),Math.max(1,t))}else for(const l in this.style.tileManagers)this.style.tileManagers[l].getSource().calculateTileZoom=ni(Math.max(1,m),Math.max(1,t));return this._update(!0),this}refreshTiles(m,t){const r=this.style.tileManagers[m];if(!r)throw new Error(`There is no tile manager with ID "${m}", cannot refresh tile`);t===void 0?r.reload(!0):r.refreshTiles(t.map((l=>new d.ac(l.z,l.x,l.y))))}addImage(m,t,r={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:_,stretchY:v,content:b,textFitWidth:S,textFitHeight:A}=r;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||d.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:R,data:I}=t,F=t;return this.style.addImage(m,{data:new d.R({width:z,height:R},new Uint8Array(I)),pixelRatio:l,stretchX:_,stretchY:v,content:b,textFitWidth:S,textFitHeight:A,sdf:h,version:0,userImage:F}),F.onAdd&&F.onAdd(this,m),this}}{const{width:z,height:R,data:I}=ei.getImageData(t);this.style.addImage(m,{data:new d.R({width:z,height:R},I),pixelRatio:l,stretchX:_,stretchY:v,content:b,textFitWidth:S,textFitHeight:A,sdf:h,version:0})}}updateImage(m,t){const r=this.style.getImage(m);if(!r)return this.fire(new d.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||d.b(t)?ei.getImageData(t):t,{width:h,height:_,data:v}=l;if(h===void 0||_===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==r.data.width||_!==r.data.height)return this.fire(new d.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(t instanceof HTMLImageElement||d.b(t));return r.data.replace(v,b),this.style.updateImage(m,r),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new d.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return Ct.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,t){return this._lazyInitEmptyStyle(),this.style.addLayer(m,t),this._update(!0)}moveLayer(m,t){return this.style.moveLayer(m,t),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,t,r){return this.style.setLayerZoomRange(m,t,r),this._update(!0)}setFilter(m,t,r={}){return this.style.setFilter(m,t,r),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,t,r,l={}){return this.style.setPaintProperty(m,t,r,l),this._update(!0)}getPaintProperty(m,t){return this.style.getPaintProperty(m,t)}setLayoutProperty(m,t,r,l={}){return this.style.setLayoutProperty(m,t,r,l),this._update(!0)}getLayoutProperty(m,t){return this.style.getLayoutProperty(m,t)}setGlyphs(m,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,t,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,t,r,(l=>{l||this._update(!0)})),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,t,(r=>{r||this._update(!0)})),this}setLight(m,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,t){return this.style.setFeatureState(m,t),this._update()}removeFeatureState(m,t){return this.style.removeFeatureState(m,t),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,t=0;return this._container&&(m=this._container.clientWidth||400,t=this._container.clientHeight||300),[m,t]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const t=this._canvasContainer=ve.create("div","maplibregl-canvas-container",m);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=ve.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),l=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],l);const h=this._controlContainer=ve.create("div","maplibregl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((v=>{_[v]=ve.create("div",`maplibregl-ctrl-${v} `,h)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,t,r){this._canvas.width=Math.floor(r*m),this._canvas.height=Math.floor(r*t),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{t={requestedAttributes:m},l&&(t.statusMessage=l.statusMessage,t.type=l.type)}),{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!r){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new Nf(r,this.transform),ti.testSupport(r)}migrateProjection(m,t){super.migrateProjection(m,t),this.painter.transform=m,this.fire(new d.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var t,r,l,h,_;const v=this._idleTriggered?this._fadeDuration:0,b=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let S=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,I=nt();this.style.zoomHistory.update(R,I);const F=new d.H(R,{now:I,fadeDuration:v,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),U=F.crossFadingFactor();U===1&&U===this._crossFadingFactor||(S=!0,this._crossFadingFactor=U),this.style.update(F)}const A=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==b;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(_=this.style.projection)===null||_===void 0?void 0:_.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||A)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,A),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,showPadding:this.showPadding}),this.fire(new d.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.cG.mark(d.cH.load),this.fire(new d.l("load"))),this.style&&(this.style.hasTransitions()||S)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const z=this._sourcesDirty||this._styleDirty||this._placementDirty;return z||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.l("idle")),!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,d.cG.mark(d.cH.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ct.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ve.remove(this._canvasContainer),ve.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),d.cG.clearMetrics(),this._removed=!0,this.fire(new d.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ei.frame(this._frameRequest,(m=>{d.cG.frame(m),this._frameRequest=null;try{this._render(m)}catch(t){if(!d.Z(t)&&!(function(r){return r.message===mo})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Jo}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},O.MapMouseEvent=Xn,O.MapTouchEvent=Vr,O.MapWheelEvent=Pc,O.Marker=Hu,O.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const t=this._map.getZoom(),r=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,r)=>{const l=this._map._getUIString(`NavigationControl.${r}`);t.title=l,t.setAttribute("aria-label",l)},this.options=d.e({},zh,m),this._container=ve.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),ve.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),ve.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=ve.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yi(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ve.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,t){const r=ve.create("button",m,this._container);return r.type="button",r.addEventListener("click",t),r}},O.Popup=class extends d.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&ve.remove(this._content),this._container&&(ve.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ve.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ve.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=ql(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const r=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const h=Hl(this.options.offset);if(!l){const v=this._container.offsetWidth,b=this._container.offsetHeight;let S;S=r.y+h.bottom.y<b?["top"]:r.y>this._map.transform.height-b?["bottom"]:[],r.x<v/2?S.push("left"):r.x>this._map.transform.width-v/2&&S.push("right"),l=S.length===0?"bottom":S.join("-")}let _=r.add(h[l]);this.options.subpixelPositioning||(_=_.round()),ve.setTransform(this._container,`${Zl[l]} translate(${_.x}px,${_.y}px)`),Zu(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(el),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=d.V.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const t=document.createDocumentFragment(),r=document.createElement("body");let l;for(r.innerHTML=m;l=r.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ve.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=ve.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(tl);m&&m.focus()}},O.RasterDEMTileSource=Gn,O.RasterTileSource=es,O.ScaleControl=class{constructor(m){this._onMove=()=>{rn(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,rn(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ca),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=ve.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ve.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},O.ScrollZoomHandler=ju,O.Style=so,O.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=ve.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ve.create("button","maplibregl-ctrl-terrain",this._container),ve.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ve.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},O.TwoFingersTouchPitchHandler=Ns,O.TwoFingersTouchRotateHandler=Vu,O.TwoFingersTouchZoomHandler=bs,O.TwoFingersTouchZoomRotateHandler=Wo,O.VectorTileSource=Br,O.VideoSource=ye,O.addSourceType=(m,t)=>d._(void 0,void 0,void 0,(function*(){if(H(m))throw new Error(`A source type called "${m}" already exists.`);((r,l)=>{V[r]=l})(m,t)})),O.clearPrewarmedResources=function(){const m=Xt;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(yt),Xt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},O.createTileMesh=Ef,O.getMaxParallelImageRequests=function(){return d.c.MAX_PARALLEL_IMAGE_REQUESTS},O.getRTLTextPluginStatus=function(){return _e().getRTLTextPluginStatus()},O.getVersion=function(){return Zr},O.getWorkerCount=function(){return xt.workerCount},O.getWorkerUrl=function(){return d.c.WORKER_URL},O.importScriptInWorkers=function(m){return Un().broadcast("IS",m)},O.isTimeFrozen=function(){return tt.isFrozen()},O.now=nt,O.prewarm=function(){wi().acquire(yt)},O.restoreNow=function(){tt.restoreNow()},O.setMaxParallelImageRequests=function(m){d.c.MAX_PARALLEL_IMAGE_REQUESTS=m},O.setNow=function(m){tt.setNow(m)},O.setRTLTextPlugin=function(m,t){return _e().setRTLTextPlugin(m,t)},O.setWorkerCount=function(m){xt.workerCount=m},O.setWorkerUrl=function(m){d.c.WORKER_URL=m}}));var _t=Ne;return _t}))})(fg)),fg.exports}var zy=Cy();const Zg=gy(zy),dg="ottawa",Dy={version:8,sources:{googleSat:{type:"raster",tiles:["https://mt0.google.com/vt/lyrs=s&hl=en&x={x}&y={y}&z={z}","https://mt1.google.com/vt/lyrs=s&hl=en&x={x}&y={y}&z={z}","https://mt2.google.com/vt/lyrs=s&hl=en&x={x}&y={y}&z={z}","https://mt3.google.com/vt/lyrs=s&hl=en&x={x}&y={y}&z={z}"],tileSize:256,attribution:" Google"}},layers:[{id:"base",type:"raster",source:"googleSat",paint:{"raster-opacity":1}}]},xf="roads-source",am="roads-base",lc="roads-line",xl="roads-label",Hg="roads",em=2,Py=14,Iy=["Carling Avenue","Hunt Club Road","West Hunt Club Road","Somerset Street West","Bank Street","Rideau Street","Elgin Street","Laurier Avenue","Laurier Avenue West","Wellington Street","Bronson Avenue","Baseline Road","Merivale Road","Woodroffe Avenue","Greenbank Road","Fisher Avenue","Riverside Drive","St. Laurent Boulevard","Montreal Road","Innes Road","Blair Road","Prince of Wales Drive","Heron Road","Main Street","Lees Avenue","King Edward Avenue","Nicholas Street","Scott Street","Richmond Road","Island Park Drive","Parkdale Avenue","Terry Fox Drive","March Road","Kichi Zibi Mikan","Alexandra Bridge","Champlain Bridge","Chaudire Bridge","Macdonald-Cartier Bridge","Portage Bridge","Hazeldean Road","Eagleson Road","Campeau Drive","Kanata Avenue","Robertson Road","Moodie Drive","Fallowfield Road","Strandherd Drive","Leitrim Road","Tenth Line Road","Walkley Road","Promenade Vanier Parkway","Industrial Avenue","Colonel By Drive","Queen Elizabeth Driveway","Sussex Drive","George Street","York Street","Clarence Street","Dalhousie Street","Slater Street","Albert Street","Metcalfe Street","O'Connor Street","Booth Street","Wellington Street West","Maitland Avenue","Gladstone Avenue","Ogilvie Road","St. Joseph Boulevard","Jeanne D'Arc Boulevard"],Ry=["Route du Fleuve (Route 138)","Pont Champlain","Pont Jacques-Cartier","Tunnel Louis-Hippolyte-La Fontaine","Pont Honor-Mercier","Rue Sainte-Catherine Ouest","Rue Sainte-Catherine Est","Boulevard Ren-Lvesque Ouest","Boulevard Ren-Lvesque Est","Rue Sherbrooke Ouest","Rue Sherbrooke Est","Boulevard De Maisonneuve Ouest","Boulevard De Maisonneuve Est","Rue Notre-Dame Ouest","Rue Notre-Dame Est","Boulevard Saint-Laurent","Rue Saint-Denis","Chemin de la Cte-des-Neiges","Boulevard Robert-Bourassa","Boulevard Dcarie","Boulevard Pie-IX","Boulevard Saint-Michel","Boulevard Lacordaire","Boulevard Langelier","Boulevard Jean-Talon Ouest","Boulevard Jean-Talon Est","Boulevard Henri-Bourassa Ouest","Boulevard Henri-Bourassa Est","Boulevard Crmazie","Boulevard Mtropolitain","Boulevard Cur-Labelle","Boulevard des Laurentides","Boulevard Saint-Martin Ouest","Boulevard Saint-Martin Est","Boulevard Taschereau","Boulevard Marie-Victorin","Chemin de Chambly","Boulevard Lapinire"],Ly=["Albert Street","Frontenac Street","Alfred Street","University Avenue","Aberdeen Street","Division Street","Princess Street","Johnson Street","Bagot Street","Barrie Street","Queen Street","King Street","Mack Street","Nelson Street","Earl Street","Union Street","Arch Street","Stuart Street","Brock Street","William Street","Collingwood Street","Victoria Street","Clergy Street","Bader Lane"],By=["417","416","174"],Oy=["Autoroute Bonaventure (A-10)","Autoroute Chomedey (A-13)","Autoroute Dcarie (A-15)","Autoroute Jean-Lesage (A-20)","Autoroute Louis-Hippolyte-La Fontaine (A-25)","Autoroute de la Montrgie (A-30)","Autoroute Flix-Leclerc (A-40)","Route de la Valle-du-Richelieu (Route 116)","Route Marie-Victorin (Route 132)"],tm={ottawa:Iy,montreal:Ry,kingston:Ly},Xg={ottawa:By,montreal:Oy,kingston:[]},ky=[...tm.ottawa,...tm.montreal],pa=te=>te.trim().toLowerCase(),mg=new Set(ky.map(te=>pa(te))),Fy=["George Street","York Street","Clarence Street","St. Patrick Street","Albert Street"],pg=new Set(Fy.map(te=>pa(te))),a_=new Map([["10","Autoroute Bonaventure (A-10)"],["13","Autoroute Chomedey (A-13)"],["15","Autoroute Dcarie (A-15)"],["20","Autoroute Jean-Lesage (A-20)"],["25","Autoroute Louis-Hippolyte-La Fontaine (A-25)"],["30","Autoroute de la Montrgie (A-30)"],["40","Autoroute Flix-Leclerc (A-40)"],["116","Route de la Valle-du-Richelieu (Route 116)"],["132","Route Marie-Victorin (Route 132)"],["138","Route du Fleuve (Route 138)"],["117","Route du Nord (Route 117)"]].map(([te,Ee])=>[pa(te),Ee])),B_=new Map([["Pont Alexandra","Alexandra Bridge"],["Pont Champlain Bridge","Champlain Bridge"],["Pont Macdonald-Cartier Bridge","Macdonald-Cartier Bridge"],["Pont du Portage","Portage Bridge"],["Pont du Portage Bridge","Portage Bridge"],["Pont de la Chaudire","Chaudire Bridge"]].map(([te,Ee])=>[pa(te),Ee])),Ny=new Map([["King Street East","King Street"],["King Street West","King Street"]].map(([te,Ee])=>[pa(te),Ee])),$g=(te,Ee)=>[...te.map(Ne=>pa(Ne)),...Ee.map(Ne=>pa(Ne))],Yg={ottawa:$g(tm.ottawa,Xg.ottawa),montreal:$g(tm.montreal,Xg.montreal),kingston:$g(tm.kingston,Xg.kingston)},Qg=[-76.046145,45.179021,-75.368409,45.57046],Wg=[-73.953278,45.394652,-73.353682,45.697687],rg=[-76.544148,44.195596,-76.425662,44.290928],O_=[-.009,-.013],Kg=(te,Ee=.8,Ne=.4)=>[te[0]-Ee,te[1]-Ne,te[2]+Ee,te[3]+Ne],sg=te=>[(te[0]+te[2])/2,(te[1]+te[3])/2],zo={ottawa:{label:"Ottawa",center:sg(Qg),zoom:11.5,tileBounds:Qg,mapBounds:Kg(Qg),tilePath:"assets/tiles/ottawa/{z}/{x}/{y}.pbf",catalogPath:"assets/roads/ottawa.json",tagline:"Memorize high traffic roads in Canada's Capital.",defaultTokens:Yg.ottawa},montreal:{label:"Montreal",center:sg(Wg),zoom:11.5,tileBounds:Wg,mapBounds:Kg(Wg),tilePath:"assets/tiles/montreal/{z}/{x}/{y}.pbf",catalogPath:"assets/roads/montreal.json",tagline:"Memorize high traffic roads in Montreal.",defaultTokens:Yg.montreal},kingston:{label:"Queen's University",selectLabel:"Kingston (Queen's University)",center:[sg(rg)[0]+O_[0],sg(rg)[1]+O_[1]],zoom:14,tileBounds:rg,mapBounds:Kg(rg),tilePath:"assets/tiles/kingston/{z}/{x}/{y}.pbf",catalogPath:"assets/roads/kingston.json",tagline:"Memorize key streets around Queen's University.",defaultTokens:Yg.kingston}},q_=te=>{if(typeof window>"u")return te;const Ee=new URL("/Road-Learning-Tool/",window.location.href);return`${Ee.href.endsWith("/")?Ee.href:`${Ee.href}/`}${te.replace(/^\/+/,"")}`},Vy=te=>q_(zo[te].tilePath),jy=te=>q_(zo[te].catalogPath),o_="quiz",Uy={ottawa:"ottawa",montreal:"montreal",kingston:"kingston_queens_university"},Gy={ottawa:["","ottawa"],montreal:["montreal"],kingston:["kingston_queens_university","kingston"]},Z_=()=>{const te=new URL("/Road-Learning-Tool/",window.location.href);return te.pathname.endsWith("/")?te.pathname:`${te.pathname}/`},im=te=>te.endsWith("/")?te:`${te}/`,H_=te=>{const Ee=im(Z_()).toLowerCase();let Ne=im(te).toLowerCase();Ne.startsWith(Ee)&&(Ne=Ne.slice(Ee.length));const fe=Ne.replace(/^\/+/,"").replace(/\/+$/,"");return fe?fe.split("/"):[]},qy=te=>{const Ee=H_(te);if(!Ee.length||Ee[0]===o_)return dg;for(const[Ne,fe]of Object.entries(Gy))if(fe.includes(Ee[0]))return Ne;return dg},Zy=te=>{const Ee=H_(te);return Ee.length?Ee.includes(o_):!1},Hy=te=>{let Ee=0;for(let fe=0;fe<te.length;fe+=1)Ee=(Ee<<5)-Ee+te.charCodeAt(fe),Ee|=0;return`hsl(${Math.abs(Ee)%360}, 70%, 55%)`},Jg=(te,Ee=.55)=>{const Ne=["to-rgba",["to-color",te]];return["case",["<",["+",["*",.2126,["at",0,Ne]],["*",.7152,["at",1,Ne]],["*",.0722,["at",2,Ne]]],["*",Ee,255]],"#ffffff","#111111"]},Xy="#f28c5f",$y="#ffffff85",Yy="#4fb360ff",Qy="#dd5656ff",Wy={[pa("Parkdale Avenue")]:"#2563eb",[pa("Bank Street")]:"#b5d2a6ff",[pa("Wellington Street")]:"#d23d3dff",[pa("West Hunt CLub Road")]:"#0095ffff",[pa("Hazeldean Road")]:"#a22c57ff",[pa("University Avenue")]:"#d66d94ff",[pa("Albert Street")]:"#bfa6ecff",[pa("Mack Street")]:"#5ad0b6ff",[pa("Union Street")]:"#ffa16fff",[pa("Queen Elizabeth Driveway")]:"#6d0978ff",[pa("Terry Fox Drive")]:"#eb5c5cff",[pa("Ogilvie Road")]:"#0a9396ff"},Ky=["coalesce",["get","name:en"],["get","name"],["get","name_en"],""],bf=["downcase",Ky],X_=["downcase",["coalesce",["get","name"],""]],$_=["downcase",["coalesce",["get","name:en"],["get","name_en"],""]],Y_=[X_,$_],nm=te=>["any",...Y_.map(Ee=>["in",Ee,["literal",te]])],Gd=["downcase",["coalesce",["get","ref"],""]],k_="main street",Jy=pa("Booth Street"),Q_="Chaudire Bridge",F_=pa("Rue Clarence"),ev=[-75.72,45.39,-75.64,45.44],W_=te=>({type:"Polygon",coordinates:[[[te[0],te[1]],[te[2],te[1]],[te[2],te[3]],[te[0],te[3]],[te[0],te[1]]]]}),tv=W_(ev),iv=[-75.7202,45.4199,-75.7177,45.4226],nv=W_(iv),N_=["any",["!=",bf,k_],["all",["==",bf,k_],["within",tv]]],_g=["all",["within",nv],["==",bf,Jy]],av=_g,rv=["all",["!=",X_,F_],["!=",$_,F_]],r_=["coalesce",["get","name"],["get","name:en"],["get","name_en"],["get","ref"],""],sv=["coalesce",["get","name:en"],["get","name_en"],["get","name"],["get","ref"],""],ov=te=>{let Ee=sv;if(B_.size){const Ne=[];for(const[fe,Ye]of B_)Ne.push(["==",bf,fe],Ye);Ee=["case",...Ne,Ee]}return te?["case",_g,Q_,Ee]:Ee},lv=()=>{if(!a_.size)return r_;const te=["concat",";",["downcase",["coalesce",["get","ref"],""]],";"],Ee=[];for(const[Ne,fe]of a_)Ee.push(["in",`;${Ne};`,te],fe);return["case",...Ee,r_]},e_=(te,Ee)=>te==="ottawa"?ov(Ee?.useChaudiereBridgeOverride??!1):te==="montreal"?lv():r_,yg=3,l_=1,uv=/[^a-z0-9]+/i,gg=/^\d+$/,cv=["motorway","motorway_link","trunk","trunk_link","primary","primary_link","secondary","secondary_link","tertiary","tertiary_link"],t_=["in",["get","highway"],["literal",cv]],hv=new Set(["n","s","e","w","o","north","south","east","west","nord","sud","est","ouest"]),uc=te=>te.trim().toLowerCase(),K_=te=>te.normalize("NFD").replace(/[\u0300-\u036f]/g,""),J_=te=>K_(te.trim().toLowerCase()),fv=J_(Q_),dv=(te,Ee)=>te.find(Ne=>J_(Ne)===Ee),u_=te=>dv(te,fv),ey=te=>!!u_(te),vg=te=>{const Ee=te.split(uv).filter(Boolean);if(!Ee.length)return[];const Ne=Ee.filter(fe=>fe.length>=2||gg.test(fe));return Ne.length?Ne:Ee},xg=te=>vg(K_(te)),qd=(te,Ee,Ne)=>{const fe=vg(te);if(!fe.length)return["==",1,0];if(fe.length>1)return["all",...fe.map(O=>["in",O,Ee])];const[Ye]=fe;return Ye.length<Ne?["==",Ee,Ye]:["in",Ye,Ee]},V_=(te,Ee)=>gg.test(te)||gg.test(Ee),c_=te=>xg(te),j_=(te,Ee)=>!te||!Ee?!1:gg.test(te)||te.length<yg?Ee===te:Ee===te?!0:Ee.endsWith("s")&&Ee.slice(0,-1)===te,pv=(te,Ee)=>{if(Ee.length<te.length)return!1;if(Ee.length===te.length)return!0;for(let Ne=te.length;Ne<Ee.length;Ne+=1)if(!hv.has(Ee[Ne]))return!1;return!0},bg=(te,Ee)=>{if(!te.length||!Ee.length)return!1;if(te.length===1)return Ee.some(Ne=>j_(te[0],Ne));if(Ee.length<te.length)return!1;for(let Ne=0;Ne<te.length;Ne+=1)if(!j_(te[Ne],Ee[Ne]))return!1;return!!pv(te,Ee)},h_=(te,Ee)=>!te.length||!Ee.length?!1:te.length===1?Ee.includes(te[0]):te.every(Ne=>Ee.includes(Ne)),U_=te=>{const Ee=[],Ne=[],fe=[];for(const Ye of te)pg.has(Ye)?Ne.push(Ye):mg.has(Ye)?Ee.push(Ye):fe.push(Ye);return{majorPopular:Ee,residentialPopular:Ne,other:fe}},mv=(te,Ee,Ne)=>{if(Ne.length===1){const _t=te.parts[0]===Ne[0],O=Ee.parts[0]===Ne[0];if(_t!==O)return _t}const fe=te.parts.length===Ne.length,Ye=Ee.parts.length===Ne.length;return fe!==Ye?fe:te.parts.length!==Ee.parts.length?te.parts.length<Ee.parts.length:te.label.length!==Ee.label.length?te.label.length<Ee.label.length:te.label.localeCompare(Ee.label)<0},gv=(te,Ee,Ne)=>{const fe=Ne.nameLabelByNormalized.get(te);if(fe)return{normalized:te,label:fe};let Ye=null;for(const _t of Ne.nameEntries)bg(Ee,_t.parts)&&(!Ye||mv(_t,Ye,Ee))&&(Ye=_t);return Ye?{normalized:Ye.normalized,label:Ye.label}:null},Jp=(te,Ee)=>{if(!te.length)return null;const Ne=["any",...Y_.map(fe=>["in",fe,["literal",te]])];return Ee?["all",Ee,Ne]:Ne},_v=te=>{const Ee=O=>{const d=[],ge=new Map,Be=new Set;for(const ft of O){const ht=ft.trim();if(!ht)continue;const At=uc(ht);!At||Be.has(At)||(Be.add(At),ge.set(At,ht),d.push({label:ht,normalized:At,parts:c_(At)}))}return{entries:d,labelByNormalized:ge}},Ne=O=>{const d=new Map,ge=new Map;if(!O?.length)return{aliasByToken:d,aliasTokenByValue:ge};for(const Be of O){const ft=uc(Be.token??"");if(!ft)continue;const ht=(Be.names??[]).map(mt=>uc(mt)).filter(Boolean),At=(Be.refs??[]).map(mt=>uc(mt)).filter(Boolean);if(!ht.length&&!At.length)continue;const ei=Be.label?.trim()||void 0,tt=d.get(ft),nt=new Set([...tt?.names??[],...ht]),ve=new Set([...tt?.refs??[],...At]),ti={label:tt?.label??ei,names:Array.from(nt),refs:Array.from(ve)};d.set(ft,ti);for(const mt of ti.names)ge.set(mt,ft);for(const mt of ti.refs)ge.set(mt,ft)}return{aliasByToken:d,aliasTokenByValue:ge}},fe=Ee(te.names),Ye=Ee(te.refs),_t=Ne(te.aliases);return{nameEntries:fe.entries,refEntries:Ye.entries,nameLabelByNormalized:fe.labelByNormalized,refLabelByNormalized:Ye.labelByNormalized,aliasByToken:_t.aliasByToken,aliasTokenByValue:_t.aliasTokenByValue}},i_=(te,Ee,Ne)=>{const fe=Ee.map(tt=>({token:tt,parts:xg(tt)})),Ye=new Set,_t=new Set,O=new Set,d=new Map,ge=new Map,Be=new Map,ft=new Set,ht=new Map,At=te.aliasByToken;for(const tt of fe){Ye.add(tt.token),d.has(tt.token)||d.set(tt.token,new Set),d.get(tt.token).add(tt.token),_t.add(tt.token),ge.has(tt.token)||ge.set(tt.token,new Set),ge.get(tt.token).add(tt.token);const nt=te.nameLabelByNormalized.get(tt.token),ve=te.refLabelByNormalized.get(tt.token),ti=Ne?.get(tt.token),mt=At.get(tt.token);if(ti?(Be.set(tt.token,ti),ft.add(tt.token)):mt?.label?(Be.set(tt.token,mt.label),ft.add(tt.token)):nt?(Be.set(tt.token,nt),ft.add(tt.token)):ve&&(Be.set(tt.token,ve),ft.add(tt.token)),mg.has(tt.token)){const Ft=nt?{normalized:tt.token,label:nt}:gv(tt.token,tt.parts,te);Ft&&(ht.set(tt.token,Ft.normalized),Be.set(tt.token,Ft.label),ft.add(tt.token))}}for(const tt of te.nameEntries)for(const nt of fe){const ve=ht.get(nt.token);if(ve){if(tt.normalized!==ve)continue;O.add(tt.normalized)}else{if(!bg(nt.parts,tt.parts))continue;Ye.add(tt.normalized)}if(d.has(nt.token)||d.set(nt.token,new Set),d.get(nt.token).add(tt.normalized),!ft.has(nt.token)){const ti=Be.get(nt.token);(!ti||tt.label.length<ti.length)&&Be.set(nt.token,tt.label)}}for(const tt of te.refEntries)for(const nt of fe)if(h_(nt.parts,tt.parts)&&(_t.add(tt.normalized),ge.has(nt.token)||ge.set(nt.token,new Set),ge.get(nt.token).add(tt.normalized),!ft.has(nt.token))){const ve=Be.get(nt.token);(!ve||tt.label.length<ve.length)&&Be.set(nt.token,tt.label)}for(const tt of fe){const nt=At.get(tt.token);if(nt){if(nt.names.length)for(const ve of nt.names)Ye.add(ve),d.has(tt.token)||d.set(tt.token,new Set),d.get(tt.token).add(ve);if(nt.refs.length)for(const ve of nt.refs)_t.add(ve),ge.has(tt.token)||ge.set(tt.token,new Set),ge.get(tt.token).add(ve)}}const ei=tt=>new Map(Array.from(tt.entries()).map(([nt,ve])=>[nt,Array.from(ve).sort((ti,mt)=>ti.localeCompare(mt))]));return{matchedNames:Array.from(Ye).sort((tt,nt)=>tt.localeCompare(nt)),strictMatchedNames:Array.from(O).sort((tt,nt)=>tt.localeCompare(nt)),matchedRefs:Array.from(_t).sort((tt,nt)=>tt.localeCompare(nt)),nameMatchesByToken:ei(d),refMatchesByToken:ei(ge),tokenLabels:Be}},og=(te,Ee)=>te!=="ottawa"?[]:ey(Ee)?[av]:[],lg=te=>te==="ottawa"?[rv]:[],n_=(te,Ee)=>te==="ottawa"&&ey(Ee),ug=(te,Ee,Ne=[],fe=[])=>{if(!te.length)return["==",1,0];if(!Ee){const tt=te.filter(Ot=>mg.has(Ot)&&!pg.has(Ot)),nt=te.filter(Ot=>pg.has(Ot)),ve=te.filter(Ot=>!mg.has(Ot)&&!pg.has(Ot)),ti=[],mt=Jp(tt,t_);mt&&ti.push(mt);const Ft=Jp(nt);return Ft&&ti.push(Ft),ve.length&&ti.push(["any",...ve.flatMap(Ot=>[qd(Ot,bf,yg),qd(Ot,Gd,l_)])]),Ne.length&&ti.push(...Ne),ti.length?["all",N_,...fe,["any",...ti]]:["==",1,0]}const Ye=[],{majorPopular:_t,residentialPopular:O,other:d}=U_(Ee.strictMatchedNames),{majorPopular:ge,residentialPopular:Be,other:ft}=U_(Ee.matchedNames),ht=Jp(_t,t_),At=Jp(O),ei=Jp(d);return ht&&Ye.push(ht),At&&Ye.push(At),ei&&Ye.push(ei),ge.length&&Ye.push(["all",t_,nm(ge)]),Be.length&&Ye.push(nm(Be)),ft.length&&Ye.push(nm(ft)),Ee.matchedRefs.length&&Ye.push(["in",Gd,["literal",Ee.matchedRefs]]),Ne.length&&Ye.push(...Ne),Ye.length?["all",N_,...fe,["any",...Ye]]:["==",1,0]},cg=(te,Ee,Ne=Xy,fe)=>{if(!te.length)return Ne;const Ye=ge=>fe?.[ge]??Wy[ge]??Hy(ge),_t=u_(te),O=[];if(_t&&O.push(_g,Ye(_t)),!Ee){const ge=te.flatMap(Be=>{const ft=Ye(Be);return[qd(Be,bf,yg),ft,qd(Be,Gd,l_),ft]});return["case",...O,...ge,Ne]}const d=te.flatMap(ge=>{const Be=Ye(ge),ft=Ee.nameMatchesByToken.get(ge),ht=Ee.refMatchesByToken.get(ge),At=[];return ft?.length&&At.push(nm(ft),Be),ht?.length&&At.push(["in",Gd,["literal",ht]],Be),At});return!d.length&&!O.length?Ne:["case",...O,...d,Ne]},yv=(te,Ee,Ne=1)=>{if(!te.length)return Ne;const fe=[];if(u_(te)&&fe.push(_g,1),!Ee){const _t=te.flatMap(O=>[qd(O,bf,yg),1,qd(O,Gd,l_),1]);return["case",...fe,..._t,Ne]}const Ye=te.flatMap(_t=>{const O=Ee.nameMatchesByToken.get(_t),d=Ee.refMatchesByToken.get(_t),ge=[];return O?.length&&ge.push(nm(O),1),d?.length&&ge.push(["in",Gd,["literal",d]],1),ge});return!Ye.length&&!fe.length?Ne:["case",...fe,...Ye,Ne]},vv=te=>{const Ee=[...te];for(let Ne=Ee.length-1;Ne>0;Ne-=1){const fe=Math.floor(Math.random()*(Ne+1));[Ee[Ne],Ee[fe]]=[Ee[fe],Ee[Ne]]}return Ee},hg=(te,Ee)=>Ee>0?`Final score: ${te}/${Ee}.`:"No selected roads visible. Pan or zoom for another prompt.",xv=te=>{const Ee=[],Ne=[],fe=new Set,Ye=new Set;for(const _t of te){const O=_t.properties??{},d=[O.name,O["name:en"],O.name_en];for(const ft of d){if(typeof ft!="string")continue;const ht=uc(ft);!ht||fe.has(ht)||(fe.add(ht),Ee.push(c_(ht)))}const ge=O.ref;if(typeof ge!="string")continue;const Be=uc(ge);!Be||Ye.has(Be)||(Ye.add(Be),Ne.push(vg(Be)))}return{namePartsList:Ee,refPartsList:Ne}},bv=(te,Ee,Ne,fe=am)=>{const Ye=te.queryRenderedFeatures({layers:[fe]});if(!Ye.length)return[];const{namePartsList:_t,refPartsList:O}=xv(Ye),d=[];for(const ge of Ne){if(Ee.has(ge))continue;const Be=xg(ge),ft=_t.some(At=>bg(Be,At)),ht=O.some(At=>h_(Be,At));(ft||ht)&&d.push(ge)}return d},wv=(te,Ee)=>{const Ne=te.properties??{},fe=[Ne.name,Ne["name:en"],Ne.name_en];for(const _t of fe){if(typeof _t!="string")continue;const O=uc(_t);if(O&&bg(Ee,c_(O)))return!0}const Ye=Ne.ref;if(typeof Ye=="string"){const _t=uc(Ye);if(_t&&h_(Ee,vg(_t)))return!0}return!1},ty=(te,Ee,Ne,fe,Ye,_t)=>{te.getSource(xf)||te.addSource(xf,{type:"vector",tiles:[Vy(Ee)],minzoom:em,maxzoom:Py,bounds:zo[Ee].tileBounds}),te.getLayer(am)||te.addLayer({id:am,type:"line",source:xf,"source-layer":Hg,filter:["has","highway"],paint:{"line-color":"#c1c7cbff","line-width":["interpolate",["linear"],["zoom"],4,.8,12,1.8,15,2.4],"line-opacity":0}}),te.getLayer(lc)||te.addLayer({id:lc,type:"line",source:xf,"source-layer":Hg,filter:Ne,paint:{"line-color":fe,"line-width":["interpolate",["linear"],["zoom"],4,1.6,8,2.6,12,4,15,6],"line-opacity":1}}),te.getLayer(xl)||te.addLayer({id:xl,type:"symbol",source:xf,"source-layer":Hg,filter:Ne,minzoom:em,layout:{"symbol-placement":"line","text-field":_t,"text-font":["Noto Sans Regular","Open Sans Regular"],"text-max-angle":80,"symbol-spacing":["interpolate",["linear"],["zoom"],em,60,10,150,14,250],"text-allow-overlap":!0,"text-ignore-placement":!0,"symbol-avoid-edges":!1,"text-size":["interpolate",["linear"],["zoom"],em,9,10,12,14,16],"text-max-width":8,"text-keep-upright":!0,"text-rotation-alignment":"map","text-pitch-alignment":"map"},paint:{"text-color":Ye,"text-halo-color":fe,"text-halo-width":2,"text-halo-blur":.5}})},Tv=(te,Ee,Ne,fe,Ye,_t)=>{te.getLayer(xl)&&te.removeLayer(xl),te.getLayer(lc)&&te.removeLayer(lc),te.getLayer(am)&&te.removeLayer(am),te.getSource(xf)&&te.removeSource(xf),ty(te,Ee,Ne,fe,Ye,_t)};function Sv(){const te=typeof window>"u"?dg:qy(window.location.pathname),Ee=zo[te].defaultTokens,Ne=typeof window>"u"?!1:Zy(window.location.pathname),fe=Lt.useRef(null),Ye=Lt.useRef(null),_t=Lt.useRef(te),[O,d]=Lt.useState(!1),[ge,Be]=Lt.useState(Ee),[ft,ht]=Lt.useState(Ee),[At,ei]=Lt.useState(null),[tt,nt]=Lt.useState(""),[ve,ti]=Lt.useState(!1),[mt,Ft]=Lt.useState(te),[Ot,jn]=Lt.useState(Ne),[Ht,Ct]=Lt.useState(null),[Pi,bn]=Lt.useState([]),[Yn,An]=Lt.useState([]),[Gi,Cn]=Lt.useState([]),[ma,Hi]=Lt.useState(null),[je,it]=Lt.useState([]),[Mt,St]=Lt.useState(0),[Wt,de]=Lt.useState(0),[Ze,ot]=Lt.useState("idle"),yt=Lt.useRef(null),xt=Lt.useRef([]),zt=Lt.useRef([]),Xt=Lt.useRef(Ee),ri=Lt.useRef(null),wi=Lt.useRef(!0),Xi=mt==="montreal"?a_:mt==="kingston"?Ny:null,Un=Lt.useMemo(()=>At?_v(At):null,[At]),ga=Un?.aliasTokenByValue??null,Ya=Lt.useMemo(()=>Un?i_(Un,ge,Xi):null,[Un,ge,Xi]),Ii=Lt.useMemo(()=>Un?i_(Un,ft,Xi):null,[Un,ft,Xi]),Qn=Lt.useMemo(()=>Un?i_(Un,Pi,Xi):null,[Un,Pi,Xi]),La=Lt.useMemo(()=>Ht?Ii?.tokenLabels.get(Ht)??Xi?.get(Ht)??Ht:null,[Ht,Ii,Xi]),$i=Lt.useMemo(()=>{if(!Yn.length&&!Gi.length)return null;const W={};return Yn.forEach(he=>{W[he]=Yy}),Gi.forEach(he=>{W[he]=Qy}),W},[Yn,Gi]),Qa=Lt.useMemo(()=>{const W=Ya?.tokenLabels;return[...ge].map(he=>({token:he,label:W?.get(he)??Xi?.get(he)??he})).sort((he,we)=>{const Ie=V_(he.token,he.label),et=V_(we.token,we.label);return Ie!==et?Ie?1:-1:he.label.localeCompare(we.label)})},[ge,Ya,Xi]);Lt.useEffect(()=>{if(typeof window>"u")return;const W=Z_(),he=Uy[mt],we=`${W}${he}`,Ie=Ot?`${im(we)}${o_}`:we,et=new URL(window.location.href);im(et.pathname)!==im(Ie)&&(et.pathname=Ie,window.history.replaceState(window.history.state,"",et.toString()))},[mt,Ot]),Lt.useEffect(()=>{const W=zo[mt].defaultTokens;Be(W),ht(W),nt(""),ti(!1);const he=wi.current?Ne:!1;jn(he),Ct(null),bn([]),An([]),Cn([]),Hi(null),it([]),St(0),de(0),ot("idle"),Xt.current=W,xt.current=[],zt.current=[],yt.current=null,ri.current&&(clearTimeout(ri.current),ri.current=null),wi.current&&(wi.current=!1)},[mt]);const Br=Lt.useCallback(W=>{W.preventDefault();const he=tt.split(/[,\n]/).map(we=>uc(we)).filter(Boolean).map(we=>ga?.get(we)??we);he.length&&(Be(we=>{const Ie=new Set(we);return he.forEach(et=>Ie.add(et)),Array.from(Ie)}),nt(""))},[tt,ga]),es=Lt.useCallback(W=>{Be(he=>he.filter(we=>we!==W))},[]),Gn=Lt.useCallback(()=>{ri.current&&(clearTimeout(ri.current),ri.current=null)},[]),Ba=Lt.useCallback(W=>{Gn(),ot(W?"correct":"incorrect"),ri.current=setTimeout(()=>{ot("idle"),ri.current=null},2e3)},[Gn]),Wa=Lt.useCallback((W,he)=>{const we=Ye.current;if(!we||!O||!he.length)return[];const Ie=bv(we,new Set(W),he,lc);return Ie.length?vv(Ie):[]},[O]),On=Lt.useCallback(()=>{if(!Ht)return;Gn(),ot("idle");const W=[...zt.current,Ht],[he,...we]=W;zt.current=we,it(we),Ct(he??null),Hi(he?null:hg(Mt,Wt))},[Gn,Mt,Wt,Ht]),ua=Lt.useCallback(()=>{if(Gn(),ot("idle"),Ot){jn(!1),Ct(null),bn([]),An([]),Cn([]),Hi(null),it([]),St(0),de(0),xt.current=[],zt.current=[];return}const W=[...ge];Xt.current=W,ht(W),jn(!0),bn([]),An([]),Cn([]);const he=Wa([],W);Ct(he[0]??null),it(he.slice(1)),xt.current=[],zt.current=he.slice(1),Hi(he.length?null:O?hg(0,0):"Map is still loading. Try again in a moment."),St(0),de(0)},[ge,Wa,Gn,Ot,O]);Lt.useEffect(()=>{let W=!1;return ei(null),(async()=>{try{const we=await fetch(jy(mt));if(!we.ok)throw new Error(`Road catalog request failed: ${we.status}`);const Ie=await we.json();if(W)return;ei(Ie)}catch(we){if(W)return;console.error("Road catalog error:",we)}})(),()=>{W=!0}},[mt]),Lt.useEffect(()=>{if(!fe.current||Ye.current)return;const W=new Zg.Map({container:fe.current,style:Dy,center:zo[te].center,zoom:zo[te].zoom,maxBounds:zo[te].mapBounds,minZoom:em,attributionControl:!1});Ye.current=W,W.addControl(new Zg.NavigationControl,"top-right"),W.addControl(new Zg.AttributionControl({compact:!0}));const he=()=>{d(!0);const we=cg(Ee),Ie=og(te,Ee),et=lg(te),pt=ug(Ee,void 0,Ie,et),Et=e_(te,{useChaudiereBridgeOverride:n_(te,Ee)});ty(W,te,pt,we,Jg(we),Et),_t.current=te};return W.on("load",he),W.on("error",we=>{console.error("Map Error:",we)}),()=>{W.remove(),Ye.current=null}},[]),Lt.useEffect(()=>{const W=Ye.current;if(!W||!O||_t.current===mt)return;const he=zo[mt].defaultTokens,we=cg(he),Ie=og(mt,he),et=lg(mt),pt=ug(he,void 0,Ie,et),Et=e_(mt,{useChaudiereBridgeOverride:n_(mt,he)});Tv(W,mt,pt,we,Jg(we),Et),_t.current=mt},[mt,O]),Lt.useEffect(()=>{const W=Ye.current;if(!W||!O)return;const he=Ot?ft:ge,we=Ot?Ii:Ya,Ie=Ot?Pi:ge,et=Ot?Qn:Ya,pt=og(mt,he),Et=lg(mt),li=ug(he,we,pt,Et),$t=Ot?cg(Pi,Qn,$y,$i??void 0):cg(ge,Ya),be=og(mt,Ie),fi=lg(mt),Ki=Ot?ug(Ie,et,be,fi):li,Pt=Jg($t),ni=Ot?yv(Ie,et,0):1,Vi=$t,Nt=Ot?["*",ni,2]:2,Ji=e_(mt,{useChaudiereBridgeOverride:n_(mt,Ie)});W.getLayer(lc)&&(W.setFilter(lc,li),W.setPaintProperty(lc,"line-color",$t)),W.getLayer(xl)&&(W.setFilter(xl,Ki),W.setLayoutProperty(xl,"text-field",Ji),W.setPaintProperty(xl,"text-color",Pt),W.setPaintProperty(xl,"text-halo-color",Vi),W.setPaintProperty(xl,"text-opacity",ni),W.setPaintProperty(xl,"text-halo-width",Nt))},[ge,mt,Ot,O,Qn,Pi,$i,Ii,ft,Ya]);const ye=Lt.useCallback(()=>{if(!Ye.current||!O||!Ot||Ht)return;if(je.length){const[we,...Ie]=je;Ct(we),it(Ie),Hi(null);return}const he=Wa(Pi,Xt.current);if(!he.length){Hi(hg(Mt,Wt));return}Ct(he[0]),it(he.slice(1)),Hi(null)},[Wa,Ot,O,Mt,Pi,Wt,je,Ht]);Lt.useEffect(()=>{ye()},[ye]),Lt.useEffect(()=>{Xt.current=ft},[ft]),Lt.useEffect(()=>{xt.current=Pi},[Pi]),Lt.useEffect(()=>{zt.current=je},[je]),Lt.useEffect(()=>{yt.current=null},[Ht]),Lt.useEffect(()=>()=>{Gn()},[Gn]),Lt.useEffect(()=>{const W=Ye.current;if(!(!W||!O||!Ot))return W.on("moveend",ye),()=>{W.off("moveend",ye)}},[Ot,O,ye]),Lt.useEffect(()=>{const W=Ye.current;if(!W||!O||!Ot||!Ht)return;const he=xg(Ht),we=Ie=>{const{x:pt,y:Et}=Ie.point,li=[[pt-10,Et-10],[pt+10,Et+10]],$t=W.queryRenderedFeatures(li,{layers:[lc]});if(!$t.length||xt.current.includes(Ht)||yt.current===Ht)return;yt.current=Ht;const be=$t.some(Nt=>wv(Nt,he)),fi=Wt+1,Ki=Mt+(be?1:0);Ba(be),de(Nt=>Nt+1),be?(St(Nt=>Nt+1),An(Nt=>Nt.includes(Ht)?Nt:[...Nt,Ht])):Cn(Nt=>Nt.includes(Ht)?Nt:[...Nt,Ht]);const Pt=[...xt.current,Ht];xt.current=Pt,bn(Pt);let ni=null,Vi=zt.current;if(Vi.length)[ni,...Vi]=Vi;else{const Nt=Wa(Pt,Xt.current);Nt.length&&([ni,...Vi]=Nt)}zt.current=Vi,it(Vi),Ct(ni),Hi(ni?null:hg(Ki,fi))};return W.on("click",we),()=>{W.off("click",we)}},[Wa,Ot,O,Mt,Wt,Ht,Ba]),Lt.useEffect(()=>{const W=Ye.current;if(!W)return;const{center:he,zoom:we,mapBounds:Ie}=zo[mt];W.setMaxBounds(Ie),W.flyTo({center:he,zoom:we})},[mt]);const j=zo[mt],V=`${Mt}/${Wt}`,H=!Ht&&Wt>0&&ma?.startsWith("Final score")===!0,oe=H?"Final score":"Find",ue=Ht||H?"ready":"empty",Me=La??(H?V:ma??"Pan or zoom to load a prompt."),_e=Ze==="correct"?"Correct!":Ze==="incorrect"?"Incorrect.":"Score";return oi.jsxs("div",{className:"app-shell",children:[oi.jsx("div",{ref:fe,className:"map-canvas"}),oi.jsx("aside",{className:"control-panel",children:Ot?oi.jsxs("div",{className:"quiz-only",children:[oi.jsxs("div",{className:"quiz-panel","data-state":ue,children:[oi.jsx("span",{className:"quiz-label",children:oe}),oi.jsx("span",{className:"quiz-value",children:Me})]}),!H&&oi.jsxs("div",{className:"quiz-score","data-state":Ze,children:[oi.jsx("span",{className:"quiz-score-label",children:_e}),oi.jsx("span",{className:"quiz-score-value",children:V})]}),oi.jsxs("div",{className:"quiz-controls",children:[oi.jsx("button",{type:"button",className:"quiz-skip",onClick:On,disabled:!Ht,children:"Skip Road"}),oi.jsx("button",{type:"button",className:"quiz-end",onClick:ua,children:"End Quiz"})]})]}):oi.jsxs(oi.Fragment,{children:[oi.jsxs("div",{className:"panel-header",children:[oi.jsx("p",{className:"eyebrow",children:"Road Learning Tool"}),oi.jsx("h1",{children:j.label}),oi.jsx("p",{className:"subhead",children:j.tagline})]}),oi.jsxs("div",{className:"panel-body",children:[oi.jsxs("label",{className:"field",children:[oi.jsx("span",{children:"City"}),oi.jsx("select",{value:mt,onChange:W=>Ft(W.target.value),children:Object.entries(zo).map(([W,he])=>oi.jsx("option",{value:W,children:he.selectLabel??he.label},W))})]}),oi.jsx("button",{type:"button",className:"edit-roads-toggle","data-open":ve?"true":"false",onClick:()=>ti(W=>!W),children:ve?"Close Road Editor":"Edit Roads"}),ve&&oi.jsxs("div",{className:"road-editor",children:[oi.jsxs("div",{className:"road-editor-header",children:[oi.jsx("span",{children:"Selected Roads"}),oi.jsxs("span",{children:[Qa.length," shown"]})]}),oi.jsx("ul",{className:"road-list",children:Qa.length===0?oi.jsx("li",{className:"road-empty",children:"No roads selected yet. Add a road name or ref below."}):Qa.map(W=>oi.jsxs("li",{className:"road-item",children:[oi.jsx("span",{className:"road-name",children:W.label}),oi.jsx("button",{type:"button",className:"road-remove",onClick:()=>es(W.token),"aria-label":`Remove ${W.label}`,children:"X"})]},W.token))}),oi.jsxs("form",{className:"road-input",onSubmit:Br,children:[oi.jsx("input",{type:"text",placeholder:"Add road name or ref",value:tt,onChange:W=>nt(W.target.value)}),oi.jsx("button",{type:"submit",className:"road-add",disabled:!tt.trim(),children:"Add"})]}),oi.jsx("p",{className:"note",children:'Example inputs: "Bank", "Bank Street", or "Bank, Corkstown, Queen".'})]}),oi.jsx("button",{type:"button",className:"quiz-toggle","data-active":Ot?"true":"false",onClick:ua,children:"Start Quiz"})]})]})})]})}function Mv(){return oi.jsx(Sv,{})}Ey.createRoot(document.getElementById("root")).render(oi.jsx(Lt.StrictMode,{children:oi.jsx(Mv,{})}));
